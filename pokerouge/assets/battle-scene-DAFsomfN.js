var Vp=Object.defineProperty;var Fg=(T,e,t)=>e in T?Vp(T,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):T[e]=t;var h=(T,e)=>Vp(T,"name",{value:e,configurable:!0});var Gi=(T,e,t)=>Fg(T,typeof e!="symbol"?e+"":e,t);import{F as dt,C as Ve,B as de,T as ls,a as B,b as Xe,P as De,M as He,g as $t,r as Ke,G as fe,c as Hp,d as Rr,e as Pt,O as ie,f as Je,h as Ug,i as Vg,j as zt,k as it,S as ye,l as Pn,m as Cs,n as Ss,o as ft,p as Hg,q as Wg,U as x,t as Rn,s as ks,u as Br,v as Gg,w as Hf,x as yt,y as Es,A as Tt,z as nt,D as lt,E as Us,H as Lh,I as Yg,J as ke,K as ve,L as ir,N as ei,Q as Kg,R as zg,V as Ns,W as jg,X as $g,Y as cs,Z as Xg,_ as wi,$ as ln,a0 as Wf,a1 as qg,a2 as Fe,a3 as ua,a4 as es,a5 as Gf,a6 as Ut,a7 as ts,a8 as Zg,a9 as ct,aa as li,ab as Qg,ac as Wp,ad as Gp,ae as Re,af as ti,ag as Jg,ah as gt,ai as Ie,aj as ys,ak as Rt,al as st,am as da,an as pa,ao as Dh,ap as $e,aq as Bn,ar as bi,as as em,at as ms,au as nr,av as Ze,aw as ge,ax as Xt,ay as Ce,az as P,aA as O,aB as fs,aC as Vi,aD as It,aE as le,aF as qt,aG as Dt,aH as sn,aI as nn,aJ as Fh,aK as Mi,aL as F,aM as ki,aN as Et,aO as Yp,aP as Me,aQ as Ds,aR as tm,aS as xs,aT as ns,aU as Lr,aV as Ni,aW as sm,aX as im,aY as nm,aZ as am,a_ as rm,a$ as Yf,b0 as Kf,b1 as om,b2 as ar,b3 as lm,b4 as zf,b5 as jf,b6 as $f,b7 as ss,b8 as hm,b9 as pi,ba as ur,bb as cm,bc as Yi,bd as dr,be as Xf,bf as Nt,bg as um,bh as rr,bi as Fs,bj as We,bk as qf,bl as pr,bm as Dr,bn as Zf,bo as dm,bp as pm,bq as Qf,br as fm,bs as gm,bt as mm,bu as ym,bv as oa,bw as Tm,bx as Cm,by as Sm,bz as at,bA as Qt,bB as xt,bC as hi,bD as an,bE as ae,bF as Em,bG as Ii,bH as ze,bI as Vt,bJ as fr,bK as Uh,bL as Vh,bM as Jf,bN as bm,bO as Fr,bP as Hh,bQ as Ts,bR as Ur,bS as vi,bT as Im,bU as vm,bV as Kp,bW as ws,bX as Hn,bY as fa,bZ as Ls,b_ as Wn,b$ as Om,c0 as Ki,c1 as Am,c2 as Oi,c3 as xm,c4 as _m,c5 as wm,c6 as Ai,c7 as zp,c8 as Mm,c9 as eg,ca as Vr,cb as km,cc as Nm,cd as Pm,ce as Rm,cf as Bm,cg as Lm,ch as tg,ci as Dm,cj as jp,ck as Fm,cl as Um,cm as Vm,cn as Hm,co as sg,cp as Wm,cq as Gm,cr as Ym,cs as ig,ct as Km,cu as zm,cv as jm,cw as mi,cx as ng,cy as $m,cz as Xm,cA as qm,cB as Zm,cC as ag,cD as $p,cE as rg,cF as Ln,cG as Gn,cH as Qm,cI as ga,cJ as Jm,cK as Vs,cL as si,cM as ey,cN as Hr,cO as og,cP as Wr,cQ as or,cR as la,cS as ty,cT as sy,cU as iy,cV as gr,cW as lg,cX as Xp,cY as ny,cZ as ay,c_ as ry,c$ as oy,d0 as ly,d1 as ma,d2 as xi,d3 as hg,d4 as cg,d5 as ug,d6 as hy,d7 as cy,d8 as qp,d9 as uy,da as dy,db as dg,dc as py,dd as fy,de as Zp,df as gy,dg as pg,dh as Be,di as Yt,dj as my,dk as yy,dl as Ty,dm as hn,dn as Pi,dp as Cy,dq as Sy,dr as Ey,ds as by,dt as Iy,du as vy,dv as Oy,dw as Ay,dx as xy,dy as _y,dz as wy,dA as My,dB as ky,dC as Js,dD as Qp,dE as Ny,dF as Py,dG as Kt,dH as os,dI as Ms,dJ as ya,dK as Ht,dL as fg,dM as mr,dN as Bt,dO as ht,dP as Ta,dQ as fi,dR as hs,dS as Gr,dT as Jp,dU as _t,dV as cn,dW as vt,dX as un,dY as dn,dZ as _i,d_ as gg,d$ as Wh,e0 as Hs,e1 as mg,e2 as Ca,e3 as ci,e4 as is,e5 as yg,e6 as us,e7 as Gh,e8 as lr,e9 as Tg,ea as Ft,eb as Cg,ec as Sg,ed as Eg,ee as Ry,ef as bg,eg as Yh,eh as Si,ei as ai,ej as ef,ek as By,el as Ly,em as tf,en as Qi,eo as yr,ep as kt,eq as Ks,er as zi,es as Tr,et as Dy,eu as ji,ev as sf,ew as Fy,ex as Ji,ey as Ig,ez as Yr,eA as Uy,eB as Mt,eC as nf,eD as vg,eE as zs,eF as Vy,eG as Hy,eH as Cr,eI as Og,eJ as Wy,eK as Gy,eL as oi,eM as Yy,eN as af,eO as rf,eP as Ky,eQ as zy,eR as jy,eS as ri,eT as $i,eU as $y,eV as Xy,eW as qy,eX as Zy,eY as Yn,eZ as Qy,e_ as Is,e$ as Sr,f0 as St,f1 as Jy,f2 as eT,f3 as tT,f4 as sT,f5 as iT,f6 as nT,f7 as aT,f8 as rT,f9 as oT,fa as lT,fb as hT,fc as cT,fd as uT,fe as of,ff as Er,fg as Kn,fh as lf,fi as dT,fj as pT,fk as zn,fl as fT,fm as gT,fn as mT,fo as yT,fp as TT,fq as CT,fr as ST,fs as ET,ft as hf,fu as cf,fv as br,fw as bT,fx as IT,fy as jn,fz as vT,fA as OT,fB as AT,fC as xT,fD as _T,fE as wT,fF as MT,fG as kT,fH as uf,fI as NT,fJ as PT,fK as RT,fL as BT,fM as LT,fN as DT,fO as FT,fP as js,fQ as df,fR as UT,fS as VT,fT as HT,fU as Ir,fV as WT,fW as GT,fX as pf}from"./loading-scene-B6I9BHmm.js";import{w as s,i as f,x as b,P as Jt,y as YT,B as Ag,z as KT,H as bt,J as Ri,K as zT,c as $n,g as jT,L as $T}from"./touch-controls-Cqu2p6dm.js";import{R as XT,v as xg,c as qT}from"./RoundRectangle-CXNoaaeq.js";const ff=!1,gf=!1,pn=!1,mf={[Ve.TOWN_YOUNGSTER]:new dt().setBattleType(de.TRAINER).setGetTrainerFunc(()=>new ls(B.YOUNGSTER,Ke(2)?Xe.FEMALE:Xe.DEFAULT)),[Ve.RIVAL_1]:new dt().setBattleType(de.TRAINER).setGetTrainerFunc(()=>new ls(B.RIVAL,s.gameData.gender===De.MALE?Xe.FEMALE:Xe.DEFAULT)),[Ve.RIVAL_2]:new dt().setBattleType(de.TRAINER).setGetTrainerFunc(()=>new ls(B.RIVAL_2,s.gameData.gender===De.MALE?Xe.FEMALE:Xe.DEFAULT)).setCustomModifierRewards({guaranteedModifierTiers:[He.ULTRA,He.GREAT,He.GREAT],allowLuckUpgrades:!1}),[Ve.EVIL_GRUNT_1]:new dt().setBattleType(de.TRAINER).setGetTrainerFunc($t([B.ROCKET_GRUNT,B.MAGMA_GRUNT,B.AQUA_GRUNT,B.GALACTIC_GRUNT,B.PLASMA_GRUNT,B.FLARE_GRUNT,B.AETHER_GRUNT,B.SKULL_GRUNT,B.MACRO_GRUNT,B.STAR_GRUNT],!0)),[Ve.RIVAL_3]:new dt().setBattleType(de.TRAINER).setGetTrainerFunc(()=>new ls(B.RIVAL_3,s.gameData.gender===De.MALE?Xe.FEMALE:Xe.DEFAULT)).setCustomModifierRewards({guaranteedModifierTiers:[He.ULTRA,He.ULTRA,He.GREAT,He.GREAT],allowLuckUpgrades:!1}),[Ve.EVIL_GRUNT_2]:new dt().setBattleType(de.TRAINER).setSeedOffsetWave(Ve.EVIL_GRUNT_1).setGetTrainerFunc($t([B.ROCKET_GRUNT,B.MAGMA_GRUNT,B.AQUA_GRUNT,B.GALACTIC_GRUNT,B.PLASMA_GRUNT,B.FLARE_GRUNT,B.AETHER_GRUNT,B.SKULL_GRUNT,B.MACRO_GRUNT,B.STAR_GRUNT],!0)),[Ve.EVIL_GRUNT_3]:new dt().setBattleType(de.TRAINER).setSeedOffsetWave(Ve.EVIL_GRUNT_1).setGetTrainerFunc($t([B.ROCKET_GRUNT,B.MAGMA_GRUNT,B.AQUA_GRUNT,B.GALACTIC_GRUNT,B.PLASMA_GRUNT,B.FLARE_GRUNT,B.AETHER_GRUNT,B.SKULL_GRUNT,B.MACRO_GRUNT,B.STAR_GRUNT],!0)),[Ve.EVIL_ADMIN_1]:new dt().setBattleType(de.TRAINER).setSeedOffsetWave(Ve.EVIL_GRUNT_1).setGetTrainerFunc($t([B.PETREL,[B.TABITHA,B.COURTNEY],[B.MATT,B.SHELLY],[B.JUPITER,B.MARS,B.SATURN],B.COLRESS,B.BRYONY,B.FABA,B.PLUMERIA,B.OLEANA,[B.GIACOMO,B.MELA,B.ATTICUS,B.ORTEGA,B.ERI]],!0)),[Ve.RIVAL_4]:new dt().setBattleType(de.TRAINER).setGetTrainerFunc(()=>new ls(B.RIVAL_4,s.gameData.gender===De.MALE?Xe.FEMALE:Xe.DEFAULT)).setCustomModifierRewards({guaranteedModifierTiers:[He.ULTRA,He.ULTRA,He.ULTRA,He.ULTRA],allowLuckUpgrades:!1}),[Ve.EVIL_GRUNT_4]:new dt().setBattleType(de.TRAINER).setSeedOffsetWave(Ve.EVIL_GRUNT_1).setGetTrainerFunc($t([B.ROCKET_GRUNT,B.MAGMA_GRUNT,B.AQUA_GRUNT,B.GALACTIC_GRUNT,B.PLASMA_GRUNT,B.FLARE_GRUNT,B.AETHER_GRUNT,B.SKULL_GRUNT,B.MACRO_GRUNT,B.STAR_GRUNT],!0)),[Ve.EVIL_ADMIN_2]:new dt().setBattleType(de.TRAINER).setSeedOffsetWave(Ve.EVIL_GRUNT_1).setGetTrainerFunc($t([B.PROTON,[B.TABITHA,B.COURTNEY],[B.MATT,B.SHELLY],[B.JUPITER,B.MARS,B.SATURN],B.ZINZOLIN,[B.BRYONY,B.XEROSIC],B.FABA,B.PLUMERIA,B.OLEANA,[B.GIACOMO,B.MELA,B.ATTICUS,B.ORTEGA,B.ERI]],!0,1)),[Ve.EVIL_BOSS_1]:new dt().setBattleType(de.TRAINER).setSeedOffsetWave(Ve.EVIL_GRUNT_1).setGetTrainerFunc($t([B.ROCKET_BOSS_GIOVANNI_1,B.MAXIE,B.ARCHIE,B.CYRUS,B.GHETSIS,B.LYSANDRE,B.LUSAMINE,B.GUZMA,B.ROSE,B.PENNY])).setCustomModifierRewards({guaranteedModifierTiers:[He.ROGUE,He.ROGUE,He.ULTRA,He.ULTRA,He.ULTRA],allowLuckUpgrades:!1}),[Ve.RIVAL_5]:new dt().setBattleType(de.TRAINER).setGetTrainerFunc(()=>new ls(B.RIVAL_5,s.gameData.gender===De.MALE?Xe.FEMALE:Xe.DEFAULT)).setCustomModifierRewards({guaranteedModifierTiers:[He.ROGUE,He.ROGUE,He.ROGUE,He.ULTRA,He.ULTRA],allowLuckUpgrades:!1}),[Ve.EVIL_ADMIN_3]:new dt().setBattleType(de.TRAINER).setSeedOffsetWave(Ve.EVIL_GRUNT_1).setGetTrainerFunc($t([[B.ARCHER,B.ARIANA],[B.TABITHA,B.COURTNEY],[B.MATT,B.SHELLY],[B.JUPITER,B.MARS,B.SATURN],B.COLRESS,B.XEROSIC,B.FABA,B.PLUMERIA,B.OLEANA,[B.GIACOMO,B.MELA,B.ATTICUS,B.ORTEGA,B.ERI]],!0,2)),[Ve.EVIL_BOSS_2]:new dt().setBattleType(de.TRAINER).setSeedOffsetWave(Ve.EVIL_GRUNT_1).setGetTrainerFunc($t([B.ROCKET_BOSS_GIOVANNI_2,B.MAXIE_2,B.ARCHIE_2,B.CYRUS_2,B.GHETSIS_2,B.LYSANDRE_2,B.LUSAMINE_2,B.GUZMA_2,B.ROSE_2,B.PENNY_2])).setCustomModifierRewards({guaranteedModifierTiers:[He.ROGUE,He.ROGUE,He.ULTRA,He.ULTRA,He.ULTRA,He.ULTRA],allowLuckUpgrades:!1}),[Ve.ELITE_FOUR_1]:new dt().setBattleType(de.TRAINER).setGetTrainerFunc($t([B.LORELEI,B.WILL,B.SIDNEY,B.AARON,B.SHAUNTAL,B.MALVA,[B.HALA,B.MOLAYNE],B.MARNIE_ELITE,B.RIKA,B.CRISPIN])),[Ve.ELITE_FOUR_2]:new dt().setBattleType(de.TRAINER).setSeedOffsetWave(Ve.ELITE_FOUR_1).setGetTrainerFunc($t([B.BRUNO,B.KOGA,B.PHOEBE,B.BERTHA,B.MARSHAL,B.SIEBOLD,B.OLIVIA,B.NESSA_ELITE,B.POPPY,B.AMARYS])),[Ve.ELITE_FOUR_3]:new dt().setBattleType(de.TRAINER).setSeedOffsetWave(Ve.ELITE_FOUR_1).setGetTrainerFunc($t([B.AGATHA,B.BRUNO,B.GLACIA,B.FLINT,B.GRIMSLEY,B.WIKSTROM,B.ACEROLA,[B.BEA_ELITE,B.ALLISTER_ELITE],B.LARRY_ELITE,B.LACEY])),[Ve.ELITE_FOUR_4]:new dt().setBattleType(de.TRAINER).setSeedOffsetWave(Ve.ELITE_FOUR_1).setGetTrainerFunc($t([B.LANCE,B.KAREN,B.DRAKE,B.LUCIAN,B.CAITLIN,B.DRASNA,B.KAHILI,B.RAIHAN_ELITE,B.HASSEL,B.DRAYTON])),[Ve.CHAMPION]:new dt().setBattleType(de.TRAINER).setSeedOffsetWave(Ve.ELITE_FOUR_1).setGetTrainerFunc($t([B.BLUE,[B.RED,B.LANCE_CHAMPION],[B.STEVEN,B.WALLACE],B.CYNTHIA,[B.ALDER,B.IRIS],B.DIANTHA,[B.KUKUI,B.HAU],[B.LEON,B.MUSTARD],[B.GEETA,B.NEMONA],B.KIERAN])),[Ve.RIVAL_6]:new dt().setBattleType(de.TRAINER).setGetTrainerFunc(()=>new ls(B.RIVAL_6,s.gameData.gender===De.MALE?Xe.FEMALE:Xe.DEFAULT)).setCustomModifierRewards({guaranteedModifierTiers:[He.ROGUE,He.ROGUE,He.ULTRA,He.ULTRA,He.GREAT,He.GREAT],allowLuckUpgrades:!1})},Qh=class Qh{modeId;isClassic;isEndless;isDaily;hasTrainers;hasNoShop;hasShortBiomes;hasRandomBiomes;hasRandomBosses;isSplicedOnly;isChallenge;challenges;battleConfig;hasMysteryEncounters;minMysteryEncounterWave;maxMysteryEncounterWave;constructor(e,t,i){this.modeId=e,this.challenges=[],Object.assign(this,t),this.isChallenge&&(this.challenges=Hp.map(n=>Rr(n))),this.battleConfig=i||{}}setChallengeValue(e,t){this.isChallenge||(this.isChallenge=!0,this.challenges=Hp.map(i=>Rr(i))),this.challenges.filter(i=>i.id===e).map(i=>i.value=t)}hasChallenge(e){return this.challenges.some(t=>t.id===e&&t.value!==0)}hasAnyChallenges(){return this.challenges.length>0}isFreshStartChallenge(){return this.hasChallenge(Pt.FRESH_START)}isFullFreshStartChallenge(){for(const e of this.challenges)if(e.id===Pt.FRESH_START&&e.value===1)return!0;return!1}getStartingLevel(){if(ie.STARTING_LEVEL_OVERRIDE>0)return ie.STARTING_LEVEL_OVERRIDE;switch(this.modeId){case fe.DAILY:return 20;default:return 5}}getStartingMoney(){return ie.STARTING_MONEY_OVERRIDE||1e3}getStartingBiome(){if(ie.STARTING_BIOME_OVERRIDE!=null)return ie.STARTING_BIOME_OVERRIDE;switch(this.modeId){case fe.DAILY:return Ug();default:return Je.TOWN}}getWaveForDifficulty(e,t=!1){switch(this.modeId){case fe.DAILY:return e+30+(t?0:Math.floor(e/5));default:return e}}isWaveTrainer(e,t){if(this.isDaily)return e%10===5||!(e%10)&&e>10&&!this.isWaveFinal(e);if(e%30===(s.offsetGym?0:20)&&!this.isWaveFinal(e))return!0;if(e%10!==1&&e%10){const i=t.getTrainerChance();let n=!0;if(i){const a=Math.floor(e/10)*10;for(let r=Math.max(e-2,a+2);r<=Math.min(e+2,a+9);r++)if(r!==e){if(r%30===(s.offsetGym?0:20)||this.isFixedBattle(r)){n=!1;break}if(r<e&&(s.executeWithSeedOffset(()=>{const o=t.getTrainerChance();Ke(o)||(n=!1)},r),!n))break}}return!!(n&&i&&!Ke(i))}return!1}isTrainerBoss(e,t,i){switch(this.modeId){case fe.DAILY:return e>10&&e<50&&!(e%10);default:return e%30===(i?0:20)&&(t!==Je.END||this.isClassic||this.isWaveFinal(e))}}getOverrideSpecies(e){if(this.isDaily&&this.isWaveFinal(e)){const t=Vg(s.seed);if(t!=null)return zt(t.speciesId);const i=it.filter(n=>(n.subLegendary||n.legendary||n.mythical)&&n.baseTotal>=600&&n.speciesId!==ye.ETERNATUS&&n.speciesId!==ye.ARCEUS);return Pn(i)}return null}isWaveFinal(e,t=this.modeId){switch(t){case fe.CLASSIC:case fe.CHALLENGE:return e===200;case fe.ENDLESS:case fe.SPLICED_ENDLESS:return!(e%250);case fe.DAILY:return e===50}}isBoss(e){return e%10===0}isBattleClassicFinalBoss(e){return(this.modeId===fe.CLASSIC||this.modeId===fe.CHALLENGE)&&this.isWaveFinal(e)}isEndlessBoss(e){return e%50===0&&(this.modeId===fe.ENDLESS||this.modeId===fe.SPLICED_ENDLESS)}isEndlessMinorBoss(e){return e%250===0&&(this.modeId===fe.ENDLESS||this.modeId===fe.SPLICED_ENDLESS)}isEndlessMajorBoss(e){return e%1e3===0&&(this.modeId===fe.ENDLESS||this.modeId===fe.SPLICED_ENDLESS)}isFixedBattle(e){const t=new dt;return this.battleConfig.hasOwnProperty(e)||Cs(Ss.FIXED_BATTLES,e,t)}getFixedBattle(e){const t=new dt;return Cs(Ss.FIXED_BATTLES,e,t)?t:this.battleConfig[e]}getShopStatus(){const e=new ft(!this.hasNoShop);return Cs(Ss.SHOP,e),e.value}getClearScoreBonus(){switch(this.modeId){case fe.CLASSIC:case fe.CHALLENGE:return 5e3;case fe.DAILY:return 2500;default:return 0}}getEnemyModifierChance(e){switch(this.modeId){case fe.CLASSIC:case fe.CHALLENGE:case fe.DAILY:return e?6:18;case fe.ENDLESS:case fe.SPLICED_ENDLESS:return e?4:12}}getName(){switch(this.modeId){case fe.CLASSIC:return f.t("gameMode:classic");case fe.ENDLESS:return f.t("gameMode:endless");case fe.SPLICED_ENDLESS:return f.t("gameMode:endlessSpliced");case fe.DAILY:return f.t("gameMode:dailyRun");case fe.CHALLENGE:return f.t("gameMode:challenge")}}getMysteryEncounterLegalWaves(){switch(this.modeId){case fe.CLASSIC:return Wg;case fe.CHALLENGE:return Hg;default:return[0,0]}}static getModeName(e){switch(e){case fe.CLASSIC:return f.t("gameMode:classic");case fe.ENDLESS:return f.t("gameMode:endless");case fe.SPLICED_ENDLESS:return f.t("gameMode:endlessSpliced");case fe.DAILY:return f.t("gameMode:dailyRun");case fe.CHALLENGE:return f.t("gameMode:challenge")}}};h(Qh,"GameMode");let Lt=Qh;function Sa(T){switch(T){case fe.CLASSIC:return new Lt(fe.CLASSIC,{isClassic:!0,hasTrainers:!0,hasMysteryEncounters:!0},mf);case fe.ENDLESS:return new Lt(fe.ENDLESS,{isEndless:!0,hasShortBiomes:!0,hasRandomBosses:!0});case fe.SPLICED_ENDLESS:return new Lt(fe.SPLICED_ENDLESS,{isEndless:!0,hasShortBiomes:!0,hasRandomBosses:!0,isSplicedOnly:!0});case fe.DAILY:return new Lt(fe.DAILY,{isDaily:!0,hasTrainers:!0,hasNoShop:!0});case fe.CHALLENGE:return new Lt(fe.CHALLENGE,{isClassic:!0,hasTrainers:!0,isChallenge:!0,hasMysteryEncounters:!0},mf)}}h(Sa,"getGameMode");var Le=(T=>(T[T.GAMEPAD=0]="GAMEPAD",T[T.KEYBOARD=1]="KEYBOARD",T))(Le||{}),re=(T=>(T.Button_Up="BUTTON_UP",T.Alt_Button_Up="ALT_BUTTON_UP",T.Button_Down="BUTTON_DOWN",T.Alt_Button_Down="ALT_BUTTON_DOWN",T.Button_Left="BUTTON_LEFT",T.Alt_Button_Left="ALT_BUTTON_LEFT",T.Button_Right="BUTTON_RIGHT",T.Alt_Button_Right="ALT_BUTTON_RIGHT",T.Button_Action="BUTTON_ACTION",T.Alt_Button_Action="ALT_BUTTON_ACTION",T.Button_Cancel="BUTTON_CANCEL",T.Alt_Button_Cancel="ALT_BUTTON_CANCEL",T.Button_Menu="BUTTON_MENU",T.Alt_Button_Menu="ALT_BUTTON_MENU",T.Button_Stats="BUTTON_STATS",T.Alt_Button_Stats="ALT_BUTTON_STATS",T.Button_Cycle_Form="BUTTON_CYCLE_FORM",T.Alt_Button_Cycle_Form="ALT_BUTTON_CYCLE_FORM",T.Button_Cycle_Shiny="BUTTON_CYCLE_SHINY",T.Alt_Button_Cycle_Shiny="ALT_BUTTON_CYCLE_SHINY",T.Button_Cycle_Gender="BUTTON_CYCLE_GENDER",T.Alt_Button_Cycle_Gender="ALT_BUTTON_CYCLE_GENDER",T.Button_Cycle_Ability="BUTTON_CYCLE_ABILITY",T.Alt_Button_Cycle_Ability="ALT_BUTTON_CYCLE_ABILITY",T.Button_Cycle_Nature="BUTTON_CYCLE_NATURE",T.Alt_Button_Cycle_Nature="ALT_BUTTON_CYCLE_NATURE",T.Button_Cycle_Tera="BUTTON_CYCLE_TERA",T.Alt_Button_Cycle_Tera="ALT_BUTTON_CYCLE_TERA",T.Button_Speed_Up="BUTTON_SPEED_UP",T.Alt_Button_Speed_Up="ALT_BUTTON_SPEED_UP",T.Button_Slow_Down="BUTTON_SLOW_DOWN",T.Alt_Button_Slow_Down="ALT_BUTTON_SLOW_DOWN",T.Button_Submit="BUTTON_SUBMIT",T.Alt_Button_Submit="ALT_BUTTON_SUBMIT",T))(re||{});const Ye=f.t("settings:pressToBind"),ZT={BUTTON_UP:[`KEY ${b.UP.toString()}`,Ye],BUTTON_DOWN:[`KEY ${b.DOWN.toString()}`,Ye],ALT_BUTTON_UP:[`KEY ${b.UP.toString()}`,Ye],BUTTON_LEFT:[`KEY ${b.LEFT.toString()}`,Ye],BUTTON_RIGHT:[`KEY ${b.RIGHT.toString()}`,Ye],BUTTON_ACTION:[`KEY ${b.ACTION.toString()}`,Ye],BUTTON_MENU:[`KEY ${b.MENU.toString()}`,Ye],BUTTON_SUBMIT:[`KEY ${b.SUBMIT.toString()}`,Ye],ALT_BUTTON_DOWN:[`KEY ${b.DOWN.toString()}`,Ye],ALT_BUTTON_LEFT:[`KEY ${b.LEFT.toString()}`,Ye],ALT_BUTTON_RIGHT:[`KEY ${b.RIGHT.toString()}`,Ye],ALT_BUTTON_ACTION:[`KEY ${b.ACTION.toString()}`,Ye],BUTTON_CANCEL:[`KEY ${b.CANCEL.toString()}`,Ye],ALT_BUTTON_CANCEL:[`KEY ${b.CANCEL.toString()}`,Ye],ALT_BUTTON_MENU:[`KEY ${b.MENU.toString()}`,Ye],BUTTON_STATS:[`KEY ${b.STATS.toString()}`,Ye],ALT_BUTTON_STATS:[`KEY ${b.STATS.toString()}`,Ye],BUTTON_CYCLE_FORM:[`KEY ${b.CYCLE_FORM.toString()}`,Ye],ALT_BUTTON_CYCLE_FORM:[`KEY ${b.CYCLE_FORM.toString()}`,Ye],BUTTON_CYCLE_SHINY:[`KEY ${b.CYCLE_SHINY.toString()}`,Ye],ALT_BUTTON_CYCLE_SHINY:[`KEY ${b.CYCLE_SHINY.toString()}`,Ye],BUTTON_CYCLE_GENDER:[`KEY ${b.CYCLE_GENDER.toString()}`,Ye],ALT_BUTTON_CYCLE_GENDER:[`KEY ${b.CYCLE_GENDER.toString()}`,Ye],BUTTON_CYCLE_ABILITY:[`KEY ${b.CYCLE_ABILITY.toString()}`,Ye],ALT_BUTTON_CYCLE_ABILITY:[`KEY ${b.CYCLE_ABILITY.toString()}`,Ye],BUTTON_CYCLE_NATURE:[`KEY ${b.CYCLE_NATURE.toString()}`,Ye],ALT_BUTTON_CYCLE_NATURE:[`KEY ${b.CYCLE_NATURE.toString()}`,Ye],BUTTON_CYCLE_TERA:[`KEY ${b.CYCLE_TERA.toString()}`,Ye],ALT_BUTTON_CYCLE_TERA:[`KEY ${b.CYCLE_TERA.toString()}`,Ye],BUTTON_SPEED_UP:[`KEY ${b.SPEED_UP.toString()}`,Ye],ALT_BUTTON_SPEED_UP:[`KEY ${b.SPEED_UP.toString()}`,Ye],BUTTON_SLOW_DOWN:[`KEY ${b.SLOW_DOWN.toString()}`,Ye],ALT_BUTTON_SLOW_DOWN:[`KEY ${b.SLOW_DOWN.toString()}`,Ye],ALT_BUTTON_SUBMIT:[`KEY ${b.SUBMIT.toString()}`,Ye]},QT={BUTTON_UP:0,BUTTON_DOWN:0,BUTTON_LEFT:0,BUTTON_RIGHT:0,BUTTON_ACTION:0,BUTTON_MENU:0,BUTTON_SUBMIT:0,ALT_BUTTON_UP:0,ALT_BUTTON_DOWN:0,ALT_BUTTON_LEFT:0,ALT_BUTTON_RIGHT:0,ALT_BUTTON_ACTION:0,BUTTON_CANCEL:0,ALT_BUTTON_CANCEL:0,ALT_BUTTON_MENU:0,BUTTON_STATS:0,ALT_BUTTON_STATS:0,BUTTON_CYCLE_FORM:0,ALT_BUTTON_CYCLE_FORM:0,BUTTON_CYCLE_SHINY:0,ALT_BUTTON_CYCLE_SHINY:0,BUTTON_CYCLE_GENDER:0,ALT_BUTTON_CYCLE_GENDER:0,BUTTON_CYCLE_ABILITY:0,ALT_BUTTON_CYCLE_ABILITY:0,BUTTON_CYCLE_NATURE:0,ALT_BUTTON_CYCLE_NATURE:0,BUTTON_CYCLE_TERA:0,ALT_BUTTON_CYCLE_TERA:0,BUTTON_SPEED_UP:0,ALT_BUTTON_SPEED_UP:0,BUTTON_SLOW_DOWN:0,ALT_BUTTON_SLOW_DOWN:0,ALT_BUTTON_SUBMIT:0},JT=["BUTTON_SUBMIT","BUTTON_MENU","BUTTON_ACTION","BUTTON_CANCEL","BUTTON_UP","BUTTON_DOWN","BUTTON_LEFT","BUTTON_RIGHT"];function _g(T,e){switch(T){case"BUTTON_UP":case"BUTTON_DOWN":case"BUTTON_LEFT":case"BUTTON_RIGHT":case"BUTTON_ACTION":case"BUTTON_CANCEL":case"BUTTON_MENU":case"BUTTON_STATS":case"BUTTON_CYCLE_SHINY":case"BUTTON_CYCLE_FORM":case"BUTTON_CYCLE_GENDER":case"BUTTON_CYCLE_ABILITY":case"BUTTON_CYCLE_NATURE":case"BUTTON_CYCLE_TERA":case"BUTTON_SPEED_UP":case"BUTTON_SLOW_DOWN":case"ALT_BUTTON_UP":case"ALT_BUTTON_DOWN":case"ALT_BUTTON_LEFT":case"ALT_BUTTON_RIGHT":case"ALT_BUTTON_ACTION":case"ALT_BUTTON_CANCEL":case"ALT_BUTTON_MENU":case"ALT_BUTTON_STATS":case"ALT_BUTTON_CYCLE_SHINY":case"ALT_BUTTON_CYCLE_FORM":case"ALT_BUTTON_CYCLE_GENDER":case"ALT_BUTTON_CYCLE_ABILITY":case"ALT_BUTTON_CYCLE_NATURE":case"ALT_BUTTON_CYCLE_TERA":case"ALT_BUTTON_SPEED_UP":case"ALT_BUTTON_SLOW_DOWN":case"ALT_BUTTON_SUBMIT":if(e&&s.ui){const t=h((i=!1)=>(s.ui.revertMode(),s.ui.getHandler().updateBindings(),i),"cancelHandler");s.ui.setOverlayMode(x.KEYBOARD_BINDING,{target:T,cancelHandler:t})}break}return!0}h(_g,"setSettingKeyboard");const Kr={padID:"default",padType:"keyboard",deviceMapping:{KEY_A:Phaser.Input.Keyboard.KeyCodes.A,KEY_B:Phaser.Input.Keyboard.KeyCodes.B,KEY_C:Phaser.Input.Keyboard.KeyCodes.C,KEY_D:Phaser.Input.Keyboard.KeyCodes.D,KEY_E:Phaser.Input.Keyboard.KeyCodes.E,KEY_F:Phaser.Input.Keyboard.KeyCodes.F,KEY_G:Phaser.Input.Keyboard.KeyCodes.G,KEY_H:Phaser.Input.Keyboard.KeyCodes.H,KEY_I:Phaser.Input.Keyboard.KeyCodes.I,KEY_J:Phaser.Input.Keyboard.KeyCodes.J,KEY_K:Phaser.Input.Keyboard.KeyCodes.K,KEY_L:Phaser.Input.Keyboard.KeyCodes.L,KEY_M:Phaser.Input.Keyboard.KeyCodes.M,KEY_N:Phaser.Input.Keyboard.KeyCodes.N,KEY_O:Phaser.Input.Keyboard.KeyCodes.O,KEY_P:Phaser.Input.Keyboard.KeyCodes.P,KEY_Q:Phaser.Input.Keyboard.KeyCodes.Q,KEY_R:Phaser.Input.Keyboard.KeyCodes.R,KEY_S:Phaser.Input.Keyboard.KeyCodes.S,KEY_T:Phaser.Input.Keyboard.KeyCodes.T,KEY_U:Phaser.Input.Keyboard.KeyCodes.U,KEY_V:Phaser.Input.Keyboard.KeyCodes.V,KEY_W:Phaser.Input.Keyboard.KeyCodes.W,KEY_X:Phaser.Input.Keyboard.KeyCodes.X,KEY_Y:Phaser.Input.Keyboard.KeyCodes.Y,KEY_Z:Phaser.Input.Keyboard.KeyCodes.Z,KEY_0:Phaser.Input.Keyboard.KeyCodes.ZERO,KEY_1:Phaser.Input.Keyboard.KeyCodes.ONE,KEY_2:Phaser.Input.Keyboard.KeyCodes.TWO,KEY_3:Phaser.Input.Keyboard.KeyCodes.THREE,KEY_4:Phaser.Input.Keyboard.KeyCodes.FOUR,KEY_5:Phaser.Input.Keyboard.KeyCodes.FIVE,KEY_6:Phaser.Input.Keyboard.KeyCodes.SIX,KEY_7:Phaser.Input.Keyboard.KeyCodes.SEVEN,KEY_8:Phaser.Input.Keyboard.KeyCodes.EIGHT,KEY_9:Phaser.Input.Keyboard.KeyCodes.NINE,KEY_F1:Phaser.Input.Keyboard.KeyCodes.F1,KEY_F2:Phaser.Input.Keyboard.KeyCodes.F2,KEY_F3:Phaser.Input.Keyboard.KeyCodes.F3,KEY_F4:Phaser.Input.Keyboard.KeyCodes.F4,KEY_F5:Phaser.Input.Keyboard.KeyCodes.F5,KEY_F6:Phaser.Input.Keyboard.KeyCodes.F6,KEY_F7:Phaser.Input.Keyboard.KeyCodes.F7,KEY_F8:Phaser.Input.Keyboard.KeyCodes.F8,KEY_F9:Phaser.Input.Keyboard.KeyCodes.F9,KEY_F10:Phaser.Input.Keyboard.KeyCodes.F10,KEY_F11:Phaser.Input.Keyboard.KeyCodes.F11,KEY_F12:Phaser.Input.Keyboard.KeyCodes.F12,KEY_PAGE_DOWN:Phaser.Input.Keyboard.KeyCodes.PAGE_DOWN,KEY_PAGE_UP:Phaser.Input.Keyboard.KeyCodes.PAGE_UP,KEY_CTRL:Phaser.Input.Keyboard.KeyCodes.CTRL,KEY_DEL:Phaser.Input.Keyboard.KeyCodes.DELETE,KEY_END:Phaser.Input.Keyboard.KeyCodes.END,KEY_ENTER:Phaser.Input.Keyboard.KeyCodes.ENTER,KEY_ESC:Phaser.Input.Keyboard.KeyCodes.ESC,KEY_HOME:Phaser.Input.Keyboard.KeyCodes.HOME,KEY_INSERT:Phaser.Input.Keyboard.KeyCodes.INSERT,KEY_PLUS:Phaser.Input.Keyboard.KeyCodes.NUMPAD_ADD,KEY_MINUS:Phaser.Input.Keyboard.KeyCodes.NUMPAD_SUBTRACT,KEY_QUOTATION:Phaser.Input.Keyboard.KeyCodes.QUOTES,KEY_SHIFT:Phaser.Input.Keyboard.KeyCodes.SHIFT,KEY_SPACE:Phaser.Input.Keyboard.KeyCodes.SPACE,KEY_TAB:Phaser.Input.Keyboard.KeyCodes.TAB,KEY_TILDE:Phaser.Input.Keyboard.KeyCodes.BACKTICK,KEY_ARROW_UP:Phaser.Input.Keyboard.KeyCodes.UP,KEY_ARROW_DOWN:Phaser.Input.Keyboard.KeyCodes.DOWN,KEY_ARROW_LEFT:Phaser.Input.Keyboard.KeyCodes.LEFT,KEY_ARROW_RIGHT:Phaser.Input.Keyboard.KeyCodes.RIGHT,KEY_LEFT_BRACKET:Phaser.Input.Keyboard.KeyCodes.OPEN_BRACKET,KEY_RIGHT_BRACKET:Phaser.Input.Keyboard.KeyCodes.CLOSED_BRACKET,KEY_SEMICOLON:Phaser.Input.Keyboard.KeyCodes.SEMICOLON,KEY_COMMA:Phaser.Input.Keyboard.KeyCodes.COMMA,KEY_PERIOD:Phaser.Input.Keyboard.KeyCodes.PERIOD,KEY_BACK_SLASH:Phaser.Input.Keyboard.KeyCodes.BACK_SLASH,KEY_FORWARD_SLASH:Phaser.Input.Keyboard.KeyCodes.FORWARD_SLASH,KEY_BACKSPACE:Phaser.Input.Keyboard.KeyCodes.BACKSPACE,KEY_ALT:Phaser.Input.Keyboard.KeyCodes.ALT},icons:{KEY_A:"A.png",KEY_B:"B.png",KEY_C:"C.png",KEY_D:"D.png",KEY_E:"E.png",KEY_F:"F.png",KEY_G:"G.png",KEY_H:"H.png",KEY_I:"I.png",KEY_J:"J.png",KEY_K:"K.png",KEY_L:"L.png",KEY_M:"M.png",KEY_N:"N.png",KEY_O:"O.png",KEY_P:"P.png",KEY_Q:"Q.png",KEY_R:"R.png",KEY_S:"S.png",KEY_T:"T.png",KEY_U:"U.png",KEY_V:"V.png",KEY_W:"W.png",KEY_X:"X.png",KEY_Y:"Y.png",KEY_Z:"Z.png",KEY_0:"0.png",KEY_1:"1.png",KEY_2:"2.png",KEY_3:"3.png",KEY_4:"4.png",KEY_5:"5.png",KEY_6:"6.png",KEY_7:"7.png",KEY_8:"8.png",KEY_9:"9.png",KEY_F1:"F1.png",KEY_F2:"F2.png",KEY_F3:"F3.png",KEY_F4:"F4.png",KEY_F5:"F5.png",KEY_F6:"F6.png",KEY_F7:"F7.png",KEY_F8:"F8.png",KEY_F9:"F9.png",KEY_F10:"F10.png",KEY_F11:"F11.png",KEY_F12:"F12.png",KEY_PAGE_DOWN:"PAGE_DOWN.png",KEY_PAGE_UP:"PAGE_UP.png",KEY_CTRL:"CTRL.png",KEY_DEL:"DEL.png",KEY_END:"END.png",KEY_ENTER:"ENTER.png",KEY_ESC:"ESC.png",KEY_HOME:"HOME.png",KEY_INSERT:"INS.png",KEY_PLUS:"PLUS.png",KEY_MINUS:"MINUS.png",KEY_QUOTATION:"QUOTE.png",KEY_SHIFT:"SHIFT.png",KEY_SPACE:"SPACE.png",KEY_TAB:"TAB.png",KEY_TILDE:"TILDE.png",KEY_ARROW_UP:"KEY_ARROW_UP.png",KEY_ARROW_DOWN:"KEY_ARROW_DOWN.png",KEY_ARROW_LEFT:"KEY_ARROW_LEFT.png",KEY_ARROW_RIGHT:"KEY_ARROW_RIGHT.png",KEY_LEFT_BRACKET:"LEFT_BRACKET.png",KEY_RIGHT_BRACKET:"RIGHT_BRACKET.png",KEY_SEMICOLON:"SEMICOLON.png",KEY_COMMA:"COMMA.png",KEY_PERIOD:"PERIOD.png",KEY_BACK_SLASH:"BACK_SLASH.png",KEY_FORWARD_SLASH:"FORWARD_SLASH.png",KEY_BACKSPACE:"BACK.png",KEY_ALT:"ALT.png"},settings:{[re.Button_Up]:b.UP,[re.Button_Down]:b.DOWN,[re.Button_Left]:b.LEFT,[re.Button_Right]:b.RIGHT,[re.Button_Submit]:b.SUBMIT,[re.Button_Action]:b.ACTION,[re.Button_Cancel]:b.CANCEL,[re.Button_Menu]:b.MENU,[re.Button_Stats]:b.STATS,[re.Button_Cycle_Shiny]:b.CYCLE_SHINY,[re.Button_Cycle_Form]:b.CYCLE_FORM,[re.Button_Cycle_Gender]:b.CYCLE_GENDER,[re.Button_Cycle_Ability]:b.CYCLE_ABILITY,[re.Button_Cycle_Nature]:b.CYCLE_NATURE,[re.Button_Speed_Up]:b.SPEED_UP,[re.Button_Slow_Down]:b.SLOW_DOWN,[re.Button_Cycle_Tera]:b.CYCLE_TERA,[re.Alt_Button_Up]:b.UP,[re.Alt_Button_Down]:b.DOWN,[re.Alt_Button_Left]:b.LEFT,[re.Alt_Button_Right]:b.RIGHT,[re.Alt_Button_Submit]:b.SUBMIT,[re.Alt_Button_Action]:b.ACTION,[re.Alt_Button_Cancel]:b.CANCEL,[re.Alt_Button_Menu]:b.MENU,[re.Alt_Button_Stats]:b.STATS,[re.Alt_Button_Cycle_Shiny]:b.CYCLE_SHINY,[re.Alt_Button_Cycle_Form]:b.CYCLE_FORM,[re.Alt_Button_Cycle_Gender]:b.CYCLE_GENDER,[re.Alt_Button_Cycle_Ability]:b.CYCLE_ABILITY,[re.Alt_Button_Cycle_Nature]:b.CYCLE_NATURE,[re.Alt_Button_Speed_Up]:b.SPEED_UP,[re.Alt_Button_Slow_Down]:b.SLOW_DOWN,[re.Alt_Button_Cycle_Tera]:b.CYCLE_TERA},default:{KEY_ARROW_UP:re.Button_Up,KEY_ARROW_DOWN:re.Button_Down,KEY_ARROW_LEFT:re.Button_Left,KEY_ARROW_RIGHT:re.Button_Right,KEY_ENTER:re.Button_Submit,KEY_SPACE:re.Button_Action,KEY_BACKSPACE:re.Button_Cancel,KEY_ESC:re.Button_Menu,KEY_C:re.Button_Stats,KEY_R:re.Button_Cycle_Shiny,KEY_F:re.Button_Cycle_Form,KEY_G:re.Button_Cycle_Gender,KEY_E:re.Button_Cycle_Ability,KEY_N:re.Button_Cycle_Nature,KEY_V:re.Button_Cycle_Tera,KEY_PLUS:-1,KEY_MINUS:-1,KEY_A:re.Alt_Button_Left,KEY_B:-1,KEY_D:re.Alt_Button_Right,KEY_H:-1,KEY_I:-1,KEY_J:-1,KEY_K:-1,KEY_L:-1,KEY_M:re.Alt_Button_Menu,KEY_O:-1,KEY_P:-1,KEY_Q:-1,KEY_S:re.Alt_Button_Down,KEY_T:re.Alt_Button_Cycle_Form,KEY_U:-1,KEY_W:re.Alt_Button_Up,KEY_X:re.Alt_Button_Cancel,KEY_Y:re.Alt_Button_Cycle_Shiny,KEY_Z:re.Alt_Button_Action,KEY_0:-1,KEY_1:-1,KEY_2:-1,KEY_3:-1,KEY_4:-1,KEY_5:-1,KEY_6:-1,KEY_7:-1,KEY_8:-1,KEY_9:-1,KEY_CTRL:-1,KEY_DEL:-1,KEY_END:-1,KEY_F1:-1,KEY_F2:-1,KEY_F3:-1,KEY_F4:-1,KEY_F5:-1,KEY_F6:-1,KEY_F7:-1,KEY_F8:-1,KEY_F9:-1,KEY_F10:-1,KEY_F11:-1,KEY_F12:-1,KEY_HOME:-1,KEY_INSERT:-1,KEY_PAGE_DOWN:re.Button_Slow_Down,KEY_PAGE_UP:re.Button_Speed_Up,KEY_QUOTATION:-1,KEY_SHIFT:re.Alt_Button_Stats,KEY_TAB:-1,KEY_TILDE:-1,KEY_LEFT_BRACKET:-1,KEY_RIGHT_BRACKET:-1,KEY_SEMICOLON:-1,KEY_ALT:-1},blacklist:["KEY_ENTER","KEY_ESC","KEY_SPACE","KEY_BACKSPACE","KEY_ARROW_UP","KEY_ARROW_DOWN","KEY_ARROW_LEFT","KEY_ARROW_RIGHT","KEY_DEL","KEY_HOME"]};function Bi(T,e){return Object.keys(T.deviceMapping).find(t=>T.deviceMapping[t]===e)}h(Bi,"getKeyWithKeycode");function wg(T,e){const t=Bi(T,e);return t?T.custom[t]:null}h(wg,"getSettingNameWithKeycode");function Xn(T,e){const t=wg(T,e);return T.settings[t]}h(Xn,"getButtonWithKeycode");function Li(T,e){return Object.keys(T.custom).find(t=>T.custom[t]===e)}h(Li,"getKeyWithSettingName");function zr(T,e){return T.custom[e]}h(zr,"getSettingNameWithKey");function eC(T,e){return T.icons[e]}h(eC,"getIconWithKey");function Ea(T,e){const t=Li(T,e);return eC(T,t)}h(Ea,"getIconWithSettingName");function tC(T,e,t,i){let n;e==="gamepad"?n=T[t[Le.GAMEPAD]]:n=T[t[Le.KEYBOARD]];const a=Ea(n,i);if(!a){const r=i.includes("ALT_");let o;return r?o=i.split("ALT_").splice(1)[0]:o=`ALT_${i}`,Ea(n,o)}return a}h(tC,"getIconForLatestInput");function sC(T,e,t){if(!aC(T,Bi(T,t))||!rC(T,e))return!1;const i=wg(T,t);if(i){const r=Li(T,i);r&&(T.custom[r]=-1)}const n=Li(T,e);n&&(T.custom[n]=-1);const a=Bi(T,t);return a&&(T.custom[a]=e),!0}h(sC,"assign");function iC(T,e,t){if(T.padType==="keyboard")return!1;const i=Li(T,e),n=zr(T,i),a=Bi(T,t),r=zr(T,a);return i&&(T.custom[i]=r),a&&(T.custom[a]=n),!0}h(iC,"swap");function nC(T,e){const t=Li(T,e);return T.blacklist.includes(t)?!1:(t&&(T.custom[t]=-1),!0)}h(nC,"deleteBind");function aC(T,e){const t=zr(T,e);return!T.blacklist?.includes(e)}h(aC,"canIAssignThisKey");function rC(T,e){const t=Li(T,e);return!T.blacklist?.includes(t)}h(rC,"canIOverrideThisSetting");var G=(T=>(T.Controller="CONTROLLER",T.Gamepad_Support="GAMEPAD_SUPPORT",T.Button_Up="BUTTON_UP",T.Button_Down="BUTTON_DOWN",T.Button_Left="BUTTON_LEFT",T.Button_Right="BUTTON_RIGHT",T.Button_Action="BUTTON_ACTION",T.Button_Cancel="BUTTON_CANCEL",T.Button_Menu="BUTTON_MENU",T.Button_Stats="BUTTON_STATS",T.Button_Cycle_Form="BUTTON_CYCLE_FORM",T.Button_Cycle_Shiny="BUTTON_CYCLE_SHINY",T.Button_Cycle_Gender="BUTTON_CYCLE_GENDER",T.Button_Cycle_Ability="BUTTON_CYCLE_ABILITY",T.Button_Cycle_Nature="BUTTON_CYCLE_NATURE",T.Button_Cycle_Tera="BUTTON_CYCLE_TERA",T.Button_Speed_Up="BUTTON_SPEED_UP",T.Button_Slow_Down="BUTTON_SLOW_DOWN",T.Button_Submit="BUTTON_SUBMIT",T))(G||{});const wt=f.t("settings:pressActionToAssign"),Mg={CONTROLLER:[f.t("settings:controllerDefault"),f.t("settings:controllerChange")],GAMEPAD_SUPPORT:[f.t("settings:gamepadSupportAuto"),f.t("settings:gamepadSupportDisabled")],BUTTON_UP:[`KEY ${b.UP.toString()}`,wt],BUTTON_DOWN:[`KEY ${b.DOWN.toString()}`,wt],BUTTON_LEFT:[`KEY ${b.LEFT.toString()}`,wt],BUTTON_RIGHT:[`KEY ${b.RIGHT.toString()}`,wt],BUTTON_ACTION:[`KEY ${b.ACTION.toString()}`,wt],BUTTON_CANCEL:[`KEY ${b.CANCEL.toString()}`,wt],BUTTON_MENU:[`KEY ${b.MENU.toString()}`,wt],BUTTON_STATS:[`KEY ${b.STATS.toString()}`,wt],BUTTON_CYCLE_FORM:[`KEY ${b.CYCLE_FORM.toString()}`,wt],BUTTON_CYCLE_SHINY:[`KEY ${b.CYCLE_SHINY.toString()}`,wt],BUTTON_CYCLE_GENDER:[`KEY ${b.CYCLE_GENDER.toString()}`,wt],BUTTON_CYCLE_ABILITY:[`KEY ${b.CYCLE_ABILITY.toString()}`,wt],BUTTON_CYCLE_NATURE:[`KEY ${b.CYCLE_NATURE.toString()}`,wt],BUTTON_CYCLE_TERA:[`KEY ${b.CYCLE_TERA.toString()}`,wt],BUTTON_SPEED_UP:[`KEY ${b.SPEED_UP.toString()}`,wt],BUTTON_SLOW_DOWN:[`KEY ${b.SLOW_DOWN.toString()}`,wt],BUTTON_SUBMIT:[`KEY ${b.SUBMIT.toString()}`,wt]},kg={CONTROLLER:0,GAMEPAD_SUPPORT:0,BUTTON_UP:0,BUTTON_DOWN:0,BUTTON_LEFT:0,BUTTON_RIGHT:0,BUTTON_ACTION:0,BUTTON_CANCEL:0,BUTTON_MENU:0,BUTTON_STATS:0,BUTTON_CYCLE_FORM:0,BUTTON_CYCLE_SHINY:0,BUTTON_CYCLE_GENDER:0,BUTTON_CYCLE_ABILITY:0,BUTTON_CYCLE_NATURE:0,BUTTON_CYCLE_TERA:0,BUTTON_SPEED_UP:0,BUTTON_SLOW_DOWN:0,BUTTON_SUBMIT:0},oC=[re.Button_Up,re.Button_Down,re.Button_Left,re.Button_Right];function ha(T,e){switch(T){case"GAMEPAD_SUPPORT":s.inputController.setGamepadSupport(Mg[T][e]!=="Disabled");break;case"BUTTON_ACTION":case"BUTTON_CANCEL":case"BUTTON_MENU":case"BUTTON_STATS":case"BUTTON_CYCLE_SHINY":case"BUTTON_CYCLE_FORM":case"BUTTON_CYCLE_GENDER":case"BUTTON_CYCLE_ABILITY":case"BUTTON_CYCLE_NATURE":case"BUTTON_CYCLE_TERA":case"BUTTON_SPEED_UP":case"BUTTON_SLOW_DOWN":case"BUTTON_SUBMIT":if(e&&s.ui){const t=h((i=!1)=>(s.ui.revertMode(),s.ui.getHandler().updateBindings(),i),"cancelHandler");s.ui.setOverlayMode(x.GAMEPAD_BINDING,{target:T,cancelHandler:t})}break;case"CONTROLLER":if(e){const t=s.inputController.getGamepadsName();if(s.ui&&t){const i=h(()=>(s.ui.revertMode(),s.ui.getHandler().setOptionCursor(Object.values(G).indexOf("CONTROLLER"),0,!0),s.ui.getHandler().updateBindings(),!1),"cancelHandler"),n=h(a=>(s.inputController.setChosenGamepad(a),i(),!0),"changeGamepadHandler");return s.ui.setOverlayMode(x.OPTION_SELECT,{options:[...t.map(a=>({label:Rn(a,30),handler:h(()=>n(a),"handler")})),{label:f.t("settings:cancelControllerChoice"),handler:i}]}),!1}}break}return!0}h(ha,"setSettingGamepad");const Ng={padID:"Dualshock",padType:"dualshock",deviceMapping:{RC_S:0,RC_E:1,RC_W:2,RC_N:3,START:9,SELECT:8,LB:4,RB:5,LT:6,RT:7,LS:10,RS:11,LC_N:12,LC_S:13,LC_W:14,LC_E:15,TOUCH:17},icons:{RC_S:"CROSS.png",RC_E:"CIRCLE.png",RC_W:"SQUARE.png",RC_N:"TRIANGLE.png",START:"START.png",SELECT:"SELECT.png",LB:"L1.png",RB:"R1.png",LT:"L2.png",RT:"R2.png",LS:"L3.png",RS:"R3.png",LC_N:"UP.png",LC_S:"DOWN.png",LC_W:"LEFT.png",LC_E:"RIGHT.png",TOUCH:"TOUCH.png"},settings:{[G.Button_Up]:b.UP,[G.Button_Down]:b.DOWN,[G.Button_Left]:b.LEFT,[G.Button_Right]:b.RIGHT,[G.Button_Action]:b.ACTION,[G.Button_Cancel]:b.CANCEL,[G.Button_Cycle_Nature]:b.CYCLE_NATURE,[G.Button_Cycle_Tera]:b.CYCLE_TERA,[G.Button_Menu]:b.MENU,[G.Button_Stats]:b.STATS,[G.Button_Cycle_Form]:b.CYCLE_FORM,[G.Button_Cycle_Shiny]:b.CYCLE_SHINY,[G.Button_Cycle_Gender]:b.CYCLE_GENDER,[G.Button_Cycle_Ability]:b.CYCLE_ABILITY,[G.Button_Speed_Up]:b.SPEED_UP,[G.Button_Slow_Down]:b.SLOW_DOWN,[G.Button_Submit]:b.SUBMIT},default:{LC_N:G.Button_Up,LC_S:G.Button_Down,LC_W:G.Button_Left,LC_E:G.Button_Right,RC_S:G.Button_Action,RC_E:G.Button_Cancel,RC_W:G.Button_Cycle_Nature,RC_N:G.Button_Cycle_Tera,START:G.Button_Menu,SELECT:G.Button_Stats,LB:G.Button_Cycle_Form,RB:G.Button_Cycle_Shiny,LT:G.Button_Cycle_Gender,RT:G.Button_Cycle_Ability,LS:G.Button_Speed_Up,RS:G.Button_Slow_Down,TOUCH:G.Button_Submit}},lC={padID:"Generic",padType:"xbox",deviceMapping:{RC_S:0,RC_E:1,RC_W:2,RC_N:3,START:9,SELECT:8,LB:4,RB:5,LT:6,RT:7,LS:10,RS:11,LC_N:12,LC_S:13,LC_W:14,LC_E:15},icons:{RC_S:"XB_Letter_A_OL.png",RC_E:"XB_Letter_B_OL.png",RC_W:"XB_Letter_X_OL.png",RC_N:"XB_Letter_Y_OL.png",START:"START.png",SELECT:"SELECT.png",LB:"Bumper_L.png",RB:"Bumper_R.png",LT:"Trigger_L.png",RT:"Trigger_R.png",LS:"LS.png",RS:"RS.png",LC_N:"UP.png",LC_S:"DOWN.png",LC_W:"LEFT.png",LC_E:"RIGHT.png"},settings:{[G.Button_Up]:b.UP,[G.Button_Down]:b.DOWN,[G.Button_Left]:b.LEFT,[G.Button_Right]:b.RIGHT,[G.Button_Action]:b.ACTION,[G.Button_Cancel]:b.CANCEL,[G.Button_Cycle_Nature]:b.CYCLE_NATURE,[G.Button_Cycle_Tera]:b.CYCLE_TERA,[G.Button_Menu]:b.MENU,[G.Button_Stats]:b.STATS,[G.Button_Cycle_Form]:b.CYCLE_FORM,[G.Button_Cycle_Shiny]:b.CYCLE_SHINY,[G.Button_Cycle_Gender]:b.CYCLE_GENDER,[G.Button_Cycle_Ability]:b.CYCLE_ABILITY,[G.Button_Speed_Up]:b.SPEED_UP,[G.Button_Slow_Down]:b.SLOW_DOWN},default:{LC_N:G.Button_Up,LC_S:G.Button_Down,LC_W:G.Button_Left,LC_E:G.Button_Right,RC_S:G.Button_Action,RC_E:G.Button_Cancel,RC_W:G.Button_Cycle_Nature,RC_N:G.Button_Cycle_Tera,START:G.Button_Menu,SELECT:G.Button_Stats,LB:G.Button_Cycle_Form,RB:G.Button_Cycle_Shiny,LT:G.Button_Cycle_Gender,RT:G.Button_Cycle_Ability,LS:G.Button_Speed_Up,RS:G.Button_Slow_Down},blacklist:["LC_N","LC_S","LC_W","LC_E"]},hC={padID:"Pro Controller",padType:"xbox",deviceMapping:{RC_S:1,RC_E:0,RC_W:3,RC_N:2,START:9,SELECT:8,LB:4,RB:5,LT:6,RT:7,LS:10,RS:11,LC_N:12,LC_S:13,LC_W:14,LC_E:15,MENU:16},icons:{RC_S:"XB_Letter_B_OL.png",RC_E:"XB_Letter_A_OL.png",RC_W:"XB_Letter_Y_OL.png",RC_N:"XB_Letter_X_OL.png",START:"START.png",SELECT:"SELECT.png",LB:"Bumper_L.png",RB:"Bumper_R.png",LT:"Trigger_L.png",RT:"Trigger_R.png",LS:"LS.png",RS:"RS.png",LC_N:"UP.png",LC_S:"DOWN.png",LC_W:"LEFT.png",LC_E:"RIGHT.png"},settings:{[G.Button_Up]:b.UP,[G.Button_Down]:b.DOWN,[G.Button_Left]:b.LEFT,[G.Button_Right]:b.RIGHT,[G.Button_Action]:b.ACTION,[G.Button_Cancel]:b.CANCEL,[G.Button_Cycle_Nature]:b.CYCLE_NATURE,[G.Button_Cycle_Tera]:b.CYCLE_TERA,[G.Button_Menu]:b.MENU,[G.Button_Stats]:b.STATS,[G.Button_Cycle_Form]:b.CYCLE_FORM,[G.Button_Cycle_Shiny]:b.CYCLE_SHINY,[G.Button_Cycle_Gender]:b.CYCLE_GENDER,[G.Button_Cycle_Ability]:b.CYCLE_ABILITY,[G.Button_Speed_Up]:b.SPEED_UP,[G.Button_Slow_Down]:b.SLOW_DOWN},default:{LC_N:G.Button_Up,LC_S:G.Button_Down,LC_W:G.Button_Left,LC_E:G.Button_Right,RC_S:G.Button_Action,RC_E:G.Button_Cancel,RC_W:G.Button_Cycle_Nature,RC_N:G.Button_Cycle_Tera,START:G.Button_Menu,SELECT:G.Button_Stats,LB:G.Button_Cycle_Form,RB:G.Button_Cycle_Shiny,LT:G.Button_Cycle_Gender,RT:G.Button_Cycle_Ability,LS:G.Button_Speed_Up,RS:G.Button_Slow_Down}},Pg={padID:"081f-e401",padType:"xbox",deviceMapping:{RC_S:2,RC_E:1,RC_W:3,RC_N:0,START:9,SELECT:8,LB:4,RB:5,LC_N:12,LC_S:13,LC_W:14,LC_E:15},icons:{RC_S:"XB_Letter_A_OL.png",RC_E:"XB_Letter_B_OL.png",RC_W:"XB_Letter_X_OL.png",RC_N:"XB_Letter_Y_OL.png",START:"START.png",SELECT:"SELECT.png",LB:"Bumper_L.png",RB:"Bumper_R.png",LC_N:"UP.png",LC_S:"DOWN.png",LC_W:"LEFT.png",LC_E:"RIGHT.png"},settings:{[G.Button_Up]:b.UP,[G.Button_Down]:b.DOWN,[G.Button_Left]:b.LEFT,[G.Button_Right]:b.RIGHT,[G.Button_Action]:b.ACTION,[G.Button_Cancel]:b.CANCEL,[G.Button_Cycle_Nature]:b.CYCLE_NATURE,[G.Button_Cycle_Tera]:b.CYCLE_TERA,[G.Button_Menu]:b.MENU,[G.Button_Stats]:b.STATS,[G.Button_Cycle_Form]:b.CYCLE_FORM,[G.Button_Cycle_Shiny]:b.CYCLE_SHINY,[G.Button_Cycle_Gender]:b.CYCLE_GENDER,[G.Button_Cycle_Ability]:b.CYCLE_ABILITY,[G.Button_Speed_Up]:b.SPEED_UP,[G.Button_Slow_Down]:b.SLOW_DOWN},default:{LC_N:G.Button_Up,LC_S:G.Button_Down,LC_W:G.Button_Left,LC_E:G.Button_Right,RC_S:G.Button_Action,RC_E:G.Button_Cancel,RC_W:G.Button_Cycle_Nature,RC_N:G.Button_Cycle_Tera,START:G.Button_Menu,SELECT:G.Button_Stats,LB:G.Button_Cycle_Form,RB:G.Button_Cycle_Shiny,LT:-1,RT:-1,LS:-1,RS:-1}},Rg={padID:"Xbox 360 controller (XInput STANDARD GAMEPAD)",padType:"xbox",deviceMapping:{RC_S:0,RC_E:1,RC_W:2,RC_N:3,START:9,SELECT:8,LB:4,RB:5,LT:6,RT:7,LS:10,RS:11,LC_N:12,LC_S:13,LC_W:14,LC_E:15},icons:{RC_S:"XB_Letter_A_OL.png",RC_E:"XB_Letter_B_OL.png",RC_W:"XB_Letter_X_OL.png",RC_N:"XB_Letter_Y_OL.png",START:"START.png",SELECT:"SELECT.png",LB:"Bumper_L.png",RB:"Bumper_R.png",LT:"Trigger_L.png",RT:"Trigger_R.png",LS:"LS.png",RS:"RS.png",LC_N:"UP.png",LC_S:"DOWN.png",LC_W:"LEFT.png",LC_E:"RIGHT.png"},settings:{[G.Button_Up]:b.UP,[G.Button_Down]:b.DOWN,[G.Button_Left]:b.LEFT,[G.Button_Right]:b.RIGHT,[G.Button_Action]:b.ACTION,[G.Button_Cancel]:b.CANCEL,[G.Button_Cycle_Nature]:b.CYCLE_NATURE,[G.Button_Cycle_Tera]:b.CYCLE_TERA,[G.Button_Menu]:b.MENU,[G.Button_Stats]:b.STATS,[G.Button_Cycle_Form]:b.CYCLE_FORM,[G.Button_Cycle_Shiny]:b.CYCLE_SHINY,[G.Button_Cycle_Gender]:b.CYCLE_GENDER,[G.Button_Cycle_Ability]:b.CYCLE_ABILITY,[G.Button_Speed_Up]:b.SPEED_UP,[G.Button_Slow_Down]:b.SLOW_DOWN},default:{LC_N:G.Button_Up,LC_S:G.Button_Down,LC_W:G.Button_Left,LC_E:G.Button_Right,RC_S:G.Button_Action,RC_E:G.Button_Cancel,RC_W:G.Button_Cycle_Nature,RC_N:G.Button_Cycle_Tera,START:G.Button_Menu,SELECT:G.Button_Stats,LB:G.Button_Cycle_Form,RB:G.Button_Cycle_Shiny,LT:G.Button_Cycle_Gender,RT:G.Button_Cycle_Ability,LS:G.Button_Speed_Up,RS:G.Button_Slow_Down}},cC="touchControlPositionsLandscape",uC="touchControlPositionsPortrait",Jh=class Jh{draggingElement=null;inConfigurationMode;configurationEventListeners={pointerdown:[],pointermove:[],pointerup:[]};overlay;isLandscapeMode=this.getScreenSize().width>this.getScreenSize().height;touchControls;constructor(e){this.touchControls=e,this.inConfigurationMode=!1,this.setPositions(this.getSavedPositionsOfCurrentOrientation()??[]),window.addEventListener("resize",t=>{const i=this.getScreenSize();i.width>i.height!==this.isLandscapeMode&&this.changeOrientation(i.width>i.height)})}async changeOrientation(e){if(this.isLandscapeMode=e,this.inConfigurationMode){const i=document.querySelector("#touchControls #orientation");i&&(i.textContent=this.isLandscapeMode?f.t("settings:landscape"):f.t("settings:portrait"))}const t=this.getSavedPositionsOfCurrentOrientation()??[];this.setPositions(t)}getScreenSize(){return{width:window.screen.width,height:window.screen.height}}createToolbarElement(){const e=document.createElement("div");return e.id="configToolbar",e.innerHTML=`
    <div class="column">
      <div class="button-row">
        <div id="resetButton" class="button">${f.t("settings:touchReset")}</div>
        <div id="saveButton" class="button">${f.t("settings:touchSaveClose")}</div>
        <div id="cancelButton" class="button">${f.t("settings:touchCancel")}</div>
      </div>
      <div class="info-row">
        <div class="orientation-label">
          ${f.t("settings:orientation")}
          <span id="orientation">
            ${this.isLandscapeMode?f.t("settings:landscape"):f.t("settings:portrait")}
          </span>
        </div>
      </div>
    </div>
  `,e}createToolbar(){document.querySelector("#touchControls")?.prepend(this.createToolbarElement());const e=this.getConfigToolbarRefs();if(!e)return;const{saveButton:t,resetButton:i,cancelButton:n}=e;t.addEventListener("click",()=>{this.saveCurrentPositions(),this.disableConfigurationMode()}),i.addEventListener("click",()=>{this.resetPositions()}),n.addEventListener("click",()=>{const a=this.getSavedPositionsOfCurrentOrientation();this.setPositions(a),this.disableConfigurationMode()})}getConfigToolbarRefs(){const e=document.querySelector("#touchControls #configToolbar");if(e)return{toolbar:e,saveButton:e.querySelector("#saveButton"),resetButton:e.querySelector("#resetButton"),cancelButton:e.querySelector("#cancelButton")}}isLeft=h(e=>document.querySelector("#touchControls .left")?.contains(e),"isLeft");startDrag=h(e=>{this.draggingElement=e},"startDrag");drag=h(e=>{if(!this.draggingElement)return;const t=this.draggingElement.getBoundingClientRect(),i=this.isLeft(this.draggingElement)?e.clientX-t.width/2:window.innerWidth-e.clientX-t.width/2,n=window.innerHeight-e.clientY-t.height/2;this.setPosition(this.draggingElement,i,n)},"drag");stopDrag=h(()=>{this.draggingElement=null},"stopDrag");getModifiedCurrentPositions(){return this.getControlGroupElements().filter(e=>e.style.right||e.style.left).map(e=>({id:e.id,x:Number.parseFloat(this.isLeft(e)?e.style.left:e.style.right),y:Number.parseFloat(e.style.bottom)}))}getLocalStorageKey(){return this.isLandscapeMode?cC:uC}getSavedPositionsOfCurrentOrientation(){const e=localStorage.getItem(this.getLocalStorageKey());return e?JSON.parse(e):[]}saveCurrentPositions(){const e=this.getModifiedCurrentPositions();localStorage.setItem(this.getLocalStorageKey(),JSON.stringify(e))}setPositions(e){return this.resetPositions(),e.forEach(t=>{const i=document.querySelector(`#${t.id}`);this.setPosition(i,t.x,t.y)})}setPosition(e,t,i){const n=e.getBoundingClientRect(),a=h((l,c,u)=>Math.min(Math.max(l,c),u),"checkBound"),{height:r,width:o}=this.getScreenSize();t=a(t,0,o-n.width),i=a(i,0,r-n.height),this.isLeft(e)?e.style.left=`${t}px`:e.style.right=`${t}px`,e.style.bottom=`${i}px`}resetPositions(){this.getControlGroupElements().forEach(e=>{e.style.removeProperty("left"),e.style.removeProperty("right"),e.style.removeProperty("bottom")})}getControlGroupElements(){return[...document.querySelectorAll("#touchControls .control-group")]}createConfigurationEventListeners(e){return{pointerdown:e.map(t=>{const i=h(()=>this.startDrag(t),"startDrag");return t.addEventListener("pointerdown",i,{passive:!0}),i}),pointermove:e.map(()=>{const t=h(i=>this.drag(i),"drag");return window.addEventListener("pointermove",t,{passive:!0}),t}),pointerup:e.map(()=>{const t=h(()=>this.stopDrag(),"stopDrag");return window.addEventListener("pointerup",t,{passive:!0}),t})}}createOverlay(e){const t=new Phaser.GameObjects.Container(s,0,0),i=new Phaser.GameObjects.Rectangle(s,0,0,s.game.canvas.width,s.game.canvas.height,0,.5);i.setInteractive(),t.add(i),e.add(t),this.overlay=t,document.querySelector("#touchControls")?.classList.add("config-mode")}enableConfigurationMode(e){this.inConfigurationMode||(this.inConfigurationMode=!0,this.touchControls.disable(),this.createOverlay(e),this.createToolbar(),setTimeout(()=>{this.configurationEventListeners=this.createConfigurationEventListeners(this.getControlGroupElements())},500))}disableConfigurationMode(){this.inConfigurationMode=!1,this.draggingElement=null;const{pointerdown:e,pointermove:t,pointerup:i}=this.configurationEventListeners;this.getControlGroupElements().forEach((a,r)=>a.removeEventListener("pointerdown",e[r])),t.forEach(a=>window.removeEventListener("pointermove",a)),i.forEach(a=>window.removeEventListener("pointerup",a)),document.querySelector("#touchControls #configToolbar")?.remove(),this.overlay?.destroy(),document.querySelector("#touchControls")?.classList.remove("config-mode"),this.touchControls.enable()}};h(Jh,"MoveTouchControlsHandler");let jr=Jh;const yf=250,ec=class ec{gamepads=[];events;buttonLock=[];interactions=new Map;configs=new Map;gamepadSupport=!0;selectedDevice;disconnectedGamepads=[];lastSource="keyboard";inputInterval=[];touchControls;moveTouchControlsHandler;constructor(){this.selectedDevice={[Le.GAMEPAD]:null,[Le.KEYBOARD]:"default"};for(const e of ks(b))this.interactions[e]={pressTime:!1,isPressed:!1,source:null};delete this.interactions[b.MENU],delete this.interactions[b.STATS],this.init()}init(){if(this.events=s.game.events,s.game.events.on(Jt.Core.Events.BLUR,()=>{this.loseFocus()}),typeof s.input.gamepad<"u"){if(s.input.gamepad?.on("connected",function(e){e&&(this.refreshGamepads(),this.setupGamepad(e),this.onReconnect(e))},this),s.input.gamepad?.on("disconnected",function(e){this.onDisconnect(e)},this),s.input.gamepad?.refreshPads(),s.input.gamepad?.total){this.refreshGamepads();for(const e of this.gamepads)s.input.gamepad.emit("connected",e)}s.input.gamepad?.on("down",this.gamepadButtonDown,this),s.input.gamepad?.on("up",this.gamepadButtonUp,this),s.input.keyboard?.on("keydown",this.keyboardKeyDown,this),s.input.keyboard?.on("keyup",this.keyboardKeyUp,this)}this.touchControls=new YT,this.moveTouchControlsHandler=new jr(this.touchControls)}loseFocus(){this.deactivatePressedKey(),this.touchControls.deactivatePressedKey()}setGamepadSupport(e){e?this.gamepadSupport=!0:(this.gamepadSupport=!1,this.deactivatePressedKey())}setChosenGamepad(e){this.deactivatePressedKey(),this.initChosenGamepad(e)}setChosenKeyboardLayout(e){this.deactivatePressedKey(),this.initChosenLayoutKeyboard(e)}getGamepadsName(){return this.gamepads.filter(e=>!this.disconnectedGamepads.includes(e.id)).map(e=>e.id)}initChosenGamepad(e){e&&(this.selectedDevice[Le.GAMEPAD]=e.toLowerCase()),s.ui?.handlers[x.SETTINGS_GAMEPAD]?.updateChosenGamepadDisplay()}initChosenLayoutKeyboard(e){e&&(this.selectedDevice[Le.KEYBOARD]=e.toLowerCase()),s.ui?.handlers[x.SETTINGS_KEYBOARD]?.updateChosenKeyboardDisplay()}onDisconnect(e){this.disconnectedGamepads.push(e.id)}onReconnect(e){this.disconnectedGamepads=this.disconnectedGamepads.filter(t=>t!==e.id)}setupGamepad(e){const t=this.getGamepadsName();for(const n of t){const a=n.toLowerCase();this.selectedDevice[Le.GAMEPAD]||this.setChosenGamepad(a);const r=Br(this.getConfig(a));r.custom=this.configs[a]?.custom||{...r.default},this.configs[a]=r,s.gameData?.saveMappingConfigs(a,this.configs[a])}this.lastSource="gamepad",s.ui?.handlers[x.SETTINGS_GAMEPAD]?.updateChosenGamepadDisplay()}setupKeyboard(){for(const e of["default"]){const t=Br(this.getConfigKeyboard(e));t.custom=this.configs[e]?.custom||{...t.default},this.configs[e]=t,s.gameData?.saveMappingConfigs(this.selectedDevice[Le.KEYBOARD],this.configs[e])}this.initChosenLayoutKeyboard(this.selectedDevice[Le.KEYBOARD])}refreshGamepads(){this.gamepads=s.input.gamepad?.gamepads.filter(e=>e!==null)??[];for(const[e,t]of this.gamepads.entries())t.index=e}ensureKeyboardIsInit(){this.getActiveConfig(Le.KEYBOARD)?.padID||this.setupKeyboard()}keyboardKeyDown(e){this.lastSource="keyboard",this.ensureKeyboardIsInit();const t=Xn(this.getActiveConfig(Le.KEYBOARD),e.keyCode);if(t!==void 0){if(this.buttonLock.includes(t))return;this.events.emit("input_down",{controller_type:"keyboard",button:t}),clearInterval(this.inputInterval[t]),this.inputInterval[t]=setInterval(()=>{this.events.emit("input_down",{controller_type:"keyboard",button:t})},yf),this.buttonLock.push(t)}}keyboardKeyUp(e){this.lastSource="keyboard";const t=Xn(this.getActiveConfig(Le.KEYBOARD),e.keyCode);if(t!==void 0){this.events.emit("input_up",{controller_type:"keyboard",button:t});const i=this.buttonLock.indexOf(t);this.buttonLock.splice(i,1),clearInterval(this.inputInterval[t])}}gamepadButtonDown(e,t,i){if(this.configs[this.selectedDevice[Le.KEYBOARD]]?.padID||this.setupKeyboard(),!e||(this.lastSource="gamepad",(!this.selectedDevice[Le.GAMEPAD]||s.ui.getMode()!==x.GAMEPAD_BINDING&&this.selectedDevice[Le.GAMEPAD]!==e.id.toLowerCase())&&this.setChosenGamepad(e.id),!this.gamepadSupport||e.id.toLowerCase()!==this.selectedDevice[Le.GAMEPAD].toLowerCase()))return;const n=this.getActiveConfig(Le.GAMEPAD),a=n&&Xn(n,t.index);if(a!==void 0){if(this.buttonLock.includes(a))return;this.events.emit("input_down",{controller_type:"gamepad",button:a}),clearInterval(this.inputInterval[a]),this.inputInterval[a]=setInterval(()=>{if(!this.buttonLock.includes(a)){clearInterval(this.inputInterval[a]);return}this.events.emit("input_down",{controller_type:"gamepad",button:a})},yf),this.buttonLock.push(a)}}gamepadButtonUp(e,t,i){if(!e||(this.lastSource="gamepad",!this.gamepadSupport||e.id.toLowerCase()!==this.selectedDevice[Le.GAMEPAD]))return;const n=Xn(this.getActiveConfig(Le.GAMEPAD),t.index);if(n!==void 0){this.events.emit("input_up",{controller_type:"gamepad",button:n});const a=this.buttonLock.indexOf(n);this.buttonLock.splice(a,1),clearInterval(this.inputInterval[n])}}getConfig(e){return e=e.toLowerCase(),e.includes("081f")&&e.includes("e401")?Pg:e.includes("xbox")&&e.includes("360")?Rg:e.includes("054c")?Ng:e.includes("057e")&&e.includes("2009")?hC:lC}getConfigKeyboard(e){return Kr}deactivatePressedKey(){for(const e of Object.keys(this.inputInterval))clearInterval(this.inputInterval[e]);this.buttonLock=[]}getActiveConfig(e){return this.configs[this.selectedDevice[e]]?.padID?this.configs[this.selectedDevice[e]]:null}getIconForLatestInputRecorded(e){return this.lastSource==="keyboard"&&this.ensureKeyboardIsInit(),tC(this.configs,this.lastSource,this.selectedDevice,e)}getLastSourceDevice(){return this.lastSource==="gamepad"?Le.GAMEPAD:Le.KEYBOARD}getLastSourceConfig(){const e=this.getLastSourceDevice();return e===Le.KEYBOARD&&this.ensureKeyboardIsInit(),this.getActiveConfig(e)}getLastSourceType(){return this.getLastSourceConfig()?.padType}injectConfig(e,t){this.configs[e]||(this.configs[e]={});const i={BUTTON_CYCLE_VARIANT:"BUTTON_CYCLE_TERA"};for(const n in t.custom)t.custom[n]in i&&(t.custom[n]=i[t.custom[n]]);this.configs[e].custom=t.custom}resetConfigs(){this.configs=new Map,this.getGamepadsName()?.length>0&&this.setupGamepad(this.selectedDevice[Le.GAMEPAD]),this.setupKeyboard()}assignBinding(e,t,i){return this.deactivatePressedKey(),e.padType==="keyboard"?sC(e,t,i):iC(e,t,i)}};h(ec,"InputsController");let $r=ec;const dC="green",tc=class tc extends Gg{setOrder;reorder(){const e=this.setOrder;e?this.queue.sort((t,i)=>e.indexOf(t.getPokemon().getBattlerIndex())-e.indexOf(i.getPokemon().getBattlerIndex())):this.queue=Hf(this.queue)}};h(tc,"PokemonPhasePriorityQueue");let fn=tc;const sc=class sc extends fn{lastTurnOrder=[];reorder(){super.reorder(),this.sortPostSpeed()}cancelMove(e){this.queue.find(t=>e(t))?.cancel()}setTimingModifier(e,t){const i=this.queue.find(n=>e(n));i!=null&&(i.timingModifier=t)}setMoveForPhase(e,t){const i=this.queue.find(n=>e(n));i!=null&&(i.move=t)}redirectMoves(e,t){s.currentBattle.double&&t?.isActive(!0)&&this.queue.filter(i=>i.targets.length===1&&i.targets[0]===e.getBattlerIndex()&&i.pokemon.isPlayer()!==t.isPlayer()).forEach(i=>{i&&i.targets[0]!==t.getBattlerIndex()&&(i.targets[0]=t.getBattlerIndex())})}setMoveOrder(e){this.setOrder=e}pop(){this.reorder();const e=this.queue.shift();return e&&this.lastTurnOrder.push(e.pokemon),e}getTurnOrder(){return this.lastTurnOrder}clearTurnOrder(){this.lastTurnOrder=[]}clear(){this.setOrder=void 0,this.lastTurnOrder=[],super.clear()}sortPostSpeed(){this.queue.sort((e,t)=>{const i=[e,t].map(r=>r.move.getMove().getPriority(r.pokemon,!0)),n=[e,t].map(r=>r.timingModifier),a=[e,t].map(r=>r.move.getMove().getPriorityModifier(r.pokemon));return n[0]!==n[1]?n[1]-n[0]:i[0]===i[1]&&a[0]!==a[1]?a[1]-a[0]:i[1]-i[0]})}};h(sc,"MovePhasePriorityQueue");let Xr=sc;const ic=class ic{start(){}end(){s.phaseManager.shiftPhase()}is(e){return this.phaseName===e}};h(ic,"Phase");let Ge=ic;const nc=class nc extends Ge{showEnemyTrainer(e=yt.NONE){if(!s.currentBattle.trainer){console.warn("Enemy trainer is missing!");return}const t=s.currentBattle.trainer.getSprites(),i=s.currentBattle.trainer.getTintSprites();for(let n=0;n<t.length;n++){const a=!e||!n==(e===yt.TRAINER)||t.length<2;[t[n],i[n]].forEach(r=>{a&&(r.x=e||t.length<2?0:n?16:-16),r.setVisible(a),r.clearTint()})}s.tweens.add({targets:s.currentBattle.trainer,x:"-=16",y:"+=16",alpha:1,ease:"Sine.easeInOut",duration:750})}hideEnemyTrainer(){s.tweens.add({targets:s.currentBattle.trainer,x:"+=16",y:"-=16",alpha:0,ease:"Sine.easeInOut",duration:750})}};h(nc,"BattlePhase");let rt=nc;const ac=class ac extends rt{executeForAll(e){for(const t of Es(Tt.BOTH))e(t)}};h(ac,"FieldPhase");let ps=ac;const rc=class rc extends ps{battlerIndex;player;fieldIndex;constructor(e){super(),e=e??s.getField().find(t=>t?.isActive())?.getBattlerIndex(),e===void 0&&(console.warn("There are no Pokemon on the field!"),e=nt.PLAYER),this.battlerIndex=e,this.player=e<2,this.fieldIndex=e%2}getPokemon(){return this.battlerIndex>nt.ENEMY_2?s.getPokemonById(this.battlerIndex):s.getField()[this.battlerIndex]}};h(rc,"PokemonPhase");let Ot=rc;const oc=class oc extends Ot{phaseName="PostSummonPhase";start(){super.start();const e=this.getPokemon();e.name,e.status?.effect===lt.TOXIC&&(e.status.toxicTurnCount=0),s.arena.applyTags(Us.PENDING_HEAL,!1,e),s.arena.applyTags(Lh,!1,e),s.currentBattle.isBattleMysteryEncounter()&&e.findTags(t=>t instanceof Yg).length>0&&e.lapseTag(ke.MYSTERY_ENCOUNTER_POST_SUMMON);for(const t of e.getAlliesGenerator())ve("CommanderAbAttr",{pokemon:t});this.end()}getPriority(){return 0}};h(oc,"PostSummonPhase");let ba=oc;const lc=class lc extends ba{priority;passive;constructor(e,t,i){super(e),this.priority=t,this.passive=i}start(){ve("PostSummonAbAttr",{pokemon:this.getPokemon(),passive:this.passive}),this.end()}getPriority(){return this.priority}};h(lc,"PostSummonActivateAbilityPhase");let Ia=lc;const hc=class hc extends fn{reorder(){this.queue=Hf(this.queue),this.queue.sort((e,t)=>t.getPriority()-e.getPriority())}push(e){super.push(e),this.queueAbilityPhase(e)}queueAbilityPhase(e){if(e instanceof Ia)return;const t=e.getPokemon();t.getAbilityPriorities().forEach((i,n)=>{const a=new Ia(t.getBattlerIndex(),i,n!==0);s.phaseManager.unshiftPhase(a)})}};h(hc,"PostSummonPhasePriorityQueue");let qr=hc;const pC=["SummonPhase","CommandPhase","LearnMovePhase","MoveEffectPhase","MoveEndPhase","FaintPhase","DamageAnimPhase","VictoryPhase","PokemonHealPhase","WeatherEffectPhase","ShowAbilityPhase","HideAbilityPhase","ExpPhase","ShowPartyExpBarPhase","HidePartyExpBarPhase"],cc=class cc{dynamicPhaseMap;constructor(){this.dynamicPhaseMap=new Map,this.dynamicPhaseMap.set("PostSummonPhase",new qr),this.dynamicPhaseMap.set("MovePhase",new Xr)}clearQueues(){for(const e of this.dynamicPhaseMap.values())e.clear()}queueDynamicPhase(e){return this.isDynamicPhase(e)?(this.dynamicPhaseMap.has(e.phaseName)||this.dynamicPhaseMap.set(e.phaseName,new fn),this.dynamicPhaseMap.get(e.phaseName)?.push(e),!0):!1}popNextPhase(e){return this.dynamicPhaseMap.get(e)?.pop()}exists(e,t){return!!this.dynamicPhaseMap.get(e)?.has(t)}removePhase(e,t){return!!this.dynamicPhaseMap.get(e)?.remove(t)}setMoveTimingModifier(e,t){this.getMovePhaseQueue().setTimingModifier(e,t)}setMoveForPhase(e,t){this.getMovePhaseQueue().setMoveForPhase(e,t)}redirectMoves(e,t){this.getMovePhaseQueue().redirectMoves(e,t)}getMovePhase(e){return this.getMovePhaseQueue().find(e)}cancelMovePhase(e){this.getMovePhaseQueue().cancelMove(e)}setMoveOrder(e){this.getMovePhaseQueue().setMoveOrder(e)}getLastTurnOrder(){return this.getMovePhaseQueue().getTurnOrder()}clearLastTurnOrder(){this.getMovePhaseQueue().clearTurnOrder()}getMovePhaseQueue(){return this.dynamicPhaseMap.get("MovePhase")}isDynamicPhase(e){return typeof e.getPokemon=="function"&&!pC.includes(e.phaseName)}};h(cc,"DynamicQueueManager");let Zr=cc;const uc=class uc{levels=[[]];currentLevel=0;deferredActive=!1;add(e,t){if(t===this.currentLevel+1&&t===this.levels.length&&this.levels.push([]),this.levels[t]==null)throw new Error(`Attempted to add a phase to a nonexistent level of the PhaseTree!
Level: `+t.toString());this.levels[t].push(e)}addPhase(e,t=!1){t&&!this.deferredActive&&(this.deferredActive=!0,this.levels.splice(-1,0,[]),this.currentLevel+=1),this.add(e,this.currentLevel+1-+t)}addAfter(e,t){for(let i=this.levels.length-1;i>=0;i--){const n=this.levels[i].findIndex(a=>a.is(t))+1;if(n!==0){this.levels[i].splice(n,0,e);return}}this.addPhase(e)}pushPhase(e){this.add(e,0)}getNextPhase(){for(this.currentLevel=this.levels.length-1;this.currentLevel>0&&this.levels[this.currentLevel].length===0;)this.deferredActive=!1,this.levels.pop(),this.currentLevel--;return this.levels[this.currentLevel].shift()}find(e,t){for(let i=this.levels.length-1;i>=0;i--){const a=this.levels[i].find(r=>r.is(e)&&(!t||t(r)));if(a)return a}}findAll(e,t){const i=[];for(let n=this.levels.length-1;n>=0;n--){const r=this.levels[n].filter(o=>o.is(e)&&(!t||t(o)));i.push(...r)}return i}clear(e=!1){this.levels=[e?this.levels.at(-1)??[]:[]],this.currentLevel=0}remove(e,t){for(let i=this.levels.length-1;i>=0;i--){const n=this.levels[i],a=n.findIndex(r=>r.is(e)&&(!t||t(r)));if(a!==-1)return n.splice(a,1),!0}return!1}removeAll(e){for(let t=0;t<this.levels.length;t++){const i=this.levels[t].filter(n=>!n.is(e));this.levels[t]=i}}exists(e,t){for(const i of this.levels)for(const n of i)if(n.is(e)&&(!t||t(n)))return!0;return!1}};h(uc,"PhaseTree");let Qr=uc;const dc=class dc extends Ge{phaseName="AddEnemyBuffModifierPhase";start(){super.start();const e=s.currentBattle.waveIndex,t=e%1e3?e%250?He.COMMON:He.GREAT:He.ULTRA;ir(s.getEnemyParty(),ei.ENEMY_BUFF);const i=Math.ceil(e/250);for(let n=0;n<i;n++)s.addEnemyModifier(Kg(t,s.findModifiers(a=>a instanceof zg,!1)),!0,!0);s.updateModifiers(!1,!0),this.end()}};h(dc,"AddEnemyBuffModifierPhase");let Jr=dc;const pc=class pc extends Ot{phaseName="AttemptCapturePhase";pokeballType;pokeball;originalY;constructor(e,t){super(nt.ENEMY+e),this.pokeballType=t}start(){super.start();const e=this.getPokemon();if(!e?.hp)return this.end();const t=e.getTag(Ns);t&&t.sprite.setVisible(!1),s.pokeballCounts[this.pokeballType]--,this.originalY=e.y;const i=3*e.getMaxHp(),n=2*e.hp,a=e.species.catchRate,r=jg(this.pokeballType),o=e.status?$g(e.status.effect):1,l=e.isShiny()?cs.getShinyCatchMultiplier():1,c=Math.round((i-n)*a*r/i*o*l),u=Math.round(65536/Math.pow(255/c,.1875)),p=Xg(c),m=e.randBattleSeedInt(256)<p,d=e.getFieldPositionOffset(),y=wi(this.pokeballType);this.pokeball=s.addFieldSprite(16,80,"pb",y),this.pokeball.setOrigin(.5,.625),s.field.add(this.pokeball),s.playSound(m?"se/crit_throw":"se/pb_throw"),s.time.delayedCall(300,()=>{s.field.moveBelow(this.pokeball,e)}),s.tweens.add({targets:this.pokeball,x:{value:236+d[0],ease:"Linear"},y:{value:16+d[1],ease:"Cubic.easeOut"},duration:500,onComplete:h(()=>{this.pokeball.setTexture("pb",`${y}_opening`),s.time.delayedCall(17,()=>this.pokeball.setTexture("pb",`${y}_open`)),s.playSound("se/pb_rel"),e.tint(ln(this.pokeballType)),Wf(this.pokeball.x,this.pokeball.y,this.pokeballType),s.tweens.add({targets:e,duration:500,ease:"Sine.easeIn",scale:.25,y:20,onComplete:h(()=>{this.pokeball.setTexture("pb",`${y}_opening`),e.setVisible(!1),s.playSound("se/pb_catch"),s.time.delayedCall(17,()=>this.pokeball.setTexture("pb",`${y}`));const g=h(()=>{let C=0;const E=this.pokeball.x,I=s.tweens.addCounter({from:0,to:1,repeat:m?2:4,yoyo:!0,ease:"Cubic.easeOut",duration:250,repeatDelay:500,onUpdate:h(A=>{if(C&&C<(m?2:4)){const _=A.getValue()??0,w=C%2===1?1:-1;this.pokeball.setX(E+_*4*w),this.pokeball.setAngle(_*27.5*w)}},"onUpdate"),onRepeat:h(()=>{if(!e.species.isObtainable())I.stop(),this.failCatch(C);else if(C++<(m?1:3))r===-1||m||c>=255||e.randBattleSeedInt(65536)<u?s.playSound("se/pb_move"):(I.stop(),this.failCatch(C));else if(m&&e.randBattleSeedInt(65536)>=u)I.stop(),this.failCatch(C);else{s.playSound("se/pb_lock"),Zg(this.pokeball);const A=s.add.sprite(this.pokeball.x,this.pokeball.y,"pb","pb");A.setOrigin(this.pokeball.originX,this.pokeball.originY),A.setTintFill(0),A.setAlpha(0),s.field.add(A),s.tweens.add({targets:A,alpha:.375,duration:200,easing:"Sine.easeOut",onComplete:h(()=>{s.tweens.add({targets:A,alpha:0,duration:200,easing:"Sine.easeIn",onComplete:h(()=>A.destroy(),"onComplete")})},"onComplete")})}},"onRepeat"),onComplete:h(()=>{this.catch()},"onComplete")})},"doShake");s.time.delayedCall(250,()=>qg(this.pokeball,16,72,350,g,m))},"onComplete")})},"onComplete")})}failCatch(e){const t=this.getPokemon();s.playSound("se/pb_rel"),t.setY(this.originalY),t.status?.effect!==lt.SLEEP&&t.cry(t.getHpRatio()>.25?void 0:{rate:.85}),t.tint(ln(this.pokeballType)),t.setVisible(!0),t.untint(250,"Sine.easeOut");const i=t.getTag(Ns);i&&i.sprite.setVisible(!0);const n=wi(this.pokeballType);this.pokeball.setTexture("pb",`${n}_opening`),s.time.delayedCall(17,()=>this.pokeball.setTexture("pb",`${n}_open`)),s.tweens.add({targets:t,duration:250,ease:"Sine.easeOut",scale:1}),s.currentBattle.lastUsedPokeball=this.pokeballType,this.removePb(),this.end()}catch(){const e=this.getPokemon(),t=e.fusionSpecies?e.getFusionSpeciesForm():e.getSpeciesForm();t.abilityHidden&&(e.fusionSpecies?e.fusionAbilityIndex:e.abilityIndex)===t.getAbilityCount()-1&&s.validateAchv(Fe.HIDDEN_ABILITY),e.species.subLegendary&&s.validateAchv(Fe.CATCH_SUB_LEGENDARY),e.species.legendary&&s.validateAchv(Fe.CATCH_LEGENDARY),e.species.mythical&&s.validateAchv(Fe.CATCH_MYTHICAL),s.pokemonInfoContainer.show(e,!0),s.gameData.updateSpeciesDexIvs(e.species.getRootSpeciesId(!0),e.ivs);const i=new ft(!0);Cs(Ss.POKEMON_ADD_TO_PARTY,e,i),s.ui.showText(f.t(i.value?"battle:pokemonCaught":"battle:pokemonCaughtButChallenge",{pokemonName:e.name}),null,()=>{const n=h(()=>{s.phaseManager.unshiftNew("VictoryPhase",this.battlerIndex),s.pokemonInfoContainer.hide(),this.removePb(),this.end()},"end"),a=h(()=>{s.addFaintedEnemyScore(e),e.hp=0,e.doSetStatus(lt.FAINT),s.clearEnemyHeldItemModifiers(),e.leaveField(!0,!0,!0)},"removePokemon"),r=h(o=>{const l=e.addToParty(this.pokeballType,o),c=s.findModifiers(u=>u instanceof es,!1);s.getPlayerParty().filter(u=>u.isShiny()).length===ua&&s.validateAchv(Fe.SHINY_PARTY),Promise.all(c.map(u=>s.addModifier(u,!0))).then(()=>{s.updateModifiers(!0),a(),l?(l.leaveField(!0,!0,!1),l.loadAssets().then(n)):n()})},"addToParty");Promise.all([e.hideInfo(),s.gameData.setPokemonCaught(e)]).then(()=>{if(!i.value){a(),n();return}if(s.getPlayerParty().length===ua){const o=h(()=>{s.ui.showText(f.t("battle:partyFull",{pokemonName:e.getNameToRender()}),null,()=>{s.pokemonInfoContainer.makeRoomForConfirmUi(1,!0),s.ui.setMode(x.CONFIRM,()=>{const l=s.addPlayerPokemon(e.species,e.level,e.abilityIndex,e.formIndex,e.gender,e.shiny,e.variant,e.ivs,e.nature,e);s.ui.setMode(x.SUMMARY,l,0,Gf.DEFAULT,()=>{s.ui.setMode(x.MESSAGE).then(()=>{o()})},!1)},()=>{const l={shiny:e.shiny,variant:e.variant,form:e.formIndex,female:e.gender===Ut.FEMALE};s.ui.setOverlayMode(x.POKEDEX_PAGE,e.species,l,null,null,()=>{s.ui.setMode(x.MESSAGE).then(()=>{o()})})},()=>{s.ui.setMode(x.PARTY,ts.RELEASE,this.fieldIndex,(l,c)=>{s.ui.setMode(x.MESSAGE).then(()=>{l<6?r(l):o()})})},()=>{s.ui.setMode(x.MESSAGE).then(()=>{a(),n()})},"fullParty")})},"promptRelease");o()}else r()})},0,!0)}removePb(){s.tweens.add({targets:this.pokeball,duration:250,delay:250,ease:"Sine.easeIn",alpha:0,onComplete:h(()=>this.pokeball.destroy(),"onComplete")})}};h(pc,"AttemptCapturePhase");let eo=pc;const fc=class fc extends ps{phaseName="AttemptRunPhase";start(){super.start();const e=s.currentBattle.escapeAttempts++,t=s.getEnemyField(),i=s.randBattleSeedInt(100),n=new ct(this.calculateEscapeChance(e));for(const a of Es(Tt.PLAYER))ve("RunSuccessAbAttr",{pokemon:a,chance:n});i<n.value?(t.forEach(a=>ve("PreLeaveFieldAbAttr",{pokemon:a})),s.playSound("se/flee"),s.phaseManager.queueMessage(f.t("battle:runAwaySuccess"),null,!0,500),s.tweens.add({targets:[s.arenaEnemy,t].flat(),alpha:0,duration:250,ease:"Sine.easeIn",onComplete:h(()=>t.forEach(a=>a.destroy()),"onComplete")}),s.clearEnemyHeldItemModifiers(),t.forEach(a=>{a.hideInfo().then(()=>a.destroy()),a.hp=0,a.doSetStatus(lt.FAINT)}),s.phaseManager.pushNew("BattleEndPhase",!1),(s.gameMode.hasRandomBiomes||s.isNewBiome())&&s.phaseManager.pushNew("SelectBiomePhase"),s.phaseManager.pushNew("NewBattlePhase")):(s.getPlayerField(!0).forEach(a=>{a.turnData.failedRunAway=!0}),s.phaseManager.queueMessage(f.t("battle:runAwayCannotEscape"),null,!0,500)),this.end()}calculateEscapeChance(e){if(ie.RUN_SUCCESS_OVERRIDE!==null)return ie.RUN_SUCCESS_OVERRIDE?100:0;const t=s.getEnemyField(),i=s.getPlayerField(!0),n=t.reduce((d,y)=>d+y.getStat(li.SPD),0),a=i.reduce((d,y)=>d+y.getStat(li.SPD),0),r=t.some(d=>d.isBoss()),o=a/n,l=r?6:4,c=5,u=r?25:95,p=r?2:10,m=(u-c)/l;return Phaser.Math.Clamp(Math.round(m*o+c+p*e),c,u)}};h(fc,"AttemptRunPhase");let to=fc;const gc=class gc extends rt{phaseName="BattleEndPhase";isVictory;constructor(e){super(),this.isVictory=e}start(){super.start(),this.isVictory||=s.phaseManager.hasPhaseOfType("BattleEndPhase",t=>t.isVictory),s.phaseManager.removeAllPhasesOfType("BattleEndPhase"),s.gameData.gameStats.battles++,s.gameMode.isEndless&&s.currentBattle.waveIndex+1>s.gameData.gameStats.highestEndlessWave&&(s.gameData.gameStats.highestEndlessWave=s.currentBattle.waveIndex+1),this.isVictory&&(s.currentBattle.addBattleScore(),s.currentBattle.trainer&&s.gameData.gameStats.trainersDefeated++),s.gameMode.isEndless&&s.currentBattle.waveIndex>=5850&&(s.phaseManager.clearPhaseQueue(),s.phaseManager.unshiftNew("GameOverPhase",!0));for(const t of s.getPokemonAllowedInBattle())ve("PostBattleAbAttr",{pokemon:t,victory:this.isVictory});s.currentBattle.moneyScattered&&s.currentBattle.pickUpScatteredMoney(),s.clearEnemyHeldItemModifiers();for(const t of s.getEnemyParty())try{t.destroy()}catch{console.warn("Unable to destroy stale pokemon object in BattleEndPhase:",t)}const e=s.findModifiers(t=>t instanceof Qg||t instanceof Wp);for(const t of e){const i=[];t instanceof Wp&&i.push(s.getPokemonById(t.pokemonId)),t.lapse(...i)||s.removeModifier(t)}s.updateModifiers(),this.end()}};h(gc,"BattleEndPhase");let so=gc;const mc=class mc extends ps{phaseName="BerryPhase";start(){super.start(),this.executeForAll(e=>{this.eatBerries(e),ve("CudChewConsumeBerryAbAttr",{pokemon:e})}),this.end()}eatBerries(e){if(!!!s.findModifier(n=>n instanceof Gp&&n.shouldApply(e),e.isPlayer()))return;const i=new ft(!1);if(e.getOpponents().forEach(n=>ve("PreventBerryUseAbAttr",{pokemon:n,cancelled:i})),i.value){s.phaseManager.queueMessage(f.t("abilityTriggers:preventBerryUse",{pokemonNameWithAffix:Re(e)}));return}s.phaseManager.unshiftNew("CommonAnimPhase",e.getBattlerIndex(),e.getBattlerIndex(),ti.USE_ITEM);for(const n of s.applyModifiers(Gp,e.isPlayer(),e))n.consumed&&(n.consumed=!1,e.loseHeldItem(n)),s.eventTarget.dispatchEvent(new Jg(n));s.updateModifiers(e.isPlayer()),ve("HealFromBerryUseAbAttr",{pokemon:e})}};h(mc,"BerryPhase");let io=mc;const yc=class yc extends Ge{phaseName="CheckInterludePhase";start(){super.start();const{phaseManager:e}=s,{waveIndex:t}=s.currentBattle;t%10===0&&s.getEnemyParty().every(i=>i.isFainted())&&e.onInterlude(),this.end()}};h(yc,"CheckInterludePhase");let no=yc;const Tc=class Tc extends Ge{phaseName="CheckStatusEffectPhase";start(){for(const e of Es(Tt.BOTH))e.status?.isPostTurn()&&s.phaseManager.unshiftNew("PostTurnStatusEffectPhase",e.getBattlerIndex());this.end()}};h(Tc,"CheckStatusEffectPhase");let ao=Tc;var Kh=(T=>(T[T.SWITCH=0]="SWITCH",T[T.SET=1]="SET",T))(Kh||{});const Cc=class Cc extends rt{phaseName="CheckSwitchPhase";fieldIndex;useName;constructor(e,t){super(),this.fieldIndex=e,this.useName=t}start(){super.start();const e=s.getPlayerField()[this.fieldIndex];if(s.battleStyle===Kh.SET){this.end();return}if(s.field.getAll().indexOf(e)===-1)return s.phaseManager.unshiftNew("SummonMissingPhase",this.fieldIndex),super.end();if(s.getPlayerParty().slice(1).filter(t=>t.isActive()).length===0){this.end();return}if(e.getTag(ke.FRENZY)||e.isTrapped()||s.getPlayerField().some(t=>t.getTag(ke.COMMANDED))){this.end();return}s.ui.showText(f.t("battle:switchQuestion",{pokemonName:this.useName?Re(e):f.t("battle:pokemon")}),null,()=>{s.ui.setMode(x.CONFIRM,()=>{s.ui.setMode(x.MESSAGE),s.phaseManager.unshiftNew("SwitchPhase",gt.INITIAL_SWITCH,this.fieldIndex,!1,!0),this.end()},()=>{s.ui.setMode(x.MESSAGE),this.end()})})}};h(Cc,"CheckSwitchPhase");let ro=Cc;const Sc=class Sc extends ps{phaseName="CommandPhase";fieldIndex;isSwitch=!1;constructor(e){super(),this.fieldIndex=e}resetCursorIfNeeded(){const e=s.ui.handlers[x.COMMAND],{arena:t,commandCursorMemory:i,currentBattle:n}=s,{battleType:a,turn:r}=n,{biomeType:o}=t,l=a===de.MYSTERY_ENCOUNTER||a===de.TRAINER||o===Je.END;e&&(r===1&&(!i||l)||e.getCursor()===Ie.POKEMON)&&e.setCursor(Ie.FIGHT)}handleFieldIndexLogic(){if(s.getPlayerField().filter(t=>t.isActive()).length===1){this.fieldIndex=ys.CENTER;return}const e=s.currentBattle.turnCommands[this.fieldIndex-1];(e?.command===Ie.BALL||e?.command===Ie.RUN)&&(s.currentBattle.turnCommands[this.fieldIndex]={command:e?.command,skip:!0})}checkCommander(){s.currentBattle?.double&&this.getPokemon().getAlly()?.getTag(ke.COMMANDED)?.getSourcePokemon()===this.getPokemon()&&(s.currentBattle.turnCommands[this.fieldIndex]={command:Ie.FIGHT,move:{move:st.NONE,targets:[],useMode:Rt.NORMAL},skip:!0})}clearUnusableMoves(){const e=this.getPokemon(),t=e.getMoveQueue();if(t.length===0)return;let i=0;const n=e.getMoveset();for(const a of t){const r=n.find(o=>o.moveId===a.move);if(a.move!==st.NONE&&!da(a.useMode)&&!r?.isUsable(e,pa(a.useMode),!0))i++;else break}i&&t.splice(0,i)}tryExecuteQueuedMove(){this.clearUnusableMoves();const e=s.getPlayerField()[this.fieldIndex],t=e.getMoveQueue();if(t.length===0)return!1;const i=t[0];if(i.move===st.NONE)return this.handleCommand(Ie.FIGHT,-1),!0;const n=e.getMoveset().findIndex(a=>a.moveId===i.move);return!da(i.useMode)&&n===-1?s.ui.setMode(x.COMMAND,this.fieldIndex):this.handleCommand(Ie.FIGHT,n,i.useMode,i),!0}start(){if(super.start(),s.updateGameInfo(),this.resetCursorIfNeeded(),this.fieldIndex&&this.handleFieldIndexLogic(),this.checkCommander(),this.getPokemon().lapseTag(ke.ENCORE),s.currentBattle.turnCommands[this.fieldIndex]?.skip){this.end();return}this.tryExecuteQueuedMove()||(s.currentBattle.isBattleMysteryEncounter()&&s.currentBattle.mysteryEncounter?.skipToFightInput?(s.ui.clearText(),s.ui.setMode(x.FIGHT,this.fieldIndex)):s.ui.setMode(x.COMMAND,this.fieldIndex))}queueFightErrorMessage(e){const t=s.ui;t.setMode(x.MESSAGE),t.showText(e,null,()=>{t.clearText(),t.setMode(x.FIGHT,this.fieldIndex)},null,!0)}computeMoveId(e,t,i){return i?.move??(t>-1?e.getMoveset()[t]?.moveId:st.NONE)}handleFightCommand(e,t,i=Rt.NORMAL,n){const a=this.getPokemon(),r=pa(i),[o,l]=t===-1?[!0,""]:a.trySelectMove(t,r),c=o?!1:t>-1&&!a.getMoveset().some(y=>y.isUsable(a,r,!0)[0]);if(!o&&!c)return console.error("Cannot use move:",l),this.queueFightErrorMessage(l),!1;const u=c?st.STRUGGLE:this.computeMoveId(a,t,n),p={command:Ie.FIGHT,cursor:t,move:{move:u,targets:[],useMode:i},args:[i,n]},m={command:e,targets:[this.fieldIndex],skip:e===Ie.FIGHT},d=n===void 0?Dh(a,u):{targets:n.targets,multiple:n.targets.length>1};return u===st.NONE&&(p.targets=[this.fieldIndex]),st[u],Re(a),d.targets.length>1&&d.multiple&&s.phaseManager.unshiftNew("SelectTargetPhase",this.fieldIndex),p.move&&(d.targets.length<=1||d.multiple)?p.move.targets=d.targets:p.move&&a.getTag(ke.CHARGING)&&a.getMoveQueue().length>0?p.move.targets=a.getMoveQueue()[0].targets:s.phaseManager.unshiftNew("SelectTargetPhase",this.fieldIndex),s.currentBattle.preTurnCommands[this.fieldIndex]=m,s.currentBattle.turnCommands[this.fieldIndex]=p,!0}queueShowText(e){s.ui.setMode(x.COMMAND,this.fieldIndex),s.ui.setMode(x.MESSAGE),s.ui.showText(f.t(e),null,()=>{s.ui.showText("",0),s.ui.setMode(x.COMMAND,this.fieldIndex)},null,!0)}checkCanUseBall(){const{arena:e,currentBattle:t,gameData:i,gameMode:n}=s,{battleType:a}=t,{biomeType:r}=e,{isClassic:o,isEndless:l,isDaily:c}=n,{dexData:u}=i,p=n.isBattleClassicFinalBoss(s.currentBattle.waveIndex),m=n.isEndlessMinorBoss(s.currentBattle.waveIndex),d=n.isFullFreshStartChallenge(),y=s.getEnemyField().some(C=>C.isActive()&&!u[C.species.speciesId].caughtAttr),g=i.getStarterCount(C=>!!C.caughtAttr)<Object.keys($e).length-1;if(r===Je.END&&a===de.WILD)if(o&&!p&&y||d&&!p||l&&!m)this.queueShowText("battle:noPokeballForce");else if(o&&p&&g||d&&p||l&&m||c)this.queueShowText("battle:noPokeballForceFinalBoss");else return!0;else if(a===de.TRAINER)this.queueShowText("battle:noPokeballTrainer");else if(t.isBattleMysteryEncounter()&&!t.mysteryEncounter.catchAllowed)this.queueShowText("battle:noPokeballMysteryEncounter");else return!0;return!1}handleBallCommand(e){const t=s.getEnemyField().filter(r=>r.isActive(!0)).map(r=>r.getBattlerIndex());if(!this.checkCanUseBall())return!1;if(t.length>1)return this.queueShowText("battle:noPokeballMulti"),!1;const i=s.gameMode.hasAnyChallenges(),n=s.gameMode.isBattleClassicFinalBoss(s.currentBattle.waveIndex);if(e<5){const r=s.getEnemyPokemon(!1);if(r?.isBoss()&&r?.bossSegmentIndex>=1&&!r?.hasAbility(Bn.WONDER_GUARD,!1,!0)){if(n&&(e<bi.MASTER_BALL||e===bi.MASTER_BALL&&i))return this.queueShowText("battle:noPokeballForceFinalBossCatchable"),!1;if(e<bi.MASTER_BALL)return this.queueShowText("battle:noPokeballStrong"),!1}return s.currentBattle.turnCommands[this.fieldIndex]={command:Ie.BALL,cursor:e},s.currentBattle.turnCommands[this.fieldIndex].targets=t,this.fieldIndex&&(s.currentBattle.turnCommands[this.fieldIndex-1].skip=!0),!0}return!1}handleTrap(){const e=this.getPokemon(),t=[],i=this.isSwitch;if(!e.isTrapped(t))return!1;if(t.length>0)i&&s.ui.setMode(x.MESSAGE).then(()=>{s.ui.showText(t[0],null,()=>{s.ui.showText("",0),i&&s.ui.setMode(x.COMMAND,this.fieldIndex)},null,!0)});else{const n=e.getTag(em),a=s.arena.getTagOnSide(Us.FAIRY_LOCK,Tt.PLAYER);i||(s.ui.setMode(x.COMMAND,this.fieldIndex),s.ui.setMode(x.MESSAGE)),n?this.showNoEscapeText(n,!1):a&&this.showNoEscapeText(a,!1)}return!0}tryLeaveField(e,t=!1){const i=s.currentBattle;return t||!this.handleTrap()?(i.turnCommands[this.fieldIndex]=this.isSwitch?{command:Ie.POKEMON,cursor:e,args:[t]}:{command:Ie.RUN},!this.isSwitch&&this.fieldIndex&&(i.turnCommands[this.fieldIndex-1].skip=!0),!0):!1}handleRunCommand(){const{currentBattle:e,arena:t}=s,i=e.mysteryEncounter?.fleeAllowed??!0;return t.biomeType===Je.END||!i?(this.queueShowText("battle:noEscapeForce"),!1):e.battleType===de.TRAINER||e.mysteryEncounter?.encounterMode===ms.TRAINER_BATTLE?(this.queueShowText("battle:noEscapeTrainer"),!1):this.tryLeaveField()}showNoEscapeText(e,t){s.ui.showText(f.t("battle:noEscapePokemon",{pokemonName:e.sourceId&&s.getPokemonById(e.sourceId)?Re(s.getPokemonById(e.sourceId)):"",moveName:e.getMoveName(),escapeVerb:f.t(t?"battle:escapeVerbSwitch":"battle:escapeVerbFlee")}),null,()=>{s.ui.showText("",0),t||s.ui.setMode(x.COMMAND,this.fieldIndex)},null,!0)}handleCommand(e,t,i=!1,n){let a=!1;switch(e){case Ie.TERA:case Ie.FIGHT:a=this.handleFightCommand(e,t,typeof i=="boolean"?void 0:i,n);break;case Ie.BALL:a=this.handleBallCommand(t);break;case Ie.POKEMON:this.isSwitch=!0,a=this.tryLeaveField(t,typeof i=="boolean"?i:void 0),this.isSwitch=!1;break;case Ie.RUN:a=this.handleRunCommand()}return a&&this.end(),a}cancel(){this.fieldIndex&&(s.phaseManager.unshiftNew("CommandPhase",0),s.phaseManager.unshiftNew("CommandPhase",1),this.end())}getFieldIndex(){return this.fieldIndex}getPokemon(){return s.getPlayerField()[this.fieldIndex]}end(){s.ui.setMode(x.MESSAGE).then(()=>super.end())}};h(Sc,"CommandPhase");let oo=Sc;const Ec=class Ec extends Ot{phaseName="CommonAnimPhase";anim;targetIndex;constructor(e,t,i=null){super(e),this.anim=i,this.targetIndex=t}setAnimation(e){this.anim=e}start(){const e=this.targetIndex!==void 0?(this.player?s.getEnemyField():s.getPlayerField())[this.targetIndex]:this.getPokemon();new nr(this.anim,this.getPokemon(),e).play(!1,()=>{this.end()})}};h(Ec,"CommonAnimPhase");let gn=Ec;const bc=class bc extends Ot{phaseName="DamageAnimPhase";amount;damageResult;critical;constructor(e,t,i=Ze.EFFECTIVE,n=!1){super(e),this.amount=t,this.damageResult=i,this.critical=n}start(){if(super.start(),this.damageResult===Ze.ONE_HIT_KO||this.damageResult===Ze.INDIRECT_KO){s.moveAnimations&&s.toggleInvert(!0),s.time.delayedCall(ge(1e3),()=>{s.toggleInvert(!1),this.applyDamage()});return}this.applyDamage()}updateAmount(e){this.amount=e}applyDamage(){switch(this.damageResult){case Ze.EFFECTIVE:case Ze.CONFUSION:s.playSound("se/hit");break;case Ze.SUPER_EFFECTIVE:case Ze.INDIRECT_KO:case Ze.ONE_HIT_KO:s.playSound("se/hit_strong");break;case Ze.NOT_VERY_EFFECTIVE:s.playSound("se/hit_weak");break}if(this.amount&&s.damageNumberHandler.add(this.getPokemon(),this.amount,this.damageResult,this.critical),this.damageResult!==Ze.INDIRECT&&this.amount>0){const e=s.time.addEvent({delay:100,repeat:5,startAt:200,callback:h(()=>{this.getPokemon().getSprite().setVisible(e.repeatCount%2===0),e.repeatCount||this.getPokemon().updateInfo().then(()=>this.end())},"callback")})}else this.getPokemon().updateInfo().then(()=>this.end())}end(){s.currentBattle.battleSpec===Xt.FINAL_BOSS?s.initFinalBossPhaseTwo(this.getPokemon()):super.end()}};h(bc,"DamageAnimPhase");let lo=bc;const Ic=class Ic extends Ge{phaseName="DynamicPhaseMarker";phaseType;constructor(e){super(),this.phaseType=e}};h(Ic,"DynamicPhaseMarker");let va=Ic;var Bg=(T=>(T.EGG_COUNT_CHANGED="onEggCountChanged",T))(Bg||{});const vc=class vc extends Event{eggCount;constructor(e){super("onEggCountChanged"),this.eggCount=e}};h(vc,"EggCountChangedEvent");let ho=vc;const Oc=class Oc extends Phaser.GameObjects.Container{WINDOW_DEFAULT_WIDTH=37;WINDOW_MEDIUM_WIDTH=42;WINDOW_HEIGHT=26;onEggCountChangedEvent=h(e=>this.onEggCountChanged(e),"onEggCountChangedEvent");eggCount;eggCountWindow;eggCountText;constructor(e){super(s,0,0),this.eggCount=e,s.ui.getHandler().eventTarget.addEventListener(Bg.EGG_COUNT_CHANGED,this.onEggCountChangedEvent),this.setup()}setup(){const e=this.eggCount>9?this.WINDOW_MEDIUM_WIDTH:this.WINDOW_DEFAULT_WIDTH;this.eggCountWindow=Ce(5,5,e,this.WINDOW_HEIGHT),this.setVisible(this.eggCount>1),this.add(this.eggCountWindow);const t=s.add.sprite(19,18,"egg","egg_0").setScale(.32);this.eggCountText=P(28,13,`${this.eggCount}`,O.MESSAGE,{fontSize:"66px"}).setName("text-egg-count"),this.add([t,this.eggCountText])}setWindowToDefaultSize(){this.eggCountWindow.setSize(this.WINDOW_DEFAULT_WIDTH,this.WINDOW_HEIGHT)}onEggCountChanged(e){const t=e;if(!t||!this.eggCountText?.data)return;const i=t.eggCount;i<10&&this.setWindowToDefaultSize(),i>0?this.eggCountText.setText(i.toString()):this.eggCountText.setVisible(!1)}};h(Oc,"EggCounterContainer");let co=Oc;const fC="",gC="",Ac=class Ac extends fs{optionSelectContainer;optionSelectTextContainer;optionSelectBg;optionSelectText;optionSelectIcons;config;blockInput;scrollCursor=0;fullCursor=0;scale=.1666666667;cursorObj;unskippedIndices=[];defaultTextStyle=O.WINDOW;textContent;getWindowHeight(){return(Math.min((this.config?.options||[]).length,this.config?.maxOptions||99)+1)*96*this.scale}setup(){const e=this.getUi();this.optionSelectContainer=s.add.container(s.scaledCanvas.width-1,-48),this.optionSelectContainer.setName(`option-select-${this.mode?x[this.mode]:"UNKNOWN"}`),this.optionSelectContainer.setVisible(!1),e.add(this.optionSelectContainer),this.optionSelectBg=Ce(0,0,this.getWindowWidth(),this.getWindowHeight()),this.optionSelectBg.setName("option-select-bg"),this.optionSelectBg.setOrigin(1,1),this.optionSelectContainer.add(this.optionSelectBg),this.optionSelectTextContainer=s.add.container(0,0),this.optionSelectContainer.add(this.optionSelectTextContainer),this.optionSelectIcons=[],this.scale=Vi(O.WINDOW).scale,this.setCursor(0)}setupOptions(){const e=this.config?.options??[],t=e;if(this.unskippedIndices=this.getUnskippedIndices(e),this.optionSelectText)if(this.optionSelectText instanceof Ag)try{this.optionSelectText.destroy()}catch(a){console.error("Error while destroying optionSelectText:",a)}else console.warn("optionSelectText is not an instance of BBCodeText.");this.optionSelectIcons?.length>0&&(this.optionSelectIcons.map(a=>a.destroy()),this.optionSelectIcons.splice(0,this.optionSelectIcons.length));const i=this.config?.options&&this.config?.options.length>this.config?.maxOptions?this.getOptionsWithScroll():t,n=s.ui.getMode()===x.AUTO_COMPLETE?i:t;this.optionSelectText=It(0,0,n.map(a=>a.item?`[shadow=${le(a.style??this.defaultTextStyle,!0)}][color=${le(a.style??O.WINDOW,!1)}]    ${a.label}[/color][/shadow]`:`[shadow=${le(a.style??this.defaultTextStyle,!0)}][color=${le(a.style??O.WINDOW,!1)}]${a.label}[/color][/shadow]`).join(`
`),O.WINDOW,{maxLines:t.length,lineSpacing:12}),this.optionSelectText.setOrigin(0,0),this.optionSelectText.setName("text-option-select"),this.optionSelectTextContainer.add(this.optionSelectText),this.optionSelectContainer.setPosition(s.scaledCanvas.width-1-(this.config?.xOffset||0),-48+(this.config?.yOffset||0)),this.optionSelectBg.width=Math.max(this.optionSelectText.displayWidth+24,this.getWindowWidth()),this.optionSelectBg.height=this.getWindowHeight(),this.optionSelectTextContainer.setPosition(this.optionSelectBg.x-this.optionSelectBg.width+12+24*this.scale,this.optionSelectBg.y-this.optionSelectBg.height+2+42*this.scale),this.textContent=i.map(a=>a.item?`[shadow=${le(a.style??this.defaultTextStyle,!0)}][color=${le(a.style??O.WINDOW,!1)}]    ${a.label}[/color][/shadow]`:`[shadow=${le(a.style??this.defaultTextStyle,!0)}][color=${le(a.style??O.WINDOW,!1)}]${a.label}[/color][/shadow]`).join(`
`),this.optionSelectText.setText(this.textContent),t.forEach((a,r)=>{if(a.item){const o=s.add.sprite(0,0,"items",a.item);if(o.setScale(3*this.scale),this.optionSelectIcons.push(o),this.optionSelectTextContainer.add(o),o.setPositionRelative(this.optionSelectText,36*this.scale,7+r*(114*this.scale-3)),a.item==="candy"){const l=s.add.sprite(0,0,"items","candy_overlay");l.setScale(3*this.scale),this.optionSelectIcons.push(l),this.optionSelectTextContainer.add(l),l.setPositionRelative(this.optionSelectText,36*this.scale,7+r*(114*this.scale-3)),a.itemArgs&&(o.setTint(qt(Dt(a.itemArgs[0]))),l.setTint(qt(Dt(a.itemArgs[1]))))}}})}show(e){return e.length===0||!e[0].hasOwnProperty("options")||e[0].options.length===0?!1:(super.show(e),this.config=e[0],this.setupOptions(),s.ui.bringToTop(this.optionSelectContainer),this.optionSelectContainer.setVisible(!0),this.scrollCursor=0,this.fullCursor=0,this.setCursor(0),this.config.delay&&(this.blockInput=!0,this.optionSelectTextContainer.setAlpha(.5),this.cursorObj?.setAlpha(.8),s.time.delayedCall(ge(this.config.delay),()=>this.unblockInput())),this.config?.supportHover&&this.config?.options[this.unskippedIndices[this.fullCursor]]?.onHover?.(),!0)}processInput(e){const t=this.getUi();let i=!1,n=!0;if(e===b.ACTION||e===b.CANCEL){if(this.blockInput)return t.playError(),!1;if(i=!0,e===b.CANCEL)if(this.config?.maxOptions&&this.config.options.length>this.config.maxOptions)this.setCursor(this.unskippedIndices.length-1);else if(!this.config?.noCancel)this.setCursor(this.unskippedIndices.length-1);else return!1;const a=this.config?.options[this.unskippedIndices[this.fullCursor]];a?.handler()?(a.keepOpen||this.clear(),n=!a.overrideSound):t.playError()}else if(e===b.SUBMIT&&t.getMode()===x.AUTO_COMPLETE){i=!0;const a=this.config?.options[this.unskippedIndices[this.fullCursor]];a?.handler()?(a.keepOpen||this.clear(),n=!a.overrideSound):t.playError()}else{switch(e){case b.UP:this.fullCursor===0?i=this.setCursor(this.unskippedIndices.length-1):this.fullCursor&&(i=this.setCursor(this.fullCursor-1));break;case b.DOWN:this.fullCursor<this.unskippedIndices.length-1?i=this.setCursor(this.fullCursor+1):i=this.setCursor(0);break}this.config?.supportHover&&this.config?.options[this.unskippedIndices[this.fullCursor]]?.onHover?.()}return i&&n&&t.playSelect(),i}unblockInput(){this.blockInput&&(this.blockInput=!1,this.optionSelectTextContainer.setAlpha(1),this.cursorObj?.setAlpha(1))}getOptionsWithScroll(){if(!this.config)return[];const e=this.config.options.slice(0);if(!this.config.maxOptions||this.config.options.length<this.config.maxOptions)return e;const t=e.length,i=this.scrollCursor,n=Math.min(t,i+(!i||this.scrollCursor+(this.config.maxOptions-1)>=t?this.config.maxOptions-1:this.config.maxOptions-2));return this.config?.maxOptions&&e.length>this.config.maxOptions&&(e.splice(n,t),e.splice(0,i),i&&e.unshift({label:fC,handler:h(()=>!0,"handler"),style:this.defaultTextStyle}),n<t&&e.push({label:gC,handler:h(()=>!0,"handler"),style:this.defaultTextStyle})),e}getUnskippedIndices(e){return e.map((i,n)=>i.skip?null:n).filter(i=>i!==null)}setCursor(e){const t=this.fullCursor!==e;if(t&&this.config?.maxOptions&&this.config.options.length>this.config.maxOptions)if(e===this.unskippedIndices.length-1)this.fullCursor=e,this.cursor=this.config.maxOptions-(this.config.options.length-this.unskippedIndices[e]),this.scrollCursor=this.config.options.length-this.config.maxOptions+1;else if(e===0)this.fullCursor=e,this.cursor=this.unskippedIndices[e],this.scrollCursor=0;else if(e&&e>this.fullCursor){const n=this.unskippedIndices[e]-this.unskippedIndices[this.fullCursor],a=this.unskippedIndices[e+1]-this.unskippedIndices[e]-1;this.cursor+n+a>=this.config.maxOptions-1?(this.fullCursor=e,this.cursor=this.config.maxOptions-2-a,this.scrollCursor=this.unskippedIndices[this.fullCursor]-this.cursor+1):(this.fullCursor=e,this.cursor=this.unskippedIndices[e]-this.scrollCursor+(this.scrollCursor?1:0))}else{const n=this.unskippedIndices[e]-this.unskippedIndices[e-1];this.cursor-n<1?(this.fullCursor=e,this.cursor=1,this.scrollCursor=this.unskippedIndices[this.fullCursor]-this.cursor+1):(this.fullCursor=e,this.cursor=this.unskippedIndices[e]-this.scrollCursor+(this.scrollCursor?1:0))}else this.fullCursor=e,this.cursor=this.unskippedIndices[e];return this.setupOptions(),this.cursorObj||(this.cursorObj=s.add.image(0,0,"cursor"),this.optionSelectContainer.add(this.cursorObj)),this.cursorObj.setScale(this.scale*6),this.cursorObj.setPositionRelative(this.optionSelectBg,12,102*this.scale+this.cursor*(114*this.scale-3)),t}clear(){super.clear(),this.config=null,this.optionSelectContainer.setVisible(!1),this.fullCursor=0,this.scrollCursor=0,this.eraseCursor()}eraseCursor(){this.cursorObj&&this.cursorObj.destroy(),this.cursorObj=null}};h(Ac,"AbstractOptionSelectUiHandler");let mn=Ac;const rn=class rn extends mn{switchCheck;switchCheckCursor;constructor(){super(x.CONFIRM)}getWindowWidth(){return rn.windowWidth}show(e){if(e.length===5&&e[0]instanceof Function&&e[1]instanceof Function&&e[2]instanceof Function&&e[3]instanceof Function&&e[4]==="fullParty"){const t={options:[{label:f.t("partyUiHandler:summary"),handler:h(()=>(e[0](),!0),"handler")},{label:f.t("partyUiHandler:pokedex"),handler:h(()=>(e[1](),!0),"handler")},{label:f.t("menu:yes"),handler:h(()=>(e[2](),!0),"handler")},{label:f.t("menu:no"),handler:h(()=>(e[3](),!0),"handler")}],delay:e.length>=9&&e[8]!==null?e[8]:0};super.show([t]),this.switchCheck=e.length>=6&&e[5]!==null&&e[5];const i=e.length>=7&&e[6]!==null?e[6]:0,n=e.length>=8&&e[7]!==null?e[7]:0;return this.optionSelectContainer.setPosition(s.scaledCanvas.width-1+i,-48+n),this.setCursor(this.switchCheck?this.switchCheckCursor:0),!0}if(e.length>=2&&e[0]instanceof Function&&e[1]instanceof Function){const t={options:[{label:f.t("menu:yes"),handler:h(()=>(e[0](),!0),"handler")},{label:f.t("menu:no"),handler:h(()=>(e[1](),!0),"handler")}],delay:e.length>=6&&e[5]!==null?e[5]:0,noCancel:e.length>=7&&e[6]!==null?e[6]:!1};super.show([t]),this.switchCheck=e.length>=3&&e[2]!==null&&e[2];const i=e.length>=4&&e[3]!==null?e[3]:0,n=e.length>=5&&e[4]!==null?e[4]:0;return this.optionSelectContainer.setPosition(s.scaledCanvas.width-1+i,-48+n),this.setCursor(this.switchCheck?this.switchCheckCursor:0),!0}return!1}processInput(e){return e===b.CANCEL&&this.blockInput&&!this.config?.noCancel&&this.unblockInput(),super.processInput(e)}setCursor(e){const t=super.setCursor(e);return t&&this.switchCheck&&(this.switchCheckCursor=this.cursor),t}};h(rn,"ConfirmUiHandler"),Gi(rn,"windowWidth",48);let Oa=rn;const vs=24,yi=[[0,-1],[.825,-.5],[.825,.5],[-.825,-.5],[-.825,.5],[0,1]],mC=-3,qn=1,Tf=[0,qn,-qn,qn,-qn,mC],yC=[0,5,0,5,0,0],Ti=[0,1,2,5,4,3],Zn=new Array(12).fill(0),xc=class xc extends Phaser.GameObjects.Container{showDiff;statsIvsCache;ivChart;ivStatValueTexts;constructor(e,t,i){super(s,e,t),this.showDiff=!!i,this.setup()}setup(){this.setName("stats");const e=new Array(6).fill(null).flatMap((a,r)=>[vs*yi[Ti[r]][0],vs*yi[Ti[r]][1]]),t=s.add.polygon(48,44,e,14213360,.625);t.setOrigin(0,0);const i=s.add.polygon(t.x,t.y,e).setStrokeStyle(1,4735056);i.setOrigin(0,0);const n=[[0,-1,0,1],[-.825,-.5,.825,.5],[.825,-.5,-.825,.5]].map(a=>{const r=new Phaser.GameObjects.Line(s,t.x,t.y,vs*a[0],vs*a[1],vs*a[2],vs*a[3],16777215).setLineWidth(.5);return r.setOrigin(0,0),r});this.ivChart=s.add.polygon(t.x,t.y,Zn,10016928,.75),this.ivChart.setOrigin(0,0),this.add(t),n.map(a=>this.add(a)),this.add(this.ivChart),this.add(i),this.ivStatValueTexts=[];for(const a of sn){const r=P(t.x+vs*yi[a][0]*1.325+(this.showDiff?0:Tf[a]),t.y+vs*yi[a][1]*1.325-4+(this.showDiff?0:yC[a]),f.t(nn(a)),O.STATS_HEXAGON);r.setOrigin(.5),this.ivStatValueTexts[a]=It(r.x-(this.showDiff?0:Tf[a]),r.y+8,"0",O.STATS_HEXAGON),this.ivStatValueTexts[a].setOrigin(.5),this.add(r),this.add(this.ivStatValueTexts[a])}}updateIvs(e,t){if(e){const i=new Array(6).fill(null).flatMap((c,u)=>[e[Ti[u]]/31*vs*yi[Ti[u]][0],e[Ti[u]]/31*vs*yi[Ti[u]][1]]),n=this.statsIvsCache||Zn,a=le(O.SUMMARY_GOLD,!1);this.statsIvsCache=i.slice(0),this.ivStatValueTexts.map((c,u)=>{let p="";e[u]===31?p+=`[color=${a}][shadow]${e[u].toString()}[/shadow][/color]`:p=e[u].toString(),this.showDiff&&t&&(t[u]<e[u]?p+=` ([color=${le(O.SUMMARY_BLUE,!1)}][shadow=${le(O.SUMMARY_BLUE,!0)}]+${e[u]-t[u]}[/shadow][/color])`:p+=" (-)"),c.setText(`[shadow]${p}[/shadow]`)});const r=e.every(c=>c===31)?Number.parseInt(a.substr(1),16):10016928,o=this.ivChart.fillColor,l=o!==r?[Phaser.Display.Color.IntegerToColor(o),Phaser.Display.Color.IntegerToColor(r)]:null;s.tweens.addCounter({from:0,to:1,duration:1e3,ease:"Cubic.easeOut",onUpdate:h(c=>{const u=c.getValue()??1,p=i.map((m,d)=>m*u+n[d]*(1-u));l&&this.ivChart.setFillStyle(Phaser.Display.Color.ValueToColor(Phaser.Display.Color.Interpolate.ColorWithColor(l[0],l[1],1,u)).color,.75),this.ivChart.setTo(p)},"onUpdate")})}else this.statsIvsCache=Zn,this.ivChart.setTo(Zn)}};h(xc,"StatsContainer");let yn=xc;const Qn={en:{infoContainerTextSize:"64px",infoContainerLabelXPos:-20,infoContainerTextXPos:-17},pt:{infoContainerTextSize:"60px",infoContainerLabelXPos:-15,infoContainerTextXPos:-12},ja:{infoContainerTextSize:"64px",infoContainerLabelXPos:-27,infoContainerTextXPos:-25}},_c=class _c extends Phaser.GameObjects.Container{infoWindowWidth=104;pokemonFormLabelText;pokemonFormText;pokemonGenderText;pokemonGenderNewText;pokemonAbilityLabelText;pokemonAbilityText;pokemonNatureLabelText;pokemonNatureText;pokemonShinyIcon;pokemonShinyNewIcon;pokemonFusionShinyIcon;pokemonMovesContainer;pokemonMovesContainers;pokemonMoveBgs;pokemonMoveLabels;infoBg;numCharsBeforeCutoff=16;initialX;movesContainerInitialX;statsContainer;shown;constructor(e=372,t=66){super(s,e,t),this.initialX=e}setup(){this.setName("pkmn-info");const e=f.resolvedLanguage,t=Object.keys(Qn).find(c=>e?.includes(c)),i=Qn[t];this.infoBg=Ce(0,0,this.infoWindowWidth,132),this.infoBg.setOrigin(.5,.5),this.infoBg.setName("window-info-bg"),this.pokemonMovesContainer=s.add.container(6,14),this.pokemonMovesContainer.setName("pkmn-moves"),this.movesContainerInitialX=this.pokemonMovesContainer.x,this.pokemonMovesContainers=[],this.pokemonMoveBgs=[],this.pokemonMoveLabels=[];const n=Ce(0,0,58,52);n.setOrigin(1,0),n.setName("window-moves-bg"),this.pokemonMovesContainer.add(n);const a=P(-n.width/2,6,f.t("pokemonInfoContainer:moveset"),O.WINDOW,{fontSize:"64px"});a.setOrigin(.5,0),a.setName("text-moves"),this.pokemonMovesContainer.add(a);for(let c=0;c<4;c++){const u=s.add.container(-6,18+7*c);u.setScale(.5),u.setName("move");const p=s.add.nineslice(0,0,"type_bgs","unknown",92,14,2,2,2,2);p.setOrigin(1,0),p.setName("nineslice-move-bg");const m=P(-p.width/2,0,"-",O.MOVE_LABEL);m.setOrigin(.5,0),m.setName("text-move-label"),this.pokemonMoveBgs.push(p),this.pokemonMoveLabels.push(m),u.add(p),u.add(m),this.pokemonMovesContainers.push(u),this.pokemonMovesContainer.add(u)}this.add(this.pokemonMovesContainer),this.statsContainer=new yn(-48,-64,!0),this.add(this.infoBg),this.add(this.statsContainer);const r=i?.infoContainerLabelXPos||-18,o=i?.infoContainerTextXPos||-14,l=i?.infoContainerTextSize||"64px";this.pokemonFormLabelText=P(r,19,f.t("pokemonInfoContainer:form"),O.WINDOW,{fontSize:l}),this.pokemonFormLabelText.setOrigin(1,0),this.pokemonFormLabelText.setVisible(!1),this.add(this.pokemonFormLabelText),this.pokemonFormText=P(o,19,"",O.WINDOW,{fontSize:l}),this.pokemonFormText.setOrigin(0,0),this.pokemonFormText.setVisible(!1),this.add(this.pokemonFormText),this.pokemonGenderText=P(-42,-61,"",O.WINDOW,{fontSize:l}),this.pokemonGenderText.setOrigin(0,0),this.pokemonGenderText.setVisible(!1),this.pokemonGenderText.setName("text-pkmn-gender"),this.add(this.pokemonGenderText),this.pokemonGenderNewText=P(-36,-61,"",O.WINDOW,{fontSize:"64px"}),this.pokemonGenderNewText.setOrigin(0,0),this.pokemonGenderNewText.setVisible(!1),this.pokemonGenderNewText.setName("text-pkmn-new-gender"),this.add(this.pokemonGenderNewText),this.pokemonAbilityLabelText=P(r,29,f.t("pokemonInfoContainer:ability"),O.WINDOW,{fontSize:l}),this.pokemonAbilityLabelText.setOrigin(1,0),this.pokemonAbilityLabelText.setName("text-pkmn-ability-label"),this.add(this.pokemonAbilityLabelText),this.pokemonAbilityText=P(o,29,"",O.WINDOW,{fontSize:l}),this.pokemonAbilityText.setOrigin(0,0),this.pokemonAbilityText.setName("text-pkmn-ability"),this.add(this.pokemonAbilityText),this.pokemonNatureLabelText=P(r,39,f.t("pokemonInfoContainer:nature"),O.WINDOW,{fontSize:l}),this.pokemonNatureLabelText.setOrigin(1,0),this.pokemonNatureLabelText.setName("text-pkmn-nature-label"),this.add(this.pokemonNatureLabelText),this.pokemonNatureText=It(o,39,"",O.WINDOW,{fontSize:l,lineSpacing:3,maxLines:2}),this.pokemonNatureText.setOrigin(0,0),this.pokemonNatureText.setName("text-pkmn-nature"),this.add(this.pokemonNatureText),this.pokemonShinyIcon=s.add.image(-43.5,48.5,"shiny_star"),this.pokemonShinyIcon.setOrigin(0,0),this.pokemonShinyIcon.setScale(.75),this.pokemonShinyIcon.setInteractive(new Phaser.Geom.Rectangle(0,0,12,15),Phaser.Geom.Rectangle.Contains),this.pokemonShinyIcon.setName("img-pkmn-shiny-icon"),this.add(this.pokemonShinyIcon),this.pokemonShinyNewIcon=P(this.pokemonShinyIcon.x+12,this.pokemonShinyIcon.y,"",O.WINDOW,{fontSize:l}),this.pokemonShinyNewIcon.setOrigin(0,0),this.pokemonShinyNewIcon.setName("text-pkmn-shiny-new-icon"),this.add(this.pokemonShinyNewIcon),this.pokemonShinyNewIcon.setVisible(!1),this.pokemonFusionShinyIcon=s.add.image(this.pokemonShinyIcon.x,this.pokemonShinyIcon.y,"shiny_star_2"),this.pokemonFusionShinyIcon.setOrigin(0,0),this.pokemonFusionShinyIcon.setScale(.75),this.pokemonFusionShinyIcon.setName("img-pkmn-fusion-shiny-icon"),this.add(this.pokemonFusionShinyIcon),this.setVisible(!1)}show(e,t=!1,i=1,n,a,r=!1){return new Promise(o=>{n||(n=s.gameData.dexData[e.species.speciesId]),a||(a=s.gameData.starterData[e.species.getRootSpeciesId()]);const l=BigInt(n.caughtAttr);if(e.gender>Ut.GENDERLESS){this.pokemonGenderText.setText(Fh(e.gender)),this.pokemonGenderText.setColor(Mi(e.gender)),this.pokemonGenderText.setShadowColor(Mi(e.gender,!0)),this.pokemonGenderText.setVisible(!0);const A=BigInt(1<<e.gender)*F.MALE;this.pokemonGenderNewText.setText("(+)"),this.pokemonGenderNewText.setColor(le(O.SUMMARY_BLUE,!1)),this.pokemonGenderNewText.setShadowColor(le(O.SUMMARY_BLUE,!0)),this.pokemonGenderNewText.setVisible((A&l)===BigInt(0))}else this.pokemonGenderNewText.setVisible(!1),this.pokemonGenderText.setVisible(!1);const c=e.species.getFormNameToDisplay(e.formIndex);c?(this.pokemonFormLabelText.setVisible(!0),this.pokemonFormText.setVisible(!0),(BigInt(1<<e.formIndex)*F.DEFAULT_FORM&l)===BigInt(0)?(this.pokemonFormLabelText.setColor(le(O.SUMMARY_BLUE,!1)),this.pokemonFormLabelText.setShadowColor(le(O.SUMMARY_BLUE,!0))):(this.pokemonFormLabelText.setColor(le(O.WINDOW,!1)),this.pokemonFormLabelText.setShadowColor(le(O.WINDOW,!0))),this.pokemonFormText.setText(c.length>this.numCharsBeforeCutoff?`${c.substring(0,this.numCharsBeforeCutoff-3)}...`:c),c.length>this.numCharsBeforeCutoff?(this.pokemonFormText.setInteractive(new Phaser.Geom.Rectangle(0,0,this.pokemonFormText.width,this.pokemonFormText.height),Phaser.Geom.Rectangle.Contains),this.pokemonFormText.on("pointerover",()=>s.ui.showTooltip("",c,!0)),this.pokemonFormText.on("pointerout",()=>s.ui.hideTooltip())):this.pokemonFormText.disableInteractive()):(this.pokemonFormLabelText.setVisible(!1),this.pokemonFormText.setVisible(!1),this.pokemonFormText.disableInteractive());const u=e.abilityIndex===2?O.MONEY:O.WINDOW;this.pokemonAbilityText.setText(e.getAbility(!0).name),this.pokemonAbilityText.setColor(le(u,!1)),this.pokemonAbilityText.setShadowColor(le(u,!0)),e.checkIfPlayerHasAbilityOfStarter(a.abilityAttr)?(this.pokemonAbilityLabelText.setColor(le(O.WINDOW,!1)),this.pokemonAbilityLabelText.setShadowColor(le(O.WINDOW,!0))):(this.pokemonAbilityLabelText.setColor(le(O.SUMMARY_BLUE,!1)),this.pokemonAbilityLabelText.setShadowColor(le(O.SUMMARY_BLUE,!0))),this.pokemonNatureText.setText(ki(e.getNature(),!0,!1,!1));const m=n.natureAttr,d=1<<e.nature+1;m&d?(this.pokemonNatureLabelText.setColor(le(O.WINDOW,!1)),this.pokemonNatureLabelText.setShadowColor(le(O.WINDOW,!0))):(this.pokemonNatureLabelText.setColor(le(O.SUMMARY_BLUE,!1)),this.pokemonNatureLabelText.setShadowColor(le(O.SUMMARY_BLUE,!0)));const y=e.isFusion(),g=y&&e.shiny&&e.fusionShiny,C=g?e.variant:e.getVariant();if(this.pokemonShinyIcon.setTexture(`shiny_star${g?"_1":""}`),this.pokemonShinyIcon.setVisible(e.isShiny()),this.pokemonShinyIcon.setTint(Et(C)),this.pokemonShinyIcon.visible){let A="";(g||C)&&(A=" ("+Yp(C),g&&(A+="/"+Yp(e.fusionVariant)),A+=")"),this.pokemonShinyIcon.on("pointerover",()=>s.ui.showTooltip("",f.t("common:shinyOnHover")+A,!0)).on("pointerout",()=>s.ui.hideTooltip());const _=BigInt(1<<(e.shiny?1:0)),w=BigInt(1<<e.variant+4);this.pokemonShinyNewIcon.setText("(+)"),this.pokemonShinyNewIcon.setColor(le(O.SUMMARY_BLUE,!1)),this.pokemonShinyNewIcon.setShadowColor(le(O.SUMMARY_BLUE,!0));const L=(_&l)===BigInt(0)||(w&l)===BigInt(0);this.pokemonShinyNewIcon.setVisible(!!L)}else(l&F.NON_SHINY)===BigInt(0)&&(l&F.SHINY)===F.SHINY?(this.pokemonShinyNewIcon.setVisible(!0),this.pokemonShinyNewIcon.setText("(+)"),this.pokemonShinyNewIcon.setColor(le(O.SUMMARY_BLUE,!1)),this.pokemonShinyNewIcon.setShadowColor(le(O.SUMMARY_BLUE,!0))):this.pokemonShinyNewIcon.setVisible(!1);this.pokemonFusionShinyIcon.setPosition(this.pokemonShinyIcon.x,this.pokemonShinyIcon.y),this.pokemonFusionShinyIcon.setVisible(g),y&&this.pokemonFusionShinyIcon.setTint(Et(e.fusionVariant));const E=e.species.getRootSpeciesId(),I=r?n.caughtAttr?n.ivs:null:s.gameData.dexData[E].caughtAttr?s.gameData.dexData[E].ivs:null;this.statsContainer.updateIvs(e.ivs,I),r||(s.tweens.add({targets:this,duration:ge(Math.floor(750/i)),ease:"Cubic.easeInOut",x:this.initialX-this.infoWindowWidth,onComplete:h(()=>{o()},"onComplete")}),t&&s.tweens.add({delay:ge(Math.floor(325/i)),targets:this.pokemonMovesContainer,duration:ge(Math.floor(325/i)),ease:"Cubic.easeInOut",x:this.movesContainerInitialX-57,onComplete:h(()=>o(),"onComplete")}));for(let A=0;A<4;A++){const _=A<e.moveset.length&&e.moveset[A]?e.moveset[A].getMove():null;this.pokemonMoveBgs[A].setFrame(Me[_?_.type:Me.UNKNOWN].toString().toLowerCase()),this.pokemonMoveLabels[A].setText(_?_.name:"-"),this.pokemonMovesContainers[A].setVisible(!!_)}this.setVisible(!0),this.shown=!0,s.hideEnemyModifierBar()})}changeToEggSummaryLayout(){const e=f.resolvedLanguage,t=Object.keys(Qn).find(o=>e?.includes(o)),i=Qn[t],n=43,a=(i?.infoContainerLabelXPos||-18)+n,r=(i?.infoContainerTextXPos||-14)+n;this.x=this.initialX-this.infoWindowWidth,this.pokemonGenderText.setPosition(89,-2),this.pokemonGenderNewText.setPosition(79,-2),this.pokemonShinyIcon.setPosition(82,87),this.pokemonShinyNewIcon.setPosition(72,87),this.pokemonFormLabelText.setPosition(a,153),this.pokemonFormText.setPosition(r,153),this.pokemonAbilityLabelText.setPosition(a,111),this.pokemonAbilityText.setPosition(r,111),this.pokemonNatureLabelText.setPosition(a,126),this.pokemonNatureText.setPosition(r,126),this.statsContainer.setScale(.7),this.statsContainer.setPosition(30,-3),this.infoBg.setVisible(!1),this.pokemonMovesContainer.setVisible(!1)}makeRoomForConfirmUi(e=1,t=!1){const i=t?this.initialX-this.infoWindowWidth-67:this.initialX-this.infoWindowWidth-Oa.windowWidth,n=s.tweens.getTweensOf(this)[0],a=Math.max(n?n.duration-n.elapsed:0,150);return n?.destroy(),new Promise(r=>{s.tweens.add({targets:this,duration:ge(Math.floor(a/e)),ease:"Cubic.easeInOut",x:i,onComplete:h(()=>{r()},"onComplete")})})}hide(e=1){return new Promise(t=>{if(!this.shown)return s.showEnemyModifierBar(),t();s.tweens.add({targets:this.pokemonMovesContainer,duration:ge(Math.floor(750/e)),ease:"Cubic.easeInOut",x:this.movesContainerInitialX}),s.tweens.add({targets:this,duration:ge(Math.floor(750/e)),ease:"Cubic.easeInOut",x:this.initialX,onComplete:h(()=>{this.setVisible(!1),this.pokemonShinyIcon.off("pointerover"),this.pokemonShinyIcon.off("pointerout"),s.ui.hideTooltip(),s.showEnemyModifierBar(),t()},"onComplete")}),this.shown=!1})}};h(_c,"PokemonInfoContainer");let Tn=_c;const wc=class wc extends Ge{phaseName="EggHatchPhase";egg;eggHatchData;eggsToHatchCount;eggCounterContainer;eggHatchHandler;eggHatchContainer;eggHatchBg;eggHatchOverlay;eggContainer;eggSprite;eggCrackSprite;eggLightraysOverlay;pokemonSprite;pokemonShinySparkle;infoContainer;pokemon;eggMoveIndex;hatched;canSkip;skipped;evolutionBgm;eggLapsePhase;constructor(e,t,i){super(),this.eggLapsePhase=e,this.egg=t,this.eggsToHatchCount=i}start(){super.start(),s.ui.setModeForceTransition(x.EGG_HATCH_SCENE).then(()=>{if(!this.egg)return this.end();const e=s.gameData.eggs.findIndex(n=>n.id===this.egg.id);if(e===-1)return this.end();s.gameData.eggs.splice(e,1),s.fadeOutBgm(void 0,!1),this.eggHatchHandler=s.ui.getHandler(),this.eggHatchContainer=this.eggHatchHandler.eggHatchContainer,this.eggHatchBg=s.add.image(0,0,"default_bg"),this.eggHatchBg.setOrigin(0,0),this.eggHatchContainer.add(this.eggHatchBg),this.eggContainer=s.add.container(this.eggHatchBg.displayWidth/2,this.eggHatchBg.displayHeight/2),this.eggSprite=s.add.sprite(0,0,"egg",`egg_${this.egg.getKey()}`),this.eggCrackSprite=s.add.sprite(0,0,"egg_crack","0"),this.eggCrackSprite.setVisible(!1),this.eggLightraysOverlay=s.add.sprite(-this.eggHatchBg.displayWidth/2+4,-this.eggHatchBg.displayHeight/2,"egg_lightrays","3"),this.eggLightraysOverlay.setOrigin(0,0),this.eggLightraysOverlay.setVisible(!1),this.eggContainer.add(this.eggSprite),this.eggContainer.add(this.eggCrackSprite),this.eggContainer.add(this.eggLightraysOverlay),this.eggHatchContainer.add(this.eggContainer),this.eggCounterContainer=new co(this.eggsToHatchCount),this.eggHatchContainer.add(this.eggCounterContainer);const t=h(()=>{const n=s.add.sprite(this.eggHatchBg.displayWidth/2,this.eggHatchBg.displayHeight/2,"pkmn__sub");return n.setPipeline(s.spritePipeline,{tone:[0,0,0,0],ignoreTimeTint:!0}),n},"getPokemonSprite");this.eggHatchContainer.add(this.pokemonSprite=t()),this.pokemonShinySparkle=s.add.sprite(this.pokemonSprite.x,this.pokemonSprite.y,"shiny"),this.pokemonShinySparkle.setVisible(!1),this.eggHatchContainer.add(this.pokemonShinySparkle),this.eggHatchOverlay=s.add.rectangle(0,-s.scaledCanvas.height,s.scaledCanvas.width,s.scaledCanvas.height,16777215),this.eggHatchOverlay.setOrigin(0,0),this.eggHatchOverlay.setAlpha(0),s.fieldUI.add(this.eggHatchOverlay),this.infoContainer=new Tn,this.infoContainer.setup(),this.eggHatchContainer.add(this.infoContainer);const i=this.generatePokemon();i.fusionSpecies&&i.clearFusionSpecies(),this.pokemonSprite.setVisible(!1),this.pokemon=i,i.loadAssets().then(()=>{this.canSkip=!0,s.time.delayedCall(1e3,()=>{this.hatched||(this.evolutionBgm=s.playSoundWithoutBgm("evolution"))}),s.time.delayedCall(2e3,()=>{this.hatched||(this.eggCrackSprite.setVisible(!0),this.doSpray(1,this.eggSprite.displayHeight/-2),this.doEggShake(2).then(()=>{this.hatched||s.time.delayedCall(1e3,()=>{this.hatched||(this.doSpray(2,this.eggSprite.displayHeight/-4),this.eggCrackSprite.setFrame("1"),s.time.delayedCall(125,()=>this.eggCrackSprite.setFrame("2")),this.doEggShake(4).then(()=>{this.hatched||s.time.delayedCall(1e3,()=>{this.hatched||(s.playSound("se/egg_crack"),this.doSpray(4),this.eggCrackSprite.setFrame("3"),s.time.delayedCall(125,()=>this.eggCrackSprite.setFrame("4")),this.doEggShake(8,2).then(()=>{this.hatched||this.doHatch()}))})}))})}))})})})}end(){s.phaseManager.hasPhaseOfType("EggHatchPhase")?this.eggHatchHandler.clear():s.time.delayedCall(250,()=>s.setModifiersVisible(!0)),this.pokemon?.destroy(),super.end()}doEggShake(e,t,i){return new Promise(n=>{t===void 0&&(t=0),i===void 0&&(i=0),s.playSound("se/pb_move"),s.tweens.add({targets:this.eggContainer,x:`-=${e/(i?1:2)}`,ease:"Sine.easeInOut",duration:125,onComplete:h(()=>{s.tweens.add({targets:this.eggContainer,x:`+=${e}`,ease:"Sine.easeInOut",duration:250,onComplete:h(()=>{if(i++,i<t)return this.doEggShake(e,t,i).then(()=>n());s.tweens.add({targets:this.eggContainer,x:`-=${e/2}`,ease:"Sine.easeInOut",duration:125,onComplete:h(()=>n(),"onComplete")})},"onComplete")})},"onComplete")})})}trySkip(){return!this.canSkip||this.skipped||this.eggCounterContainer.eggCountText?.data===void 0?!1:(this.skipped=!0,this.hatched?this.doReveal():this.doHatch(),!0)}doHatch(){this.canSkip=!1,this.hatched=!0,this.evolutionBgm&&Ds.fadeOut(s,this.evolutionBgm,ge(100));for(let e=0;e<5;e++)s.time.delayedCall(ge(375*e),()=>s.playSound("se/egg_hatch",{volume:1-e*.2}));this.eggLightraysOverlay.setVisible(!0),this.eggLightraysOverlay.play("egg_lightrays"),s.tweens.add({duration:ge(125),targets:this.eggHatchOverlay,alpha:1,ease:"Cubic.easeIn",onComplete:h(()=>{this.skipped=!1,this.canSkip=!0},"onComplete")}),s.time.delayedCall(ge(1500),()=>{this.canSkip=!1,this.skipped||this.doReveal()})}doReveal(){const e=this.pokemon.isShiny();this.pokemon.species.subLegendary&&s.validateAchv(Fe.HATCH_SUB_LEGENDARY),this.pokemon.species.legendary&&s.validateAchv(Fe.HATCH_LEGENDARY),this.pokemon.species.mythical&&s.validateAchv(Fe.HATCH_MYTHICAL),e&&s.validateAchv(Fe.HATCH_SHINY),this.eggContainer.setVisible(!1);const t=this.pokemon.getSpriteKey(!0);try{this.pokemonSprite.play(t)}catch(i){console.error(`Failed to play animation for ${t}`,i)}this.pokemonSprite.setPipelineData("ignoreTimeTint",!0),this.pokemonSprite.setPipelineData("spriteKey",this.pokemon.getSpriteKey()),this.pokemonSprite.setPipelineData("shiny",this.pokemon.shiny),this.pokemonSprite.setPipelineData("variant",this.pokemon.variant),this.pokemonSprite.setVisible(!0),s.time.delayedCall(ge(250),()=>{this.eggsToHatchCount--,this.eggHatchHandler.eventTarget.dispatchEvent(new ho(this.eggsToHatchCount)),this.pokemon.cry(),e&&s.time.delayedCall(ge(500),()=>{tm(this.pokemonShinySparkle,this.pokemon.variant)}),s.time.delayedCall(ge(this.skipped?e?750:250:e?1750:1250),()=>{this.infoContainer.show(this.pokemon,!1,this.skipped?2:1),s.playSoundWithoutBgm("evolution_fanfare"),s.ui.showText(f.t("egg:hatchFromTheEgg",{pokemonName:this.pokemon.species.getExpandedSpeciesName()}),null,()=>{s.gameData.updateSpeciesDexIvs(this.pokemon.species.speciesId,this.pokemon.ivs),s.gameData.setPokemonCaught(this.pokemon,!0,!0).then(()=>{s.gameData.setEggMoveUnlocked(this.pokemon.species,this.eggMoveIndex).then(i=>{this.eggHatchData.setEggMoveUnlocked(i),s.ui.showText("",0),this.end()})})},null,!0,3e3)})}),s.tweens.add({duration:ge(this.skipped?500:3e3),targets:this.eggHatchOverlay,alpha:0,ease:"Cubic.easeOut"})}sin(e,t){return t*Math.sin(e*(Math.PI/128))}doSpray(e,t){s.tweens.addCounter({repeat:e,duration:xs(1),onRepeat:h(()=>{this.doSprayParticle(ns(8),t||0)},"onRepeat")})}doSprayParticle(e,t){const i=this.eggHatchBg.displayWidth/2,n=this.eggHatchBg.displayHeight/2+t,a=this.egg.isManaphyEgg()?"1":this.egg.tier.toString(),r=s.add.image(i,n,"egg_shard",`${a}_${Math.floor(e/2)}`);this.eggHatchContainer.add(r);let o=0,l=0;const c=3-ns(8),u=24+ns(32),p=s.tweens.addCounter({repeat:-1,duration:xs(1),onRepeat:h(()=>{m()},"onRepeat")}),m=h(()=>{const d=this.skipped?6:1;l+=d,e<160?(r.setPosition(i+c*o/3,n+l),r.y+=-this.sin(e,u),o>108&&r.setScale(1-(o-108)/20),e+=2*d,o+=d):(r.destroy(),p.remove())},"updateParticle");m()}generatePokemon(){return this.eggHatchData=this.eggLapsePhase.generatePokemon(this.egg),this.eggMoveIndex=this.eggHatchData.eggMoveIndex,this.eggHatchData.pokemon}};h(wc,"EggHatchPhase");let uo=wc;const Mc=class Mc{pokemon;eggMoveIndex;eggMoveUnlocked;dexEntryBeforeUpdate;starterDataEntryBeforeUpdate;constructor(e,t){this.pokemon=e,this.eggMoveIndex=t}setEggMoveUnlocked(e){this.eggMoveUnlocked=e}setDex(){const e=s.gameData.dexData[this.pokemon.species.speciesId],t=s.gameData.starterData[this.pokemon.species.getRootSpeciesId()];this.dexEntryBeforeUpdate={seenAttr:e.seenAttr,caughtAttr:e.caughtAttr,natureAttr:e.natureAttr,seenCount:e.seenCount,caughtCount:e.caughtCount,hatchedCount:e.hatchedCount,ivs:[...e.ivs],ribbons:e.ribbons},this.starterDataEntryBeforeUpdate={moveset:t.moveset,eggMoves:t.eggMoves,candyCount:t.candyCount,friendship:t.friendship,abilityAttr:t.abilityAttr,passiveAttr:t.passiveAttr,valueReduction:t.valueReduction,classicWinCount:t.classicWinCount}}getDex(){return this.dexEntryBeforeUpdate}getStarterEntry(){return this.starterDataEntryBeforeUpdate}updatePokemon(e=!1){return new Promise(t=>{s.gameData.setPokemonCaught(this.pokemon,!0,!0,e).then(()=>{s.gameData.updateSpeciesDexIvs(this.pokemon.species.speciesId,this.pokemon.ivs),s.gameData.setEggMoveUnlocked(this.pokemon.species,this.eggMoveIndex,e).then(i=>{this.setEggMoveUnlocked(i),t()})})})}};h(Mc,"EggHatchData");let po=Mc;const kc=class kc extends Ge{phaseName="EggLapsePhase";eggHatchData=[];minEggsToSkip=2;start(){super.start();const e=s.gameData.eggs.filter(i=>ie.EGG_IMMEDIATE_HATCH_OVERRIDE?!0:--i.hatchWaves<1),t=e.length;this.eggHatchData=[],t>0?t>=this.minEggsToSkip&&s.eggSkipPreference===1?s.ui.showText(f.t("battle:eggHatching"),0,()=>{s.ui.showText(f.t("battle:eggSkipPrompt",{eggsToHatch:t}),0),s.ui.setModeWithoutClear(x.CONFIRM,()=>{this.hatchEggsSkipped(e),this.showSummary()},()=>{this.hatchEggsRegular(e),this.end()},null,null,null,1e3,!0)},100,!0):t>=this.minEggsToSkip&&s.eggSkipPreference===2?(s.phaseManager.queueMessage(f.t("battle:eggHatching")),this.hatchEggsSkipped(e),this.showSummary()):(s.phaseManager.queueMessage(f.t("battle:eggHatching")),this.hatchEggsRegular(e),this.end()):this.end()}hatchEggsRegular(e){let t=e.length;for(const i of e)s.phaseManager.unshiftNew("EggHatchPhase",this,i,t),t--}hatchEggsSkipped(e){for(const t of e)this.hatchEggSilently(t)}showSummary(){s.phaseManager.unshiftNew("EggSummaryPhase",this.eggHatchData),this.end()}hatchEggSilently(e){const t=s.gameData.eggs.findIndex(a=>a.id===e.id);if(t===-1)return this.end();s.gameData.eggs.splice(t,1);const n=this.generatePokemon(e).pokemon;n.fusionSpecies&&n.clearFusionSpecies(),n.species.subLegendary&&s.validateAchv(Fe.HATCH_SUB_LEGENDARY),n.species.legendary&&s.validateAchv(Fe.HATCH_LEGENDARY),n.species.mythical&&s.validateAchv(Fe.HATCH_MYTHICAL),n.isShiny()&&s.validateAchv(Fe.HATCH_SHINY)}generatePokemon(e){let t,i;return s.executeWithSeedOffset(()=>{t=e.generatePlayerPokemon(),i=new po(t,e.eggMoveIndex),i.setDex(),this.eggHatchData.push(i)},e.id,Lr.toString()),i}};h(kc,"EggLapsePhase");let fo=kc;const Nc=class Nc extends Ge{phaseName="EggSummaryPhase";eggHatchData;constructor(e){super(),this.eggHatchData=e}start(){super.start();const e=h(t=>{t>=this.eggHatchData.length?s.ui.setModeForceTransition(x.EGG_HATCH_SUMMARY,this.eggHatchData).then(()=>{s.fadeOutBgm(void 0,!1)}):(this.eggHatchData[t].setDex(),this.eggHatchData[t].updatePokemon().then(()=>{t<this.eggHatchData.length&&e(t+1)}))},"updateNextPokemon");e(0)}end(){this.eggHatchData.forEach(e=>{e.pokemon?.destroy()}),this.eggHatchData=[],s.time.delayedCall(250,()=>s.setModifiersVisible(!0)),s.ui.setModeForceTransition(x.MESSAGE).then(()=>{super.end()})}};h(Nc,"EggSummaryPhase");let go=Nc;var ds=(T=>(T.Intro="INTRO",T.Access_Menu="ACCESS_MENU",T.Menu="MENU",T.Starter_Select="STARTER_SELECT",T.Pokedex="POKEDEX",T.Pokerus="POKERUS",T.Stat_Change="STAT_CHANGE",T.Select_Item="SELECT_ITEM",T.Egg_Gacha="EGG_GACHA",T))(ds||{});const TC={INTRO:h(()=>new Promise(T=>{s.ui.showText(f.t("tutorial:intro"),null,()=>T(),null,!0)}),"INTRO"),ACCESS_MENU:h(()=>new Promise(T=>{if(s.enableTouchControls)return T();s.showFieldOverlay(1e3).then(()=>s.ui.showText(f.t("tutorial:accessMenu"),null,()=>s.hideFieldOverlay(1e3).then(()=>T()),null,!0))}),"ACCESS_MENU"),MENU:h(()=>new Promise(T=>{s.gameData.saveTutorialFlag("ACCESS_MENU",!0),s.ui.showText(f.t("tutorial:menu"),null,()=>s.ui.showText("",null,()=>T()),null,!0)}),"MENU"),STARTER_SELECT:h(()=>new Promise(T=>{s.ui.showText(f.t("tutorial:starterSelect"),null,()=>s.ui.showText("",null,()=>T()),null,!0)}),"STARTER_SELECT"),POKERUS:h(()=>new Promise(T=>{s.ui.showText(f.t("tutorial:pokerus"),null,()=>s.ui.showText("",null,()=>T()),null,!0)}),"POKERUS"),STAT_CHANGE:h(()=>new Promise(T=>{s.showFieldOverlay(1e3).then(()=>s.ui.showText(f.t("tutorial:statChange"),null,()=>s.ui.showText("",null,()=>s.hideFieldOverlay(1e3).then(()=>T())),null,!0))}),"STAT_CHANGE"),SELECT_ITEM:h(()=>new Promise(T=>{s.ui.setModeWithoutClear(x.MESSAGE).then(()=>{s.ui.showText(f.t("tutorial:selectItem"),null,()=>s.ui.showText("",null,()=>s.ui.setModeWithoutClear(x.MODIFIER_SELECT).then(()=>T())),null,!0)})}),"SELECT_ITEM"),EGG_GACHA:h(()=>new Promise(T=>{s.ui.showText(f.t("tutorial:eggGacha"),null,()=>s.ui.showText("",null,()=>T()),null,!0)}),"EGG_GACHA")};async function ii(T){if(!s.enableTutorials&&!ie.BYPASS_TUTORIAL_SKIP_OVERRIDE||s.gameData.getTutorialFlags()[T]&&!ie.BYPASS_TUTORIAL_SKIP_OVERRIDE)return!1;const e=s.ui.getHandler(),t=s.disableMenu;return s.disableMenu=!0,e instanceof Ni&&(e.tutorialActive=!0),await CC(e),await TC[T](),await SC(e),s.disableMenu=t,s.gameData.saveTutorialFlag(T,!0),e instanceof Ni&&(e.tutorialActive=!1),!0}h(ii,"handleTutorial");async function CC(T){if(T instanceof Ni&&T.tutorialOverlay)s.tweens.add({targets:T.tutorialOverlay,alpha:.5,duration:750,ease:"Sine.easeOut",onComplete:h(()=>!0,"onComplete")});else return!0}h(CC,"showTutorialOverlay");async function SC(T){if(T instanceof Ni&&T.tutorialOverlay)s.tweens.add({targets:T.tutorialOverlay,alpha:0,duration:500,ease:"Sine.easeOut",onComplete:h(()=>!0,"onComplete")});else return!0}h(SC,"hideTutorialOverlay");const Pc=class Pc extends rt{phaseName="EncounterPhase";loaded;constructor(e=!1){super(),this.loaded=e}start(){super.start(),s.updateGameInfo(),s.initSession(),s.eventTarget.dispatchEvent(new sm),s.gameMode.isClassic&&s.currentBattle.waveIndex>200&&s.phaseManager.unshiftNew("GameOverPhase");const e=[],t=s.currentBattle;t.isBattleMysteryEncounter()&&!t.mysteryEncounter&&s.executeWithSeedOffset(()=>{const a=t.mysteryEncounterType;t.mysteryEncounter=s.getMysteryEncounter(a)},t.waveIndex*16);const i=t.mysteryEncounter;i&&(s.executeWithSeedOffset(()=>{i.onInit&&i.onInit(),i.populateDialogueTokensFromRequirements()},t.waveIndex),i.encounterAnimations&&i.encounterAnimations.length>0&&e.push(im(i.encounterAnimations).then(()=>nm(!0))),i.initIntroVisuals(),s.field.add(i.introVisuals));let n=0;if(t.enemyLevels?.every((a,r)=>{if(t.isBattleMysteryEncounter())return!1;if(!this.loaded)if(t.battleType===de.TRAINER)t.enemyParty[r]=t.trainer?.genPartyMember(r);else{let c=s.randomSpecies(t.waveIndex,a,!0);s.findModifier(u=>u instanceof am)&&!s.gameMode.isBoss(t.waveIndex)&&s.arena.biomeType!==Je.END&&Ke(10)===0&&(c=rm(a)),t.enemyParty[r]=s.addEnemyPokemon(c,a,yt.NONE,!!s.getEncounterBossSegments(t.waveIndex,a,c)),s.currentBattle.battleSpec===Xt.FINAL_BOSS&&t.enemyParty[r].ivs.fill(31),s.getPlayerParty().slice(0,t.double?2:1).reverse().forEach(u=>{ve("SyncEncounterNatureAbAttr",{pokemon:u,target:t.enemyParty[r]})})}const o=s.getEnemyParty()[r];r<(t.double?2:1)&&(o.setX(-66+o.getFieldPositionOffset()[0]),o.fieldSetup(!0)),this.loaded||s.gameData.setPokemonSeen(o,!0,t.battleType===de.TRAINER||t?.mysteryEncounter?.encounterMode===ms.TRAINER_BATTLE),o.species.speciesId===ye.ETERNATUS&&(s.gameMode.isClassic&&(t.battleSpec===Xt.FINAL_BOSS||s.gameMode.isWaveFinal(t.waveIndex))?(t.battleSpec!==Xt.FINAL_BOSS&&(o.formIndex=1,o.updateScale()),o.setBoss()):t.waveIndex%1e3||(o.formIndex=1,o.updateScale())),n+=o.getSpeciesForm().baseTotal,e.push(o.loadAssets()),`${o.stats[0]}${o.ivs[0]}`,`${o.stats[1]}${o.ivs[1]}`,`${o.stats[2]}${o.ivs[2]}`,`${o.stats[3]}${o.ivs[3]}`,`${o.stats[4]}${o.ivs[4]}`,`${o.stats[5]}${o.ivs[5]}`;const l=[];for(const c of o.getMoveset())l.push(c.getName());return`${Re(o)}`,`${o.species.speciesId}`,`${o.level}`,`${ki(o.nature,!0,!0,!0)}`,`${o.getAbility().name}`,o.hasPassive(),`${o.getPassiveAbility().name}`,o.isBoss()&&`${o.bossSegments}`,!0}),s.getPlayerParty().filter(a=>a.isShiny()).length===ua&&s.validateAchv(Fe.SHINY_PARTY),t.battleType===de.TRAINER)e.push(t.trainer?.loadAssets().then(()=>t.trainer?.initSprite()));else if(t.isBattleMysteryEncounter())t.mysteryEncounter?.introVisuals&&e.push(t.mysteryEncounter.introVisuals.loadAssets().then(()=>t.mysteryEncounter.introVisuals.initSprite())),t.mysteryEncounter?.loadAssets&&t.mysteryEncounter.loadAssets.length>0&&e.push(...t.mysteryEncounter.loadAssets),e.push(new Promise(a=>{s.loadSe("GEN8- Exclaim","battle_anims","GEN8- Exclaim.wav"),s.loadImage("encounter_exclaim","mystery-encounters"),s.load.once(Phaser.Loader.Events.COMPLETE,()=>a()),s.load.isLoading()||s.load.start()}));else if(!(ie.ENEMY_HEALTH_SEGMENTS_OVERRIDE>1)&&t.enemyParty.filter(r=>r.isBoss()).length>1)for(const r of t.enemyParty)r.isBoss()&&!r.isPopulatedFromDataSource&&(r.setBoss(!0,Math.ceil(r.bossSegments*(r.getSpeciesForm().baseTotal/n))),r.initBattleInfo());Promise.all(e).then(()=>{if(t.enemyParty.every((a,r)=>{if(t.isBattleMysteryEncounter())return!1;if(r<(t.double?2:1)){if(t.battleType===de.WILD){for(const l of s.getField())ve("PreSummonAbAttr",{pokemon:l});s.field.add(a),t.seenEnemyPartyMemberIds.add(a.id);const o=s.getPlayerPokemon();o?.isOnField()&&s.field.moveBelow(a,o),a.tint(0,.5)}else t.battleType===de.TRAINER&&(a.setVisible(!1),s.currentBattle.trainer?.tint(0,.5));t.double&&a.setFieldPosition(r?ys.RIGHT:ys.LEFT)}return!0}),!this.loaded&&t.battleType!==de.MYSTERY_ENCOUNTER){ir(s.getEnemyField(),t.battleType===de.TRAINER?ei.TRAINER:ei.WILD),s.generateEnemyModifiers(),Yf(!1);for(const a of s.getEnemyField())Kf(a,!1)}t.battleType===de.TRAINER&&s.currentBattle.trainer&&s.currentBattle.trainer.genAI(s.getEnemyParty()),s.ui.setMode(x.MESSAGE).then(()=>{this.loaded?(this.doEncounter(),s.resetSeed()):(this.trySetWeatherIfNewBiome(),s.gameData.saveAll(!0,t.waveIndex%5===1||(s.lastSavePlayTime??0)>=300).then(a=>{if(s.disableMenu=!1,!a)return s.reset(!0);this.doEncounter(),s.resetSeed()}))})})}doEncounter(){s.playBgm(void 0,!0),s.updateModifiers(!1),s.setFieldScale(1);const{battleType:e,waveIndex:t}=s.currentBattle;s.isMysteryEncounterValidForWave(e,t)&&!s.currentBattle.isBattleMysteryEncounter()&&(s.mysteryEncounterSaveData.encounterSpawnChance+=om);for(const a of s.getPlayerParty())a&&a.resetWaveData();const i=s.getEnemyField();s.tweens.add({targets:[s.arenaEnemy,s.currentBattle.trainer,i,s.arenaPlayer,s.trainer].flat(),x:h((a,r,o,l)=>l<2+i.length?o+300:o-300,"x"),duration:2e3,onComplete:h(()=>{this.tryOverrideForBattleSpec()||this.doEncounterCommon()},"onComplete")});const n=s.currentBattle?.mysteryEncounter?.introVisuals;if(n){const a=n.enterFromRight;a&&(n.x+=500),s.tweens.add({targets:n,x:a?"-=200":"+=300",duration:2e3})}}getEncounterMessage(){const e=s.getEnemyField();return s.currentBattle.battleSpec===Xt.FINAL_BOSS?f.t("battle:bossAppeared",{bossName:Re(e[0])}):s.currentBattle.battleType===de.TRAINER?s.currentBattle.double?f.t("battle:trainerAppearedDouble",{trainerName:s.currentBattle.trainer?.getName(yt.NONE,!0)}):f.t("battle:trainerAppeared",{trainerName:s.currentBattle.trainer?.getName(yt.NONE,!0)}):e.length===1?f.t("battle:singleWildAppeared",{pokemonName:e[0].getNameToRender()}):f.t("battle:multiWildAppeared",{pokemonName1:e[0].getNameToRender(),pokemonName2:e[1].getNameToRender()})}doEncounterCommon(e=!0){const t=s.getEnemyField();if(s.currentBattle.battleType===de.WILD){for(const i of t)i.untint(100,"Sine.easeOut"),i.cry(),i.showInfo(),i.isShiny()&&s.validateAchv(Fe.SEE_SHINY);s.updateFieldScale(),e?s.ui.showText(this.getEncounterMessage(),null,()=>this.end(),1500):this.end()}else if(s.currentBattle.battleType===de.TRAINER){const i=s.currentBattle.trainer;i?.untint(100,"Sine.easeOut"),i?.playAnim();const n=h(()=>{s.currentBattle.started=!0,s.playBgm(void 0),s.pbTray.showPbTray(s.getPlayerParty()),s.pbTrayEnemy.showPbTray(s.getEnemyParty());const r=h(()=>{this.hideEnemyTrainer();const o=s.getEnemyParty().filter(l=>!l.isFainted()).length;s.phaseManager.unshiftNew("SummonPhase",0,!1),s.currentBattle.double&&o>1&&s.phaseManager.unshiftNew("SummonPhase",1,!1),this.end()},"doTrainerSummon");e?s.ui.showText(this.getEncounterMessage(),null,r,1500,!0):r()},"doSummon"),a=i?.getEncounterMessages()??[];if(a.length===0)n();else{let r="";s.executeWithSeedOffset(()=>r=Pn(a),s.currentBattle.waveIndex);const o=h(()=>{s.ui.showDialogue(r,i?.getName(yt.NONE,!0),null,()=>{s.charSprite.hide().then(()=>s.hideFieldOverlay(250).then(()=>n()))})},"showDialogueAndSummon");i?.config.hasCharSprite&&!s.ui.shouldSkipDialogue(r)?s.showFieldOverlay(500).then(()=>s.charSprite.showCharacter(i.getKey(),ar(a[0])).then(()=>o())):o()}}else if(s.currentBattle.isBattleMysteryEncounter()&&s.currentBattle.mysteryEncounter){const i=s.currentBattle.mysteryEncounter,n=i.introVisuals;n?.playAnim(),i.onVisualsStart?i.onVisualsStart():i.spriteConfigs&&n&&n.playShinySparkles();const a=h(()=>{const o=h(()=>{s.ui.clearText(),s.ui.getMessageHandler().hideNameText(),s.phaseManager.unshiftNew("MysteryEncounterPhase"),this.end()},"doShowEncounterOptions"),l=i.dialogue.intro;if(e&&l){let u=0;const p=h(()=>{const m=u===l.length-1?o:p,d=l[u],y=ss(d?.speaker),g=ss(d.text);u++,y?s.ui.showDialogue(g,y,null,m,0,u===1?750:0):s.ui.showText(g,null,m,u===1?750:0,!0)},"showNextDialogue");l.length>0&&p()}else o()},"doEncounter"),r=f.t("battle:mysteryEncounterAppeared");r?(lm(),s.ui.showDialogue(r,"???",null,()=>{s.charSprite.hide().then(()=>s.hideFieldOverlay(250).then(()=>a()))})):a()}}end(){const e=s.getEnemyField();if(e.forEach((t,i)=>{if(t.isShiny(!0)&&s.phaseManager.unshiftNew("ShinySparklePhase",nt.ENEMY+i),t.species.speciesId===ye.ETERNATUS&&(s.gameMode.isBattleClassicFinalBoss(s.currentBattle.waveIndex)||s.gameMode.isEndlessMajorBoss(s.currentBattle.waveIndex))){const n=s.findModifier(a=>a instanceof zf,!1);n&&(s.removeModifier(n,!0),n.setTransferrableFalse(),s.addEnemyModifier(n))}}),[de.TRAINER,de.MYSTERY_ENCOUNTER].includes(s.currentBattle.battleType)||s.findModifier(i=>i instanceof jf)&&e.map(i=>s.phaseManager.pushNew("ScanIvsPhase",i.getBattlerIndex())),!this.loaded){const t=s.getPokemonAllowedInBattle();if(t[0].isOnField()||s.phaseManager.pushNew("SummonPhase",0),s.currentBattle.double?t.length>1&&(s.phaseManager.pushNew("ToggleDoublePositionPhase",!0),t[1].isOnField()||s.phaseManager.pushNew("SummonPhase",1)):(t.length>1&&t[1].isOnField()&&s.phaseManager.pushNew("ReturnPhase",1),s.phaseManager.pushNew("ToggleDoublePositionPhase",!1)),s.currentBattle.battleType!==de.TRAINER&&(s.currentBattle.waveIndex>1||!s.gameMode.isDaily)){const i=s.currentBattle.double?2:1;t.length>i&&(s.phaseManager.pushNew("CheckSwitchPhase",0,s.currentBattle.double),s.currentBattle.double&&s.phaseManager.pushNew("CheckSwitchPhase",1,s.currentBattle.double))}}ii(ds.Access_Menu).then(()=>super.end()),s.phaseManager.pushNew("InitEncounterPhase")}tryOverrideForBattleSpec(){switch(s.currentBattle.battleSpec){case Xt.FINAL_BOSS:{const e=s.getEnemyPokemon();return s.ui.showText(this.getEncounterMessage(),null,()=>{const t="battleSpecDialogue:encounter";if(s.ui.shouldSkipDialogue(t))this.doEncounterCommon(!1);else{const i=5643853+s.gameData.gameStats.classicSessionsPlayed,n=!f.exists(t,{fallbackLng:[]})||f.resolvedLanguage==="en"?f.t("battleSpecDialogue:key",{count:i,ordinal:!0}):"",a=i.toLocaleString()+n,r=s.gameData.gender??De.UNSET,o=De[r].toLowerCase(),l=f.t(t,{context:o,cycleCount:a});s.gameData.getSeenDialogues()[t]||s.gameData.saveSeenDialogue(t),s.ui.showDialogue(l,e?.species.name,null,()=>{this.doEncounterCommon(!1)})}},1500,!0),!0}}return!1}trySetWeatherIfNewBiome(){this.loaded||s.arena.trySetWeather($f(s.arena))}};h(Pc,"EncounterPhase");let Aa=Pc;const Rc=class Rc extends Ge{phaseName="EndCardPhase";endCard;text;start(){super.start(),s.ui.getMessageHandler().bg.setVisible(!1),s.ui.getMessageHandler().nameBoxContainer.setVisible(!1),this.endCard=s.add.image(0,0,`end_${s.gameData.gender===De.FEMALE?"f":"m"}`),this.endCard.setOrigin(0),this.endCard.setScale(.5),s.field.add(this.endCard),this.text=P(s.scaledCanvas.width/2,s.scaledCanvas.height-16,f.t("battle:congratulations"),O.SUMMARY,{fontSize:"128px"}),this.text.setOrigin(.5),s.field.add(this.text),s.ui.clearText(),s.ui.fadeIn(1e3).then(()=>{s.ui.showText("",null,()=>{s.ui.getMessageHandler().bg.setVisible(!0),this.end()},null,!0)})}};h(Rc,"EndCardPhase");let mo=Rc;const Bc=class Bc extends Ge{phaseName="EndEvolutionPhase";start(){super.start(),s.ui.setModeForceTransition(x.MESSAGE).then(()=>this.end())}};h(Bc,"EndEvolutionPhase");let yo=Bc;const Lc=class Lc extends ps{phaseName="EnemyCommandPhase";fieldIndex;skipTurn=!1;constructor(e){super(),this.fieldIndex=e,s.currentBattle.mysteryEncounter?.skipEnemyBattleTurns&&(this.skipTurn=!0)}start(){super.start();const e=s.getEnemyField()[this.fieldIndex],t=s.currentBattle,i=t.trainer;if(t.double&&e.hasAbility(Bn.COMMANDER)&&e.getAlly()?.getTag(ke.COMMANDED)&&(this.skipTurn=!0),i&&e.getMoveQueue().length===0){const a=e.getOpponents();if(!e.isTrapped()){const r=i.getPartyMemberMatchupScores(e.trainerSlot,!0);if(r.length>0){const o=a.map(p=>e.getMatchupScore(p)),l=o.reduce((p,m)=>p+=m,0)/o.length,c=i.getSortedPartyMemberMatchupScores(r),u=1-(t.enemySwitchCounter?Math.pow(.1,1/t.enemySwitchCounter):0);if(c[0][1]*u>=l*(i.config.isBoss?2:3)){const p=i.getNextSummonIndex(e.trainerSlot,r);return t.turnCommands[this.fieldIndex+nt.ENEMY]={command:Ie.POKEMON,cursor:p,args:[!1],skip:this.skipTurn},t.enemySwitchCounter++,this.end()}}}}const n=e.getNextMove();this.shouldTera(e)&&(s.currentBattle.preTurnCommands[this.fieldIndex+nt.ENEMY]={command:Ie.TERA}),s.currentBattle.turnCommands[this.fieldIndex+nt.ENEMY]={command:Ie.FIGHT,move:n,skip:this.skipTurn},s.currentBattle.enemySwitchCounter=Math.max(s.currentBattle.enemySwitchCounter-1,0),this.end()}shouldTera(e){return!!s.currentBattle.trainer?.shouldTera(e)}getFieldIndex(){return this.fieldIndex}};h(Lc,"EnemyCommandPhase");let To=Lc;const Dc=class Dc extends Ge{phaseName="EvolutionPhase";pokemon;lastLevel;evoChain=null;preEvolvedPokemonName;evolution;fusionSpeciesEvolved;evolutionBgm;evolutionHandler;evolutionContainer;evolutionBaseBg;evolutionBg;evolutionBgOverlay;evolutionOverlay;pokemonSprite;pokemonTintSprite;pokemonEvoSprite;pokemonEvoTintSprite;canCancel;constructor(e,t,i,n=!0){super(),this.pokemon=e,this.evolution=t,this.lastLevel=i,this.fusionSpeciesEvolved=t instanceof hm,this.canCancel=n}validate(){return!!this.evolution}setMode(){return s.ui.setModeForceTransition(x.EVOLUTION_SCENE)}setupEvolutionAssets(){this.evolutionHandler=s.ui.getHandler(),this.evolutionContainer=this.evolutionHandler.evolutionContainer,this.evolutionBaseBg=s.add.image(0,0,"default_bg").setOrigin(0),this.evolutionBg=s.add.video(0,0,"evo_bg").stop().setOrigin(0).setScale(.4359673025).setVisible(!1),this.evolutionBgOverlay=s.add.rectangle(0,0,s.scaledCanvas.width,s.scaledCanvas.height,2500134).setOrigin(0).setAlpha(0),this.evolutionContainer.add([this.evolutionBaseBg,this.evolutionBgOverlay,this.evolutionBg]),this.evolutionOverlay=s.add.rectangle(0,-s.scaledCanvas.height,s.scaledCanvas.width,s.scaledCanvas.height-48,16777215),this.evolutionOverlay.setOrigin(0).setAlpha(0),s.ui.add(this.evolutionOverlay)}configureSprite(e,t,i=!0){const n=e.getSpriteKey(!0);try{t.play(n)}catch(a){console.error(`Failed to play animation for ${n}`,a)}i&&t.setPipeline(s.spritePipeline,{tone:[0,0,0,0],hasShadow:!1,teraColor:pi(e.getTeraType()),isTerastallized:e.isTerastallized}),t.setPipelineData("ignoreTimeTint",!0).setPipelineData("spriteKey",n).setPipelineData("shiny",e.shiny).setPipelineData("variant",e.variant);for(let a of["spriteColors","fusionSpriteColors"])e.summonData.speciesForm&&(a+="Base"),t.pipelineData[a]=e.getSprite().pipelineData[a];return t}getPokemonSprite(){const e=s.addPokemonSprite(this.pokemon,this.evolutionBaseBg.displayWidth/2,this.evolutionBaseBg.displayHeight/2,"pkmn__sub");return e.setPipeline(s.spritePipeline,{tone:[0,0,0,0],ignoreTimeTint:!0}),e}setupPokemonSprites(){this.pokemonSprite=this.configureSprite(this.pokemon,this.getPokemonSprite()),this.pokemonTintSprite=this.configureSprite(this.pokemon,this.getPokemonSprite().setAlpha(0).setTintFill(16777215)),this.pokemonEvoSprite=this.configureSprite(this.pokemon,this.getPokemonSprite().setVisible(!1)),this.pokemonEvoTintSprite=this.configureSprite(this.pokemon,this.getPokemonSprite().setVisible(!1).setTintFill(16777215)),this.evolutionContainer.add([this.pokemonSprite,this.pokemonTintSprite,this.pokemonEvoSprite,this.pokemonEvoTintSprite])}async start(){if(super.start(),await this.setMode(),!this.validate())return this.end();this.setupEvolutionAssets(),this.setupPokemonSprites(),this.preEvolvedPokemonName=Re(this.pokemon),this.doEvolution()}updateEvolvedPokemonSprites(e){this.configureSprite(e,this.pokemonEvoSprite,!1),this.configureSprite(e,this.pokemonEvoTintSprite,!1)}playEvolutionAnimation(e){s.time.delayedCall(1e3,()=>{this.evolutionBgm=s.playSoundWithoutBgm("evolution"),s.tweens.add({targets:this.evolutionBgOverlay,alpha:1,delay:500,duration:1500,ease:"Sine.easeOut",onComplete:h(()=>{s.time.delayedCall(1e3,()=>{this.evolutionBg.setVisible(!0).play()}),s.playSound("se/charge"),this.doSpiralUpward(),this.fadeOutPokemonSprite(e)},"onComplete")})})}fadeOutPokemonSprite(e){s.tweens.addCounter({from:0,to:1,duration:2e3,onUpdate:h(t=>{this.pokemonTintSprite.setAlpha(t.getValue()??1)},"onUpdate"),onComplete:h(()=>{this.pokemonSprite.setVisible(!1),s.time.delayedCall(1100,()=>{s.playSound("se/beam"),this.doArcDownward(),this.prepareForCycle(e)})},"onComplete")})}prepareForCycle(e){s.time.delayedCall(1500,()=>{this.pokemonEvoTintSprite.setScale(.25).setVisible(!0),this.evolutionHandler.canCancel=this.canCancel,this.doCycle(1,void 0,()=>{this.evolutionHandler.cancelled?this.handleFailedEvolution(e):this.handleSuccessEvolution(e)})})}doEvolution(){s.ui.showText(f.t("menu:evolving",{pokemonName:this.preEvolvedPokemonName}),null,()=>{this.pokemon.cry(),this.pokemon.getPossibleEvolution(this.evolution).then(e=>{this.updateEvolvedPokemonSprites(e),this.playEvolutionAnimation(e)})},1e3)}fadeOutEvolutionAssets(){s.tweens.add({targets:[this.evolutionBg,this.pokemonTintSprite,this.pokemonEvoSprite,this.pokemonEvoTintSprite],alpha:0,duration:250,onComplete:h(()=>{this.evolutionBg.setVisible(!1)},"onComplete")}),this.evolutionBgm&&Ds.fadeOut(s,this.evolutionBgm,100)}showPauseEvolutionConfirmation(e){s.ui.setOverlayMode(x.CONFIRM,()=>{s.ui.revertMode(),this.pokemon.pauseEvolutions=!0,s.ui.showText(f.t("menu:evolutionsPaused",{pokemonName:this.preEvolvedPokemonName}),null,e,3e3)},()=>{s.ui.revertMode(),s.time.delayedCall(3e3,e)})}showFailedEvolutionUI(e){s.phaseManager.unshiftNew("EndEvolutionPhase"),s.ui.showText(f.t("menu:stoppedEvolving",{pokemonName:this.preEvolvedPokemonName}),null,()=>{s.ui.showText(f.t("menu:pauseEvolutionsQuestion",{pokemonName:this.preEvolvedPokemonName}),null,()=>{const t=h(()=>{s.ui.showText("",0),s.playBgm(),e.destroy(),this.end()},"end");this.showPauseEvolutionConfirmation(t)})},null,!0)}handleFailedEvolution(e){this.pokemonSprite.setVisible(!0),this.pokemonTintSprite.setScale(1),this.fadeOutEvolutionAssets(),s.phaseManager.unshiftNew("EndEvolutionPhase"),this.showFailedEvolutionUI(e)}onEvolutionComplete(e){this.evolutionBgm&&Ds.fadeOut(s,this.evolutionBgm,100),s.time.delayedCall(250,()=>{this.pokemon.cry(),s.time.delayedCall(1250,()=>{s.playSoundWithoutBgm("evolution_fanfare"),e.destroy(),s.ui.showText(f.t("menu:evolutionDone",{pokemonName:this.preEvolvedPokemonName,evolvedPokemonName:this.pokemon.name}),null,()=>this.end(),null,!0,ge(4e3)),s.time.delayedCall(ge(4250),()=>s.playBgm())})})}postEvolve(e){const t=this.fusionSpeciesEvolved?ur.EVOLUTION_FUSED:this.pokemon.fusionSpecies?ur.EVOLUTION_FUSED_BASE:ur.EVOLUTION,i=this.pokemon.getLevelMoves(this.lastLevel+1,!0,!1,!1,t).filter(n=>n[0]===cm);for(const n of i)s.phaseManager.unshiftNew("LearnMovePhase",s.getPlayerParty().indexOf(this.pokemon),n[1]);s.phaseManager.unshiftNew("EndEvolutionPhase"),s.playSound("se/shine"),this.doSpray(),s.tweens.chain({targets:null,tweens:[{targets:this.evolutionOverlay,alpha:1,duration:250,easing:"Sine.easeIn",onComplete:h(()=>{this.evolutionBgOverlay.setAlpha(1),this.evolutionBg.setVisible(!1)},"onComplete")},{targets:[this.evolutionOverlay,this.pokemonEvoTintSprite],alpha:0,duration:2e3,delay:150,easing:"Sine.easeIn"},{targets:this.evolutionBgOverlay,alpha:0,duration:250,onComplete:h(()=>this.onEvolutionComplete(e),"onComplete")}]})}handleSuccessEvolution(e){s.playSound("se/sparkle"),this.pokemonEvoSprite.setVisible(!0),this.doCircleInward(),s.time.delayedCall(900,()=>{this.evolutionHandler.canCancel=this.canCancel,this.pokemon.evolve(this.evolution,this.pokemon.species).then(()=>this.postEvolve(e))})}doSpiralUpward(){let e=0;s.tweens.addCounter({repeat:64,duration:xs(1),onRepeat:h(()=>{if(e<64){if(!(e&7))for(let t=0;t<4;t++)this.doSpiralUpwardParticle((e&120)*2+t*64);e++}},"onRepeat")})}doArcDownward(){let e=0;s.tweens.addCounter({repeat:96,duration:xs(1),onRepeat:h(()=>{if(e<96){if(e<6)for(let t=0;t<9;t++)this.doArcDownParticle(t*16);e++}},"onRepeat")})}doCycle(e,t=15,i=()=>{}){const n=[];for(let a=e;a<=t;a+=.5)n.push({targets:[this.pokemonTintSprite,this.pokemonEvoTintSprite],scale:h((r,o,l,c,u,p)=>c===0?.25:1,"scale"),ease:"Cubic.easeInOut",duration:500/a,yoyo:a!==t,onComplete:h(()=>{if(this.evolutionHandler.cancelled){this.pokemonEvoTintSprite.setScale(1),this.pokemonEvoTintSprite.setVisible(!1),this.evoChain?.complete?.();return}a===t&&(this.pokemonTintSprite.setVisible(!1).setActive(!1),this.pokemonEvoTintSprite.setScale(1))},"onComplete")});this.evoChain=s.tweens.chain({targets:null,tweens:n,onComplete:h(()=>{this.evoChain=null,i()},"onComplete")})}doCircleInward(){let e=0;s.tweens.addCounter({repeat:48,duration:xs(1),onRepeat:h(()=>{if(e){if(e===32)for(let t=0;t<16;t++)this.doCircleInwardParticle(t*16,8)}else for(let t=0;t<16;t++)this.doCircleInwardParticle(t*16,4);e++},"onRepeat")})}doSpray(){let e=0;s.tweens.addCounter({repeat:48,duration:xs(1),onRepeat:h(()=>{if(e)e<50&&this.doSprayParticle(ns(8));else for(let t=0;t<8;t++)this.doSprayParticle(t);e++},"onRepeat")})}doSpiralUpwardParticle(e){const t=this.evolutionBaseBg.displayWidth/2,i=s.add.image(t,0,"evo_sparkle");this.evolutionContainer.add(i);let n=0,a=48;const r=s.tweens.addCounter({repeat:-1,duration:xs(1),onRepeat:h(()=>{o()},"onRepeat")}),o=h(()=>{!n||i.y>8?(i.setPosition(t,88-n*n/80),i.y+=Yi(e,a)/4,i.x+=dr(e,a),i.setScale(1-n/80),e+=4,n&1&&a--,n++):(i.destroy(),r.remove())},"updateParticle");o()}doArcDownParticle(e){const t=this.evolutionBaseBg.displayWidth/2,i=s.add.image(t,0,"evo_sparkle");i.setScale(.5),this.evolutionContainer.add(i);let n=0,a=8;const r=s.tweens.addCounter({repeat:-1,duration:xs(1),onRepeat:h(()=>{o()},"onRepeat")}),o=h(()=>{!n||i.y<88?(i.setPosition(t,8+n*n/5),i.y+=Yi(e,a)/4,i.x+=dr(e,a),a=8+Yi(n*4,40),n++):(i.destroy(),r.remove())},"updateParticle");o()}doCircleInwardParticle(e,t){const i=this.evolutionBaseBg.displayWidth/2,n=this.evolutionBaseBg.displayHeight/2,a=s.add.image(i,n,"evo_sparkle");this.evolutionContainer.add(a);let r=120;const o=s.tweens.addCounter({repeat:-1,duration:xs(1),onRepeat:h(()=>{l()},"onRepeat")}),l=h(()=>{r>8?(a.setPosition(i,n),a.y+=Yi(e,r),a.x+=dr(e,r),r-=t,e+=4):(a.destroy(),o.remove())},"updateParticle");l()}doSprayParticle(e){const t=this.evolutionBaseBg.displayWidth/2,i=this.evolutionBaseBg.displayHeight/2,n=s.add.image(t,i,"evo_sparkle");this.evolutionContainer.add(n);let a=0,r=0;const o=3-ns(8),l=48+ns(64),c=s.tweens.addCounter({repeat:-1,duration:xs(1),onRepeat:h(()=>{u()},"onRepeat")}),u=h(()=>{a&3||r++,e<128?(n.setPosition(t+o*a/3,i+r),n.y+=-Yi(e,l),a>108&&n.setScale(1-(a-108)/20),e++,a++):(n.destroy(),c.remove())},"updateParticle");u()}};h(Dc,"EvolutionPhase");let xa=Dc;const Fc=class Fc extends ps{partyMemberIndex;fieldIndex;player;constructor(e,t){super(),this.partyMemberIndex=e,this.fieldIndex=e<s.currentBattle.getBattlerCount()?e:-1,this.player=t}getParty(){return this.player?s.getPlayerParty():s.getEnemyParty()}getPokemon(){return this.getParty()[this.partyMemberIndex]}isPlayer(){return this.player}};h(Fc,"PartyMemberPokemonPhase");let _a=Fc;const Uc=class Uc extends _a{constructor(e){super(e,!0)}getPlayerPokemon(){return super.getPokemon()}};h(Uc,"PlayerPartyMemberPokemonPhase");let Di=Uc;const Vc=class Vc extends Di{phaseName="ExpPhase";expValue;constructor(e,t){super(e),this.expValue=t}start(){super.start();const e=this.getPokemon(),t=new ct(this.expValue);s.applyModifiers(Xf,!0,t),t.value=Math.floor(t.value),s.ui.showText(f.t("battle:expGain",{pokemonName:Re(e),exp:t.value}),null,()=>{const i=e.level;e.addExp(t.value);const n=e.level;n>i&&s.phaseManager.unshiftNew("LevelUpPhase",this.partyMemberIndex,i,n),e.updateInfo().then(()=>this.end())},null,!0)}};h(Vc,"ExpPhase");let Co=Vc;const Hc=class Hc extends Ot{phaseName="FaintPhase";preventInstantRevive;source;constructor(e,t=!1,i){super(e),this.preventInstantRevive=t,this.source=i}start(){super.start();const e=this.getPokemon();if(this.source&&(e.getTag(ke.DESTINY_BOND)?.lapse(this.source,Nt.CUSTOM),e.getTag(ke.GRUDGE)?.lapse(e,Nt.CUSTOM,this.source)),e.resetSummonData(),!this.preventInstantRevive){const t=s.applyModifier(um,this.player,e);if(t)return e.loseHeldItem(t),s.updateModifiers(this.player),this.end()}for(const t of s.getPlayerField())(t?.isActive()||t?.isFainted())&&s.currentBattle.addParticipant(t);this.tryOverrideForBattleSpec()||this.doFaint()}doFaint(){const e=this.getPokemon();if(e.isPlayer()?(s.arena.playerFaints+=1,s.currentBattle.playerFaintsHistory.push({pokemon:e,turn:s.currentBattle.turn})):(s.currentBattle.enemyFaints+=1,s.currentBattle.enemyFaintsHistory.push({pokemon:e,turn:s.currentBattle.turn})),s.phaseManager.queueMessage(f.t("battle:fainted",{pokemonNameWithAffix:Re(e)}),null,!0),s.triggerPokemonFormChange(e,rr,!0),e.resetTera(),e.turnData.attacksReceived?.length>0){const i=e.turnData.attacksReceived[0];ve("PostFaintAbAttr",{pokemon:e,attacker:s.getPokemonById(i.sourceId)??void 0,move:new Fs(i.move).getMove(),hitResult:i.result})}else ve("PostFaintAbAttr",{pokemon:e});for(const i of Es(Tt.BOTH))ve("PostKnockOutAbAttr",{pokemon:i,victim:e});if(e.turnData.attacksReceived?.length>0){const i=this.source;if(i?.isOnField()){ve("PostVictoryAbAttr",{pokemon:i});const n=We[e.turnData.attacksReceived[0].move],a=n.getAttrs("PostVictoryStatStageChangeAttr");if(a.length>0)for(const r of a)r.applyPostVictory(i,i,n)}}if(this.player){const i=s.getPokemonAllowedInBattle(),n=i.filter(a=>!a.isActive(!0));i.length===0?s.phaseManager.unshiftNew("GameOverPhase"):s.currentBattle.double&&i.length===1&&n.length===0?s.phaseManager.unshiftNew("ToggleDoublePositionPhase",!0):n.length>0&&s.phaseManager.pushNew("SwitchPhase",gt.SWITCH,this.fieldIndex,!0,!1)}else s.phaseManager.unshiftNew("VictoryPhase",this.battlerIndex),[de.TRAINER,de.MYSTERY_ENCOUNTER].includes(s.currentBattle.battleType)&&s.getEnemyParty().filter(n=>n.isActive()&&!n.isOnField()&&n.trainerSlot===e.trainerSlot).length>0&&s.phaseManager.pushNew("SwitchSummonPhase",gt.SWITCH,this.fieldIndex,-1,!1,!1);const t=e.getAlly();s.currentBattle.double&&t!=null&&s.redirectPokemonMoves(e,t),e.faintCry(()=>{e.isPlayer()&&e.addFriendship(-5),e.hideInfo(),s.playSound("se/faint"),s.tweens.add({targets:e,duration:500,y:e.y+150,ease:"Sine.easeIn",onComplete:h(()=>{e.lapseTags(Nt.FAINT),e.y-=150,e.doSetStatus(lt.FAINT),e.isPlayer()?s.currentBattle.removeFaintedParticipant(e):(s.addFaintedEnemyScore(e),s.currentBattle.addPostBattleLoot(e)),e.leaveField(),this.end()},"onComplete")})})}tryOverrideForBattleSpec(){switch(s.currentBattle.battleSpec){case Xt.FINAL_BOSS:if(!this.player){const e=this.getPokemon();return e.formIndex?s.ui.showDialogue(qf[Xt.FINAL_BOSS].secondStageWin,e.species.name,null,()=>this.doFaint()):(e.hp++,s.phaseManager.unshiftNew("DamageAnimPhase",e.getBattlerIndex(),0,Ze.INDIRECT),this.end()),!0}}return!1}};h(Hc,"FaintPhase");let So=Hc;const Wc=class Wc extends xa{phaseName="FormChangePhase";formChange;modal;constructor(e,t,i){super(e,null,0),this.formChange=t,this.modal=i}validate(){return!!this.formChange}setMode(){return this.modal?s.ui.setOverlayMode(x.EVOLUTION_SCENE):super.setMode()}postFormChangeTweens(e,t){s.tweens.chain({targets:null,tweens:[{targets:this.evolutionOverlay,alpha:1,duration:250,easing:"Sine.easeIn",onComplete:h(()=>{this.evolutionBgOverlay.setAlpha(1),this.evolutionBg.setVisible(!1)},"onComplete")},{targets:[this.evolutionOverlay,this.pokemonEvoTintSprite],alpha:0,duration:2e3,delay:150,easing:"Sine.easeIn"},{targets:this.evolutionBgOverlay,alpha:0,duration:250,completeDelay:250,onComplete:h(()=>this.pokemon.cry(),"onComplete")}],completeDelay:1250,onComplete:h(()=>{let i=!1;this.formChange.formKey.indexOf(pr.MEGA)>-1?(s.validateAchv(Fe.MEGA_EVOLVE),i=!0):(this.formChange.formKey.indexOf(pr.GIGANTAMAX)>-1||this.formChange.formKey.indexOf(pr.ETERNAMAX)>-1)&&(s.validateAchv(Fe.GIGANTAMAX),i=!0);const n=i?4e3:1750;s.playSoundWithoutBgm(i?"evolution_fanfare":"minor_fanfare"),e.destroy(),s.ui.showText(Dr(this.pokemon,this.formChange,t),null,()=>this.end(),null,!0,ge(n)),s.time.delayedCall(ge(n+250),()=>s.playBgm())},"onComplete")})}afterCycle(e,t){s.playSound("se/sparkle"),this.pokemonEvoSprite.setVisible(!0),this.doCircleInward(),s.time.delayedCall(900,()=>{this.pokemon.changeForm(this.formChange).then(()=>{this.modal||s.phaseManager.unshiftNew("EndEvolutionPhase"),s.playSound("se/shine"),this.doSpray(),this.postFormChangeTweens(t,e)})})}beginTweens(e,t){s.tweens.chain({targets:null,tweens:[{delay:250,targets:this.evolutionBgOverlay,alpha:1,duration:1500,ease:"Sine.easeOut",onComplete:h(()=>{s.tweens.add({targets:this.evolutionBgOverlay,alpha:0,duration:250,delay:1e3}),this.evolutionBg.setVisible(!0).play()},"onComplete")},{targets:this.pokemonTintSprite,alpha:{from:0,to:1},duration:2e3,onStart:h(()=>{s.playSound("se/charge"),this.doSpiralUpward()},"onStart"),onComplete:h(()=>{this.pokemonSprite.setVisible(!1)},"onComplete")}],completeDelay:1100,onComplete:h(()=>{s.playSound("se/beam"),this.doArcDownward(),s.time.delayedCall(1e3,()=>{this.pokemonEvoTintSprite.setScale(.25).setVisible(!0),this.doCycle(1,1,()=>this.afterCycle(e,t))})},"onComplete")})}doEvolution(){const e=Re(this.pokemon,!1);this.pokemon.getPossibleForm(this.formChange).then(t=>{this.configureSprite(t,this.pokemonEvoSprite,!1),this.configureSprite(t,this.pokemonEvoTintSprite,!1),this.beginTweens(e,t)})}end(){this.pokemon.findAndRemoveTags(e=>e.tagType===ke.AUTOTOMIZED),this.modal?s.ui.revertMode().then(()=>{if(s.ui.getMode()===x.PARTY){const e=s.ui.getHandler();e.clearPartySlots(),e.populatePartySlots()}super.end()}):super.end()}};h(Wc,"FormChangePhase");let Eo=Wc;const Gc=class Gc extends rt{phaseName="ModifierRewardPhase";modifierType;constructor(e){super(),this.modifierType=Zf(e)}start(){super.start(),this.doReward().then(()=>this.end())}doReward(){return new Promise(e=>{const t=this.modifierType.newModifier();s.addModifier(t),s.playSound("item_fanfare"),s.ui.showText(f.t("battle:rewardGain",{modifierName:t?.type.name}),null,()=>e(),null,!0)})}};h(Gc,"ModifierRewardPhase");let Cn=Gc;const Yc=class Yc extends Cn{phaseName="GameOverModifierRewardPhase";doReward(){return new Promise(e=>{const t=this.modifierType.newModifier();s.addModifier(t),s.playSound("level_up_fanfare"),s.ui.setMode(x.MESSAGE),s.ui.fadeIn(250).then(()=>{s.ui.showText(f.t("battle:rewardGain",{modifierName:t?.type.name}),null,()=>{s.time.delayedCall(1500,()=>s.arenaBg.setVisible(!0)),e()},null,!0,1500)})})}};h(Yc,"GameOverModifierRewardPhase");let bo=Yc;const Kc=class Kc{biome;weather;terrain;tags;positionalTags=[];playerTerasUsed;constructor(e){if(this.tags=e.tags?.map(t=>dm(t))?.filter(t=>t instanceof pm)??[],this.playerTerasUsed=e.playerTerasUsed??0,e instanceof Qf){this.biome=e.biomeType,this.weather=e.weather,this.terrain=e.terrain,this.positionalTags=e.positionalTagManager.tags??[];return}this.biome=e.biome,this.weather=e.weather?new fm(e.weather.weatherType,e.weather.turnsLeft,e.weather.maxDuration):null,this.terrain=e.terrain?new gm(e.terrain.terrainType,e.terrain.turnsLeft,e.terrain.maxDuration):null,this.positionalTags=e.positionalTags??[]}};h(Kc,"ArenaData");let Sn=Kc;const zc=class zc{id;value;severity;constructor(e){this.id=e.id,this.value=e.value,this.severity=e.severity}toChallenge(){return Rr(this)}};h(zc,"ChallengeData");let En=zc;const jc=class jc{player;typeId;typePregenArgs;args;stackCount;className;constructor(e,t){const i=e instanceof oa?e:null;this.player=t,this.typeId=i?i.type.id:e.typeId,i?"getPregenArgs"in e.type&&(this.typePregenArgs=e.type.getPregenArgs()):e.typePregenArgs&&(this.typePregenArgs=e.typePregenArgs),this.args=i?i.getArgs():e.args||[],this.stackCount=e.stackCount,this.className=i?i.constructor.name:e.className}toModifier(e){const t=mm(this.typeId);if(!t)return null;try{let i=t();i.id=this.typeId,i instanceof ym&&(i=i.generateType(this.player?s.getPlayerParty():s.getEnemyField(),this.typePregenArgs));const n=Reflect.construct(e,[i].concat(this.args).concat(this.stackCount));return n.stackCount>n.getMaxStackCount()&&(n.stackCount=n.getMaxStackCount()),n}catch(i){return console.error(i),null}}};h(jc,"ModifierData");let ui=jc;const $c=class $c{trainerType;variant;partyTemplateIndex;nameKey;partnerNameKey;constructor(e){const t=e instanceof ls?e:null;this.trainerType=t?t.config.trainerType:e.trainerType,this.variant=e.hasOwnProperty("variant")?e.variant:e.female?Xe.FEMALE:Xe.DEFAULT,this.partyTemplateIndex=e.partyMemberTemplateIndex,this.nameKey=e.nameKey,this.partnerNameKey=e.partnerNameKey}toTrainer(){return new ls(this.trainerType,this.variant,this.partyTemplateIndex,this.nameKey,this.partnerNameKey)}};h($c,"TrainerData");let bn=$c;const Xc=class Xc extends rt{phaseName="GameOverPhase";isVictory;firstRibbons=[];constructor(e=!1){super(),this.isVictory=e}start(){if(super.start(),s.phaseManager.hideAbilityBar(),s.gameMode.isClassic&&s.currentBattle.waveIndex>200&&(this.isVictory=!0),!this.isVictory&&s.currentBattle.mysteryEncounter?.onGameOver&&!s.currentBattle.mysteryEncounter.onGameOver())return this.end();if(this.isVictory&&s.gameMode.isEndless){const e=s.gameData.gender??De.UNSET,t=De[e].toLowerCase();s.ui.showDialogue(f.t("miscDialogue:endingEndless",{context:t}),f.t("miscDialogue:endingName"),0,()=>this.handleGameOver())}else this.isVictory||!s.enableRetries?this.handleGameOver():s.ui.showText(f.t("battle:retryBattle"),null,()=>{s.ui.setMode(x.CONFIRM,()=>{s.ui.fadeOut(1250).then(()=>{s.reset(),s.phaseManager.clearPhaseQueue(),s.gameData.loadSession(s.sessionSlotId).then(()=>{s.phaseManager.pushNew("EncounterPhase",!0);const e=s.getPokemonAllowedInBattle().length;s.phaseManager.pushNew("SummonPhase",0),s.currentBattle.double&&e>1&&s.phaseManager.pushNew("SummonPhase",1),s.currentBattle.waveIndex>1&&s.currentBattle.battleType!==de.TRAINER&&(s.phaseManager.pushNew("CheckSwitchPhase",0,s.currentBattle.double),s.currentBattle.double&&e>1&&s.phaseManager.pushNew("CheckSwitchPhase",1,s.currentBattle.double)),s.ui.fadeIn(1250),this.end()})})},()=>this.handleGameOver(),!1,0,0,1e3)})}awardRibbons(){let e=0n;for(const i of s.gameMode.challenges){const n=i.ribbonAwarded;i.value&&n&&(e|=n)}const t=e&(ae.FLIP_STATS|ae.INVERSE);t?e=t:(s.gameMode.isClassic&&(e|=ae.CLASSIC),Tm()&&(e|=ae.NUZLOCKE));for(const i of s.getPlayerParty()){const n=i.species;Cm(n,s.gameData.getSpeciesDexAttrProps(n,i.getDexAttr()),!1)&&Sm(n.speciesId,e)}}handleGameOver(){const e=h(t=>{s.disableMenu=!0,s.time.delayedCall(1e3,()=>{let i=!1;if(this.isVictory)if(s.gameMode.isClassic){i=s.validateAchv(Fe.CLASSIC_VICTORY),s.validateAchv(Fe.UNEVOLVED_CLASSIC_VICTORY),s.gameData.gameStats.sessionsWon++;for(const r of s.getPlayerParty())this.awardFirstClassicCompletion(r),r.species.getRootSpeciesId()!==r.species.getRootSpeciesId(!0)&&this.awardFirstClassicCompletion(r,!0);this.awardRibbons()}else s.gameMode.isDaily&&t&&(s.gameData.gameStats.dailyRunSessionsWon++,s.validateAchv(Fe.DAILY_VICTORY));const n=this.isVictory?1e4:5e3;s.fadeOutBgm(n,!0);const a=s.getField().filter(r=>r?.isActive(!0));a.map(r=>r.hideInfo()),s.ui.fadeOut(n).then(()=>{a.map(o=>o.setVisible(!1)),s.setFieldScale(1,!0),s.phaseManager.clearPhaseQueue(),s.ui.clearText(),this.isVictory&&s.gameMode.isChallenge&&s.gameMode.challenges.forEach(o=>s.validateAchvs(Em,o));const r=h(o=>{if(this.isVictory&&t){this.handleUnlocks();for(const l of this.firstRibbons)s.phaseManager.unshiftNew("RibbonModifierRewardPhase",ze.VOUCHER_PLUS,l);i||s.phaseManager.unshiftNew("GameOverModifierRewardPhase",ze.VOUCHER_PREMIUM)}this.getRunHistoryEntry().then(l=>{s.gameData.saveRunHistory(l,this.isVictory),s.phaseManager.pushNew("PostGameOverPhase",s.sessionSlotId,o),this.end()})},"clear");if(this.isVictory&&s.gameMode.isClassic){const o="miscDialogue:ending";if(!s.ui.shouldSkipDialogue(o))s.ui.fadeIn(500).then(()=>{const l=s.gameData.gender??De.UNSET,c=De[l].toLowerCase(),u=f.t(o,{context:c});s.charSprite.showCharacter(`rival_${s.gameData.gender===De.FEMALE?"m":"f"}`,ar(u)).then(()=>{s.ui.showDialogue(o,s.gameData.gender===De.FEMALE?Ii[B.RIVAL].name:Ii[B.RIVAL].nameFemale,null,()=>{s.ui.fadeOut(500).then(()=>{s.charSprite.hide().then(()=>{const p=s.phaseManager.create("EndCardPhase");s.phaseManager.unshiftPhase(p),r(p)})})})})});else{const l=s.phaseManager.create("EndCardPhase");s.phaseManager.unshiftPhase(l),r(l)}}else r()})})},"doGameOver");at.savedata.session.newclear({slot:s.sessionSlotId,isVictory:this.isVictory,clientSessionId:Qt}).then(t=>e(!s.gameMode.isDaily||!!t)).catch(t=>{s.phaseManager.clearPhaseQueue(),s.phaseManager.unshiftNew("MessagePhase",f.t("menu:serverCommunicationFailed"),2500),setTimeout(()=>{window.location.reload()},2e3),this.end()})}handleUnlocks(){this.isVictory&&s.gameMode.isClassic&&(s.gameData.unlocks[xt.ENDLESS_MODE]||s.phaseManager.unshiftNew("UnlockPhase",xt.ENDLESS_MODE),s.getPlayerParty().filter(e=>e.fusionSpecies).length>0&&!s.gameData.unlocks[xt.SPLICED_ENDLESS_MODE]&&s.phaseManager.unshiftNew("UnlockPhase",xt.SPLICED_ENDLESS_MODE),s.gameData.unlocks[xt.MINI_BLACK_HOLE]||s.phaseManager.unshiftNew("UnlockPhase",xt.MINI_BLACK_HOLE),!s.gameData.unlocks[xt.EVIOLITE]&&s.getPlayerParty().some(e=>e.getSpeciesForm(!0).speciesId in hi)&&s.phaseManager.unshiftNew("UnlockPhase",xt.EVIOLITE))}awardFirstClassicCompletion(e,t=!1){const i=zt(e.species.speciesId);s.gameData.incrementRibbonCount(i,t)===1&&this.firstRibbons.push(zt(e.species.getRootSpeciesId(t)))}async getRunHistoryEntry(){const e=await s.gameData.getSession(s.sessionSlotId);return{seed:s.seed,playTime:s.sessionPlayTime,gameMode:s.gameMode.modeId,party:s.getPlayerParty().map(t=>new an(t)),enemyParty:s.getEnemyParty().map(t=>new an(t)),modifiers:e?e.modifiers:s.findModifiers(()=>!0).map(t=>new ui(t,!0)),enemyModifiers:e?e.enemyModifiers:s.findModifiers(()=>!0,!1).map(t=>new ui(t,!1)),arena:new Sn(s.arena),pokeballCounts:s.pokeballCounts,money:Math.floor(s.money),score:s.score,waveIndex:s.currentBattle.waveIndex,battleType:s.currentBattle.battleType,trainer:s.currentBattle.trainer?new bn(s.currentBattle.trainer):null,gameVersion:s.game.config.gameVersion,timestamp:Date.now(),challenges:s.gameMode.challenges.map(t=>new En(t)),mysteryEncounterType:s.currentBattle.mysteryEncounter?.encounterType??-1,mysteryEncounterSaveData:s.mysteryEncounterSaveData,playerFaints:s.arena.playerFaints}}};h(Xc,"GameOverPhase");let Io=Xc;const qc=class qc extends Ge{phaseName="HideAbilityPhase";start(){super.start(),s.abilityBar.hide().then(()=>{this.end()})}};h(qc,"HideAbilityPhase");let In=qc;const Zc=class Zc extends rt{phaseName="HidePartyExpBarPhase";start(){super.start(),s.partyExpBar.hide().then(()=>this.end())}};h(Zc,"HidePartyExpBarPhase");let vo=Zc;const Qc=class Qc extends Ge{phaseName="InitEncounterPhase";start(){for(const e of s.getField(!0))(e.isEnemy()||e.turnData.summonedThisTurn)&&s.phaseManager.unshiftNew("PostSummonPhase",e.getBattlerIndex());super.end()}};h(Qc,"InitEncounterPhase");let Oo=Qc;const Jc=class Jc extends Vt{evolutionContainer;messageBg;messageContainer;canCancel;cancelled;constructor(){super(x.EVOLUTION_SCENE)}setup(){this.canCancel=!1,this.cancelled=!1;const e=this.getUi();this.evolutionContainer=s.add.container(0,-s.scaledCanvas.height);const t=s.add.sprite(0,0,"bg",s.windowType).setOrigin(0,1).setVisible(!1);this.messageBg=t,this.messageContainer=s.add.container(12,-39).setVisible(!1);const i=P(0,0,"",O.MESSAGE,{maxLines:2,wordWrap:{width:1780}});this.messageContainer.add(i),e.add([this.evolutionContainer,this.messageBg,this.messageContainer]),this.message=i,this.initPromptSprite(this.messageContainer)}show(e){return super.show(e),s.ui.bringToTop(this.evolutionContainer),s.ui.bringToTop(this.messageBg.setVisible(!0)),s.ui.bringToTop(this.messageContainer.setVisible(!0)),!0}processInput(e){if(this.canCancel&&!this.cancelled&&e===b.CANCEL)return this.cancelled=!0,!0;const t=this.getUi();if(this.awaitingActionInput&&(e===b.CANCEL||e===b.ACTION)&&this.onActionInput){t.playSelect();const i=this.onActionInput;return this.onActionInput=null,i(),!0}return!1}setCursor(e){return!1}clear(){this.clearText(),this.canCancel=!1,this.cancelled=!1,this.evolutionContainer.removeAll(!0),this.messageContainer.setVisible(!1),this.messageBg.setVisible(!1)}};h(Jc,"EvolutionSceneUiHandler");let wa=Jc;const eu=class eu extends Di{phaseName="LearnMovePhase";moveId;messageMode;learnMoveType;cost;constructor(e,t,i=fr.LEARN_MOVE,n=-1){super(e),this.moveId=t,this.learnMoveType=i,this.cost=n}start(){super.start();const e=this.getPokemon(),t=We[this.moveId],i=e.getMoveset();if(i.some(a=>a.moveId===t.id)&&this.moveId!==st.SKETCH)return this.end();this.messageMode=s.ui.getHandler()instanceof wa?x.EVOLUTION_SCENE:x.MESSAGE,s.ui.setMode(this.messageMode),i.length<4?this.learnMove(i.length,t,e):this.replaceMoveCheck(t,e)}async replaceMoveCheck(e,t){const i=f.t("battle:learnMovePrompt",{pokemonName:Re(t),moveName:e.name}),n=f.t("battle:learnMoveLimitReached",{pokemonName:Re(t)}),a=f.t("battle:learnMoveReplaceQuestion",{moveName:e.name}),r=[i,n].join("$");await s.ui.showTextPromise(r),await s.ui.showTextPromise(a,void 0,!1),await s.ui.setModeWithoutClear(x.CONFIRM,()=>this.forgetMoveProcess(e,t),()=>{s.ui.setMode(this.messageMode),this.rejectMoveAndEnd(e,t)})}async forgetMoveProcess(e,t){s.ui.setMode(this.messageMode),await s.ui.showTextPromise(f.t("battle:learnMoveForgetQuestion"),void 0,!0),await s.ui.setModeWithoutClear(x.SUMMARY,t,Gf.LEARN_MOVE,e,i=>{if(i===4){s.ui.setMode(this.messageMode).then(()=>this.rejectMoveAndEnd(e,t));return}const n=f.t("battle:learnMoveForgetSuccess",{pokemonName:Re(t),moveName:t.moveset[i].getName()}),a=[f.t("battle:countdownPoof"),n,f.t("battle:learnMoveAnd")].join("$");s.ui.setMode(this.messageMode).then(()=>this.learnMove(i,e,t,a))})}async rejectMoveAndEnd(e,t){await s.ui.showTextPromise(f.t("battle:learnMoveStopTeaching",{moveName:e.name}),void 0,!1),s.ui.setModeWithoutClear(x.CONFIRM,()=>{s.ui.setMode(this.messageMode),s.ui.showTextPromise(f.t("battle:learnMoveNotLearned",{pokemonName:Re(t),moveName:e.name}),void 0,!0).then(()=>this.end())},()=>{s.ui.setMode(this.messageMode),this.replaceMoveCheck(e,t)})}async learnMove(e,t,i,n){this.learnMoveType===fr.TM?(i.usedTMs||(i.usedTMs=[]),i.usedTMs.push(this.moveId),s.phaseManager.tryRemovePhase("SelectModifierPhase")):this.learnMoveType===fr.MEMORY&&(this.cost!==-1?(ie.WAIVE_ROLL_FEE_OVERRIDE||(s.money-=this.cost,s.updateMoneyText(),s.animateMoneyChanged(!1)),s.playSound("se/buy")):s.phaseManager.tryRemovePhase("SelectModifierPhase")),i.setMove(e,this.moveId),Uh(this.moveId).then(()=>{Vh([this.moveId],!0)}),s.ui.setMode(this.messageMode);const a=f.t("battle:learnMove",{pokemonName:Re(i),moveName:t.name});n&&await s.ui.showTextPromise(n),s.playSound("level_up_fanfare"),s.ui.showText(a,null,()=>{s.triggerPokemonFormChange(i,Jf,!0),this.end()},this.messageMode===x.EVOLUTION_SCENE?1e3:void 0,!0)}};h(eu,"LearnMovePhase");let Ao=eu;const tu=class tu extends ps{phaseName="LevelCapPhase";start(){super.start(),s.ui.setMode(x.MESSAGE).then(()=>{s.playSound("level_up_fanfare"),s.ui.showText(f.t("battle:levelCapUp",{levelCap:s.getMaxExpLevel()}),null,()=>this.end(),null,!0),this.executeForAll(e=>e.updateInfo(!0))})}};h(tu,"LevelCapPhase");let xo=tu;var di=(T=>(T[T.DEFAULT=0]="DEFAULT",T[T.ONLY_LEVEL_UP=1]="ONLY_LEVEL_UP",T[T.SKIP=2]="SKIP",T))(di||{});const su=class su extends Di{phaseName="LevelUpPhase";lastLevel;level;pokemon=this.getPlayerPokemon();constructor(e,t,i){super(e),this.lastLevel=t,this.level=i}start(){super.start(),this.level>s.gameData.gameStats.highestLevel&&(s.gameData.gameStats.highestLevel=this.level),s.validateAchvs(bm,new ct(this.level));const e=this.pokemon.stats.slice(0);this.pokemon.calculateStats(),this.pokemon.updateInfo(),s.expParty===di.DEFAULT?(s.playSound("level_up_fanfare"),s.ui.showText(f.t("battle:levelUp",{pokemonName:Re(this.pokemon),level:this.level}),null,()=>s.ui.getMessageHandler().promptLevelUpStats(this.partyMemberIndex,e,!1).then(()=>this.end()),null,!0)):s.expParty===di.SKIP?this.end():s.ui.getMessageHandler().promptLevelUpStats(this.partyMemberIndex,e,!1).then(()=>this.end())}end(){if(this.lastLevel<100){const e=this.getPokemon().getLevelMoves(this.lastLevel+1);for(const t of e)s.phaseManager.unshiftNew("LearnMovePhase",this.partyMemberIndex,t[1])}if(!this.pokemon.pauseEvolutions){const e=this.pokemon.getEvolution();e&&(this.pokemon.breakIllusion(),s.phaseManager.unshiftNew("EvolutionPhase",this.pokemon,e,this.lastLevel))}return super.end()}};h(su,"LevelUpPhase");let _o=su;const iu=class iu extends Ge{constructor(e){super(),this.moveId=e}phaseName="LoadMoveAnimPhase";start(){Uh(this.moveId).then(()=>Vh([this.moveId],!0)).then(()=>this.end())}};h(iu,"LoadMoveAnimPhase");let wo=iu;const nu=class nu extends Ge{phaseName="LoginPhase";showText;constructor(e=!0){super(),this.showText=e}async start(){const{gameData:e,ui:t}=s;super.start();const i=!!Fr(vi);t.setMode(x.LOADING,{buttonActions:[]});const n=await Hh(i,Ts),a=n?.[0]??!1,r=n?n[1]:null;if(!a){this.checkStatus(r);return}if(await e.loadSystem(),a||pn){await this.end();return}t.setMode(x.MESSAGE),t.showText(KT("menu:failedToLoadSaveData"))}async end(){s.ui.setMode(x.MESSAGE),s.gameData.gender||s.phaseManager.unshiftNew("SelectGenderPhase"),await ii(ds.Intro),super.end()}checkStatus(e){if(!e||e===400){this.showLoginRegister();return}if(e===401){Ur(vi),s.reset(!0,!0);return}s.phaseManager.unshiftNew("UnavailablePhase"),super.end()}showLoginRegister(){const{ui:e}=s,t=h(()=>{this.goToLogin()},"goToLoginButton"),i=h(()=>{this.goToRegister()},"goToRegistrationButton");this.showText&&e.showText(f.t("menu:logInOrCreateAccount")),s.playSound("ui/menu_open"),e.setMode(x.LOGIN_OR_REGISTER,{buttonActions:[t,i]})}async checkUserInfo(){return s.ui.playSelect(),(await Ts())[0]?!0:(Ur(vi),s.reset(!0,!0),!1)}goToLogin(){const{gameData:e,ui:t,phaseManager:i}=s,n=h(()=>{i.unshiftNew("LoginPhase",!1),this.end()},"backButton"),a=h(async()=>{await this.checkUserInfo()&&(await e.loadSystem(),this.end())},"loginButton");s.playSound("ui/menu_open"),t.setMode(x.LOGIN_FORM,{buttonActions:[a,n]})}goToRegister(){const{phaseManager:e,ui:t}=s,i=h(()=>{e.unshiftNew("LoginPhase",!1),this.end()},"backButton"),n=h(async()=>{await this.checkUserInfo()&&this.end()},"registerButton");s.playSound("ui/menu_open"),t.setMode(x.REGISTRATION_FORM,{buttonActions:[n,i]})}};h(nu,"LoginPhase");let Mo=nu;const au=class au extends Ge{phaseName="MessagePhase";text;callbackDelay;prompt;promptDelay;speaker;constructor(e,t,i,n,a){super(),this.text=e,this.callbackDelay=t,this.prompt=i,this.promptDelay=n,this.speaker=a}start(){if(super.start(),this.text.indexOf("$")>-1){const e=[],t=["#POKEMON1","#POKEMON2"];for(let n=0;n<s.getPlayerField().length;n++)e.push(s.getPlayerField()[n].getNameToRender()),this.text=this.text.split(e[n]).join(t[n]);const i=this.text.indexOf("$");if(i!==-1){let n=this.text.slice(0,i),a=this.text.slice(i+1);for(let r=0;r<s.getPlayerField().length;r++)n=n.split(t[r]).join(e[r]),a=a.split(t[r]).join(e[r]);s.phaseManager.unshiftNew("MessagePhase",a,this.callbackDelay,this.prompt,this.promptDelay,this.speaker),this.text=n.trim()}else for(let n=0;n<s.getPlayerField().length;n++)this.text=this.text.split(t[n]).join(e[n])}this.speaker?s.ui.showDialogue(this.text,this.speaker,null,()=>this.end(),this.callbackDelay||(this.prompt?0:1500),this.promptDelay??0):s.ui.showText(this.text,null,()=>this.end(),this.callbackDelay||(this.prompt?0:1500),this.prompt,this.promptDelay)}};h(au,"MessagePhase");let Ma=au;const ru=class ru extends rt{phaseName="MoneyRewardPhase";moneyMultiplier;constructor(e){super(),this.moneyMultiplier=e}start(){const e=new ct(s.getWaveMoneyAmount(this.moneyMultiplier));s.applyModifiers(Im,!0,e),s.arena.getTag(Us.HAPPY_HOUR)&&(e.value*=2),s.addMoney(e.value);const t=navigator.language||"en-US",i=e.value.toLocaleString(t),n=f.t("battle:moneyWon",{moneyAmount:i});s.ui.showText(n,null,()=>this.end(),null,!0)}};h(ru,"MoneyRewardPhase");let ko=ru;const ou=class ou extends Ge{constructor(e,t=!1){super(),this.anim=e,this.onSubstitute=t}phaseName="MoveAnimPhase";start(){super.start(),this.anim.play(this.onSubstitute,()=>this.end())}};h(ou,"MoveAnimPhase");let No=ou;const lu=class lu extends Ot{phaseName="MoveChargePhase";move;targetIndex;useMode;constructor(e,t,i,n){super(e),this.move=i,this.targetIndex=t,this.useMode=n}start(){super.start();const e=this.getUserPokemon(),t=this.getTargetPokemon(),i=this.move.getMove();if(!t||!i.isChargingMove()){console.warn("Invalid parameters for MoveChargePhase"),super.end();return}new vm(i.chargeAnim,i.id,e).play(!1,()=>{i.showChargeText(e,t),Kp("MoveEffectAttr",e,t,i),e.addTag(ke.CHARGING,1,i.id,e.id),this.end()})}end(){const e=this.getUserPokemon(),t=this.move.getMove(),i=new ft(!1);Kp("InstantChargeAttr",e,null,t,i),i.value?(s.phaseManager.tryRemovePhase("MoveEndPhase",n=>n.getPokemon()===e),s.phaseManager.unshiftNew("MovePhase",e,[this.targetIndex],this.move,this.useMode)):e.pushMoveQueue({move:t.id,targets:[this.targetIndex],useMode:this.useMode}),e.pushMoveHistory({move:this.move.moveId,targets:[this.targetIndex],result:ws.OTHER,useMode:this.useMode}),super.end()}getUserPokemon(){return(this.player?s.getPlayerField():s.getEnemyField())[this.fieldIndex]}getTargetPokemon(){return s.getField(!0).find(e=>this.targetIndex===e.getBattlerIndex())}};h(lu,"MoveChargePhase");let Po=lu;const et={PENDING:0,HIT:1,NO_EFFECT:2,NO_EFFECT_NO_MESSAGE:3,PROTECTED:4,MISS:5,REFLECTED:6,TARGET_NOT_ON_FIELD:7,ERROR:8},hu=class hu extends Ot{phaseName="MoveEffectPhase";move;targets;useMode;hitChecks;moveHistoryEntry;firstHit;lastHit;constructor(e,t,i,n){if(super(e),this.move=i,this.useMode=n,t.includes(e)&&this.move.moveTarget===Hn.ALL_NEAR_OTHERS){const a=t.indexOf(e);t.splice(a,a+1)}this.targets=t,this.hitChecks=new Array(this.targets.length).fill([et.PENDING,0])}conductHitChecks(e,t){let i=!1,n=!0,a=this.getTargets();for(const[r,o]of a.entries()){const l=this.hitCheck(o);if(t&&l[0]===et.REFLECTED){a=[o],this.hitChecks=[l];break}l[0]===et.HIT?i=!0:n||=l[0]===et.MISS,this.hitChecks[r]=l}return i?this.moveHistoryEntry.result=ws.SUCCESS:(e.turnData.hitCount=1,e.turnData.hitsLeft=1,this.moveHistoryEntry.result=n?ws.MISS:ws.FAIL),a}queueReflectedMove(e,t){const i=this.move.isMultiTarget()?Dh(t,this.move.id).targets:[e.getBattlerIndex()];t.getTag(ke.MAGIC_COAT)||(s.phaseManager.unshiftNew("ShowAbilityPhase",t.getBattlerIndex(),t.getPassiveAbility().hasAttr("ReflectStatusMoveAbAttr")),s.phaseManager.unshiftNew("HideAbilityPhase")),s.phaseManager.unshiftNew("MovePhase",t,i,new Fs(this.move.id),Rt.REFLECTED,fa.FIRST)}applyToTargets(e,t){let i=!0;for(const[n,a]of t.entries()){const[r,o]=this.hitChecks[n];switch(r){case et.HIT:if(this.applyMoveEffects(a,o,i),i=!1,Wn(this.move))return;break;case et.NO_EFFECT:s.phaseManager.queueMessage(f.t(this.move.id===st.SHEER_COLD?"battle:hitResultImmune":"battle:hitResultNoEffect",{pokemonName:Re(a)}));case et.NO_EFFECT_NO_MESSAGE:case et.PROTECTED:case et.TARGET_NOT_ON_FIELD:Ls("NoEffectAttr",e,a,this.move);break;case et.MISS:s.phaseManager.queueMessage(f.t("battle:attackMissed",{pokemonNameWithAffix:Re(a)})),Ls("MissEffectAttr",e,a,this.move);break;case et.REFLECTED:this.queueReflectedMove(e,a);break;case et.PENDING:case et.ERROR:throw new Error("Unexpected hit check result")}}}start(){super.start();const e=this.getUserPokemon();if(!e){super.end();return}e.isPlayer()?s.currentBattle.lastPlayerInvolved=this.fieldIndex:s.currentBattle.lastEnemyInvolved=this.fieldIndex;const t=this.move,i=new ft(!1);if(Ls("OverrideMoveEffectAttr",e,this.getFirstTarget()??null,t,i,this.useMode),i.value){this.end();return}if(e.lapseTags(Nt.MOVE_EFFECT),e.turnData.hitsLeft===-1){const r=new ct(1);Ls("MultiHitAttr",e,this.getFirstTarget()??null,t,r),ve("AddSecondStrikeAbAttr",{pokemon:e,move:t,hitCount:r,opponent:this.getFirstTarget()}),s.applyModifiers(Om,e.isPlayer(),e,t.id,r),e.turnData.hitCount=r.value,e.turnData.hitsLeft=r.value}this.moveHistoryEntry={move:this.move.id,targets:this.targets,result:ws.PENDING,useMode:this.useMode};const n=Wn(t),a=this.conductHitChecks(e,n);if(this.firstHit=e.turnData.hitCount===e.turnData.hitsLeft,this.lastHit=e.turnData.hitsLeft===1||!a.some(r=>r.isActive(!0)),this.moveHistoryEntry.result===ws.SUCCESS||t.getAttrs("MoveEffectAttr").some(r=>r.trigger===Ki.POST_TARGET)){const r=this.getFirstTarget();new Am(t.id,e,r?.getBattlerIndex()??nt.ATTACKER,s.currentBattle?.mysteryEncounter?.hasBattleAnimationsWithoutTargets??!1).play(t.hitsSubstitute(e,r),()=>this.postAnimCallback(e,a));return}this.postAnimCallback(e,a)}postAnimCallback(e,t){this.firstHit&&this.useMode!==Rt.DELAYED_ATTACK&&(e.pushMoveHistory(this.moveHistoryEntry),ve("ExecutedMoveAbAttr",{pokemon:e}));try{this.applyToTargets(e,t)}catch(n){console.warn(n.message||"Unexpected error in move effect phase"),this.end();return}const i=e.getMoveType(this.move,!0);this.move.category!==Oi.STATUS&&!e.stellarTypesBoosted.includes(i)&&e.stellarTypesBoosted.push(i),this.lastHit&&this.triggerMoveEffects(Ki.POST_TARGET,e,null),this.updateSubstitutes(),this.end()}end(){const e=this.getUserPokemon();if(!e){super.end();return}if(--e.turnData.hitsLeft>=1&&this.getFirstTarget()){this.addNextHitPhase(),super.end();return}const t=e.turnData.hitCount-Math.max(e.turnData.hitsLeft,0);(t>1||e.turnData.hitsLeft>0)&&s.phaseManager.queueMessage(f.t("battle:attackHitsCount",{count:t})),s.applyModifiers(xm,this.player,e),this.getTargets().forEach(i=>{i.turnData.moveEffectiveness=null}),super.end()}applyOnGetHitAbEffects(e,t,i,n,a=!1){const r={pokemon:t,opponent:e,move:this.move,hitResult:i,damage:n};ve("PostDefendAbAttr",r),a&&ve("PostReceiveCritStatStageChangeAbAttr",r),t.lapseTags(Nt.AFTER_HIT)}applyHeldItemFlinchCheck(e,t,i){if(!this.move.hasAttr("FlinchAttr")&&i&&!t.hasAbilityWithAttr("IgnoreMoveEffectsAbAttr")&&!this.move.hitsSubstitute(e,t)){const n=new ft(!1);s.applyModifiers(_m,e.isPlayer(),e,n),n.value&&t.addTag(ke.FLINCHED,void 0,this.move.id,e.id)}}protectedCheck(e,t){const i=t.isPlayer()?Tt.PLAYER:Tt.ENEMY,n=new ft(!1),a=new ft(!1);return this.move.isAllyTarget()||s.arena.applyTagsForSide(wm,i,!1,n,e,t,this.move.id,a),![Hn.ENEMY_SIDE,Hn.BOTH_SIDES].includes(this.move.moveTarget)&&(a.value||!this.move.doesFlagEffectApply({flag:Ai.IGNORE_PROTECT,user:e,target:t}))&&(n.value||t.findTags(r=>r instanceof zp).length===0&&t.findTags(r=>r instanceof Mm).some(r=>t.lapseTag(r.tagType))||this.move.category!==Oi.STATUS&&t.findTags(r=>r instanceof zp).some(r=>t.lapseTag(r.tagType)))}hitCheck(e){const t=this.getUserPokemon(),i=this.move;if(!t)return[et.ERROR,0];if(i.moveTarget===Hn.USER)return[et.HIT,1];const n=Wn(i);if(!e.isActive(!0)&&!n)return[et.TARGET_NOT_ON_FIELD,0];if(!n&&s.currentBattle.double&&e.getAlly()?.getTag(ke.COMMANDED)?.getSourcePokemon()===e)return[et.MISS,0];const a=n||this.checkBypassAccAndInvuln(e),r=e.getTag(eg);if(r&&!a&&!this.checkBypassSemiInvuln(r))return[et.MISS,0];if(!n&&this.protectedCheck(t,e))return[et.PROTECTED,0];if(!Vr(this.useMode)&&i.doesFlagEffectApply({flag:Ai.REFLECTABLE,user:t,target:e}))return[et.REFLECTED,0];if(n)return[et.HIT,1];const o=new ft(!1),l=e.getMoveEffectiveness(t,i,!1,!1,o);if(l===0)return[o.value?et.NO_EFFECT_NO_MESSAGE:et.NO_EFFECT,l];const c=i.calculateBattleAccuracy(t,e);if(t.turnData.hitsLeft<t.turnData.hitCount&&(!i.hasFlag(Ai.CHECK_ALL_HITS)||t.hasAbilityWithAttr("MaxMultiHitAbAttr")))return[et.HIT,l];const u=a||e.getTag(ke.ALWAYS_GET_HIT)||e.getTag(ke.TELEKINESIS)&&!this.move.hasAttr("OneHitKOAttr");if(c===-1||u)return[et.HIT,l];const p=t.getAccuracyMultiplier(e,this.move);return t.randBattleSeedInt(100)<c*p?[et.HIT,l]:[et.MISS,0]}checkBypassAccAndInvuln(e){const t=this.getUserPokemon();if(!t)return!1;if(t.hasAbilityWithAttr("AlwaysHitAbAttr")||e.hasAbilityWithAttr("AlwaysHitAbAttr")||this.move.hasAttr("ToxicAccuracyAttr")&&t.isOfType(Me.POISON)||t.getTag(ke.IGNORE_ACCURACY)&&(t.getLastXMoves().find(()=>!0)?.targets||[]).indexOf(e.getBattlerIndex())!==-1||Wn(this.move))return!0}checkBypassSemiInvuln(e){return e?this.move.getAttrs("HitsTagAttr").some(i=>i.tagType===e.tagType):!1}getUserPokemon(){return this.battlerIndex>nt.ENEMY_2?s.getPokemonById(this.battlerIndex):(this.player?s.getPlayerField():s.getEnemyField())[this.fieldIndex]??void 0}getTargets(){return s.getField(!0).filter(e=>this.targets.indexOf(e.getBattlerIndex())>-1)}getFirstTarget(){return this.getTargets()[0]}removeTarget(e){this.targets.indexOf(e.getBattlerIndex())!==-1&&this.targets.splice(this.targets.indexOf(e.getBattlerIndex()),1)}stopMultiHit(e){e&&this.removeTarget(e);const t=this.getUserPokemon();t&&(!e||this.targets.length===0)&&(t.turnData.hitCount=1,t.turnData.hitsLeft=1)}addNextHitPhase(){s.phaseManager.unshiftNew("MoveEffectPhase",this.battlerIndex,this.targets,this.move,this.useMode)}updateSubstitutes(){const e=this.getTargets();for(const t of e){const i=t.getTag(Ns);i&&i.hp<=0&&t.lapseTag(ke.SUBSTITUTE)}}triggerMoveEffects(e,t,i,n,a){km(r=>r.is("MoveEffectAttr")&&r.trigger===e&&(a==null||r.selfTarget===a)&&(!r.firstHitOnly||this.firstHit)&&(!r.lastHitOnly||this.lastHit)&&(!r.firstTargetOnly||(n??!0)),t,i,this.move)}applyMoveEffects(e,t,i){const n=this.getUserPokemon();if(n==null)return;this.triggerMoveEffects(Ki.PRE_APPLY,n,e);const[a,r,o]=this.applyMove(n,e,t);this.triggerMoveEffects(Ki.POST_APPLY,n,e,i,!0),this.move.hitsSubstitute(n,e)||this.applyOnTargetEffects(n,e,a,i,o,r),this.lastHit&&(s.triggerPokemonFormChange(n,Nm),n.turnData.hitCount>1&&ve("PostDamageAbAttr",{pokemon:e,damage:0,source:n}))}applyMoveDamage(e,t,i){const n=t.getCriticalHitResult(e,this.move);Ls("StatChangeBeforeDmgCalcAttr",e,t,this.move);const{result:a,damage:r}=t.getAttackDamage({source:e,move:this.move,ignoreAbility:!1,ignoreSourceAbility:!1,ignoreAllyAbility:!1,ignoreSourceAllyAbility:!1,simulated:!1,effectiveness:i,isCritical:n}),o=e.findTag(m=>m instanceof Pm&&m.boostedType===e.getMoveType(this.move));o?.oneUse&&e.removeTag(o.tagType);const l=a===Ze.ONE_HIT_KO;if(!r)return[a,!1,0];t.lapseTags(Nt.HIT);const c=t.getTag(Ns),u=c&&this.move.hitsSubstitute(e,t);u?(e.turnData.totalDamageDealt+=Math.min(r,c.hp),c.hp-=r):!t.isPlayer()&&r>=t.hp&&s.applyModifiers(Rm,!1,t);const p=u?0:t.damageAndUpdate(r,{result:a,ignoreFaintPhase:!0,ignoreSegments:l,isCritical:n,source:e});return n&&s.phaseManager.queueMessage(f.t("battle:hitResultCriticalHit")),p<=0?[a,n,p]:(e.isPlayer()&&(s.validateAchvs(Bm,new ct(p)),p>s.gameData.gameStats.highestDamage&&(s.gameData.gameStats.highestDamage=p)),e.turnData.totalDamageDealt+=p,e.turnData.singleHitDamageDealt=p,t.battleData.hitCount++,t.turnData.damageTaken+=p,t.turnData.attacksReceived.unshift({move:this.move.id,result:a,damage:p,critical:n,sourceId:e.id,sourceBattlerIndex:e.getBattlerIndex()}),e.isPlayer()&&t.isEnemy()&&s.applyModifiers(Lm,!0,e,new ct(p)),[a,n,p])}onFaintTarget(e,t){s.phaseManager.queueFaintPhase(t.getBattlerIndex(),!1,e),t.destroySubstitute(),t.lapseTag(ke.COMMANDED),!this.lastHit&&e.turnData.hitsLeft>1&&(this.lastHit=!0)}queueHitResultMessage(e){let t;switch(e){case Ze.SUPER_EFFECTIVE:t=f.t("battle:hitResultSuperEffective");break;case Ze.NOT_VERY_EFFECTIVE:t=f.t("battle:hitResultNotVeryEffective");break;case Ze.ONE_HIT_KO:t=f.t("battle:hitResultOneHitKo");break}t&&s.phaseManager.queueMessage(t)}applyMove(e,t,i){if(e.getMoveCategory(t,this.move)===Oi.STATUS)return[Ze.STATUS,!1,0];const a=this.applyMoveDamage(e,t,i);return(e.turnData.hitsLeft===1||t.isFainted())&&this.queueHitResultMessage(a[0]),t.isFainted()&&this.onFaintTarget(e,t),a}applyOnTargetEffects(e,t,i,n,a,r=!1){const o=[Ze.EFFECTIVE,Ze.SUPER_EFFECTIVE,Ze.NOT_VERY_EFFECTIVE,Ze.ONE_HIT_KO].includes(i);this.triggerMoveEffects(Ki.POST_APPLY,e,t,n,!1),this.applyHeldItemFlinchCheck(e,t,o),this.applyOnGetHitAbEffects(e,t,i,a,r),ve("PostAttackAbAttr",{pokemon:e,opponent:t,move:this.move,hitResult:i,damage:a}),!e.isPlayer()&&this.move.is("AttackMove")&&s.applyShuffledModifiers(tg,!1,t),this.move.is("AttackMove")&&s.applyModifiers(Dm,this.player,e,t)}};h(hu,"MoveEffectPhase");let Ro=hu;const cu=class cu extends Ot{phaseName="MoveEndPhase";wasFollowUp;targets;constructor(e,t,i=!1){super(e),this.targets=t,this.wasFollowUp=i}start(){super.start();const e=this.getPokemon();e&&(e.turnData.hitsLeft=-1),!this.wasFollowUp&&e?.isActive(!0)&&e.lapseTags(Nt.AFTER_MOVE),s.arena.setIgnoreAbilities(!1);for(const t of this.targets)t&&ve("PostSummonRemoveEffectAbAttr",{pokemon:t});this.end()}};h(cu,"MoveEndPhase");let Bo=cu;const uu=class uu extends rt{phaseName="MoveHeaderPhase";move;pokemon;constructor(e,t){super(),this.pokemon=e,this.move=t}getPokemon(){return this.pokemon}canMove(){return this.pokemon.isActive(!0)&&this.move.isUsable(this.pokemon)[0]}start(){super.start(),this.canMove()&&Ls("MoveHeaderAttr",this.pokemon,null,this.move.getMove()),this.end()}};h(uu,"MoveHeaderPhase");let Lo=uu;const du=class du extends Ot{phaseName="MovePhase";_pokemon;move;_targets;useMode;timingModifier;failed=!1;cancelled=!1;moveHistoryEntry;get pokemon(){return this._pokemon}set pokemon(e){this._pokemon=e}get targets(){return this._targets}set targets(e){this._targets=e}constructor(e,t,i,n,a=fa.NORMAL){super(e.getBattlerIndex()),this.pokemon=e,this.targets=t,this.move=i,this.useMode=n,this.timingModifier=a,this.moveHistoryEntry={move:st.NONE,targets:t,useMode:n}}fail(){this.moveHistoryEntry.result=ws.FAIL,this.failed=!0}cancel(){this.cancelled=!0,this.moveHistoryEntry.result=ws.FAIL}firstFailureCheck(){return this.checkSleep()||this.checkFreeze()||this.checkPP()||this.checkValidity()||this.checkTagCancel(ke.TRUANT)||this.checkPreUseInterrupt()||this.checkTagCancel(ke.FLINCHED)||this.checkTagCancel(ke.DISABLED)||this.checkTagCancel(ke.HEAL_BLOCK)||this.checkTagCancel(ke.THROAT_CHOPPED)||this.checkGravity()||this.checkTagCancel(ke.TAUNT)||this.checkTagCancel(ke.IMPRISON)||this.checkTagCancel(ke.CONFUSED)||this.checkPara()||this.checkTagCancel(ke.INFATUATED)}followUpMoveFirstFailureCheck(){return this.checkTagCancel(ke.HEAL_BLOCK)||this.checkTagCancel(ke.THROAT_CHOPPED)||this.checkGravity()}doThawCheck(){const e=this.pokemon;jp(this.useMode)||this.thaw&&e.cureStatus(lt.FREEZE,f.t("statusEffect:freeze.healByMove",{pokemonNameWithAffix:Re(e),moveName:this.move.getMove().name}))}secondFailureCheck(){const e=this.move.getMove(),t=this.pokemon;let i;const n=s.arena;if(!e.applyConditions(t,this.getActiveTargetPokemon()[0],2))this.failed=!0;else if(n.isMoveWeatherCancelled(t,e))i=Fm(s.arena.getWeatherType()),this.failed=!0;else return t.lapseTag(ke.POWDER,Nt.PRE_MOVE),this.failed;return this.failed&&this.showFailedText(i),this.failed}thirdFailureCheck(){const e=this.move.getMove(),t=this.getActiveTargetPokemon(),i=s.arena,n=this.pokemon,a=!e.applyConditions(n,t[0],3),r=i.isMoveTerrainCancelled(n,this.targets,e);let o=a||r;if(!o){const l=n.isPlayer()?s.getEnemyField():s.getPlayerField(),c=new ft(!1);l.forEach(u=>{ve("FieldPriorityMoveImmunityAbAttr",{pokemon:u,opponent:n,move:e,cancelled:c})}),o=c.value}return o?(this.failMove(r),!0):!1}resolveRedirectTarget(){if(this.targets.length!==1)return;const e=this.targets[0],t=new ct(e);for(const n of Es(Tt.BOTH))n!==this.pokemon&&ve("RedirectMoveAbAttr",{pokemon:n,moveId:this.move.moveId,targetIndex:t,sourcePokemon:this.pokemon});let i=e!==t.value;this.pokemon.getOpponents(!0).forEach(n=>{const a=n.getTag(Um);a&&(!a.powder||!this.pokemon.isOfType(Me.GRASS)&&!this.pokemon.hasAbility(Bn.OVERCOAT))&&(t.value=n.getBattlerIndex(),i=!1)}),e!==t.value&&(this.move.getMove().getAttrs("BypassRedirectAttr").forEach(a=>{(!a.abilitiesOnly||i)&&(t.value=e)}),this.pokemon.hasAbilityWithAttr("BlockRedirectAbAttr")&&(t.value=e,s.phaseManager.queueAbilityDisplay(this.pokemon,this.pokemon.getPassiveAbility().hasAttr("BlockRedirectAbAttr"),!0),s.phaseManager.queueAbilityDisplay(this.pokemon,this.pokemon.getPassiveAbility().hasAttr("BlockRedirectAbAttr"),!1)),this.targets[0]=t.value)}start(){if(super.start(),!this.pokemon.isActive(!0)){this.end();return}const e=this.pokemon;e.removeTag(ke.ALWAYS_GET_HIT),e.removeTag(ke.RECEIVE_DOUBLE_DAMAGE),st[this.move.moveId],Vm(Rt,this.useMode),e.turnData.acted=!0;const t=this.useMode,i=jp(t),n=t===Rt.FOLLOW_UP;if(i?n&&this.followUpMoveFirstFailureCheck():(this.firstFailureCheck(),e.lapseTags(Nt.PRE_MOVE)),this.cancelled){this.handlePreMoveFailures(),this.end();return}n||this.doThawCheck(),this.move.getMove().doesFlagEffectApply({flag:Ai.IGNORE_ABILITIES,user:e,isFollowUp:da(t)})&&s.arena.setIgnoreAbilities(!0,e.getBattlerIndex()),this.resolveRedirectTarget(),this.resolveCounterAttackTarget();const r=this.move.getMove(),o=r.isChargingMove(),l=o&&!e.getTag(ke.CHARGING),c=o&&!l;if(!r.hasAttr("CopyMoveAttr")&&!Vr(t)&&(s.currentBattle.lastMove=r.id),c||this.usePP(),n||s.triggerPokemonFormChange(e,Hm),this.showMoveText(),this.secondFailureCheck()){this.handlePreMoveFailures(),this.end();return}this.resolveFinalPreMoveCancellationChecks()||this.useMove(l),this.end()}resolveFinalPreMoveCancellationChecks(){const e=this.getActiveTargetPokemon(),t=this.pokemon.getMoveQueue();return e.length===0&&!this.move.getMove().hasAttr("AddArenaTrapTagAttr")||t.length>0&&t[0].move===st.NONE?(this.showFailedText(),this.fail(),this.pokemon.getMoveQueue().shift(),this.pokemon.pushMoveHistory(this.moveHistoryEntry),!0):(this.pokemon.lapseTags(Nt.MOVE),!1)}getActiveTargetPokemon(){return s.getField(!0).filter(e=>this.targets.includes(e.getBattlerIndex()))}triggerStatus(e,t=!0){const i=this.pokemon;s.phaseManager.queueMessage(sg(e,Re(i))),s.phaseManager.unshiftNew("CommonAnimPhase",i.getBattlerIndex(),void 0,ti.POISON+(e-1)),t&&(this.cancelled=!0)}checkSleep(){const e=this.pokemon;if(e.status?.effect!==lt.SLEEP)return!1;if(this.useMode===Rt.INDIRECT)return e.resetStatus(!1),!1;e.status.incrementTurn();const t=new ct(e.status.sleepTurnsRemaining??0);if(ve("ReduceStatusEffectDurationAbAttr",{pokemon:e,statusEffect:e.status.effect,duration:t}),e.status.sleepTurnsRemaining=t.value,e.status.sleepTurnsRemaining<=0)return e.cureStatus(lt.SLEEP),!1;const i=new ft(!1);Ls("BypassSleepAttr",this.pokemon,null,this.move.getMove(),i);const n=!i.value;return this.triggerStatus(lt.SLEEP,n),n}checkFreeze(){const e=this.pokemon;if(e.status?.effect!==lt.FREEZE)return!1;if(this.useMode===Rt.INDIRECT)return e.resetStatus(!1),!1;if(ie.STATUS_ACTIVATION_OVERRIDE)return!1;const t=this.move.getMove();return t.findAttr(i=>i.selfTarget&&i.is("HealStatusEffectAttr")&&i.isOfEffect(lt.FREEZE))&&(t.id!==st.BURN_UP||e.isOfType(Me.FIRE,!0,!0))?(this.thaw=!0,!1):ie.STATUS_ACTIVATION_OVERRIDE===!1||this.move.getMove().findAttr(i=>i.selfTarget&&i.is("HealStatusEffectAttr")&&i.isOfEffect(lt.FREEZE))||!e.randBattleSeedInt(5)&&ie.STATUS_ACTIVATION_OVERRIDE!==!0?(e.cureStatus(lt.FREEZE),!1):(this.triggerStatus(lt.FREEZE),!0)}checkPP(){const e=this.move;return e.getMove().pp!==-1&&!pa(this.useMode)&&e.ppUsed>=e.getMovePp()?(this.cancel(),this.showFailedText(),!0):!1}checkValidity(){const e=this.move,t=e.moveId,i=e.getName();let n;const a=new ft(!1);if(i.endsWith(" (N)"))n=f.t("battle:moveNotImplemented",{moveName:i.replace(" (N)","")});else if(t===st.NONE||this.targets.length===0){this.cancel();const r=this.pokemon.name,o=t===st.NONE?`${r} is attempting to use MoveId.NONE`:`${r} is attempting to use a move with no targets`;return console.warn(o),!0}else if(this.pokemon.isPlayer()&&Cs(Ss.POKEMON_MOVE,t,a)&&!a.value)n=f.t("battle:moveCannotUseChallenge",{moveName:i});else return!1;return this.cancel(),this.showFailedText(n),!0}checkPreUseInterrupt(){const e=this.move.getMove(),t=this.pokemon,i=this.getActiveTargetPokemon()[0];return e.getAttrs("PreUseInterruptAttr").some(n=>(n.apply(t,i,e),!!this.cancelled))}checkTagCancel(e){return this.pokemon.lapseTag(e,Nt.PRE_MOVE),this.cancelled}checkGravity(){const e=this.move.getMove();return!s.arena.hasTag(Us.GRAVITY)||!e.hasFlag(Ai.GRAVITY)?!1:(this.showFailedText(f.t("battle:moveDisabledGravity",{pokemonNameWithAffix:Re(this.pokemon),moveName:e.name})),!0)}checkPara(){return this.pokemon.status?.effect!==lt.PARALYSIS||!(ie.STATUS_ACTIVATION_OVERRIDE??this.pokemon.randBattleSeedInt(4)===0)?!1:(this.triggerStatus(lt.PARALYSIS),!0)}usePP(){if(!pa(this.useMode)){const e=this.move,t=1+this.getPpIncreaseFromPressure(this.getActiveTargetPokemon());e.usePp(t),s.eventTarget.dispatchEvent(new Wm(this.pokemon.id,e.getMove(),e.ppUsed))}}useMove(e=!1){const t=this.pokemon;if(this.useMode=t.getMoveQueue().shift()?.useMode??this.useMode,!e&&t.getTag(ke.CHARGING)?.sourceMove===this.move.moveId&&t.lapseTag(ke.CHARGING),this.thirdFailureCheck())return;const i=this.move.getMove(),n=this.getActiveTargetPokemon()[0];if(ve("PokemonTypeChangeAbAttr",{pokemon:t,move:i,opponent:n}),!i.applyConditions(t,n,4)){this.failMove();return}e?this.chargeMove():this.executeMove()}executeMove(){const e=this.pokemon,t=this.move.getMove(),i=this.targets;s.phaseManager.unshiftNew("MoveEffectPhase",e.getBattlerIndex(),i,t,this.useMode);const n=[Rt.INDIRECT,Rt.REFLECTED];if(this.move.getMove().hasFlag(Ai.DANCE_MOVE)&&!n.includes(this.useMode))for(const a of Es(Tt.BOTH))ve("PostMoveUsedAbAttr",{pokemon:a,move:this.move,source:e,targets:i})}failMove(e=!1){const t=this.move.getMove(),i=this.getActiveTargetPokemon(),n=this.pokemon;(e||[st.ROAR,st.WHIRLWIND,st.TRICK_OR_TREAT,st.FORESTS_CURSE].includes(this.move.moveId))&&ve("PokemonTypeChangeAbAttr",{pokemon:n,move:t,opponent:i[0]}),n.pushMoveHistory({move:t.id,targets:this.targets,result:ws.FAIL,useMode:this.useMode});const a=t.getFailedText(n,i[0],t)||(e?Gm(i[0],s.arena.getTerrainType()):f.t("battle:attackFailed"));this.showFailedText(a),n.lapseTags(Nt.MOVE_EFFECT)}chargeMove(){s.phaseManager.unshiftNew("MoveChargePhase",this.pokemon.getBattlerIndex(),this.targets[0],this.move,this.useMode===Rt.NORMAL?Rt.IGNORE_PP:this.useMode)}end(){s.phaseManager.unshiftNew("MoveEndPhase",this.pokemon.getBattlerIndex(),this.getActiveTargetPokemon(),da(this.useMode)),super.end()}getPpIncreaseFromPressure(e){return this.pokemon.getOpponents(!0).filter(i=>e.includes(i)&&i.hasAbilityWithAttr("IncreasePpAbAttr")).length}resolveCounterAttackTarget(){const e=this.targets;if(e.length!==1||e[0]!==nt.ATTACKER)return;const t=new ct(nt.ATTACKER);Ls("CounterRedirectAttr",this.pokemon,null,this.move.getMove(),t),e[0]=t.value,t.value===nt.ATTACKER&&this.fail()}handlePreMoveFailures(){if(!this.cancelled&&!this.failed)return;const e=this.pokemon;this.cancelled&&e.summonData.tags.some(i=>i.tagType===ke.FRENZY)&&Ym(e,this.move.getMove());const t=this.moveHistoryEntry;t.result=ws.FAIL,e.pushMoveHistory(t),e.lapseTags(Nt.MOVE_EFFECT),e.lapseTags(Nt.AFTER_MOVE),e.getMoveQueue().shift()}showMoveText(){const e=this.move,t=e.moveId,i=this.pokemon;t===st.NONE||i.getTag(ke.RECHARGING)||i.getTag(ke.INTERRUPTED)||(this.moveHistoryEntry.move=t,s.phaseManager.queueMessage(f.t(Vr(this.useMode)?"battle:magicCoatActivated":"battle:useMove",{pokemonNameWithAffix:Re(i),moveName:e.getName()}),500),Ls("PreMoveMessageAttr",i,this.getActiveTargetPokemon()[0],e.getMove()))}showFailedText(e=f.t("battle:attackFailed")){s.phaseManager.queueMessage(e)}};h(du,"MovePhase");let Do=du;const pu=class pu{type;tier;waveIndex;selectedOption;constructor(e,t,i,n){this.type=e,this.tier=t,this.waveIndex=i,this.selectedOption=n??-1}};h(pu,"SeenEncounterData");let Fo=pu;const fu=class fu{encounteredEvents=[];encounterSpawnChance=ig;queuedEncounters=[];constructor(e){e!=null&&Object.assign(this,e),this.encounteredEvents=this.encounteredEvents??[],this.queuedEncounters=this.queuedEncounters??[]}};h(fu,"MysteryEncounterSaveData");let Fi=fu;const gu=class gu extends Ge{phaseName="MysteryEncounterPhase";FIRST_DIALOGUE_PROMPT_DELAY=300;optionSelectSettings;constructor(e){super(),this.optionSelectSettings=e}start(){super.start(),s.phaseManager.clearPhaseQueue();const e=s.currentBattle.mysteryEncounter;e.updateSeedOffset(),this.optionSelectSettings||s.mysteryEncounterSaveData.encounteredEvents.push(new Fo(e.encounterType,e.encounterTier,s.currentBattle.waveIndex)),s.ui.setMode(x.MYSTERY_ENCOUNTER,this.optionSelectSettings)}handleOptionSelect(e,t){if(s.currentBattle.mysteryEncounter.selectedOption=e,!this.optionSelectSettings){const i=s.mysteryEncounterSaveData.encounteredEvents.at(-1);i.type===s.currentBattle.mysteryEncounter?.encounterType&&(i.selectedOption=t)}return e.onOptionPhase?(s.currentBattle.mysteryEncounter.populateDialogueTokensFromRequirements(),e.onPreOptionPhase?s.executeWithSeedOffset(async()=>await e.onPreOptionPhase().then(i=>{(i==null||i)&&this.continueEncounter()}),s.currentBattle.mysteryEncounter?.getSeedOffset()):this.continueEncounter(),!0):!1}continueEncounter(){const e=h(()=>{s.phaseManager.pushNew("MysteryEncounterOptionSelectedPhase"),this.end()},"endDialogueAndContinueEncounter"),t=s.currentBattle?.mysteryEncounter?.selectedOption?.dialogue;if(t?.selected&&t.selected.length>0){s.ui.setMode(x.MESSAGE);const i=t.selected;let n=0;const a=h(()=>{const r=n===i.length-1?e:a,o=i[n];let l=null;const c=ss(o.text);o.speaker&&(l=ss(o.speaker)),n++,l?s.ui.showDialogue(c??"",l,null,r,0,n===1?this.FIRST_DIALOGUE_PROMPT_DELAY:0):s.ui.showText(c??"",null,r,n===1?this.FIRST_DIALOGUE_PROMPT_DELAY:0,!0)},"showNextDialogue");a()}else e()}end(){s.ui.setMode(x.MESSAGE).then(()=>super.end())}};h(gu,"MysteryEncounterPhase");let Uo=gu;const mu=class mu extends Ge{phaseName="MysteryEncounterOptionSelectedPhase";onOptionSelect;constructor(){super(),this.onOptionSelect=s.currentBattle.mysteryEncounter.selectedOption.onOptionPhase}start(){super.start(),s.currentBattle.mysteryEncounter?.autoHideIntroVisuals?Km().then(()=>{s.executeWithSeedOffset(()=>{this.onOptionSelect().finally(()=>{this.end()})},s.currentBattle.mysteryEncounter?.getSeedOffset()*500)}):s.executeWithSeedOffset(()=>{this.onOptionSelect().finally(()=>{this.end()})},s.currentBattle.mysteryEncounter?.getSeedOffset()*500)}};h(mu,"MysteryEncounterOptionSelectedPhase");let Vo=mu;const yu=class yu extends Ge{phaseName="MysteryEncounterBattleStartCleanupPhase";start(){super.start();const e=[ke.FLINCHED,ke.ENDURING];for(const a of Es(Tt.BOTH)){const r=a.summonData.tags;r.filter(o=>e.includes(o.tagType)&&o.lapseTypes.includes(Nt.TURN_END)&&!o.lapse(a,Nt.TURN_END)).forEach(o=>{o.onRemove(a),r.splice(r.indexOf(o),1)})}s.phaseManager.removeAllPhasesOfType("PostTurnStatusEffectPhase");const t=s.getPokemonAllowedInBattle(),i=t.filter(a=>!a.isActive(!0));if(t.length===0)return s.phaseManager.unshiftNew("GameOverPhase"),this.end();s.getPlayerField().forEach((a,r)=>{!a.isAllowedInBattle()&&i.length>r&&s.phaseManager.unshiftNew("SwitchPhase",gt.SWITCH,r,!0,!1)}),s.currentBattle.double&&t.length===1&&i.length===0&&s.phaseManager.unshiftNew("ToggleDoublePositionPhase",!0);for(const a of s.getField(!0))a.resetTurnData();this.end()}};h(yu,"MysteryEncounterBattleStartCleanupPhase");let Ho=yu;const Tu=class Tu extends Ge{phaseName="MysteryEncounterBattlePhase";disableSwitch;constructor(e=!1){super(),this.disableSwitch=e}start(){super.start(),this.doMysteryEncounterBattle()}getBattleMessage(){const e=s.getEnemyField(),t=s.currentBattle.mysteryEncounter.encounterMode;return s.currentBattle.battleSpec===Xt.FINAL_BOSS?f.t("battle:bossAppeared",{bossName:e[0].name}):t===ms.TRAINER_BATTLE?s.currentBattle.double?f.t("battle:trainerAppearedDouble",{trainerName:s.currentBattle.trainer?.getName(yt.NONE,!0)}):f.t("battle:trainerAppeared",{trainerName:s.currentBattle.trainer?.getName(yt.NONE,!0)}):e.length===1?f.t("battle:singleWildAppeared",{pokemonName:e[0].name}):f.t("battle:multiWildAppeared",{pokemonName1:e[0].name,pokemonName2:e[1].name})}doMysteryEncounterBattle(){const e=s.currentBattle.mysteryEncounter.encounterMode;if(e===ms.WILD_BATTLE||e===ms.BOSS_BATTLE){e===ms.BOSS_BATTLE&&s.playBgm();const t=s.getEnemyParty().filter(i=>!i.isFainted()).length;s.phaseManager.unshiftNew("SummonPhase",0,!1),s.currentBattle.double&&t>1&&s.phaseManager.unshiftNew("SummonPhase",1,!1),s.currentBattle.mysteryEncounter?.hideBattleIntroMessage?this.endBattleSetup():s.ui.showText(this.getBattleMessage(),null,()=>this.endBattleSetup(),0)}else if(e===ms.TRAINER_BATTLE){this.showEnemyTrainer();const t=h(()=>{s.currentBattle.started=!0,s.playBgm(),s.pbTray.showPbTray(s.getPlayerParty()),s.pbTrayEnemy.showPbTray(s.getEnemyParty());const n=h(()=>{this.hideEnemyTrainer();const a=s.getEnemyParty().filter(r=>!r.isFainted()).length;s.phaseManager.unshiftNew("SummonPhase",0,!1),s.currentBattle.double&&a>1&&s.phaseManager.unshiftNew("SummonPhase",1,!1),this.endBattleSetup()},"doTrainerSummon");s.currentBattle.mysteryEncounter?.hideBattleIntroMessage?n():s.ui.showText(this.getBattleMessage(),null,n,1e3,!0)},"doSummon"),i=s.currentBattle.trainer?.getEncounterMessages();if(!i||i.length===0)t();else{const n=s.currentBattle.trainer;let a;s.executeWithSeedOffset(()=>a=Pn(i),s.currentBattle.mysteryEncounter?.getSeedOffset()),a=a;const r=h(()=>{s.ui.showDialogue(a,n?.getName(yt.NONE,!0),null,()=>{s.charSprite.hide().then(()=>s.hideFieldOverlay(250).then(()=>t()))})},"showDialogueAndSummon");s.currentBattle.trainer?.config.hasCharSprite&&!s.ui.shouldSkipDialogue(a)?s.showFieldOverlay(500).then(()=>s.charSprite.showCharacter(n?.getKey(),ar(i[0])).then(()=>r())):r()}}}endBattleSetup(){const e=s.getEnemyField(),t=s.currentBattle.mysteryEncounter.encounterMode;t!==ms.TRAINER_BATTLE&&s.findModifier(a=>a instanceof jf)&&e.map(a=>s.phaseManager.pushNew("ScanIvsPhase",a.getBattlerIndex()));const i=s.getPlayerParty().filter(n=>n.isAllowedInBattle());if(i[0].isOnField()||s.phaseManager.pushNew("SummonPhase",0),s.currentBattle.double)i.length>1&&(s.phaseManager.pushNew("ToggleDoublePositionPhase",!0),i[1].isOnField()||s.phaseManager.pushNew("SummonPhase",1));else{if(i.length>1&&i[1].isOnField()){for(const n of Es(Tt.PLAYER))n.lapseTag(ke.COMMANDED);s.phaseManager.pushNew("ReturnPhase",1)}s.phaseManager.pushNew("ToggleDoublePositionPhase",!1)}if(t!==ms.TRAINER_BATTLE&&!this.disableSwitch){const n=s.currentBattle.double?2:1;i.length>n&&(s.phaseManager.pushNew("CheckSwitchPhase",0,s.currentBattle.double),s.currentBattle.double&&s.phaseManager.pushNew("CheckSwitchPhase",1,s.currentBattle.double))}s.phaseManager.pushNew("InitEncounterPhase"),this.end()}showEnemyTrainer(){const e=s.currentBattle.trainer;e&&(e.alpha=0,e.x+=16,e.y-=16,e.setVisible(!0),s.tweens.add({targets:e,x:"-=16",y:"+=16",alpha:1,ease:"Sine.easeInOut",duration:750,onComplete:h(()=>{e.untint(100,"Sine.easeOut"),e.playAnim()},"onComplete")}))}hideEnemyTrainer(){s.tweens.add({targets:s.currentBattle.trainer,x:"+=16",y:"-=16",alpha:0,ease:"Sine.easeInOut",duration:750})}};h(Tu,"MysteryEncounterBattlePhase");let Wo=Tu;const Cu=class Cu extends Ge{phaseName="MysteryEncounterRewardsPhase";addHealPhase;constructor(e=!1){super(),this.addHealPhase=e}start(){super.start();const e=s.currentBattle.mysteryEncounter;e.doContinueEncounter?e.doContinueEncounter().then(()=>{this.end()}):s.executeWithSeedOffset(()=>{e.onRewards?e.onRewards().then(()=>{this.doEncounterRewardsAndContinue()}):this.doEncounterRewardsAndContinue()},s.currentBattle.waveIndex*1e3)}doEncounterRewardsAndContinue(){const e=s.currentBattle.mysteryEncounter;e.doEncounterExp&&e.doEncounterExp(),e.doEncounterRewards?e.doEncounterRewards():this.addHealPhase&&(s.phaseManager.removeAllPhasesOfType("SelectModifierPhase"),s.phaseManager.unshiftNew("SelectModifierPhase",0,void 0,{fillRemaining:!1,rerollMultiplier:-1})),s.phaseManager.pushNew("PostMysteryEncounterPhase"),this.end()}};h(Cu,"MysteryEncounterRewardsPhase");let Go=Cu;const Su=class Su extends Ge{phaseName="PostMysteryEncounterPhase";FIRST_DIALOGUE_PROMPT_DELAY=750;onPostOptionSelect;constructor(){super(),this.onPostOptionSelect=s.currentBattle.mysteryEncounter?.selectedOption?.onPostOptionPhase}start(){super.start(),this.onPostOptionSelect?s.executeWithSeedOffset(async()=>await this.onPostOptionSelect().then(e=>{(e==null||e)&&this.continueEncounter()}),s.currentBattle.mysteryEncounter?.getSeedOffset()*2e3):this.continueEncounter()}continueEncounter(){const e=h(()=>{(s.gameMode.hasRandomBiomes||s.isNewBiome())&&s.phaseManager.pushNew("SelectBiomePhase"),s.phaseManager.pushNew("NewBattlePhase"),this.end()},"endPhase"),t=s.currentBattle?.mysteryEncounter?.dialogue?.outro;if(t&&t.length>0){let i=0;const n=h(()=>{const a=i===t.length-1?e:n,r=t[i];let o=null;const l=ss(r.text);r.speaker&&(o=ss(r.speaker)),i++,s.ui.setMode(x.MESSAGE),o?s.ui.showDialogue(l??"",o,null,a,0,i===1?this.FIRST_DIALOGUE_PROMPT_DELAY:0):s.ui.showText(l??"",null,a,i===1?this.FIRST_DIALOGUE_PROMPT_DELAY:0,!0)},"showNextDialogue");n()}else e()}};h(Su,"PostMysteryEncounterPhase");let Yo=Su;const Eu=class Eu extends rt{phaseName="NewBattlePhase";start(){super.start(),s.phaseManager.removeAllPhasesOfType("NewBattlePhase"),s.newBattle(),this.end()}};h(Eu,"NewBattlePhase");let Ko=Eu;const bu=class bu extends Aa{phaseName="NextEncounterPhase";start(){super.start()}doEncounter(){s.playBgm(void 0,!0);for(const a of s.getPlayerParty())a&&a.resetWaveData();s.arenaNextEnemy.setBiome(s.arena.biomeType),s.arenaNextEnemy.setVisible(!0);const e=s.getEnemyField(),t=[s.arenaEnemy,s.arenaNextEnemy,s.currentBattle.trainer,e,s.lastEnemyTrainer],i=s.lastMysteryEncounter?.introVisuals;i&&t.push(i);const n=s.currentBattle.mysteryEncounter?.introVisuals;n&&(n.enterFromRight?(n.x+=500,s.tweens.add({targets:n,x:"-=200",duration:2e3})):t.push(n)),s.tweens.add({targets:t.flat(),x:"+=300",duration:2e3,onComplete:h(()=>{s.arenaEnemy.setBiome(s.arena.biomeType),s.arenaEnemy.setX(s.arenaNextEnemy.x),s.arenaEnemy.setAlpha(1),s.arenaNextEnemy.setX(s.arenaNextEnemy.x-300),s.arenaNextEnemy.setVisible(!1),s.lastEnemyTrainer&&s.lastEnemyTrainer.destroy(),i&&(s.field.remove(i,!0),s.lastMysteryEncounter.introVisuals=void 0),this.tryOverrideForBattleSpec()||this.doEncounterCommon()},"onComplete")})}trySetWeatherIfNewBiome(){}};h(bu,"NextEncounterPhase");let ka=bu;const Iu=class Iu extends ka{phaseName="NewBiomeEncounterPhase";doEncounter(){s.playBgm(void 0,!0);for(const n of s.getPlayerParty())n&&(n.resetBattleAndWaveData(),n.isOnField()&&ve("PostBiomeChangeAbAttr",{pokemon:n}));const e=s.getEnemyField(),t=[s.arenaEnemy,e],i=s.currentBattle?.mysteryEncounter?.introVisuals;i&&t.push(i),s.tweens.add({targets:t.flat(),x:"+=300",duration:2e3,onComplete:h(()=>{this.tryOverrideForBattleSpec()||this.doEncounterCommon()},"onComplete")})}trySetWeatherIfNewBiome(){s.arena.trySetWeather($f(s.arena))}};h(Iu,"NewBiomeEncounterPhase");let zo=Iu;const vu=class vu extends Ot{phaseName="ObtainStatusEffectPhase";statusEffect;sourcePokemon;sleepTurnsRemaining;statusMessage;constructor(e,t,i,n,a=null,r){super(e),this.statusEffect=t,this.sourcePokemon=i,this.sleepTurnsRemaining=n,this.statusMessage=r||zm(t,Re(this.getPokemon()),a??void 0)}start(){const e=this.getPokemon();e.doSetStatus(this.statusEffect,this.sleepTurnsRemaining),e.updateInfo(!0),new nr(ti.POISON+(this.statusEffect-1),e).play(!1,()=>{s.phaseManager.queueMessage(this.statusMessage),this.statusEffect&&this.statusEffect!==lt.FAINT&&(s.triggerPokemonFormChange(e,jm,!0),s.arena.setIgnoreAbilities(!1),ve("PostSetStatusAbAttr",{pokemon:e,effect:this.statusEffect,sourcePokemon:this.sourcePokemon}),this.sourcePokemon&&ve("ConfusionOnStatusEffectAbAttr",{pokemon:this.sourcePokemon,opponent:e,effect:this.statusEffect})),this.end()})}};h(vu,"ObtainStatusEffectPhase");let jo=vu;const Ou=class Ou extends Ge{phaseName="PartyExpPhase";expValue;useWaveIndexMultiplier;pokemonParticipantIds;constructor(e,t,i){super(),this.expValue=e,this.useWaveIndexMultiplier=t,this.pokemonParticipantIds=i}start(){super.start(),s.applyPartyExp(this.expValue,!1,this.useWaveIndexMultiplier,this.pokemonParticipantIds),this.end()}};h(Ou,"PartyExpPhase");let $o=Ou;const Au=class Au extends rt{phaseName="PartyHealPhase";resumeBgm;constructor(e){super(),this.resumeBgm=e}start(){super.start();const e=s.isBgmPlaying();e&&s.fadeOutBgm(1e3,!1),s.ui.fadeOut(1e3).then(()=>{const t=new ft(!1);Cs(Ss.PREVENT_REVIVE,t);for(const n of s.getPlayerParty())if(!(n.isFainted()&&t.value)){n.hp=n.getMaxHp(),n.resetStatus(!0,!1,!1,!0);for(const a of n.moveset)a.ppUsed=0;n.updateInfo(!0)}const i=s.playSoundWithoutBgm("heal");i&&s.time.delayedCall(ge(i.totalDuration*1e3),()=>{i.destroy(),this.resumeBgm&&e&&s.playBgm(),s.ui.fadeIn(500).then(()=>this.end())})}),s.arena.playerTerasUsed=0}};h(Au,"PartyHealPhase");let Xo=Au;const xu=class xu extends rt{phaseName="PokemonAnimPhase";key;pokemon;fieldAssets;constructor(e,t,i=[]){super(),this.key=e,this.pokemon=t,this.fieldAssets=i}start(){switch(super.start(),this.key){case mi.SUBSTITUTE_ADD:this.doSubstituteAddAnim();break;case mi.SUBSTITUTE_PRE_MOVE:this.doSubstitutePreMoveAnim();break;case mi.SUBSTITUTE_POST_MOVE:this.doSubstitutePostMoveAnim();break;case mi.SUBSTITUTE_REMOVE:this.doSubstituteRemoveAnim();break;case mi.COMMANDER_APPLY:this.doCommanderApplyAnim();break;case mi.COMMANDER_REMOVE:this.doCommanderRemoveAnim();break;default:this.end()}}doSubstituteAddAnim(){const e=this.pokemon.getTag(Ns);if(e==null){this.end();return}const t=h(()=>{const r=s.addFieldSprite(this.pokemon.x+this.pokemon.getSprite().x,this.pokemon.y+this.pokemon.getSprite().y,`pkmn${this.pokemon.isPlayer()?"__back":""}__sub`);return r.setOrigin(.5,1),s.field.add(r),r},"getSprite"),[i,n]=[t(),t()],a=this.pokemon.getSpriteScale()*(this.pokemon.isPlayer()?.5:1);i.setVisible(!1),i.setScale(a),n.setTintFill(16777215),n.setScale(.01),this.pokemon.isPlayer()&&s.field.bringToTop(this.pokemon),s.playSound("PRSFX- Transform"),s.tweens.add({targets:this.pokemon,duration:500,x:this.pokemon.x+this.pokemon.getSubstituteOffset()[0],y:this.pokemon.y+this.pokemon.getSubstituteOffset()[1],alpha:.5,ease:"Sine.easeIn"}),s.tweens.add({targets:n,delay:250,scale:a,ease:"Cubic.easeInOut",duration:500,onComplete:h(()=>{i.setVisible(!0),s.tweens.add({targets:n,delay:250,alpha:0,ease:"Cubic.easeOut",duration:1e3,onComplete:h(()=>{n.destroy(),e.sprite=i,this.end()},"onComplete")})},"onComplete")})}doSubstitutePreMoveAnim(){if(this.fieldAssets.length!==1){this.end();return}const e=this.fieldAssets[0];if(e===void 0){this.end();return}s.tweens.add({targets:e,alpha:0,ease:"Sine.easeInOut",duration:500}),s.tweens.add({targets:this.pokemon,x:e.x,y:e.y,alpha:1,ease:"Sine.easeInOut",delay:250,duration:500,onComplete:h(()=>this.end(),"onComplete")})}doSubstitutePostMoveAnim(){if(this.fieldAssets.length!==1){this.end();return}const e=this.fieldAssets[0];if(e===void 0){this.end();return}s.tweens.add({targets:this.pokemon,x:e.x+this.pokemon.getSubstituteOffset()[0],y:e.y+this.pokemon.getSubstituteOffset()[1],alpha:.5,ease:"Sine.easeInOut",duration:500}),s.tweens.add({targets:e,alpha:1,ease:"Sine.easeInOut",delay:250,duration:500,onComplete:h(()=>this.end(),"onComplete")})}doSubstituteRemoveAnim(){if(this.fieldAssets.length!==1){this.end();return}const e=this.fieldAssets[0];if(e===void 0){this.end();return}const i=h(()=>{const a=s.addFieldSprite(e.x,e.y,`pkmn${this.pokemon.isPlayer()?"__back":""}__sub`);return a.setOrigin(.5,1),s.field.add(a),a},"getSprite")(),n=this.pokemon.getSpriteScale()*(this.pokemon.isPlayer()?.5:1);i.setAlpha(0),i.setTintFill(16777215),i.setScale(n),s.tweens.add({targets:i,alpha:1,ease:"Sine.easeInOut",duration:500,onComplete:h(()=>{e.destroy();const a=s.time.addEvent({delay:100,repeat:7,startAt:200,callback:h(()=>{s.playSound("PRSFX- Substitute2.wav"),i.setVisible(a.repeatCount%2===0),a.repeatCount||(s.tweens.add({targets:i,scale:.01,ease:"Sine.cubicEaseIn",duration:500}),s.tweens.add({targets:this.pokemon,x:this.pokemon.x-this.pokemon.getSubstituteOffset()[0],y:this.pokemon.y-this.pokemon.getSubstituteOffset()[1],alpha:1,ease:"Sine.easeInOut",delay:250,duration:500,onComplete:h(()=>{i.destroy(),this.end()},"onComplete")}))},"callback")})},"onComplete")})}doCommanderApplyAnim(){if(!s.currentBattle?.double){this.end();return}const e=this.pokemon.getAlly();if(e?.species?.speciesId!==ye.DONDOZO){this.end();return}const t=this.pokemon.x+this.pokemon.getSprite().x,i=this.pokemon.y+this.pokemon.getSprite().y,a=h(()=>{const l=s.addPokemonSprite(this.pokemon,t,i,this.pokemon.getSprite().texture,this.pokemon.getSprite().frame.name,!0);return["spriteColors","fusionSpriteColors"].map(c=>l.pipelineData[c]=this.pokemon.getSprite().pipelineData[c]),l.setPipelineData("spriteKey",this.pokemon.getBattleSpriteKey()),l.setPipelineData("shiny",this.pokemon.shiny),l.setPipelineData("variant",this.pokemon.variant),l.setPipelineData("ignoreFieldPos",!0),l.setOrigin(.5,1),this.pokemon.getSprite().on("animationupdate",(c,u)=>l.setFrame(u.textureFrame)),s.field.add(l),l},"getSourceSprite")();this.pokemon.setVisible(!1);const r=this.pokemon.getFieldPositionOffset(),o=e.getFieldPositionOffset();s.playSound("se/pb_throw"),s.tweens.add({targets:a,duration:375,scale:.5,x:{value:t+(o[0]-r[0])/2,ease:"Linear"},y:{value:(this.pokemon.isPlayer()?100:65)+r[1],ease:"Sine.easeOut"},onComplete:h(()=>{s.field.bringToTop(e),s.tweens.add({targets:a,duration:375,scale:.01,x:{value:e.x,ease:"Linear"},y:{value:e.y+e.height/2,ease:"Sine.easeIn"},onComplete:h(()=>{a.destroy(),s.playSound("battle_anims/PRSFX- Liquidation1.wav"),s.tweens.add({targets:e,duration:250,ease:"Sine.easeInOut",scale:.85,yoyo:!0,onComplete:h(()=>this.end(),"onComplete")})},"onComplete")})},"onComplete")})}doCommanderRemoveAnim(){const e=this.pokemon.getAlly();if(e==null){console.warn("Aborting COMMANDER_REMOVE anim: Tatsugiri is undefined"),this.end();return}const t=s.addPokemonSprite(e,this.pokemon.x+this.pokemon.getSprite().x,this.pokemon.y+this.pokemon.getSprite().y+this.pokemon.height/2,e.getSprite().texture,e.getSprite().frame.name,!0);["spriteColors","fusionSpriteColors"].map(i=>t.pipelineData[i]=e.getSprite().pipelineData[i]),t.setPipelineData("spriteKey",e.getBattleSpriteKey()),t.setPipelineData("shiny",e.shiny),t.setPipelineData("variant",e.variant),t.setPipelineData("ignoreFieldPos",!0),this.pokemon.getSprite().on("animationupdate",(i,n)=>t.setFrame(n.textureFrame)),t.setOrigin(.5,1),t.setScale(.01),s.field.add(t),s.field.bringToTop(this.pokemon),t.setVisible(!0),s.tweens.add({targets:this.pokemon,duration:250,ease:"Sine.easeInOut",scale:1.15,yoyo:!0,onComplete:h(()=>{s.playSound("battle_anims/PRSFX- Liquidation4.wav"),s.tweens.add({targets:t,duration:500,scale:1,x:{value:e.x+e.getSprite().x,ease:"Linear"},y:{value:e.y+e.getSprite().y,ease:"Sine.easeIn"},onComplete:h(()=>{e.setVisible(!0),t.destroy(),this.end()},"onComplete")})},"onComplete")})}};h(xu,"PokemonAnimPhase");let qo=xu;const _u=class _u extends gn{phaseName="PokemonHealPhase";hpHealed;message;showFullHpMessage;skipAnim;revive;healStatus;preventFullHeal;fullRestorePP;constructor(e,t,i,n=!0,a=!1,r=!1,o=!1,l=!1,c=!1){super(e,void 0,ti.HEALTH_UP),this.hpHealed=t,this.message=i,this.showFullHpMessage=n,this.skipAnim=a,this.revive=r,this.healStatus=o,this.preventFullHeal=l,this.fullRestorePP=c}start(){!this.skipAnim&&(this.revive||this.getPokemon().hp)&&!this.getPokemon().isFullHp()?super.start():this.end()}end(){const e=this.getPokemon();if(!e.isOnField()||!this.revive&&!e.isActive())return super.end();const t=!!this.message,i=this.fullRestorePP&&e.getMoveset().some(o=>o.ppUsed>0),n=!e.isFullHp()||this.hpHealed<0||i,a=e.getTag(ke.HEAL_BLOCK);let r=lt.NONE;if(a&&this.hpHealed>0)return s.phaseManager.queueMessage(a.onActivation(e)),this.message=null,super.end();if(n){const o=new ct(1);this.revive||s.applyModifiers(ng,this.player,o);const l=new ct(Math.floor(this.hpHealed*o.value));if(l.value<0&&(e.damageAndUpdate(l.value*-1,{result:Ze.INDIRECT}),l.value=0),this.preventFullHeal&&e.hp+l.value>=e.getMaxHp()&&(l.value=e.getMaxHp()-e.hp-1),l.value=e.heal(l.value),l.value&&s.damageNumberHandler.add(e,l.value,Ze.HEAL),e.isPlayer()&&(s.validateAchvs($m,l),l.value>s.gameData.gameStats.highestHeal&&(s.gameData.gameStats.highestHeal=l.value)),this.healStatus&&!this.revive&&e.status&&(r=e.status.effect,e.resetStatus()),this.fullRestorePP)for(const c of this.getPokemon().getMoveset())c&&(c.ppUsed=0);e.updateInfo().then(()=>super.end())}else this.healStatus&&!this.revive&&e.status?(r=e.status.effect,e.resetStatus(),e.updateInfo().then(()=>super.end())):this.showFullHpMessage&&(this.message=f.t("battle:hpIsFull",{pokemonName:Re(e)}));this.message&&s.phaseManager.queueMessage(this.message),this.healStatus&&r&&!t&&s.phaseManager.queueMessage(Xm(r,Re(e))),!n&&!r&&super.end()}};h(_u,"PokemonHealPhase");let Zo=_u;const wu=class wu extends Ot{phaseName="PokemonTransformPhase";targetIndex;playSound;constructor(e,t,i=!1){super(e),this.targetIndex=t,this.playSound=i}start(){const e=this.getPokemon(),t=s.getField()[this.targetIndex];if(!t){this.end();return}e.summonData.speciesForm=t.getSpeciesForm(),e.summonData.ability=t.getAbility().id,e.summonData.gender=t.getGender(),e.removeTag(ke.POWER_TRICK);for(const n of qm)e.setStat(n,t.getStat(n,!1),!1);for(const n of Zm)e.setStatStage(n,t.getStatStage(n));e.summonData.moveset=t.getMoveset().map(n=>n?new Fs(n.moveId,0,0,Math.min(n.getMove().pp,5)):(console.warn(`Transform: somehow iterating over a ${n} value when copying moveset!`),new Fs(st.NONE))),e.summonData.types=t.getTypes();const i=[e.updateInfo()];this.playSound&&s.playSound("battle_anims/PRSFX- Transform"),s.phaseManager.queueMessage(f.t("abilityTriggers:postSummonTransform",{pokemonNameWithAffix:Re(e),targetName:t.name})),i.push(e.loadAssets(!1).then(()=>{e.playAnim(),e.updateInfo(),e.setTempAbility(t.getAbility())})),Promise.allSettled(i).then(()=>this.end())}};h(wu,"PokemonTransformPhase");let Qo=wu;const Mu=class Mu extends Ge{phaseName="PositionalTagPhase";start(){s.arena.positionalTagManager.activateAllTags(),super.end()}};h(Mu,"PositionalTagPhase");let Jo=Mu;const ku=class ku extends Ge{phaseName="PostGameOverPhase";endCardPhase;slotId;constructor(e,t){super(),this.slotId=e,this.endCardPhase=t}start(){super.start();const e=h(()=>{s.gameData.saveAll(!0,!0,!0).then(t=>{if(!t)return s.reset(!0);s.gameData.tryClearSession(this.slotId).then(i=>{if(!i[0])return s.reset(!0);s.reset(),s.phaseManager.unshiftNew("TitlePhase"),this.end()})})},"saveAndReset");this.endCardPhase?s.ui.fadeOut(500).then(()=>{s.ui.getMessageHandler().bg.setVisible(!0),this.endCardPhase?.endCard.destroy(),this.endCardPhase?.text.destroy(),e()}):e()}};h(ku,"PostGameOverPhase");let el=ku;const Nu=class Nu extends Ot{phaseName="PostTurnStatusEffectPhase";constructor(e){super(e)}start(){const e=this.getPokemon();if(e?.isActive(!0)&&e.status&&e.status.isPostTurn()&&!e.switchOutStatus){e.status.incrementTurn();const t=new ft(!1);if(ve("BlockNonDirectDamageAbAttr",{pokemon:e,cancelled:t}),ve("BlockStatusDamageAbAttr",{pokemon:e,cancelled:t}),t.value)this.end();else{s.phaseManager.queueMessage(sg(e.status.effect,Re(e)));const i=new ct(0);switch(e.status.effect){case lt.POISON:i.value=Math.max(e.getMaxHp()>>3,1);break;case lt.TOXIC:i.value=Math.max(Math.floor(e.getMaxHp()/16*e.status.toxicTurnCount),1);break;case lt.BURN:i.value=Math.max(e.getMaxHp()>>4,1),ve("ReduceBurnDamageAbAttr",{pokemon:e,burnDamage:i});break}i.value&&(s.damageNumberHandler.add(this.getPokemon(),e.damage(i.value,!1,!0)),e.updateInfo(),ve("PostDamageAbAttr",{pokemon:e,damage:i.value})),new nr(ti.POISON+(e.status.effect-1),e).play(!1,()=>this.end())}}else this.end()}end(){s.currentBattle.battleSpec===Xt.FINAL_BOSS?s.initFinalBossPhaseTwo(this.getPokemon()):super.end()}};h(Nu,"PostTurnStatusEffectPhase");let tl=Nu;const Pu=class Pu extends rt{phaseName="QuietFormChangePhase";pokemon;formChange;constructor(e,t){super(),this.pokemon=e,this.formChange=t}start(){if(super.start(),this.pokemon.formIndex===this.pokemon.species.forms.findIndex(a=>a.formKey===this.formChange.formKey)){this.end();return}const e=Re(this.pokemon);if(!this.pokemon.isOnField()||this.pokemon.getTag(eg)||this.pokemon.isFainted()){this.pokemon.isPlayer()||this.pokemon.isActive()?this.pokemon.changeForm(this.formChange).then(()=>{s.ui.showText(Dr(this.pokemon,this.formChange,e),null,()=>this.end(),1500)}):this.end();return}const t=h(()=>{const a=s.addPokemonSprite(this.pokemon,this.pokemon.x+this.pokemon.getSprite().x,this.pokemon.y+this.pokemon.getSprite().y,"pkmn__sub");a.setOrigin(.5,1);const r=this.pokemon.getBattleSpriteKey();try{a.play(r).stop()}catch(o){console.error(`Failed to play animation for ${r}`,o)}return a.setPipeline(s.spritePipeline,{tone:[0,0,0,0],hasShadow:!1,teraColor:pi(this.pokemon.getTeraType()),isTerastallized:this.pokemon.isTerastallized}),["spriteColors","fusionSpriteColors"].map(o=>{this.pokemon.summonData.speciesForm&&(o+="Base"),a.pipelineData[o]=this.pokemon.getSprite().pipelineData[o]}),s.field.add(a),a},"getPokemonSprite"),[i,n]=[t(),t()];this.pokemon.getSprite().on("animationupdate",(a,r)=>{r.textureKey===i.texture.key?i.setFrame(r.textureFrame):n.setFrame(r.textureFrame)}),i.setAlpha(0),i.setTintFill(16777215),n.setVisible(!1),n.setTintFill(16777215),s.playSound("battle_anims/PRSFX- Transform"),s.tweens.add({targets:i,alpha:1,duration:1e3,ease:"Cubic.easeIn",onComplete:h(()=>{this.pokemon.setVisible(!1),this.pokemon.changeForm(this.formChange).then(()=>{n.setScale(.01);const a=this.pokemon.getBattleSpriteKey();try{n.play(a).stop()}catch(r){console.error(`Failed to play animation for ${a}`,r)}n.setVisible(!0),s.tweens.add({targets:i,delay:250,scale:.01,ease:"Cubic.easeInOut",duration:500,onComplete:h(()=>i.destroy(),"onComplete")}),s.tweens.add({targets:n,delay:250,scale:this.pokemon.getSpriteScale(),ease:"Cubic.easeInOut",duration:500,onComplete:h(()=>{this.pokemon.setVisible(!0),s.tweens.add({targets:n,delay:250,alpha:0,ease:"Cubic.easeOut",duration:1e3,onComplete:h(()=>{i.setVisible(!1),s.ui.showText(Dr(this.pokemon,this.formChange,e),null,()=>this.end(),1500)},"onComplete")})},"onComplete")})})},"onComplete")})}end(){if(this.pokemon.findAndRemoveTags(e=>e.tagType===ke.AUTOTOMIZED),s?.currentBattle.battleSpec===Xt.FINAL_BOSS&&this.pokemon.isEnemy()&&(s.playBgm(),s.phaseManager.unshiftNew("PokemonHealPhase",this.pokemon.getBattlerIndex(),this.pokemon.getMaxHp(),null,!1,!1,!1,!0),this.pokemon.findAndRemoveTags(()=>!0),this.pokemon.bossSegments=5,this.pokemon.bossSegmentIndex=4,this.pokemon.initBattleInfo(),this.pokemon.cry(),s.phaseManager.cancelMove(e=>e.pokemon===this.pokemon)),this.formChange.trigger instanceof ag){const e={pokemon:this.pokemon};ve("PostTeraFormChangeStatChangeAbAttr",e),ve("ClearWeatherAbAttr",e),ve("ClearTerrainAbAttr",e)}super.end()}};h(Pu,"QuietFormChangePhase");let sl=Pu;const Ru=class Ru extends Ge{phaseName="ReloadSessionPhase";systemDataStr;constructor(e){super(),this.systemDataStr=e}start(){s.ui.setMode(x.SESSION_RELOAD);let e=!1,t=!1;s.time.delayedCall(ge(1500),()=>{t?this.end():e=!0}),s.gameData.clearLocalData(),(this.systemDataStr?s.gameData.initSystem(this.systemDataStr):s.gameData.loadSystem()).then(()=>{e?this.end():t=!0})}};h(Ru,"ReloadSessionPhase");let il=Ru;const Bu=class Bu extends rt{phaseName="ResetStatusPhase";pokemon;affectConfusion;reloadAssets;constructor(e,t,i){super(),this.pokemon=e,this.affectConfusion=t,this.reloadAssets=i}start(){this.pokemon.clearStatus(this.affectConfusion,this.reloadAssets),this.end()}};h(Bu,"ResetStatusPhase");let nl=Bu;const Lu=class Lu extends _a{phaseName="SummonPhase";loaded;constructor(e,t=!0,i=!1){super(e,t),this.loaded=i}start(){super.start(),ve("PreSummonAbAttr",{pokemon:this.getPokemon()}),this.preSummon()}preSummon(){const e=this.getPokemon();if(!e.isAllowedInBattle()||this.player&&!this.getParty().some(t=>t.id===e.id)){console.warn("The Pokemon about to be sent out is fainted or illegal under a challenge. Attempting to resolve..."),e.isOnField()&&e.leaveField();const t=this.getParty(),i=t.findIndex((n,a)=>a>this.partyMemberIndex&&n.isAllowedInBattle());if(i===-1){console.error(`Party Details:
`,t),console.error("All available Pokemon were fainted or illegal!"),s.phaseManager.clearPhaseQueue(),s.phaseManager.unshiftNew("GameOverPhase"),this.end();return}[t[this.partyMemberIndex],t[i]]=[t[i],t[this.partyMemberIndex]],console.warn("Swapped %s %O with %s %O",Re(e),e,Re(t[0]),t[0])}if(this.player)s.ui.showText(f.t("battle:playerGo",{pokemonName:Re(this.getPokemon())})),this.player&&s.pbTray.hide(),s.trainer.setTexture(`trainer_${s.gameData.gender===De.FEMALE?"f":"m"}_back_pb`),s.time.delayedCall(562,()=>{s.trainer.setFrame("2"),s.time.delayedCall(64,()=>{s.trainer.setFrame("3")})}),s.tweens.add({targets:s.trainer,x:-36,duration:1e3,onComplete:h(()=>s.trainer.setVisible(!1),"onComplete")}),s.time.delayedCall(750,()=>this.summon());else if(s.currentBattle.battleType===de.TRAINER||s.currentBattle.mysteryEncounter?.encounterMode===ms.TRAINER_BATTLE){const t=s.currentBattle.trainer?.getName(this.fieldIndex%2?yt.TRAINER_PARTNER:yt.TRAINER),i=this.getPokemon().getNameToRender(),n=f.t("battle:trainerSendOut",{trainerName:t,pokemonName:i});s.pbTrayEnemy.hide(),s.ui.showText(n,null,()=>this.summon())}else s.currentBattle.isBattleMysteryEncounter()&&(s.pbTrayEnemy.hide(),this.summonWild())}summon(){const e=this.getPokemon(),t=s.addFieldSprite(this.player?36:248,this.player?80:44,"pb",wi(e.getPokeball(!0)));if(t.setVisible(!1),t.setOrigin(.5,.625),s.field.add(t),this.fieldIndex===1)e.setFieldPosition(ys.RIGHT,0);else{const n=this.getParty().filter(a=>a.isAllowedInBattle()).length;e.setFieldPosition(!s.currentBattle.double||n===1?ys.CENTER:ys.LEFT)}const i=e.getFieldPositionOffset();t.setVisible(!0),s.tweens.add({targets:t,duration:650,x:(this.player?100:236)+i[0]}),s.tweens.add({targets:t,duration:150,ease:"Cubic.easeOut",y:(this.player?70:34)+i[1],onComplete:h(()=>{s.tweens.add({targets:t,duration:500,ease:"Cubic.easeIn",angle:1440,y:(this.player?132:86)+i[1],onComplete:h(()=>{if(s.playSound("se/pb_rel"),t.destroy(),s.add.existing(e),s.field.add(e),!this.player){const n=s.getPlayerPokemon();n?.isOnField()&&s.field.moveBelow(e,n),s.currentBattle.seenEnemyPartyMemberIds.add(e.id)}Wf(e.x,e.y-16,e.getPokeball(!0)),s.updateModifiers(this.player),s.updateFieldScale(),e.showInfo(),e.playAnim(),e.setVisible(!0),e.getSprite().setVisible(!0),e.setScale(.5),e.tint(ln(e.getPokeball(!0))),e.untint(250,"Sine.easeIn"),s.updateFieldScale(),s.tweens.add({targets:e,duration:250,ease:"Sine.easeIn",scale:e.getSpriteScale(),onComplete:h(()=>{e.cry(e.getHpRatio()>.25?void 0:{rate:.85}),e.getSprite().clearTint(),e.fieldSetup(),e.summonData.speciesForm&&e.loadAssets(!1),s.time.delayedCall(1e3,()=>this.end())},"onComplete")})},"onComplete")})},"onComplete")})}summonWild(){const e=this.getPokemon();if(this.fieldIndex===1)e.setFieldPosition(ys.RIGHT,0);else{const t=this.getParty().filter(i=>!i.isFainted()).length;e.setFieldPosition(!s.currentBattle.double||t===1?ys.CENTER:ys.LEFT)}if(s.add.existing(e),s.field.add(e),!this.player){const t=s.getPlayerPokemon();t?.isOnField()&&s.field.moveBelow(e,t),s.currentBattle.seenEnemyPartyMemberIds.add(e.id)}s.updateModifiers(this.player),s.updateFieldScale(),e.showInfo(),e.playAnim(),e.setVisible(!0),e.getSprite().setVisible(!0),e.setScale(.75),e.tint(ln(e.pokeball)),e.untint(250,"Sine.easeIn"),s.updateFieldScale(),e.x+=16,e.y-=20,e.alpha=0,s.tweens.add({targets:e,x:"-=16",y:"+=16",alpha:1,duration:1e3,ease:"Sine.easeIn",scale:e.getSpriteScale(),onComplete:h(()=>{e.cry(e.getHpRatio()>.25?void 0:{rate:.85}),e.getSprite().clearTint(),e.fieldSetup(),s.updateFieldScale(),s.time.delayedCall(1e3,()=>this.end())},"onComplete")})}onEnd(){const e=this.getPokemon();e.isShiny(!0)&&s.phaseManager.unshiftNew("ShinySparklePhase",e.getBattlerIndex()),e.resetTurnData(),(!this.loaded||[de.TRAINER,de.MYSTERY_ENCOUNTER].includes(s.currentBattle.battleType)||s.currentBattle.waveIndex%10===1)&&(s.triggerPokemonFormChange(e,rr,!0),this.queuePostSummon())}queuePostSummon(){this.getPokemon().turnData.summonedThisTurn=!0}end(){this.onEnd(),super.end()}getFieldIndex(){return this.fieldIndex}};h(Lu,"SummonPhase");let vn=Lu;const Du=class Du extends vn{phaseName="SwitchSummonPhase";switchType;slotIndex;doReturn;lastPokemon;constructor(e,t,i,n,a=!0){super(t,a),this.switchType=e,this.slotIndex=i,this.doReturn=n}start(){super.start()}preSummon(){if(this.player||(this.slotIndex===-1&&(this.slotIndex=s.currentBattle.trainer?.getNextSummonIndex(this.fieldIndex?yt.TRAINER_PARTNER:yt.TRAINER)),this.slotIndex>-1&&(this.showEnemyTrainer(this.fieldIndex%2?yt.TRAINER_PARTNER:yt.TRAINER),s.pbTrayEnemy.showPbTray(s.getEnemyParty()))),!this.doReturn||this.slotIndex!==-1&&!(this.player?s.getPlayerParty():s.getEnemyParty())[this.slotIndex]){if(this.player){this.switchAndSummon();return}s.time.delayedCall(750,()=>this.switchAndSummon());return}const e=this.getPokemon();for(const t of Es(this.player?Tt.ENEMY:Tt.PLAYER))t.removeTagsBySourceId(e.id);if(this.switchType===gt.SWITCH||this.switchType===gt.INITIAL_SWITCH){const t=e.getTag(Ns);t&&s.tweens.add({targets:t.sprite,duration:250,scale:t.sprite.scale*.5,ease:"Sine.easeIn",onComplete:h(()=>t.sprite.destroy(),"onComplete")})}s.ui.showText(this.player?f.t("battle:playerComeBack",{pokemonName:Re(e)}):f.t("battle:trainerComeBack",{trainerName:s.currentBattle.trainer?.getName(this.fieldIndex%2?yt.TRAINER_PARTNER:yt.TRAINER),pokemonName:e.getNameToRender()})),s.playSound("se/pb_rel"),e.hideInfo(),e.tint(ln(e.getPokeball(!0)),1,250,"Sine.easeIn"),s.tweens.add({targets:e,duration:250,ease:"Sine.easeIn",scale:.5,onComplete:h(()=>{s.time.delayedCall(750,()=>this.switchAndSummon()),e.leaveField(this.switchType===gt.SWITCH,!1)},"onComplete")})}switchAndSummon(){const e=this.player?this.getParty():s.getEnemyParty(),t=e[this.slotIndex];if(this.lastPokemon=this.getPokemon(),t.resetSummonData(),t.loadAssets(!0),this.lastPokemon.isOnField()&&this.lastPokemon.leaveField(this.switchType===gt.SWITCH),ve("PreSummonAbAttr",{pokemon:t}),ve("PreSwitchOutAbAttr",{pokemon:this.lastPokemon}),!t){this.end();return}if(this.switchType===gt.BATON_PASS&&((this.player?s.getEnemyField():s.getPlayerField()).forEach(n=>n.transferTagsBySourceId(this.lastPokemon.id,t.id)),!s.findModifier(n=>n instanceof $p&&n.pokemonId===t.id))){const n=s.findModifier(a=>a instanceof $p&&a.pokemonId===this.lastPokemon.id);n&&s.tryTransferHeldItemModifier(n,t,!1,void 0,void 0,void 0,!1)}e[this.slotIndex]=this.lastPokemon,e[this.fieldIndex]=t;const i=h(()=>{s.ui.showText(this.getSendOutText(t)),this.switchType===gt.BATON_PASS||this.switchType===gt.SHED_TAIL?this.lastPokemon.getTag(Ns)&&(t.x+=this.lastPokemon.getSubstituteOffset()[0],t.y+=this.lastPokemon.getSubstituteOffset()[1],t.setAlpha(.5)):t.fieldSetup(!0),this.summon()},"showTextAndSummon");this.player?i():s.time.delayedCall(1500,()=>{this.hideEnemyTrainer(),s.pbTrayEnemy.hide(),i()})}onEnd(){super.onEnd();const e=this.getPokemon(),t=s.currentBattle.lastMove,i=t?We[t]:void 0,n=s.currentBattle.turnCommands[this.fieldIndex]?.command,a=i?.hasAttr("ForceSwitchOutAttr")&&!this.lastPokemon.isFainted(),r=this.lastPokemon.hasAbilityWithAttr("PostDamageForceSwitchAbAttr")&&!this.lastPokemon.isFainted();if((n===Ie.POKEMON||a||r)&&(e.tempSummonData.turnCount--,e.tempSummonData.waveTurnCount--),this.switchType===gt.BATON_PASS&&e)e.transferSummon(this.lastPokemon);else if(this.switchType===gt.SHED_TAIL&&e){const o=this.lastPokemon.getTag(Ns);o&&e.summonData.tags.push(o)}this.switchType!==gt.INITIAL_SWITCH&&(e.resetTurnData(),e.turnData.switchedInThisTurn=!0),this.lastPokemon.resetSummonData(),s.triggerPokemonFormChange(e,rr,!0),s.arena.triggerWeatherBasedFormChanges(e)}queuePostSummon(){s.phaseManager.unshiftNew("PostSummonPhase",this.getPokemon().getBattlerIndex())}getSendOutText(e){return this.switchType===gt.FORCE_SWITCH?f.t("battle:pokemonDraggedOut",{pokemonName:Re(e)}):this.player?f.t("battle:playerGo",{pokemonName:Re(e)}):f.t("battle:trainerGo",{trainerName:s.currentBattle.trainer?.getName(this.fieldIndex%2?yt.TRAINER_PARTNER:yt.TRAINER),pokemonName:this.getPokemon().getNameToRender()})}};h(Du,"SwitchSummonPhase");let Na=Du;const Fu=class Fu extends Na{phaseName="ReturnPhase";constructor(e){super(gt.SWITCH,e,-1,!0)}switchAndSummon(){this.end()}summon(){}onEnd(){const e=this.getPokemon();e.resetSprite(),e.resetTurnData(),e.resetSummonData(),s.updateFieldScale(),s.triggerPokemonFormChange(e,rr)}};h(Fu,"ReturnPhase");let al=Fu;const Uu=class Uu extends rt{constructor(e){super(),this.user=e}phaseName="RevivalBlessingPhase";start(){s.ui.setMode(x.PARTY,ts.REVIVAL_BLESSING,this.user.getFieldIndex(),(e,t)=>{if(e>=0&&e<6){const i=s.getPlayerParty()[e];if(!i||!i.isFainted())return this.end();i.resetTurnData(),i.resetStatus(!0,!1,!1,!1),i.heal(Math.min(rg(.5*i.getMaxHp()),i.getMaxHp())),s.phaseManager.queueMessage(f.t("moveTriggers:revivalBlessing",{pokemonName:i.name}),0,!0);const n=this.user.getAlly();s.currentBattle.double&&s.getPlayerParty().length>1&&n!=null&&(e<=1?(s.phaseManager.unshiftNew("SwitchSummonPhase",gt.SWITCH,i.getFieldIndex(),e,!1,!0),s.phaseManager.unshiftNew("ToggleDoublePositionPhase",!0)):n.isFainted()&&(s.phaseManager.unshiftNew("SwitchSummonPhase",gt.SWITCH,n.getFieldIndex(),e,!1,!0),s.phaseManager.unshiftNew("ToggleDoublePositionPhase",!0)))}s.ui.setMode(x.MESSAGE).then(()=>this.end())},Ln.FilterFainted)}};h(Uu,"RevivalBlessingPhase");let rl=Uu;const Vu=class Vu extends Cn{phaseName="RibbonModifierRewardPhase";species;constructor(e,t){super(e),this.species=t}doReward(){return new Promise(e=>{const t=this.modifierType.newModifier();s.addModifier(t),s.playSound("level_up_fanfare"),s.ui.setMode(x.MESSAGE),s.ui.showText(f.t("battle:beatModeFirstTime",{speciesName:this.species.name,gameMode:s.gameMode.getName(),newModifier:t?.type.name}),null,()=>{e()},null,!0,1500)})}};h(Vu,"RibbonModifierRewardPhase");let ol=Vu;const Hu=class Hu extends Ot{phaseName="ScanIvsPhase";constructor(e){super(e)}start(){super.start();const e=this.getPokemon();for(const t of s.getEnemyField()){const i=t.ivs,n=s.gameData.dexData[t.species.getRootSpeciesId()].ivs,r=t.getBattleInfo().getStatsValueContainer().list.filter(o=>o.name.includes("icon_stat_label"));for(const o of r){const l=li[o.frame.name];if(i[l]>n[l]&&sn.includes(Number(l))){const c=i[l]===31?le(O.PERFECT_IV,!1):le(O.SUMMARY_GREEN,!1),u=Phaser.Display.Color.HexStringToColor(c).color;o.setTint(u)}o.setVisible(!0)}}if(s.hideIvs){this.end();return}s.ui.showText(f.t("battle:ivScannerUseQuestion",{pokemonName:Re(e)}),null,()=>{s.ui.setMode(x.CONFIRM,()=>{s.ui.setMode(x.MESSAGE),s.ui.clearText(),s.ui.getMessageHandler().promptIvs(e.id,e.ivs).then(()=>this.end())},()=>{s.ui.setMode(x.MESSAGE),s.ui.clearText(),this.end()})})}};h(Hu,"ScanIvsPhase");let ll=Hu;const Wu=class Wu extends rt{phaseName="SelectBiomePhase";start(){super.start(),s.resetSeed();const e=s.gameMode,t=s.arena.biomeType,i=s.currentBattle.waveIndex,n=i+1,a=h(r=>{if(n%10===1){s.applyModifiers(Jm,!0);const o=new ft(!0);Cs(Ss.PARTY_HEAL,o),o.value?s.phaseManager.unshiftNew("PartyHealPhase",!1):s.phaseManager.unshiftNew("SelectModifierPhase",void 0,void 0,e.isFixedBattle(i)?e.getFixedBattle(i).customModifierRewardSettings:void 0)}s.phaseManager.unshiftNew("SwitchBiomePhase",r),this.end()},"setNextBiome");if(e.isClassic&&e.isWaveFinal(n+9)||e.isDaily&&e.isWaveFinal(n)||e.hasShortBiomes&&!(n%50))a(Je.END);else if(e.hasRandomBiomes)a(this.generateNextBiome(n));else if(Array.isArray(Gn[t])){const r=Gn[t].filter(o=>!Array.isArray(o)||!Ke(o[1])).map(o=>Array.isArray(o)?o[0]:o);if(r.length>1&&s.findModifier(o=>o instanceof Qm)){const o=r.map(l=>({label:ga(l),handler:h(()=>(s.ui.setMode(x.MESSAGE),a(l),!0),"handler")}));s.ui.setMode(x.OPTION_SELECT,{options:o,delay:1e3})}else a(r[Ke(r.length)])}else Gn.hasOwnProperty(t)?a(Gn[t]):a(this.generateNextBiome(n))}generateNextBiome(e){return e%50===0?Je.END:s.generateRandomBiome(e)}};h(Wu,"SelectBiomePhase");let hl=Wu;const Gu=class Gu extends Ge{phaseName="SelectChallengePhase";start(){super.start(),s.playBgm("menu"),s.ui.setMode(x.CHALLENGE_SELECT)}};h(Gu,"SelectChallengePhase");let cl=Gu;const Yu=class Yu extends Ge{phaseName="SelectGenderPhase";start(){super.start(),s.ui.showText(f.t("menu:boyOrGirl"),null,()=>{s.ui.setMode(x.OPTION_SELECT,{options:[{label:f.t("settings:boy"),handler:h(()=>(s.gameData.gender=De.MALE,s.gameData.saveSetting(Vs.Player_Gender,0),s.gameData.saveSystem().then(()=>this.end()),!0),"handler")},{label:f.t("settings:girl"),handler:h(()=>(s.gameData.gender=De.FEMALE,s.gameData.saveSetting(Vs.Player_Gender,1),s.gameData.saveSystem().then(()=>this.end()),!0),"handler")}]})})}end(){s.ui.setMode(x.MESSAGE),super.end()}};h(Yu,"SelectGenderPhase");let ul=Yu;const Zs=7,vr=12,Or=24,Rs=-62,Ku=class Ku extends Ni{modifierContainer;rerollButtonContainer;lockRarityButtonContainer;transferButtonContainer;checkButtonContainer;continueButtonContainer;rerollCostText;lockRarityButtonText;moveInfoOverlay;moveInfoOverlayActive=!1;rowCursor=0;player;rerollCost;transferButtonWidth;checkButtonWidth;options;shopOptionsRows;cursorObj;constructor(){super(x.CONFIRM),this.options=[],this.shopOptionsRows=[]}setup(){const e=this.getUi();this.modifierContainer=s.add.container(0,0),e.add(this.modifierContainer);const i=document.createElement("canvas").getContext("2d"),n=Vi(O.PARTY).styleOptions;i&&(i.font=n.fontSize+"px "+n.fontFamily,this.transferButtonWidth=i.measureText(f.t("modifierSelectUiHandler:manageItems")).width,this.checkButtonWidth=i.measureText(f.t("modifierSelectUiHandler:checkTeam")).width),this.transferButtonContainer=s.add.container((s.game.canvas.width-this.checkButtonWidth)/6-21,Rs),this.transferButtonContainer.setName("transfer-btn"),this.transferButtonContainer.setVisible(!1),e.add(this.transferButtonContainer);const a=P(-4,-2,f.t("modifierSelectUiHandler:manageItems"),O.PARTY);a.setName("text-transfer-btn"),a.setOrigin(1,0),this.transferButtonContainer.add(a),this.checkButtonContainer=s.add.container(s.scaledCanvas.width-1,Rs),this.checkButtonContainer.setName("use-btn"),this.checkButtonContainer.setVisible(!1),e.add(this.checkButtonContainer);const r=P(-4,-2,f.t("modifierSelectUiHandler:checkTeam"),O.PARTY);r.setName("text-use-btn"),r.setOrigin(1,0),this.checkButtonContainer.add(r),this.rerollButtonContainer=s.add.container(16,Rs),this.rerollButtonContainer.setName("reroll-brn"),this.rerollButtonContainer.setVisible(!1),e.add(this.rerollButtonContainer);const o=P(-4,-2,f.t("modifierSelectUiHandler:reroll"),O.PARTY);o.setName("text-reroll-btn"),o.setOrigin(0,0),this.rerollButtonContainer.add(o),this.rerollCostText=P(0,0,"",O.MONEY),this.rerollCostText.setName("text-reroll-cost"),this.rerollCostText.setOrigin(0,0),this.rerollCostText.setPositionRelative(o,o.displayWidth+5,1),this.rerollButtonContainer.add(this.rerollCostText),this.lockRarityButtonContainer=s.add.container(16,Rs),this.lockRarityButtonContainer.setVisible(!1),e.add(this.lockRarityButtonContainer),this.lockRarityButtonText=P(-4,-2,f.t("modifierSelectUiHandler:lockRarities"),O.PARTY),this.lockRarityButtonText.setOrigin(0,0),this.lockRarityButtonContainer.add(this.lockRarityButtonText),this.continueButtonContainer=s.add.container(s.scaledCanvas.width/2,-(s.scaledCanvas.height/2)),this.continueButtonContainer.setVisible(!1),e.add(this.continueButtonContainer);const l=P(-24,5,f.t("modifierSelectUiHandler:continueNextWaveButton"),O.MESSAGE);l.setName("text-continue-btn"),this.continueButtonContainer.add(l),this.moveInfoOverlay=new si({delayVisibility:!0,onSide:!0,right:!0,x:1,y:-si.getHeight(!0)-1,width:s.scaledCanvas.width-2}),e.add(this.moveInfoOverlay),s.addInfoToggle(this.moveInfoOverlay)}show(e){if(s.disableMenu=!1,this.active)return e.length>=3&&(this.awaitingActionInput=!0,this.onActionInput=e[2]),this.moveInfoOverlay.active=this.moveInfoOverlayActive,!1;if(e.length!==4||!Array.isArray(e[1])||!(e[2]instanceof Function))return!1;super.show(e),this.getUi().clearText(),this.player=e[0];const t=this.player&&s.findModifiers(E=>E instanceof es&&E.isTransferable).length>0,i=!!s.findModifier(E=>E instanceof ey);this.transferButtonContainer.setVisible(!1),this.transferButtonContainer.setAlpha(0),this.checkButtonContainer.setVisible(!1),this.checkButtonContainer.setAlpha(0),this.rerollButtonContainer.setVisible(!1),this.rerollButtonContainer.setAlpha(0),this.lockRarityButtonContainer.setVisible(!1),this.lockRarityButtonContainer.setAlpha(0),this.continueButtonContainer.setVisible(!1),this.continueButtonContainer.setAlpha(0),this.rerollButtonContainer.setPositionRelative(this.lockRarityButtonContainer,0,i?-12:0),this.rerollCost=e[3],this.updateRerollCostText();const n=e[1],a=s.gameMode.getShopStatus(),r=new ct(s.getWaveMoneyAmount(1));s.applyModifier(Hr,!0,r);const o=a?og(s.currentBattle.waveIndex,r.value):[],l=o.length>Zs?-vr:-Or;for(let E=0;E<n.length;E++){const I=s.scaledCanvas.width/(n.length+2),A=new Pa(I*(E+1)+I*.5,-s.scaledCanvas.height/2+l,n[E]);A.setScale(.5),s.add.existing(A),this.modifierContainer.add(A),this.options.push(A)}const c=this.continueButtonContainer.getAt(0);c.y=l-5,c.setVisible(this.options.length===0);for(let E=0;E<o.length;E++){const I=E<Zs?0:1,A=E<Zs?E:E-Zs,_=o.slice(I?Zs:0,I?void 0:Zs),w=s.scaledCanvas.width/(_.length+2),L=new Pa(w*(A+1)+w*.5,-s.scaledCanvas.height/2-s.game.canvas.height/32-(42-(28*I-1)),o[E]);L.setScale(.375),s.add.existing(L),this.modifierContainer.add(L),I>=this.shopOptionsRows.length&&this.shopOptionsRows.push([]),this.shopOptionsRows[I].push(L)}const u=n.map(E=>E.upgradeCount).reduce((E,I)=>Math.max(I,E),0);s.getModifierBar().updateModifiers(s.modifiers,!0),s.showShopOverlay(750*s.gameSpeed),s.updateAndShowText(750),s.updateBiomeWaveText(),s.updateMoneyText(),this.awaitingActionInput=!1;const{promise:p,resolve:m}=Promise.withResolvers();let d=0;const y=[],g=[];s.tweens.addCounter({ease:"Sine.easeIn",duration:1250,onUpdate:h(E=>{const I=E.getValue(),A=Math.floor(I*n.length);if(A>d&&A<=n.length){const _=this.options[d];_&&y.push(_.show(Math.floor((1-I)*1250)*.325+2e3*u,-(u-n[d].upgradeCount),g)),d++}},"onUpdate"),onComplete:h(()=>{Promise.allSettled(y).then(()=>m())},"onComplete")});const C=[];return s.time.delayedCall(1e3+u*2e3,()=>{for(const E of this.shopOptionsRows.flat())E.show(0,0,C,!1)}),p.then(()=>{s.time.delayedCall(500,()=>{t&&(this.transferButtonContainer.setAlpha(0),this.transferButtonContainer.setVisible(!0),s.tweens.add({targets:this.transferButtonContainer,alpha:1,duration:250})),this.rerollButtonContainer.setAlpha(0),this.checkButtonContainer.setAlpha(0),this.lockRarityButtonContainer.setAlpha(0),this.continueButtonContainer.setAlpha(0),this.rerollButtonContainer.setVisible(!0),this.checkButtonContainer.setVisible(!0),this.continueButtonContainer.setVisible(this.rerollCost<0),this.lockRarityButtonContainer.setVisible(i),s.tweens.add({targets:[this.checkButtonContainer,this.continueButtonContainer],alpha:1,duration:250}),s.tweens.add({targets:[this.rerollButtonContainer,this.lockRarityButtonContainer],alpha:this.rerollCost<0?.5:1,duration:250}),Promise.allSettled([...C,...g]).then(()=>{const E=h(()=>{s.shopCursorTarget===la.CHECK_TEAM?(this.setRowCursor(0),this.setCursor(2)):s.shopCursorTarget===la.SHOP&&!a?(this.setRowCursor(la.REWARDS),this.setCursor(0)):(this.setRowCursor(s.shopCursorTarget),this.setCursor(0))},"updateCursorTarget");E(),ii(ds.Select_Item).then(I=>{I&&E(),this.awaitingActionInput=!0,this.onActionInput=e[2]})})})}),!0}processInput(e){const t=this.getUi();if(!this.awaitingActionInput)return!1;let i=!1;if(e===b.ACTION){if(i=!0,this.onActionInput){const n=this.onActionInput;this.awaitingActionInput=!1,this.onActionInput=null,n(this.rowCursor,this.cursor)?(this.moveInfoOverlayActive=this.moveInfoOverlay.active,this.moveInfoOverlay.setVisible(!1),this.moveInfoOverlay.active=!1):(this.awaitingActionInput=!0,this.onActionInput=n)}}else if(e===b.CANCEL){if(this.player&&(i=!0,this.onActionInput)){const n=this.onActionInput;this.awaitingActionInput=!1,this.onActionInput=null,n(-1,-1),this.moveInfoOverlayActive=this.moveInfoOverlay.active,this.moveInfoOverlay.setVisible(!1),this.moveInfoOverlay.active=!1}}else switch(e){case b.UP:this.rowCursor===0&&this.cursor===3?i=this.setCursor(0):this.rowCursor<this.shopOptionsRows.length+1?i=this.setRowCursor(this.rowCursor+1):i=this.setRowCursor(0);break;case b.DOWN:this.rowCursor?i=this.setRowCursor(this.rowCursor-1):this.lockRarityButtonContainer.visible&&this.cursor===0?i=this.setCursor(3):i=this.setRowCursor(this.shopOptionsRows.length+1);break;case b.LEFT:if(this.rowCursor)this.cursor?i=this.setCursor(this.cursor-1):this.rowCursor===1&&this.options.length===0?i=!1:i=this.setCursor(this.getRowItems(this.rowCursor)-1);else switch(this.cursor){case 0:i=this.setCursor(2);break;case 1:this.lockRarityButtonContainer.visible?i=this.setCursor(3):i=this.rerollButtonContainer.visible&&this.setCursor(0);break;case 2:this.transferButtonContainer.visible?i=this.setCursor(1):this.rerollButtonContainer.visible?i=this.setCursor(0):i=!1;break;case 3:this.lockRarityButtonContainer.visible?i=this.setCursor(2):i=!1}break;case b.RIGHT:if(this.rowCursor)this.cursor<this.getRowItems(this.rowCursor)-1?i=this.setCursor(this.cursor+1):this.rowCursor===1&&this.options.length===0?i=this.setRowCursor(0):i=this.setCursor(0);else switch(this.cursor){case 0:this.transferButtonContainer.visible?i=this.setCursor(1):i=this.setCursor(2);break;case 1:i=this.setCursor(2);break;case 2:i=this.setCursor(0);break;case 3:this.transferButtonContainer.visible?i=this.setCursor(1):i=this.setCursor(2);break}break}return i&&t.playSelect(),i}setCursor(e){const t=this.getUi(),i=super.setCursor(e);this.cursorObj||(this.cursorObj=s.add.image(0,0,"cursor"),this.modifierContainer.add(this.cursorObj));const n=this.rowCursor===1?this.options:this.shopOptionsRows.at(-(this.rowCursor-1));if(this.cursorObj.setScale(this.rowCursor===1?2:this.rowCursor>=2?1.5:1),this.moveInfoOverlay.clear(),this.rowCursor){if(this.rowCursor===1&&n.length===0)return this.cursorObj.setScale(1.25),this.cursorObj.setPosition(s.scaledCanvas.width/3+23,-s.scaledCanvas.height/2-(this.shopOptionsRows.length>1?vr-2:Or-2)),t.showText(f.t("modifierSelectUiHandler:continueNextWaveDescription")),i;const a=s.scaledCanvas.width/(n.length+2);this.rowCursor<2?this.cursorObj.setPosition(a*(e+1)+a*.5-20,-s.scaledCanvas.height/2-(this.shopOptionsRows.length>1?vr-2:Or-2)):this.cursorObj.setPosition(a*(e+1)+a*.5-16,-s.scaledCanvas.height/2-s.game.canvas.height/32-(-14+28*(this.rowCursor-(this.shopOptionsRows.length-1))));const r=n[this.cursor].modifierTypeOption.type;r&&t.showText(r.getDescription()),r instanceof Wr&&this.moveInfoOverlay.show(We[r.moveId])}else e===0?(this.cursorObj.setPosition(6,this.lockRarityButtonContainer.visible?Rs-8:Rs+4),t.showText(f.t("modifierSelectUiHandler:rerollDesc"))):e===1?(this.cursorObj.setPosition((s.game.canvas.width-this.transferButtonWidth-this.checkButtonWidth)/6-30,Rs+4),t.showText(f.t("modifierSelectUiHandler:manageItemsDesc"))):e===2?(this.cursorObj.setPosition((s.game.canvas.width-this.checkButtonWidth)/6-10,Rs+4),t.showText(f.t("modifierSelectUiHandler:checkTeamDesc"))):(this.cursorObj.setPosition(6,Rs+4),t.showText(f.t("modifierSelectUiHandler:lockRaritiesDesc")));return i}setRowCursor(e){const t=this.rowCursor;if(e!==t){this.rowCursor=e;let i=Math.round(this.cursor/Math.max(this.getRowItems(t)-1,1)*(this.getRowItems(e)-1));return e===1&&this.options.length===0&&(i=0),e===0&&(this.options.length===0&&(i=1),i===0&&!this.rerollButtonContainer.visible&&(i=1),i===1&&!this.transferButtonContainer.visible&&(i=2)),e===0&&t>1&&i===0&&this.lockRarityButtonContainer.visible&&(i=3),e===this.shopOptionsRows.length+1&&t===0&&this.cursor===3&&(i=0),this.cursor=-1,this.setCursor(i),!0}return!1}getRowItems(e){switch(e){case 0:return 3;case 1:return this.options.length;default:return this.shopOptionsRows.at(-(e-1)).length}}setRerollCost(e){this.rerollCost=e}updateCostText(){const e=this.shopOptionsRows.flat();for(const t of e)t.updateCostText();this.updateRerollCostText()}updateRerollCostText(){if(this.rerollCost<0){this.rerollCostText.setVisible(!1);return}this.rerollCostText.setVisible(!0);const t=s.money>=this.rerollCost,i=or(s.moneyFormat,this.rerollCost);this.rerollCostText.setText(f.t("modifierSelectUiHandler:rerollCost",{formattedMoney:i})),this.rerollCostText.setColor(le(t?O.MONEY:O.PARTY_RED)),this.rerollCostText.setShadowColor(le(t?O.MONEY:O.PARTY_RED,!0))}updateLockRaritiesText(){const e=s.lockModifierTiers?O.SUMMARY_BLUE:O.PARTY;this.lockRarityButtonText.setColor(le(e)),this.lockRarityButtonText.setShadowColor(le(e,!0))}clear(){super.clear(),this.moveInfoOverlay.clear(),this.moveInfoOverlayActive=!1,this.awaitingActionInput=!1,this.onActionInput=null,this.getUi().clearText(),this.eraseCursor(),this.cursor=0,this.rowCursor=0,s.hideShopOverlay(750*s.gameSpeed),s.hideLuckText(250),s.getModifierBar().updateModifiers(s.modifiers);const e=this.options.concat(this.shopOptionsRows.flat());this.options.splice(0,this.options.length),this.shopOptionsRows.splice(0,this.shopOptionsRows.length),s.tweens.add({targets:e,scale:.01,duration:250,ease:"Cubic.easeIn",onComplete:h(()=>{e.forEach(t=>{t.destroy()})},"onComplete")}),[this.rerollButtonContainer,this.checkButtonContainer,this.transferButtonContainer,this.lockRarityButtonContainer,this.continueButtonContainer].forEach(t=>{t.visible&&s.tweens.add({targets:t,alpha:0,duration:250,ease:"Cubic.easeIn",onComplete:h(()=>{this.options.length===0?t.setVisible(!1):t.setAlpha(1)},"onComplete")})})}eraseCursor(){this.cursorObj&&this.cursorObj.destroy(),this.cursorObj=null}};h(Ku,"ModifierSelectUiHandler");let dl=Ku;const zu=class zu extends Jt.GameObjects.Container{modifierTypeOption;pb;pbTint;itemContainer;item;itemTint;itemText;itemCostText;constructor(e,t,i){super(s,e,t),this.modifierTypeOption=i,this.setup()}setup(){if(!this.modifierTypeOption.cost){const t=h(()=>{const i=s.add.sprite(0,-182,"pb",this.getPbAtlasKey(-this.modifierTypeOption.upgradeCount));return i.setScale(2),i},"getPb");this.pb=t(),this.add(this.pb),this.pbTint=t(),this.pbTint.setVisible(!1),this.add(this.pbTint)}this.itemContainer=s.add.container(0,0),this.itemContainer.setScale(.5),this.itemContainer.setAlpha(0),this.add(this.itemContainer);const e=h(()=>s.add.sprite(0,0,"items",this.modifierTypeOption.type?.iconImage),"getItem");this.item=e(),this.itemContainer.add(this.item),this.modifierTypeOption.cost||(this.itemTint=e(),this.itemTint.setTintFill(Jt.Display.Color.GetColor(255,192,255)),this.itemContainer.add(this.itemTint)),this.itemText=P(0,35,this.modifierTypeOption.type?.name,O.PARTY,{align:"center"}),this.itemText.setOrigin(.5,0),this.itemText.setAlpha(0),this.itemText.setTint(this.modifierTypeOption.type?.tier?ty(this.modifierTypeOption.type?.tier):void 0),this.add(this.itemText),this.modifierTypeOption.cost&&(this.itemCostText=P(0,45,"",O.MONEY,{align:"center"}),this.itemCostText.setOrigin(.5,0),this.itemCostText.setAlpha(0),this.add(this.itemCostText),this.updateCostText())}async show(e,t,i,n=!0){const a=[];if(n){const{promise:o,resolve:l}=Promise.withResolvers();s.tweens.add({targets:this.pb,y:0,duration:1250,ease:"Bounce.Out",onComplete:h(()=>{l()},"onComplete")}),a.push(o);let c=1,u=0,p=!1;s.tweens.addCounter({from:1,to:0,duration:1250,ease:"Bounce.Out",onUpdate:h(m=>{if(!s)return;const d=m.getValue();!p&&d>c?(s.playSound("se/pb_bounce_1",{volume:1/++u}),p=!0):p&&d<c&&(p=!1),c=d},"onUpdate")});for(let m=0;m<this.modifierTypeOption.upgradeCount;m++){const{resolve:d,promise:y}=Promise.withResolvers();s.tweens.chain({tweens:[{delay:e-2e3*(this.modifierTypeOption.upgradeCount-(m+1+t)),onStart:h(()=>{s.playSound("se/upgrade",{rate:1+.25*m}),this.pbTint.setPosition(this.pb.x,this.pb.y).setTintFill(16777215).setVisible(!0).setAlpha(0)},"onStart"),targets:this.pbTint,alpha:1,duration:1e3,ease:"Sine.easeIn",onComplete:h(()=>{this.pb.setTexture("pb",this.getPbAtlasKey(-this.modifierTypeOption.upgradeCount+(m+1)))},"onComplete")},{targets:this.pbTint,alpha:0,duration:750,ease:"Sine.easeOut",onComplete:h(()=>{this.pbTint.setVisible(!1),d()},"onComplete")}]}),a.push(y)}}const r=[];s.time.delayedCall(e+2e3,()=>{if(n){this.pb.setTexture("pb",`${this.getPbAtlasKey(0)}_open`),s.playSound("se/pb_rel");const{resolve:m,promise:d}=Promise.withResolvers();s.tweens.add({targets:this.pb,duration:500,ease:"Sine.easeIn",alpha:0,onComplete:h(()=>{Promise.allSettled(a).then(()=>this.pb.destroy()),m()},"onComplete")}),r.push(d)}const o=n?250:0,{resolve:l,promise:c}=Promise.withResolvers();if(s.tweens.add({targets:this.itemContainer,delay:o,duration:500,ease:"Elastic.Out",scale:2,alpha:1,onComplete:h(()=>{l()},"onComplete")}),r.push(c),n){const{resolve:m,promise:d}=Promise.withResolvers();s.tweens.add({targets:this.itemTint,alpha:0,delay:o,duration:500,ease:"Sine.easeIn",onComplete:h(()=>{this.itemTint.destroy(),m()},"onComplete")}),r.push(d)}const{resolve:u,promise:p}=Promise.withResolvers();if(s.tweens.add({targets:this.itemText,delay:o,duration:500,alpha:1,y:25,ease:"Cubic.easeInOut",onComplete:h(()=>u(),"onComplete")}),r.push(p),this.itemCostText){const{resolve:m,promise:d}=Promise.withResolvers();s.tweens.add({targets:this.itemCostText,delay:o,duration:500,alpha:1,y:35,ease:"Cubic.easeInOut",onComplete:h(()=>m(),"onComplete")}),r.push(d)}}),i.push(Promise.allSettled([...a,...r]).then()),await Promise.allSettled(a)}getPbAtlasKey(e=0){return wi(this.modifierTypeOption.type?.tier+e)}updateCostText(){const e=ie.WAIVE_ROLL_FEE_OVERRIDE?0:this.modifierTypeOption.cost,t=e<=s.money?O.MONEY:O.PARTY_RED,i=or(s.moneyFormat,e);this.itemCostText.setText(f.t("modifierSelectUiHandler:itemCost",{formattedMoney:i})),this.itemCostText.setColor(le(t,!1)),this.itemCostText.setShadowColor(le(t,!0))}};h(zu,"ModifierOption");let Pa=zu;const ju=class ju extends rt{phaseName="SelectModifierPhase";rerollCount;modifierTiers;customModifierSettings;isCopy;typeOptions;constructor(e=0,t,i,n=!1){super(),this.rerollCount=e,this.modifierTiers=t,this.customModifierSettings=i,this.isCopy=n}start(){if(super.start(),!this.isPlayer())return!1;!this.rerollCount&&!this.isCopy?this.updateSeed():this.rerollCount&&(s.reroll=!1);const e=s.getPlayerParty();this.isCopy||ir(e,this.getPoolType(),this.rerollCount);const t=this.getModifierCount();this.typeOptions=this.getModifierTypeOptions(t);const i=h((n,a)=>{if(n<0||a<0)return s.ui.showText(f.t("battle:skipItemQuestion"),null,()=>{s.ui.setOverlayMode(x.CONFIRM,()=>{s.ui.revertMode(),s.ui.setMode(x.MESSAGE),super.end()},()=>this.resetModifierSelect(i))}),!1;switch(n){case 0:switch(a){case 0:return this.rerollModifiers();case 1:return this.openModifierTransferScreen(i);case 2:return s.ui.setModeWithoutClear(x.PARTY,ts.CHECK,-1,()=>{this.resetModifierSelect(i)}),!0;case 3:return this.toggleRerollLock();default:return!1}case 1:return this.selectRewardModifierOption(a,i);default:return this.selectShopModifierOption(n,a,i)}},"modifierSelectCallback");this.resetModifierSelect(i)}selectRewardModifierOption(e,t){if(this.typeOptions.length===0)return s.ui.clearText(),s.ui.setMode(x.MESSAGE),super.end(),!0;const i=this.typeOptions[e].type;return this.applyChosenModifier(i,-1,t)}selectShopModifierOption(e,t,i){const n=og(s.currentBattle.waveIndex,s.getWaveMoneyAmount(1)),a=n[e>2||n.length<=Zs?t:t+Zs],r=a.type,o=new ct(a.cost);s.applyModifier(Hr,!0,o);const l=o.value;return s.money<l&&!ie.WAIVE_ROLL_FEE_OVERRIDE?(s.ui.playError(),!1):this.applyChosenModifier(r,l,i)}applyChosenModifier(e,t,i){return e instanceof sy?e instanceof iy?this.openFusionMenu(e,t,i):this.openModifierMenu(e,t,i):this.applyModifier(e.newModifier(),t),t===-1}rerollModifiers(){const e=this.getRerollCost(s.lockModifierTiers);return e<0||s.money<e?(s.ui.playError(),!1):(s.reroll=!0,s.phaseManager.unshiftNew("SelectModifierPhase",this.rerollCount+1,this.typeOptions.map(t=>t.type?.tier).filter(t=>t!==void 0)),s.ui.clearText(),s.ui.setMode(x.MESSAGE).then(()=>super.end()),ie.WAIVE_ROLL_FEE_OVERRIDE||(s.money-=e,s.updateMoneyText(),s.animateMoneyChanged(!1)),s.playSound("se/buy"),!0)}openModifierTransferScreen(e){const t=s.getPlayerParty();return s.ui.setModeWithoutClear(x.PARTY,ts.MODIFIER_TRANSFER,-1,(i,n,a,r)=>{if(r!==void 0&&i<6&&r<6&&i!==r&&n>-1){const l=s.findModifiers(c=>c instanceof es&&c.isTransferable&&c.pokemonId===t[i].id)[n];s.tryTransferHeldItemModifier(l,t[r],!0,a,void 0,void 0,!1)}else this.resetModifierSelect(e)},Ln.FilterItemMaxStacks),!0}toggleRerollLock(){if(this.getRerollCost(s.lockModifierTiers)<0)return s.ui.playError(),!1;s.lockModifierTiers=!s.lockModifierTiers;const t=s.ui.getHandler();return t.setRerollCost(this.getRerollCost(s.lockModifierTiers)),t.updateLockRaritiesText(),t.updateRerollCostText(),!1}applyModifier(e,t=-1,i=!1){const n=s.addModifier(e,!1,i,void 0,void 0,t);(e.type instanceof gr||e.type instanceof Wr)&&s.phaseManager.unshiftPhase(this.copy()),t!==-1&&!(e.type instanceof gr)?n?(ie.WAIVE_ROLL_FEE_OVERRIDE||(s.money-=t,s.updateMoneyText(),s.animateMoneyChanged(!1)),s.playSound("se/buy"),s.ui.getHandler().updateCostText()):s.ui.playError():(s.ui.clearText(),s.ui.setMode(x.MESSAGE),super.end())}openFusionMenu(e,t,i){const n=s.getPlayerParty();s.ui.setModeWithoutClear(x.PARTY,ts.SPLICE,-1,(a,r)=>{r!==void 0&&a<6&&r<6&&a!==r?s.ui.setMode(x.MODIFIER_SELECT,this.isPlayer()).then(()=>{const o=e.newModifier(n[a],n[r]);this.applyModifier(o,t,!0)}):this.resetModifierSelect(i)},e.selectFilter)}openModifierMenu(e,t,i){const n=s.getPlayerParty(),a=e,r=e instanceof Xp,o=e instanceof Wr,l=e instanceof gr,c=e instanceof oy||e instanceof ly,u=r?ts.MOVE_MODIFIER:o?ts.TM_MODIFIER:l?ts.REMEMBER_MOVE_MODIFIER:ts.MODIFIER,p=o?e.moveId:void 0;s.ui.setModeWithoutClear(x.PARTY,u,-1,(m,d)=>{m<6?s.ui.setMode(x.MODIFIER_SELECT,this.isPlayer()).then(()=>{const y=r?e.newModifier(n[m],d-lg.MOVE_1):l?e.newModifier(n[m],d):e.newModifier(n[m]);this.applyModifier(y,t,!0)}):this.resetModifierSelect(i)},a.selectFilter,e instanceof Xp?e.moveSelectFilter:void 0,p,c)}getModifierCount(){const e=new ct(3);if(s.applyModifiers(ny,!0,e),s.applyModifiers(ay,!0,e),this.customModifierSettings){const t=(this.customModifierSettings.guaranteedModifierTiers?.length??0)+(this.customModifierSettings.guaranteedModifierTypeOptions?.length??0)+(this.customModifierSettings.guaranteedModifierTypeFuncs?.length??0);if(this.customModifierSettings.fillRemaining){const i=e.value;e.value=i>t?i:t}else e.value=t}return e.value}resetModifierSelect(e){s.ui.setMode(x.MODIFIER_SELECT,this.isPlayer(),this.typeOptions,e,this.getRerollCost(s.lockModifierTiers))}updateSeed(){s.resetSeed()}isPlayer(){return!0}getRerollCost(e){let t=0;if(ie.WAIVE_ROLL_FEE_OVERRIDE)return t;if(e){const r=[50,125,300,750,2e3];for(const o of this.typeOptions)t+=r[o.type.tier??0]}else t=250;let i=1;if(this.customModifierSettings?.rerollMultiplier!=null){if(this.customModifierSettings.rerollMultiplier<0)return-1;i=this.customModifierSettings.rerollMultiplier}const n=Math.min(Math.ceil(s.currentBattle.waveIndex/10)*t*2**this.rerollCount*i,Number.MAX_SAFE_INTEGER),a=new ct(n);return s.applyModifier(Hr,!0,a),a.value}getPoolType(){return ei.PLAYER}getModifierTypeOptions(e){return ry(e,s.getPlayerParty(),s.lockModifierTiers?this.modifierTiers:void 0,this.customModifierSettings)}copy(){return s.phaseManager.create("SelectModifierPhase",this.rerollCount,this.modifierTiers,{guaranteedModifierTypeOptions:this.typeOptions,rerollMultiplier:this.customModifierSettings?.rerollMultiplier,allowLuckUpgrades:!1},!0)}addModifier(e){return s.addModifier(e,!1,!0)}};h(ju,"SelectModifierPhase");let pl=ju;var zh=(T=>(T[T.RUN_HISTORY=0]="RUN_HISTORY",T[T.SESSION_PREVIEW=1]="SESSION_PREVIEW",T))(zh||{});const $u=class $u extends fs{runDisplayMode;runInfo;isVictory;pageMode;runContainer;runResultContainer;runInfoContainer;partyContainer;statsBgWidth;hallofFameContainer;endCardContainer;partyVisibility;modifiersModule;constructor(){super(x.RUN_INFO)}async setup(){this.runContainer=s.add.container(1,-s.scaledCanvas.height+1),this.modifiersModule=ma,this.runContainer.setVisible(!1),s.loadImage("encounter_exclaim","mystery-encounters")}show(e){super.show(e);const t=s.add.rectangle(0,0,s.game.canvas.width,s.game.canvas.height,26720);t.setOrigin(0,0),this.runContainer.add(t);const i=e[0];this.runDisplayMode=e[1],this.runDisplayMode===0?(this.runInfo=s.gameData.parseSessionData(JSON.stringify(i.entry)),this.isVictory=i.isVictory??!1):this.runDisplayMode===1&&(this.runInfo=e[0]),this.pageMode=0,this.addHeader(),this.statsBgWidth=(s.scaledCanvas.width-2)/3,this.runResultContainer=s.add.container(0,24);const n=Ce(0,0,this.statsBgWidth-11,65);n.setOrigin(0,0),n.setName("Run_Result_Window"),this.runResultContainer.add(n),this.runDisplayMode===0?this.parseRunResult():this.runDisplayMode===1&&this.parseRunStatus(),this.runInfoContainer=s.add.container(0,89);const a=Ce(0,0,this.statsBgWidth-11,90),r=a.getBottomRight();return this.runInfoContainer.add(a),this.parseRunInfo(r.x,r.y),this.partyContainer=s.add.container(this.statsBgWidth-10,23),this.parsePartyInfo(),this.showParty(!0),this.runContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,s.scaledCanvas.width,s.scaledCanvas.height),Phaser.Geom.Rectangle.Contains),this.getUi().bringToTop(this.runContainer),this.runContainer.setVisible(!0),this.isVictory&&(this.createHallofFame(),this.getUi().bringToTop(this.hallofFameContainer)),this.setCursor(0),this.getUi().add(this.runContainer),this.getUi().hideTooltip(),!0}addHeader(){const e=Ce(0,0,s.scaledCanvas.width-2,24);if(e.setOrigin(0,0),this.runContainer.add(e),this.runInfo.modifiers.length>0){const a=e.getTopRight(),r=s.add.container(0,0),o=P(8,0,f.t("runHistory:viewHeldItems"),O.WINDOW,{fontSize:"34px"}),l=this.getUi().getGamepadType();let c;l==="touch"?c=new Phaser.GameObjects.Sprite(s,0,2,"keyboard","E.png"):c=new Phaser.GameObjects.Sprite(s,0,2,l,s.inputController?.getIconForLatestInputRecorded(re.Button_Cycle_Ability)),r.add([o,c]),r.setPosition(a.x-o.displayWidth-c.displayWidth-8,10),this.runContainer.add(r)}const t=P(0,0,f.t("runHistory:runInfo"),O.HEADER_LABEL);t.setOrigin(0,0),t.setPositionRelative(e,8,4),this.runContainer.add(t);const i=P(0,0,this.runInfo.name,O.WINDOW);i.setOrigin(0,0);const n=t.width/6+t.x+4;i.setPositionRelative(e,n,4),this.runContainer.add(i)}async parseRunResult(){const e=s.gameData.gender??De.UNSET,t=De[e],i=this.isVictory?O.PERFECT_IV:O.SUMMARY_RED,n=this.isVictory?f.t("runHistory:victory"):f.t("runHistory:defeated",{context:t}),a=P(6,5,`${n} - ${f.t("saveSlotSelectUiHandler:wave")} ${this.runInfo.waveIndex}`,i,{fontSize:"65px",lineSpacing:.1});if(this.isVictory){const r=s.add.container(0,0),o=P(8,0,f.t("runHistory:viewHallOfFame"),O.WINDOW,{fontSize:"65px"}),l=P(8,12,f.t("runHistory:viewEndingSplash"),O.WINDOW,{fontSize:"65px"}),c=this.getUi().getGamepadType();let u,p;c==="touch"?(u=new Phaser.GameObjects.Sprite(s,0,4,"keyboard","R.png"),p=new Phaser.GameObjects.Sprite(s,0,16,"keyboard","F.png")):(u=new Phaser.GameObjects.Sprite(s,0,4,c,s.inputController?.getIconForLatestInputRecorded(re.Button_Cycle_Shiny)),p=new Phaser.GameObjects.Sprite(s,0,16,c,s.inputController?.getIconForLatestInputRecorded(re.Button_Cycle_Form))),r.add([o,u]),r.add([l,p]),r.setPosition(12,25),this.runResultContainer.add(r)}if(this.runResultContainer.add(a),!this.isVictory){const r=s.add.container(0,0);if(this.runInfo.battleType===de.WILD||this.runInfo.battleType===de.MYSTERY_ENCOUNTER&&!this.runInfo.trainer)switch(this.runInfo.enemyParty.length){case 1:this.parseWildSingleDefeat(r);break;case 2:this.parseWildDoubleDefeat(r);break}else(this.runInfo.battleType===de.TRAINER||this.runInfo.battleType===de.MYSTERY_ENCOUNTER&&this.runInfo.trainer)&&this.parseTrainerDefeat(r);this.runResultContainer.add(r)}this.runContainer.add(this.runResultContainer)}parseRunStatus(){const e=s.add.container(0,0);if(this.runResultContainer.add(e),this.runInfo.battleType===de.WILD)this.runInfo.enemyParty.length===1?this.parseWildSingleDefeat(e):this.runInfo.enemyParty.length===2&&this.parseWildDoubleDefeat(e);else if(this.runInfo.battleType===de.TRAINER){this.showTrainerSprites(e);const o=3;this.runInfo.enemyParty.forEach((y,g)=>{const C=s.add.sprite(0,0,"pb");C.setFrame(wi(y.pokeball)),C.setScale(.5),C.setPosition(58+g%o*8,g<=2?18:25),e.add(C)});const l=this.runInfo.trainer.toTrainer(),c=375;let u="";this.runInfo.trainer.trainerType>=c?u=l.variant===Xe.FEMALE?f.t("trainerNames:rivalFemale"):f.t("trainerNames:rival"):u=l.getName(0,!0);const p=f.t(l.variant!==Xe.DOUBLE?"battle:trainerAppeared":"battle:trainerAppearedDouble",{trainerName:u}).replace(/\n/g," "),m=s.add.container(0,0),d=P(0,0,p,O.WINDOW,{fontSize:"35px",wordWrap:{width:200}});m.add(d),m.setPosition(55,32),this.runResultContainer.add(m)}else if(this.runInfo.battleType===de.MYSTERY_ENCOUNTER){const o=s.add.sprite(0,0,"encounter_exclaim");o.setPosition(34,26),o.setScale(.65);const l=s.add.sprite(56,-106,"pkmn__sub");l.setScale(.65),l.setPosition(34,46);const c=f.t(s.getMysteryEncounter(this.runInfo.mysteryEncounterType,!0).localizationKey+":title"),u=s.add.container(0,0),p=P(0,0,c,O.WINDOW,{fontSize:"45px",wordWrap:{width:160}});u.add(p),u.setPosition(47,37),this.runResultContainer.add([o,l,u])}const t=this.runResultContainer.getByName("Run_Result_Window"),i=t.getTopCenter().x,n=t.getBottomCenter().y,a=P(i,5,`${f.t("saveSlotSelectUiHandler:wave")} ${this.runInfo.waveIndex}`,O.WINDOW,{fontSize:"60px",lineSpacing:.1});a.setOrigin(.5,0);const r=P(i,n-5,`${ga(this.runInfo.arena.biome)}`,O.WINDOW,{fontSize:"60px"});r.setOrigin(.5,1),this.runResultContainer.add([a,r]),this.runContainer.add(this.runResultContainer)}parseWildSingleDefeat(e){const t=s.add.container(0,0),i=this.runInfo.enemyParty[0],n=i.boss;i.boss=!1,i.player=!0;const a=i.toPokemon(),r=s.addPokemonIcon(a,0,0,0,0),o=n?O.PARTY_RED:O.PARTY,l=P(36,26,`${f.t("saveSlotSelectUiHandler:lv")}${xi(a.level,1e3)}`,o,{fontSize:"44px",color:"#f8f8f8"});l.setShadow(0,0,void 0),l.setStroke("#424242",14),l.setOrigin(1,0),t.add(r),t.add(l),e.add(t),e.setPosition(27,12),a.destroy()}parseWildDoubleDefeat(e){this.runInfo.enemyParty.forEach((t,i)=>{const n=s.add.container(0,0),a=t.boss;t.boss=!1,t.player=!0;const r=t.toPokemon(),o=s.addPokemonIcon(r,0,0,0,0),l=P(36,26,`${f.t("saveSlotSelectUiHandler:lv")}${xi(r.level,1e3)}`,a?O.PARTY_RED:O.PARTY,{fontSize:"44px",color:"#f8f8f8"});l.setShadow(0,0,void 0),l.setStroke("#424242",14),l.setOrigin(1,0),n.add(o),n.add(l),n.setPosition(i*35,0),e.add(n),r.destroy()}),e.setPosition(8,14)}showTrainerSprites(e){const t=this.runInfo.trainer.toTrainer();t.config.loadAssets(this.runInfo.trainer.variant).then(()=>{const i=t.config.getSpriteKey(this.runInfo.trainer.variant===Xe.FEMALE,!1),n=s.add.sprite(0,5,i);if(this.runInfo.trainer.variant===Xe.DOUBLE&&!t.config.doubleOnly){const a=s.add.container(5,8);n.setPosition(-3,-3);const r=t.config.getSpriteKey(!0,!0),o=s.add.sprite(5,-3,r);this.runDisplayMode===0?(o.setScale(.2),n.setScale(.2),a.add(n),a.add(o),a.setPosition(12,38)):(n.setScale(.55),n.setPosition(-9,-3),o.setScale(.55),a.add([n,o]),a.setPosition(28,34)),e.add(a)}else{const a=this.runDisplayMode===0?.35:.55,r=this.runDisplayMode===0?[12,28]:[30,32];n.setScale(a,a),n.setPosition(r[0],r[1]),e.add(n)}})}parseTrainerDefeat(e){this.showTrainerSprites(e);const t=s.add.container(0,0);this.runInfo.enemyParty.forEach((i,n)=>{const a=Math.floor(n/3),r=s.add.container(0,0);r.setScale(.6);const o=i.boss;i.boss=!1,i.player=!0;const l=i.toPokemon(),c=s.addPokemonIcon(l,0,0,0,0);c.setPosition(39*(n%3)+5,35*a);const u=P(43*(n%3),27*(a+1),`${f.t("saveSlotSelectUiHandler:lv")}${xi(l.level,1e3)}`,o?O.PARTY_RED:O.PARTY,{fontSize:"54px"});u.setShadow(0,0,void 0),u.setStroke("#424242",14),u.setOrigin(0,0),r.add(c),r.add(u),t.add(r),l.destroy()}),t.setPosition(25,15),e.add(t)}async parseRunInfo(e,t){const i=It(7,0,"",O.WINDOW,{fontSize:"50px",lineSpacing:3});switch(i.setPosition(7,5),i.appendText(f.t("runHistory:mode")+": ",!1),this.runInfo.gameMode){case fe.DAILY:i.appendText(`${f.t("gameMode:dailyRun")}`,!1);break;case fe.SPLICED_ENDLESS:i.appendText(`${f.t("gameMode:endlessSpliced")}`,!1);break;case fe.CHALLENGE:{i.appendText(`${f.t("gameMode:challenge")}`,!1),i.appendText(`${f.t("runHistory:challengeRules")}: `),i.setWrapMode(1),i.setWrapWidth(500);const d=this.challengeParser();if(d)for(let y=0;y<d.length;y++)y>0&&i.appendText(" + ",!1),i.appendText(d[y],!1);break}case fe.ENDLESS:i.appendText(`${f.t("gameMode:endless")}`,!1);break;case fe.CLASSIC:i.appendText(`${f.t("gameMode:classic")}`,!1);break}(this.runInfo.gameMode===fe.ENDLESS||this.runInfo.gameMode===fe.SPLICED_ENDLESS)&&this.runInfo.waveIndex===s.gameData.gameStats.highestEndlessWave&&(i.appendText(` [${f.t("runHistory:personalBest")}]`),i.setTint(16772956,4718441,7039999,16738665));const n=s.add.container(0,0),a=(f.resolvedLanguage==="ja",3),r=It(7,0,"",O.WINDOW,{fontSize:"50px",lineSpacing:a}),o=hg(this.runInfo.playTime);r.appendText(`${f.t("runHistory:runLength")}: ${o}`,!1);const l=or(s.moneyFormat,this.runInfo.money),c=le(O.MONEY_WINDOW,!1);r.appendText(`[color=${c}]${f.t("battleScene:moneyOwned",{formattedMoney:l})}[/color]`),r.setPosition(7,70),n.add(r);const u=It(0,0,"",O.WINDOW,{fontSize:"55px"}),p=Phaser.Math.Clamp(this.runInfo.party.map(d=>d.toPokemon().getLuck()).reduce((d,y)=>d+=y,0),0,14);let m=f.t("runHistory:luck")+": "+cg(p);if(p<14?m="[color=#"+ug(p).toString(16)+"]"+m+"[/color]":u.setTint(16772956,4718441,7039999,16738665),u.appendText("[align=right]"+m+"[/align]",!1),u.setPosition(e-u.displayWidth-5,t-13),n.add(u),this.runInfo.modifiers.length>0){let d=0;const y=s.add.container(8,this.runInfo.gameMode===fe.CHALLENGE?20:15);y.setScale(.45);for(const g of this.runInfo.modifiers){const C=g.toModifier(this.modifiersModule[g.className]);if(C instanceof es)continue;const E=C?.getIcon(!1);if(E){const I=Math.floor(d/7);E.setPosition(24*(d%7),20+35*I),y.add(E)}if(++d===20){const I=P(45,90,"+",O.WINDOW);I.setPositionRelative(y,70,45),this.runInfoContainer.add(I);break}}this.runInfoContainer.add(y)}this.runInfoContainer.add(i),this.runInfoContainer.add(n),this.runContainer.add(this.runInfoContainer)}challengeParser(){const e=[];for(const t of this.runInfo.challenges)if(t.value!==0)switch(t.id){case Pt.SINGLE_GENERATION:e.push(f.t(`runHistory:challengeMonoGen${t.value}`));break;case Pt.SINGLE_TYPE:{const i=Me[t.value-1],n=`[color=${hy[i]}]`,a=`[shadow=${cy[i]}]`,r=n+a+f.t(`pokemonInfo:type.${bt(i)}`)+"[/color][/shadow]";e.push(r);break}case Pt.INVERSE_BATTLE:e.push(f.t("challenges:inverseBattle.shortName"));break;default:{const i=bt(Pt[t.id]);e.push(f.t(`challenges:${i}.name`));break}}return e}parsePartyInfo(){const e=this.runInfo.party,t=f.resolvedLanguage??"en",i=(s.scaledCanvas.height-23)/6;e.forEach((n,a)=>{const r=new XT(s,0,14,this.statsBgWidth*2+10,i-2,3),o=n.toPokemon(),l=s.add.container(this.statsBgWidth+5,(i-.5)*a),c=o.getTypes(),u=pi(c[0]),p=new Phaser.Display.Color(u[0],u[1],u[2]),m=p.clone().darken(45);r.setFillStyle(m.color);const d=s.add.container(0,0),y=s.addPokemonIcon(o,0,0,0,0);y.setScale(.75),y.setPosition(-99,1);const g=c[1]?pi(c[1]):void 0,C=g?new Phaser.Display.Color(g[0],g[1],g[2]):void 0;C?r.setStrokeStyle(1,C.color,.95):r.setStrokeStyle(1,p.color,.95),this.getUi().bringToTop(y);const E=s.add.container(-85,3.5),I="34px",A=o.getNature(),_=ki(A),w=o.getNameToRender(),L=["ko","zh_CN","zh_TW"];let V=f.t("starterSelectUiHandler:passive")??"-",H=f.t("starterSelectUiHandler:ability")??"-";L.includes(t)||(V=V.charAt(0),H=H.charAt(0));const W=o.passive?V+": "+o.getPassiveAbility().name:"",ee=H+": "+o.getAbility(!0).name,me=(f.resolvedLanguage==="ja",3),N=It(0,0,w,O.SUMMARY,{fontSize:I,lineSpacing:me});N.appendText(`${f.t("saveSlotSelectUiHandler:lv")}${qp(o.level,1)} - ${_}`),N.appendText(ee),N.appendText(W),E.add(N);const j=s.add.container(-35,6),v=[];o.stats.forEach(Ae=>v.push(qp(Ae,1)));for(let Ae=0;Ae<v.length;Ae++){const S=uy(A,Ae);v[Ae]=S<1?v[Ae]+"[color=#40c8f8][/color]":v[Ae],v[Ae]=S>1?v[Ae]+"[color=#f89890][/color]":v[Ae]}const z=f.t("pokemonInfo:stat.hpShortened")+": "+v[0],ne=f.t("pokemonInfo:stat.atkShortened")+": "+v[1],X=f.t("pokemonInfo:stat.defShortened")+": "+v[2],J=f.t("pokemonInfo:stat.spatkShortened")+": "+v[3],R=f.t("pokemonInfo:stat.spdefShortened")+": "+v[4],Y=(t==="es-ES"||t==="pt_BR"?f.t("runHistory:spdShortened"):f.t("pokemonInfo:stat.spdShortened"))+": "+v[5],U=It(-5,0,z,O.SUMMARY,{fontSize:I,lineSpacing:me});U.appendText(ne),U.appendText(X),j.add(U);const Ee=It(25,0,J,O.SUMMARY,{fontSize:I,lineSpacing:me});Ee.appendText(R),Ee.appendText(Y),j.add(Ee);const ue=s.add.container(0,0);if(o.fusionSpecies){const Ae=s.add.image(0,0,"icon_spliced");Ae.setScale(.35),Ae.setOrigin(0,0),o.isShiny()?Ae.setPositionRelative(E,35,0):Ae.setPositionRelative(E,28,0),ue.add(Ae),this.getUi().bringToTop(Ae)}if(o.isShiny()){const Ae=o.isFusion()&&o.shiny&&o.fusionShiny,S=s.add.image(0,0,`shiny_star_small${Ae?"_1":""}`);if(S.setOrigin(0,0),S.setScale(.65),S.setPositionRelative(E,28,0),S.setTint(Et(Ae?o.variant:o.getVariant())),ue.add(S),this.getUi().bringToTop(S),Ae){const Z=s.add.image(0,0,"shiny_star_small_2");Z.setOrigin(0,0),Z.setScale(.5),Z.setPosition(S.x+1,S.y+1),Z.setTint(Et(o.fusionVariant)),ue.add(Z),this.getUi().bringToTop(Z)}}const he=o.getMoveset(!0),be=s.add.container(70,-29),_e=[],we=[],Ne=[[-6.5,35.5],[37,35.5],[-6.5,43.5],[37,43.5]];for(let Ae=0;Ae<he?.length;Ae++){const S=s.add.container(Ne[Ae][0],Ne[Ae][1]);S.setScale(.5);const Z=s.add.nineslice(0,0,"type_bgs","unknown",85,15,2,2,2,2);Z.setOrigin(1,0);const $=P(-Z.width/2,1,"-",O.MOVE_LABEL);$.setOrigin(.5,0),$.setName("text-move-label"),_e.push(Z),we.push($),S.add(Z),S.add($),be.add(S);const k=he[Ae]?.getMove();_e[Ae].setFrame(Me[k?k.type:Me.UNKNOWN].toString().toLowerCase()),we[Ae].setText(k?k.name:"-")}const ot=this.runInfo.gameMode===fe.SPLICED_ENDLESS||this.runInfo.gameMode===fe.ENDLESS?.25:.5,je=s.add.container(-82,2),Ct=[];if(this.runInfo.modifiers.length>0){for(const Ae of this.runInfo.modifiers){const S=Ae.toModifier(this.modifiersModule[Ae.className]);S instanceof es&&S.pokemonId===o.id&&(S.stackCount=Ae.stackCount,Ct.push(S))}if(Ct.length>0){Ct.sort(dy);let Ae=0;for(const[S,Z]of Ct.entries()){if(S>36){const k=P(182,4,"+",O.WINDOW);je.add(k);break}const $=Z?.getIcon(!0);Z?.stackCount<Z?.getMaxHeldItemCount(o)&&$.list[1]instanceof Phaser.GameObjects.BitmapText&&$.list[1].clearTint(),$.setScale(ot),$.setPosition(S%19*10,Ae*10),je.add($),S!==0&&S%18===0&&Ae++}}}je.setName("heldItems"),je.setVisible(!1),l.add(r),d.add(y),l.add(d),ue.setName("PkmnMarks"),l.add(ue),be.setName("PkmnMoves"),l.add(be),E.setName("PkmnInfoText"),l.add(E),j.setName("PkmnStatsText"),l.add(j),l.add(je),l.setName("PkmnInfo"),this.partyContainer.add(l),o.destroy()}),this.runContainer.add(this.partyContainer)}showParty(e){this.partyContainer.getAll("name","PkmnInfo").forEach(i=>{i.getByName("PkmnMoves").setVisible(e),i.getByName("PkmnInfoText").setVisible(e),i.getByName("PkmnStatsText").setVisible(e),i.getByName("PkmnMarks").setVisible(e),i.getByName("heldItems").setVisible(!e),this.partyVisibility=e})}createVictorySplash(){this.endCardContainer=s.add.container(0,0);const t=(s.gameData.gender??De.UNSET)===De.FEMALE,i=s.add.image(0,0,`end_${t?"f":"m"}`);i.setOrigin(0),i.setScale(.5);const n=P(s.scaledCanvas.width/2,s.scaledCanvas.height-16,f.t("battle:congratulations"),O.SUMMARY,{fontSize:"128px"});n.setOrigin(.5),this.endCardContainer.add(i),this.endCardContainer.add(n)}createHallofFame(){const e=s.gameData.gender??De.UNSET,t=e===De.FEMALE,i=De[e].toLowerCase();this.hallofFameContainer=s.add.container(0,0);const n=s.add.image(0,0,`end_${t?"f":"m"}`);n.setOrigin(0),n.setPosition(-1,-1),n.setScale(.5);const a=n.getBottomCenter(),r=t?"red":"blue",o=s.add.image(0,0,"hall_of_fame_"+r);o.setPosition(159,89),o.setSize(s.game.canvas.width,s.game.canvas.height+10),o.setAlpha(.8),this.hallofFameContainer.add(n),this.hallofFameContainer.add(o);const l=P(0,0,f.t("runHistory:hallofFameText",{context:i}),O.WINDOW);l.setPosition(a.x-l.displayWidth/2,164),this.hallofFameContainer.add(l),this.runInfo.party.forEach((c,u)=>{const p=c.toPokemon(),m=u%2,d=p.id,y=p.shiny,g=p.formIndex,C=p.variant,E=p.getSpeciesForm(),I=s.add.sprite(60+40*u,40+m*80,"pkmn__sub");I.setPipeline(s.spritePipeline,{tone:[0,0,0,0],ignoreTimeTint:!0}),this.hallofFameContainer.add(I);const A=new Map;A.set(d,!1);const _=p.gender===1;if(E.loadAssets(_,g,y,C,!0).then(()=>{A.set(d,!0),I.play(E.getSpriteKey(_,g,y,C)),I.setPipelineData("shiny",y),I.setPipelineData("variant",C),I.setPipelineData("spriteKey",E.getSpriteKey(_,g,y,C)),I.setVisible(!0)}),p.isFusion()){const w=s.add.sprite(80+40*u,50+m*80,p.getFusionIconAtlasKey());w.setName("sprite-fusion-icon"),w.setOrigin(.5,0),w.setFrame(p.getFusionIconId(!0)),this.hallofFameContainer.add(w)}p.destroy()}),this.hallofFameContainer.setVisible(!1),this.runContainer.add(this.hallofFameContainer)}processInput(e){const t=this.getUi();let i=!1;const n=!1;switch(e){case b.CANCEL:case b.LEFT:i=!0,this.pageMode===0?(this.runInfoContainer.removeAll(!0),this.runResultContainer.removeAll(!0),this.partyContainer.removeAll(!0),this.runContainer.removeAll(!0),this.isVictory&&this.hallofFameContainer.removeAll(!0),super.clear(),this.runContainer.setVisible(!1),t.revertMode()):this.pageMode===1?(this.hallofFameContainer.setVisible(!1),this.pageMode=0):this.pageMode===2&&(this.endCardContainer.setVisible(!1),this.runContainer.remove(this.endCardContainer),this.pageMode=0);break;case b.DOWN:case b.UP:break;case b.CYCLE_FORM:case b.CYCLE_SHINY:case b.CYCLE_ABILITY:this.buttonCycleOption(e);break}return i&&t.playSelect(),i||n}buttonCycleOption(e){switch(e){case b.CYCLE_FORM:this.isVictory&&this.pageMode!==1&&(!this.endCardContainer||!this.endCardContainer.visible?(this.createVictorySplash(),this.endCardContainer.setVisible(!0),this.runContainer.add(this.endCardContainer),this.pageMode=2):(this.endCardContainer.setVisible(!1),this.runContainer.remove(this.endCardContainer),this.pageMode=0));break;case b.CYCLE_SHINY:this.isVictory&&this.pageMode!==2&&(this.hallofFameContainer.visible?(this.hallofFameContainer.setVisible(!1),this.pageMode=0):(this.hallofFameContainer.setVisible(!0),this.pageMode=1));break;case b.CYCLE_ABILITY:this.runInfo.modifiers.length>0&&this.pageMode===0&&(this.partyVisibility?this.showParty(!1):this.showParty(!0));break}}};h($u,"RunInfoUiHandler");let Ra=$u;const Xi=5,$s=2;var Ba=(T=>(T[T.LOAD=0]="LOAD",T[T.SAVE=1]="SAVE",T))(Ba||{});const Xu=class Xu extends Vt{saveSlotSelectContainer;sessionSlotsContainer;saveSlotSelectMessageBox;saveSlotSelectMessageBoxContainer;sessionSlots;uiMode;saveSlotSelectCallback;manageDataConfig;scrollCursor=0;cursorObj;sessionSlotsContainerInitialY;constructor(){super(x.SAVE_SLOT)}setup(){const e=this.getUi();this.saveSlotSelectContainer=s.add.container(0,0),this.saveSlotSelectContainer.setVisible(!1),e.add(this.saveSlotSelectContainer);const t=s.add.rectangle(0,0,s.scaledCanvas.width,-s.scaledCanvas.height,26720);t.setOrigin(0,0),this.saveSlotSelectContainer.add(t),this.sessionSlotsContainerInitialY=-s.scaledCanvas.height+8,this.sessionSlotsContainer=s.add.container(8,this.sessionSlotsContainerInitialY),this.saveSlotSelectContainer.add(this.sessionSlotsContainer),this.saveSlotSelectMessageBoxContainer=s.add.container(0,0),this.saveSlotSelectMessageBoxContainer.setVisible(!1),this.saveSlotSelectContainer.add(this.saveSlotSelectMessageBoxContainer),this.saveSlotSelectMessageBox=Ce(1,-1,318,28),this.saveSlotSelectMessageBox.setOrigin(0,1),this.saveSlotSelectMessageBoxContainer.add(this.saveSlotSelectMessageBox),this.message=P(8,8,"",O.WINDOW,{maxLines:2}),this.message.setOrigin(0,0),this.saveSlotSelectMessageBoxContainer.add(this.message),this.sessionSlots=[]}show(e){return e.length<2||!(e[1]instanceof Function)?!1:(super.show(e),this.uiMode=e[0],this.saveSlotSelectCallback=e[1],this.saveSlotSelectContainer.setVisible(!0),this.populateSessionSlots(),this.setScrollCursor(0),this.setCursor(0),!0)}processInput(e){const t=this.getUi(),i=[];let n=!1,a=!1;if(e===b.ACTION||e===b.CANCEL){const r=this.saveSlotSelectCallback;if(e===b.ACTION){const o=this.cursor+this.scrollCursor,l=this.sessionSlots[o];if(this.uiMode===0&&!l.hasData)a=!0;else{switch(this.uiMode){case 0:l.malformed||(i.push({label:f.t("menu:loadGame"),handler:h(()=>(s.ui.revertMode(),r?.(o),!0),"handler"),keepOpen:!1}),i.push({label:f.t("saveSlotSelectUiHandler:renameRun"),handler:h(()=>(s.ui.revertMode(),t.setOverlayMode(x.RENAME_RUN,{buttonActions:[c=>{const u=decodeURIComponent(atob(c));s.gameData.renameSession(o,u).then(p=>{p[0]===!1?s.reset(!0):(this.clearSessionSlots(),this.cursorObj=null,this.populateSessionSlots(),this.setScrollCursor(0),this.setCursor(0),t.revertMode(),t.showText("",0))})},()=>{t.revertMode()}]},""),!0),"handler")})),this.manageDataConfig={xOffset:0,yOffset:48,options:i,maxOptions:4},i.push({label:f.t("saveSlotSelectUiHandler:deleteRun"),handler:h(()=>(s.ui.revertMode(),t.showText(f.t("saveSlotSelectUiHandler:deleteData"),null,()=>{t.setOverlayMode(x.CONFIRM,()=>{s.gameData.deleteSession(o).then(c=>{c[0]===!1?s.reset(!0):(this.clearSessionSlots(),this.cursorObj=null,this.populateSessionSlots(),this.setScrollCursor(0),this.setCursor(0),t.revertMode(),t.showText("",0))})},()=>{t.revertMode(),t.showText("",0)},!1,0,19,2e3)}),!0),"handler"),keepOpen:!1}),i.push({label:f.t("menuUiHandler:cancel"),handler:h(()=>(s.ui.revertMode(),!0),"handler"),keepOpen:!0}),t.setOverlayMode(x.MENU_OPTION_SELECT,this.manageDataConfig);break;case 1:{const c=h(()=>{const u=this.saveSlotSelectCallback;this.saveSlotSelectCallback=null,t.revertMode(),t.showText("",0),t.setMode(x.MESSAGE),u?.(o)},"saveAndCallback");if(this.sessionSlots[o].hasData)t.showText(f.t("saveSlotSelectUiHandler:overwriteData"),null,()=>{t.setOverlayMode(x.CONFIRM,()=>{s.gameData.deleteSession(o).then(u=>{u===!1?s.reset(!0):c()})},()=>{t.revertMode(),t.showText("",0)},!1,0,19,2e3)});else if(this.sessionSlots[o].hasData===!1)c();else return!1;break}}n=!0}}else this.saveSlotSelectCallback=null,t.showText("",0),r?.(-1),n=!0}else{const r=this.cursor+this.scrollCursor;switch(e){case b.UP:this.cursor?n=this.cursor===0?this.setCursor(this.cursor):this.setCursor(this.cursor-1,r):this.scrollCursor?n=this.setScrollCursor(this.scrollCursor-1,r):this.cursor===0&&this.scrollCursor===0&&(this.setScrollCursor(Xi-$s),this.revertSessionSlot(Xi-$s),this.setCursor($s-1),n=!0);break;case b.DOWN:this.cursor<$s-1?n=this.setCursor(this.cursor+1,r):this.scrollCursor<Xi-$s?n=this.setScrollCursor(this.scrollCursor+1,r):this.cursor===$s-1&&this.scrollCursor===Xi-$s&&(this.setScrollCursor(0),this.revertSessionSlot($s-1),this.setCursor(0),n=!0);break;case b.RIGHT:this.sessionSlots[r].hasData&&this.sessionSlots[r].saveData&&(s.ui.setOverlayMode(x.RUN_INFO,this.sessionSlots[r].saveData,zh.SESSION_PREVIEW),n=!0)}}return n?t.playSelect():a&&t.playError(),n||a}populateSessionSlots(){for(let e=0;e<Xi;e++){const t=new gl(e);s.add.existing(t),this.sessionSlotsContainer.add(t),this.sessionSlots.push(t),t.load().then(i=>{i&&this.cursor+this.scrollCursor===e&&this.setCursor(e)})}}showText(e,t,i,n,a,r){super.showText(e,t,i,n,a,r),e?.indexOf(`
`)===-1?(this.saveSlotSelectMessageBox.setSize(318,28),this.message.setY(-22)):(this.saveSlotSelectMessageBox.setSize(318,42),this.message.setY(-37)),this.saveSlotSelectMessageBoxContainer.setVisible(e?.length>0)}setCursor(e,t){const i=super.setCursor(e);if(!this.cursorObj){this.cursorObj=s.add.container(0,0);const r=s.add.nineslice(0,15,"select_cursor_highlight_thick",void 0,294,this.sessionSlots[t??0]?.saveData?.name?50:60,6,6,6,6),o=s.add.image(0,0,"cursor");o.setPosition(160,15),o.setName("rightArrow"),this.cursorObj.add([r,o]),this.sessionSlotsContainer.add(this.cursorObj)}const n=e+this.scrollCursor,a=n*76;if(this.sessionSlots[n]&&this.cursorObj){const r=this.sessionSlots[n],o=r.hasData&&!r.malformed;o?(this.cursorObj.setPosition(145,20+a),this.sessionSlots[n].setPosition(-6,a)):(this.cursorObj.setPosition(151,20+a),this.sessionSlots[n].setPosition(0,a)),this.setArrowVisibility(o)}return t!=null&&this.revertSessionSlot(t),i}revertSessionSlot(e){const t=this.sessionSlots[e];t&&t.setPosition(0,e*76)}setArrowVisibility(e){this.cursorObj&&(this.cursorObj?.getByName("rightArrow")).setVisible(e)}setScrollCursor(e,t){const i=e!==this.scrollCursor;return i&&(this.scrollCursor=e,this.setCursor(this.cursor,t),s.tweens.add({targets:this.sessionSlotsContainer,y:this.sessionSlotsContainerInitialY-76*e,duration:ge(325),ease:"Sine.easeInOut"})),i}clear(){super.clear(),this.saveSlotSelectContainer.setVisible(!1),this.setScrollCursor(0),this.eraseCursor(),this.saveSlotSelectCallback=null,this.clearSessionSlots()}eraseCursor(){this.cursorObj&&this.cursorObj.destroy(),this.cursorObj=null}clearSessionSlots(){this.sessionSlots.splice(0,this.sessionSlots.length),this.sessionSlotsContainer.removeAll(!0)}};h(Xu,"SaveSlotSelectUiHandler");let fl=Xu;const qu=class qu extends Phaser.GameObjects.Container{slotId;hasData;malformed;slotWindow;loadingLabel;saveData;constructor(e){super(s,0,e*76),this.slotId=e,this.setup()}setup(){this.slotWindow=Ce(0,0,304,70),this.add(this.slotWindow),this.loadingLabel=P(152,33,f.t("saveSlotSelectUiHandler:loading"),O.WINDOW),this.loadingLabel.setOrigin(.5,.5),this.add(this.loadingLabel)}decideFallback(e){let t=`${Lt.getModeName(e.gameMode)}`;switch(e.gameMode){case fe.CLASSIC:t+=` (${s.gameData.gameStats.classicSessionsPlayed+1})`;break;case fe.ENDLESS:case fe.SPLICED_ENDLESS:t+=` (${s.gameData.gameStats.endlessSessionsPlayed+1})`;break;case fe.DAILY:{const i=new Date(e.timestamp).toLocaleDateString();t+=` (${i})`;break}case fe.CHALLENGE:{const i=e.challenges.filter(n=>n.value!==0);if(i.length===0)break;t="";for(const n of i.slice(0,3))t!==""&&(t+=", "),t+=n.toChallenge().getName();i.length>3?t+=", ...":t===""&&(t=`${Lt.getModeName(e.gameMode)}`);break}}return t}async setupWithData(e){const t=e?.name;if(this.remove(this.loadingLabel,!0),t){const c=P(8,5,e.name,O.WINDOW);this.add(c)}else{const c=this.decideFallback(e);await s.gameData.renameSession(this.slotId,c);const u=P(8,5,c,O.WINDOW);this.add(u)}const i=P(8,19,`${Lt.getModeName(e.gameMode)||f.t("gameMode:unknown")} - ${f.t("saveSlotSelectUiHandler:wave")} ${e.waveIndex}`,O.WINDOW);this.add(i);const n=P(8,33,new Date(e.timestamp).toLocaleString(),O.WINDOW);this.add(n);const a=P(8,47,hg(e.playTime),O.WINDOW);this.add(a);const r=s.add.container(144,16);e.party.forEach((c,u)=>{const p=s.add.container(26*u,0);p.setScale(.75);const m=c.toPokemon(),d=s.addPokemonIcon(m,0,0,0,0),y=P(32,20,`${f.t("saveSlotSelectUiHandler:lv")}${xi(m.level,1e3)}`,O.PARTY,{fontSize:"54px",color:"#f8f8f8"});y.setShadow(0,0,void 0).setStroke("#424242",14).setOrigin(1,0),p.add([d,y]),r.add(p),m.destroy()}),this.add(r);const o=s.add.container(148,38);o.setScale(.5);let l=0;for(const c of e.modifiers){const u=c.toModifier(ma[c.className]);if(u instanceof es)continue;const p=u?.getIcon(!1);if(p&&(p.setPosition(24*l,0),o.add(p)),++l===12)break}this.add(o)}load(){return new Promise(e=>{s.gameData.getSession(this.slotId).then(async t=>{if(this.active){if(this.hasData=!!t,!t){this.loadingLabel.setText(f.t("saveSlotSelectUiHandler:empty")),e(!1);return}this.saveData=t,this.setupWithData(t),e(!0)}}).catch(t=>{this.active&&(console.warn(`Failed to load session slot #${this.slotId}:`,t),this.loadingLabel.setText(f.t("menu:failedToLoadSession")),this.hasData=!0,this.malformed=!0,e(!0))})})}};h(qu,"SessionSlot");let gl=qu;const Zu=class Zu extends Ge{phaseName="SelectStarterPhase";start(){super.start(),s.playBgm("menu"),s.ui.setMode(x.STARTER_SELECT,e=>{s.ui.clearText(),s.ui.setMode(x.SAVE_SLOT,Ba.SAVE,t=>{if(t===-1){s.phaseManager.toTitleScreen(),this.end();return}s.sessionSlotId=t,this.initBattle(e)})})}initBattle(e){const t=s.getPlayerParty(),i=[];e.forEach((n,a)=>{!a&&ie.STARTER_SPECIES_OVERRIDE&&(n.speciesId=ie.STARTER_SPECIES_OVERRIDE);const r=zt(n.speciesId);let o=n.formIndex;n.speciesId in ie.STARTER_FORM_OVERRIDES&&ie.STARTER_FORM_OVERRIDES[n.speciesId]!=null&&r.forms[ie.STARTER_FORM_OVERRIDES[n.speciesId]]&&(o=ie.STARTER_FORM_OVERRIDES[n.speciesId]);let l=r.malePercent!==null?n.female?Ut.FEMALE:Ut.MALE:Ut.GENDERLESS;ie.GENDER_OVERRIDE!==null&&(l=ie.GENDER_OVERRIDE);const c=s.addPlayerPokemon(r,s.gameMode.getStartingLevel(),n.abilityIndex,o,l,n.shiny,n.variant,n.ivs,n.nature);n.moveset&&c.tryPopulateMoveset(n.moveset),n.passive&&(c.passive=!0),c.luck=s.gameData.getDexAttrLuck(s.gameData.dexData[r.speciesId].caughtAttr),n.pokerus&&(c.pokerus=!0),n.nickname&&(c.nickname=n.nickname),n.teraType!=null?c.teraType=n.teraType:c.teraType=c.species.type1,(s.gameMode.isSplicedOnly||ie.STARTER_FUSION_OVERRIDE)&&c.generateFusionSpecies(!0),c.setVisible(!1);const u=Cs(Ss.STARTER_MODIFY,c);t.push(c),u&&i.push(c.updateInfo()),i.push(c.loadAssets())}),Yf(),Kf(t[0]),Promise.all(i).then(()=>{Ds.fadeOut(s,s.sound.get("menu"),500,!0),s.time.delayedCall(500,()=>s.playBgm()),s.gameMode.isClassic?s.gameData.gameStats.classicSessionsPlayed++:s.gameData.gameStats.endlessSessionsPlayed++,s.newBattle(),s.arena.init(),s.sessionPlayTime=0,s.lastSavePlayTime=0,s.getPlayerParty().forEach(n=>{s.triggerPokemonFormChange(n,Jf)}),this.end()})}};h(Zu,"SelectStarterPhase");let ml=Zu;const Qu=class Qu extends Ot{phaseName="SelectTargetPhase";constructor(e){super(e)}start(){super.start();const e=s.currentBattle.turnCommands[this.fieldIndex],t=e?.move?.move;s.ui.setMode(x.TARGET_SELECT,this.fieldIndex,t,i=>{s.ui.setMode(x.MESSAGE);const n=s.getField(),a=n[this.fieldIndex],r=We[t];if(r&&a.isMoveTargetRestricted(r.id,a,n[i[0]])){const o=a.getRestrictingTag(t,a,n[i[0]]).selectionDeniedText(a,r.id);s.phaseManager.queueMessage(f.t(o,{moveName:r.name}),0,!0),i=[]}i.length===0?(s.currentBattle.turnCommands[this.fieldIndex]=null,s.phaseManager.unshiftNew("CommandPhase",this.fieldIndex)):e.targets=i,e?.command===Ie.BALL&&this.fieldIndex&&(s.currentBattle.turnCommands[this.fieldIndex-1].skip=!0),this.end()})}};h(Qu,"SelectTargetPhase");let yl=Qu;const Ju=class Ju extends Ot{phaseName="ShinySparklePhase";constructor(e){super(e)}start(){super.start(),this.getPokemon().sparkle(),s.time.delayedCall(1e3,()=>this.end())}};h(Ju,"ShinySparklePhase");let Tl=Ju;const ed=class ed extends Ot{phaseName="ShowAbilityPhase";passive;pokemonName;abilityName;pokemonOnField;constructor(e,t=!1){super(e),this.passive=t;const i=this.getPokemon();i?(this.pokemonName=Re(i),this.abilityName=(t?this.getPokemon().getPassiveAbility():this.getPokemon().getAbility()).name,this.pokemonOnField=!0):this.pokemonOnField=!1}start(){if(super.start(),!this.pokemonOnField||!this.getPokemon())return this.end();if(s.abilityBar.isVisible())return s.phaseManager.unshiftNew("HideAbilityPhase"),s.phaseManager.unshiftNew("ShowAbilityPhase",this.battlerIndex,this.passive),this.end();const e=this.getPokemon();e.isPlayer()?s.currentBattle.lastPlayerInvolved=e.getBattlerIndex()%2:s.currentBattle.lastEnemyInvolved=e.getBattlerIndex()%2,s.abilityBar.showAbility(this.pokemonName,this.abilityName,this.passive,this.player).then(()=>{e.waveData.abilityRevealed=!0,this.end()})}};h(ed,"ShowAbilityPhase");let La=ed;const td=class td extends Di{phaseName="ShowPartyExpBarPhase";expValue;constructor(e,t){super(e),this.expValue=t}start(){super.start();const e=this.getPokemon(),t=new ct(this.expValue);s.applyModifiers(Xf,!0,t),t.value=Math.floor(t.value);const i=e.level;e.addExp(t.value);const n=e.level;n>i&&s.phaseManager.unshiftNew("LevelUpPhase",this.partyMemberIndex,i,n),s.phaseManager.unshiftNew("HidePartyExpBarPhase"),e.updateInfo(),s.expParty===di.SKIP?this.end():s.expParty===di.ONLY_LEVEL_UP?n>i?s.partyExpBar.showPokemonExp(e,t.value,s.expParty===di.ONLY_LEVEL_UP,n).then(()=>{setTimeout(()=>this.end(),800/Math.pow(2,s.expGainsSpeed))}):this.end():s.expGainsSpeed<dg.SKIP?s.partyExpBar.showPokemonExp(e,t.value,!1,n).then(()=>{setTimeout(()=>this.end(),500/Math.pow(2,s.expGainsSpeed))}):this.end()}};h(td,"ShowPartyExpBarPhase");let Cl=td;const sd=class sd extends rt{phaseName="ShowTrainerPhase";start(){super.start(),s.trainer.setVisible(!0),s.trainer.setTexture(`trainer_${s.gameData.gender===De.FEMALE?"f":"m"}_back`),s.tweens.add({targets:s.trainer,x:106,duration:1e3,onComplete:h(()=>this.end(),"onComplete")})}};h(sd,"ShowTrainerPhase");let Sl=sd;const id=class id extends Ot{phaseName="StatStageChangePhase";stats;selfTarget;stages;showMessage;ignoreAbilities;canBeCopied;onChange;comingFromMirrorArmorUser;comingFromStickyWeb;constructor(e,t,i,n,a=!0,r=!1,o=!0,l=null,c=!1,u=!1){super(e),this.selfTarget=t,this.stats=i,this.stages=n,this.showMessage=a,this.ignoreAbilities=r,this.canBeCopied=o,this.onChange=l,this.comingFromMirrorArmorUser=c,this.comingFromStickyWeb=u}start(){if(this.stats.length>1){for(const l of this.stats)s.phaseManager.unshiftNew("StatStageChangePhase",this.battlerIndex,this.selfTarget,[l],this.stages,this.showMessage,this.ignoreAbilities,this.canBeCopied,this.onChange,this.comingFromMirrorArmorUser);return this.end()}const e=this.getPokemon();let t;if(e.isPlayer())if(!this.comingFromStickyWeb)t=s.getEnemyField()[s.currentBattle.lastEnemyInvolved];else{const l=s.arena.findTagsOnSide(c=>c.tagType===Us.STICKY_WEB,Tt.PLAYER)[0].sourceId;s.getEnemyField().forEach(c=>{c.id===l&&(t=c)})}else if(!this.comingFromStickyWeb)t=s.getPlayerField()[s.currentBattle.lastPlayerInvolved];else{const l=s.arena.findTagsOnSide(c=>c.tagType===Us.STICKY_WEB,Tt.ENEMY)[0].sourceId;s.getPlayerField().forEach(c=>{c.id===l&&(t=c)})}if(!e.isActive(!0))return this.end();const i=new ct(this.stages);this.ignoreAbilities||ve("StatStageChangeMultiplierAbAttr",{pokemon:e,numStages:i});let n=!1;const a=this.stats.filter(l=>{const c=new ft(!1);if(!this.selfTarget&&i.value<0&&s.arena.applyTagsForSide(py,e.isPlayer()?Tt.PLAYER:Tt.ENEMY,!1,null,c),!c.value&&!this.selfTarget&&i.value<0){const u={pokemon:e,stat:l,cancelled:c,simulated:n,target:e,stages:this.stages};ve("ProtectStatAbAttr",u),ve("ConditionalUserFieldProtectStatAbAttr",u);const p=e.getAlly();p!=null&&ve("ConditionalUserFieldProtectStatAbAttr",{...u,pokemon:p}),t!==void 0&&!e.findTag(m=>m instanceof fy)&&!this.comingFromMirrorArmorUser&&ve("ReflectStatStageChangeAbAttr",{pokemon:e,stat:l,cancelled:c,simulated:n,source:t,stages:this.stages})}return c.value&&(n=!0),!c.value}),r=a.map(l=>(i.value>=1?Math.min(e.getStatStage(l)+i.value,6):Math.max(e.getStatStage(l)+i.value,-6))-e.getStatStage(l));this.onChange?.(this.getPokemon(),a,r);const o=h(()=>{if(this.showMessage){const l=this.getStatStageChangeMessages(a,i.value,r);for(const c of l)s.phaseManager.queueMessage(c)}for(const l of a)i.value>0&&e.getStatStage(l)<6?e.turnData.statStagesIncreased=!0:i.value<0&&e.getStatStage(l)>-6&&(e.turnData.statStagesDecreased=!0),e.setStatStage(l,e.getStatStage(l)+i.value);if(i.value>0&&this.canBeCopied)for(const l of e.getOpponentsGenerator())ve("StatStageChangeCopyAbAttr",{pokemon:l,stats:this.stats,numStages:i.value});if(ve("PostStatStageChangeAbAttr",{pokemon:e,stats:a,stages:this.stages,selfTarget:this.selfTarget}),!s.phaseManager.hasPhaseOfType("StatStageChangePhase",l=>l.battlerIndex===this.battlerIndex)){const l=s.applyModifier(gy,this.player,e);l&&(e.loseHeldItem(l),s.updateModifiers(this.player))}e.updateInfo(),ii(ds.Stat_Change).then(()=>super.end())},"end");if(r.filter(l=>l).length>0&&s.moveAnimations){e.enableMask();const l=e.maskSprite,c=(this.player?106:236)*e.getSpriteScale()*s.field.scale,u=((this.player?148:84)+(i.value>=1?160:0))*e.getSpriteScale()*s.field.scale,p=156*s.field.scale*e.getSpriteScale(),m=316*s.field.scale*e.getSpriteScale(),d=i.value>=1?li[li.ATK].toLowerCase():li[li.SPD].toLowerCase(),y=s.add.tileSprite(c,u,p,m,"battle_stats",d);y.setPipeline(s.fieldSpritePipeline),y.setAlpha(0),y.setScale(6),y.setOrigin(.5,1),s.playSound(`se/stat_${i.value>=1?"up":"down"}`),y.setMask(new Phaser.Display.Masks.BitmapMask(s,l??void 0)),s.tweens.add({targets:y,duration:250,alpha:.8375,onComplete:h(()=>{s.tweens.add({targets:y,delay:1e3,duration:250,alpha:0})},"onComplete")}),s.tweens.add({targets:y,duration:1500,y:`${i.value>=1?"-":"+"}=960`}),s.time.delayedCall(1750,()=>{e.disableMask(),o()})}else o()}getStatStageChangeMessages(e,t,i){const n=[],a={};for(let r=0;r<i.length;r++){const o=i[r];a[o]||(a[o]=[]),a[o].push(r)}return Object.keys(a).forEach(r=>{const o=e.filter((c,u)=>a[r].includes(u));let l="";o.length>1?(l=o.length>=5?f.t("battle:stats"):`${o.slice(0,-1).map(c=>f.t(nn(c))).join(", ")}${o.length>2?",":""} ${f.t("battle:statsAnd")} ${f.t(nn(o.at(-1)))}`,n.push(f.t(Zp(Math.abs(Number.parseInt(r)),t>=1),{pokemonNameWithAffix:Re(this.getPokemon()),stats:l,count:o.length}))):(l=f.t(nn(o[0])),n.push(f.t(Zp(Math.abs(Number.parseInt(r)),t>=1),{pokemonNameWithAffix:Re(this.getPokemon()),stats:l,count:o.length})))}),n}};h(id,"StatStageChangePhase");let El=id;const nd=class nd extends vn{phaseName="SummonMissingPhase";preSummon(){s.ui.showText(f.t("battle:sendOutPokemon",{pokemonName:Re(this.getPokemon())})),s.time.delayedCall(250,()=>this.summon())}};h(nd,"SummonMissingPhase");let bl=nd;const ad=class ad extends rt{phaseName="SwitchBiomePhase";nextBiome;constructor(e){super(),this.nextBiome=e}start(){if(super.start(),this.nextBiome===void 0)return this.end();s.lastEnemyTrainer=s.currentBattle?.trainer??null,s.lastMysteryEncounter=s.currentBattle?.mysteryEncounter,s.tweens.add({targets:[s.arenaEnemy,s.lastEnemyTrainer],x:"+=300",duration:2e3,onComplete:h(()=>{s.arenaEnemy.setX(s.arenaEnemy.x-600),s.newArena(this.nextBiome);const t=`${pg(this.nextBiome)}_bg`;s.arenaBgTransition.setTexture(t),s.arenaBgTransition.setAlpha(0),s.arenaBgTransition.setVisible(!0),s.arenaPlayerTransition.setBiome(this.nextBiome),s.arenaPlayerTransition.setAlpha(0),s.arenaPlayerTransition.setVisible(!0),s.tweens.add({targets:[s.arenaPlayer,s.arenaBgTransition,s.arenaPlayerTransition],duration:1e3,delay:1e3,ease:"Sine.easeInOut",alpha:h(i=>i===s.arenaPlayer?0:1,"alpha"),onComplete:h(()=>{s.arenaBg.setTexture(t),s.arenaPlayer.setBiome(this.nextBiome),s.arenaPlayer.setAlpha(1),s.arenaEnemy.setBiome(this.nextBiome),s.arenaEnemy.setAlpha(1),s.arenaNextEnemy.setBiome(this.nextBiome),s.arenaBgTransition.setVisible(!1),s.arenaPlayerTransition.setVisible(!1),s.lastEnemyTrainer&&s.lastEnemyTrainer.destroy(),this.end()},"onComplete")})},"onComplete")})}};h(ad,"SwitchBiomePhase");let Il=ad;const rd=class rd extends rt{phaseName="SwitchPhase";fieldIndex;switchType;isModal;doReturn;constructor(e,t,i,n){super(),this.switchType=e,this.fieldIndex=t,this.isModal=i,this.doReturn=n}start(){if(super.start(),this.isModal&&s.getPokemonAllowedInBattle().every(t=>t.isOnField()))return super.end();if(this.isModal&&!this.doReturn&&!s.getPlayerParty()[this.fieldIndex].isFainted())return super.end();if(this.isModal&&s.getPlayerField(!0).length>s.currentBattle.getBattlerCount())return super.end();const e=s.currentBattle.getBattlerCount()===1||s.getPokemonAllowedInBattle().length>1?this.fieldIndex:0;s.ui.setMode(x.PARTY,this.isModal?ts.FAINT_SWITCH:ts.POST_BATTLE_SWITCH,e,(t,i)=>{if(t>=s.currentBattle.getBattlerCount()&&t<6){const n=i===lg.PASS_BATON?gt.BATON_PASS:this.switchType;s.phaseManager.unshiftNew("SwitchSummonPhase",n,e,t,this.doReturn)}s.ui.setMode(x.MESSAGE).then(()=>super.end())},Ln.FilterNonFainted)}};h(rd,"SwitchPhase");let vl=rd;const od=class od extends rt{phaseName="TeraPhase";pokemon;constructor(e){super(),this.pokemon=e}start(){super.start(),s.phaseManager.queueMessage(f.t("battle:pokemonTerastallized",{pokemonNameWithAffix:Re(this.pokemon),type:f.t(`pokemonInfo:type.${bt(Me[this.pokemon.getTeraType()])}`)})),new nr(ti.TERASTALLIZE,this.pokemon).play(!1,()=>{this.end()})}end(){this.pokemon.isTerastallized=!0,this.pokemon.updateSpritePipelineData(),this.pokemon.isPlayer()&&(s.arena.playerTerasUsed+=1),s.triggerPokemonFormChange(this.pokemon,ag),this.pokemon.isPlayer()&&(s.validateAchv(Fe.TERASTALLIZE),this.pokemon.getTeraType()===Me.STELLAR&&s.validateAchv(Fe.STELLAR_TERASTALLIZE)),super.end()}};h(od,"TeraPhase");let Ol=od;const ld=class ld extends Ge{phaseName="TitlePhase";loaded=!1;lastSessionData;gameMode;start(){super.start(),s.ui.clearText(),s.ui.fadeIn(250);const e=new Date;e.getMonth()===11||e.getMonth()===0&&e.getDate()<=15?s.playBgm("winter_title",!0):s.playBgm("title",!0),s.gameData.getSession(Be?.lastSessionSlot??-1).then(t=>{if(t){this.lastSessionData=t;const n=`${pg(t.arena.biome)}_bg`;s.arenaBg.setTexture(n)}this.showOptions()}).catch(t=>{console.error(t),this.showOptions()})}showOptions(){const e=[];Be&&Be.lastSessionSlot>-1&&e.push({label:f.t("continue",{ns:"menu"}),handler:h(()=>(this.loadSaveSlot(this.lastSessionData||!Be?-1:Be.lastSessionSlot),!0),"handler")}),e.push({label:f.t("menu:newGame"),handler:h(()=>{const i=h(r=>{this.gameMode=r,s.ui.setMode(x.MESSAGE),s.ui.clearText(),this.end()},"setModeAndEnd"),{gameData:n}=s,a=[];return a.push({label:Lt.getModeName(fe.CLASSIC),handler:h(()=>(i(fe.CLASSIC),!0),"handler")}),a.push({label:f.t("menu:dailyRun"),handler:h(()=>(this.initDailyRun(),!0),"handler")}),n.isUnlocked(xt.ENDLESS_MODE)&&(a.push({label:Lt.getModeName(fe.CHALLENGE),handler:h(()=>(i(fe.CHALLENGE),!0),"handler")}),a.push({label:Lt.getModeName(fe.ENDLESS),handler:h(()=>(i(fe.ENDLESS),!0),"handler")}),n.isUnlocked(xt.SPLICED_ENDLESS_MODE)&&a.push({label:Lt.getModeName(fe.SPLICED_ENDLESS),handler:h(()=>(i(fe.SPLICED_ENDLESS),!0),"handler")})),a.push({label:f.t("menu:cancel"),handler:h(()=>(s.phaseManager.toTitleScreen(),super.end(),!0),"handler")}),s.ui.showText(f.t("menu:selectGameMode"),null,()=>s.ui.setOverlayMode(x.OPTION_SELECT,{options:a})),!0},"handler")},{label:f.t("menu:loadGame"),handler:h(()=>(s.ui.setOverlayMode(x.SAVE_SLOT,Ba.LOAD,i=>{if(i===-1)return this.showOptions();this.loadSaveSlot(i)}),!0),"handler")},{label:f.t("menu:runHistory"),handler:h(()=>(s.ui.setOverlayMode(x.RUN_HISTORY),!0),"handler"),keepOpen:!0},{label:f.t("menu:settings"),handler:h(()=>(s.ui.setOverlayMode(x.SETTINGS),!0),"handler"),keepOpen:!0});const t={options:e,noCancel:!0,yOffset:47};s.ui.setMode(x.TITLE,t)}loadSaveSlot(e){s.sessionSlotId=e>-1||!Be?e:Be.lastSessionSlot,s.ui.setMode(x.MESSAGE),s.ui.resetModeChain(),s.gameData.loadSession(e,e===-1?this.lastSessionData:void 0).then(t=>{t?(this.loaded=!0,Be&&(Be.lastSessionSlot=e),s.ui.showText(f.t("menu:sessionSuccess"),null,()=>this.end())):this.end()}).catch(t=>{console.error(t),s.ui.showText(f.t("menu:failedToLoadSession"),null)})}initDailyRun(){s.ui.clearText(),s.ui.setMode(x.SAVE_SLOT,Ba.SAVE,e=>{if(e===-1){s.phaseManager.toTitleScreen(),super.end();return}s.phaseManager.clearPhaseQueue(),s.sessionSlotId=e;const t=h(i=>{s.gameMode=Sa(fe.DAILY),cs.startEventChallenges(),s.setSeed(i),s.resetSeed(),s.money=s.gameMode.getStartingMoney();const n=my(i),a=s.gameMode.getStartingLevel(),r=s.getPlayerParty(),o=[];for(const c of n){const u=zt(c.speciesId),p=c.formIndex,m=u.malePercent!==null?c.female?Ut.FEMALE:Ut.MALE:Ut.GENDERLESS,d=s.addPlayerPokemon(u,a,c.abilityIndex,p,m,c.shiny,c.variant,c.ivs,c.nature);d.setVisible(!1),c.moveset&&d.tryPopulateMoveset(c.moveset,!0),r.push(d),o.push(d.loadAssets())}ir(r,ei.DAILY_STARTER);const l=new Array(3).fill(null).map(()=>ze.EXP_SHARE().withIdFromFunc(ze.EXP_SHARE).newModifier()).concat(new Array(3).fill(null).map(()=>ze.GOLDEN_EXP_CHARM().withIdFromFunc(ze.GOLDEN_EXP_CHARM).newModifier())).concat([ze.MAP().withIdFromFunc(ze.MAP).newModifier()]).concat([ze.ABILITY_CHARM().withIdFromFunc(ze.ABILITY_CHARM).newModifier()]).concat([ze.SHINY_CHARM().withIdFromFunc(ze.SHINY_CHARM).newModifier()]).concat(yy(r)).filter(c=>c!==null);for(const c of l)s.addModifier(c,!0,!1,!1,!0);for(const c of cs.getEventDailyStartingItems())s.addModifier(ze[c]().withIdFromFunc(ze[c]).newModifier(),!0,!1,!1,!0);s.updateModifiers(!0,!0),Promise.all(o).then(()=>{s.time.delayedCall(500,()=>s.playBgm()),s.gameData.gameStats.dailyRunSessionsPlayed++,s.newArena(s.gameMode.getStartingBiome()),s.newBattle(),s.arena.init(),s.sessionPlayTime=0,s.lastSavePlayTime=0,this.end()})},"generateDaily");at.daily.getSeed().then(i=>{if(i)t(i);else throw new Error("Daily run seed is null!")}).catch(i=>{console.error(`Failed to load daily run:
`,i)})})}end(){if(!this.loaded&&!s.gameMode.isDaily?(s.arena.preloadBgm(),s.gameMode=Sa(this.gameMode),this.gameMode===fe.CHALLENGE?s.phaseManager.pushNew("SelectChallengePhase"):s.phaseManager.pushNew("SelectStarterPhase"),s.newArena(s.gameMode.getStartingBiome())):s.playBgm(),s.phaseManager.pushNew("EncounterPhase",this.loaded),this.loaded){const e=s.getPokemonAllowedInBattle().length;if(s.phaseManager.pushNew("SummonPhase",0,!0,!0),s.currentBattle.double&&e>1&&s.phaseManager.pushNew("SummonPhase",1,!0,!0),s.currentBattle.battleType!==de.TRAINER&&(s.currentBattle.waveIndex>1||!s.gameMode.isDaily)){const t=s.currentBattle.double?2:1;e>t&&(s.phaseManager.pushNew("CheckSwitchPhase",0,s.currentBattle.double),s.currentBattle.double&&s.phaseManager.pushNew("CheckSwitchPhase",1,s.currentBattle.double))}}for(const e of Object.keys(s.gameData.achvUnlocks))Yt.hasOwnProperty(e)&&e!=="CLASSIC_VICTORY"&&s.validateVoucher(Yt[e]);super.end()}};h(ld,"TitlePhase");let Al=ld;const hd=class hd extends rt{phaseName="ToggleDoublePositionPhase";double;constructor(e){super(),this.double=e}start(){super.start();const e=s.getPlayerField().find(t=>t.isActive(!0));e?e.setFieldPosition(this.double&&s.getPokemonAllowedInBattle().length>1?ys.LEFT:ys.CENTER,500).then(()=>{if(e.getFieldIndex()===1){const t=s.getPlayerParty();t[1]=t[0],t[0]=e}this.end()}):this.end()}};h(hd,"ToggleDoublePositionPhase");let xl=hd;const cd=class cd extends rt{phaseName="TrainerVictoryPhase";start(){s.disableMenu=!0,s.playBgm(s.currentBattle.trainer?.config.victoryBgm),s.phaseManager.unshiftNew("MoneyRewardPhase",s.currentBattle.trainer?.config.moneyMultiplier);const e=s.currentBattle.trainer?.config.modifierRewardFuncs;for(const i of e)s.phaseManager.unshiftNew("ModifierRewardPhase",i);const t=s.currentBattle.trainer?.config.trainerType;Yt.hasOwnProperty(B[t])&&!s.validateVoucher(Yt[B[t]])&&s.currentBattle.trainer?.config.isBoss&&(cs.getUpgradeUnlockedVouchers()?s.phaseManager.unshiftNew("ModifierRewardPhase",[ze.VOUCHER_PLUS,ze.VOUCHER_PLUS,ze.VOUCHER_PLUS,ze.VOUCHER_PREMIUM][Yt[B[t]].voucherType]):s.phaseManager.unshiftNew("ModifierRewardPhase",[ze.VOUCHER,ze.VOUCHER,ze.VOUCHER_PLUS,ze.VOUCHER_PREMIUM][Yt[B[t]].voucherType])),s.arena.biomeType===Je.SPACE&&(t===B.BREEDER||t===B.EXPERT_POKEMON_BREEDER)&&s.validateAchv(Fe.BREEDERS_IN_SPACE),s.ui.showText(f.t("battle:trainerDefeated",{trainerName:s.currentBattle.trainer?.getName(yt.NONE,!0)}),null,()=>{const i=s.currentBattle.trainer?.getVictoryMessages();let n;s.executeWithSeedOffset(()=>n=Pn(i),s.currentBattle.waveIndex),n=n;const a=h(()=>{const o=r;r=h(()=>s.ui.showDialogue(n,s.currentBattle.trainer?.getName(yt.TRAINER,!0),null,o),"showMessageOrEnd"),r()},"showMessage");let r=h(()=>this.end(),"showMessageOrEnd");if(i?.length>0)if(s.currentBattle.trainer?.config.hasCharSprite&&!s.ui.shouldSkipDialogue(n)){const o=r;r=h(()=>s.charSprite.hide().then(()=>s.hideFieldOverlay(250).then(()=>o())),"showMessageOrEnd"),s.showFieldOverlay(500).then(()=>s.charSprite.showCharacter(s.currentBattle.trainer?.getKey(),ar(i[0])).then(()=>a()))}else a();else r()},null,!0),this.showEnemyTrainer()}};h(cd,"TrainerVictoryPhase");let _l=cd;const ud=class ud extends ps{phaseName="TurnEndPhase";upcomingInterlude=!1;start(){super.start(),s.currentBattle.incrementTurn(),s.eventTarget.dispatchEvent(new Ty(s.currentBattle.turn)),s.phaseManager.dynamicQueueManager.clearLastTurnOrder(),s.phaseManager.hideAbilityBar();const e=h(t=>{t.switchOutStatus||(t.lapseTags(Nt.TURN_END),s.applyModifiers(Cy,t.isPlayer(),t),s.arena.terrain?.terrainType===Pi.GRASSY&&t.isGrounded()&&s.phaseManager.unshiftNew("PokemonHealPhase",t.getBattlerIndex(),Math.max(t.getMaxHp()>>4,1),f.t("battle:turnEndHpRestore",{pokemonName:Re(t)}),!0),t.isPlayer()||(s.applyModifiers(Sy,!1,t),s.applyModifier(Ey,!1,t)),ve("PostTurnAbAttr",{pokemon:t})),s.applyModifiers(by,t.isPlayer(),t),s.applyModifiers(zf,t.isPlayer(),t),t.tempSummonData.turnCount++,t.tempSummonData.waveTurnCount++},"handlePokemon");this.upcomingInterlude||(this.executeForAll(e),s.arena.lapseTags()),s.arena.weather&&!s.arena.weather.lapse()&&(s.arena.trySetWeather(hn.NONE),s.arena.triggerWeatherBasedFormChangesToNormal()),s.arena.terrain&&!s.arena.terrain.lapse()&&s.arena.trySetTerrain(Pi.NONE),this.end()}};h(ud,"TurnEndPhase");let wl=ud;const dd=class dd extends ps{phaseName="TurnInitPhase";start(){if(super.start(),s.getPlayerField().forEach(e=>{if(e.isOnField()&&!e.isAllowedInBattle()){s.phaseManager.queueMessage(f.t("challenges:illegalEvolution",{pokemon:e.name}),null,!0);const t=s.getPokemonAllowedInBattle();t.length===0?(s.phaseManager.clearPhaseQueue(),s.phaseManager.unshiftNew("GameOverPhase")):t.length>=s.currentBattle.getBattlerCount()||s.currentBattle.double&&!t[0].isActive(!0)?e.switchOut():e.leaveField(),t.length===1&&s.currentBattle.double&&s.phaseManager.unshiftNew("ToggleDoublePositionPhase",!0)}}),s.eventTarget.dispatchEvent(new Iy),vy(),Oy()){this.end();return}s.getField().forEach((e,t)=>{e?.isActive()&&(e.isPlayer()&&s.currentBattle.addParticipant(e),e.resetTurnData(),e.isPlayer()?s.phaseManager.pushNew("CommandPhase",t):s.phaseManager.pushNew("EnemyCommandPhase",t-nt.ENEMY))}),s.phaseManager.pushNew("TurnStartPhase"),this.end()}};h(dd,"TurnInitPhase");let Da=dd;const pd=class pd extends ps{phaseName="TurnStartPhase";getCommandOrder(){const e=s.getPlayerField(!0).map(n=>n.getBattlerIndex()),t=s.getEnemyField(!0).map(n=>n.getBattlerIndex()),i=e.concat(t);return i.sort((n,a)=>{const r=s.currentBattle.turnCommands[n],o=s.currentBattle.turnCommands[a];if(r?.command!==o?.command){if(r?.command===Ie.FIGHT)return 1;if(o?.command===Ie.FIGHT)return-1}const l=i.indexOf(n),c=i.indexOf(a);return l<c?-1:l>c?1:0}),i}start(){super.start();const e=s.getField(),t=this.getCommandOrder();for(const n of Es(Tt.BOTH)){const a=s.currentBattle.preTurnCommands[n.getBattlerIndex()];if(!a?.skip)switch(a?.command){case Ie.TERA:s.phaseManager.pushNew("TeraPhase",n)}}const i=s.phaseManager;for(const n of Es(Tt.BOTH))s.currentBattle.turnCommands[n.getBattlerIndex()]?.command===Ie.FIGHT&&(ve("BypassSpeedChanceAbAttr",{pokemon:n}),s.applyModifiers(Ay,n.isPlayer(),n));t.forEach((n,a)=>{const r=e[n],o=s.currentBattle.turnCommands[n];!o||o.skip||(o.command===Ie.FIGHT&&(r.turnData.order=a),this.handleTurnCommand(o,r))}),i.pushNew("CheckInterludePhase"),s.phaseManager.queueTurnEndPhases(),this.end()}handleTurnCommand(e,t){switch(e?.command){case Ie.FIGHT:this.handleFightCommand(e,t);break;case Ie.BALL:s.phaseManager.unshiftNew("AttemptCapturePhase",e.targets[0]%2,e.cursor);break;case Ie.POKEMON:s.phaseManager.unshiftNew("SwitchSummonPhase",e.args?.[0]?gt.BATON_PASS:gt.SWITCH,t.getFieldIndex(),e.cursor,!0,t.isPlayer());break;case Ie.RUN:s.phaseManager.unshiftNew("AttemptRunPhase");break}}handleFightCommand(e,t){const i=e.move;if(!i)return;const n=t.getMoveset().find(a=>a.moveId===i.move&&a.ppUsed<a.getMovePp())??new Fs(i.move);n.getMove().hasAttr("MoveHeaderAttr")&&s.phaseManager.unshiftNew("MoveHeaderPhase",t,n),s.phaseManager.pushNew("MovePhase",t,e.targets??i.targets,n,i.useMode)}};h(pd,"TurnStartPhase");let Ml=pd;const fd=class fd extends Ge{phaseName="UnavailablePhase";start(){s.ui.setMode(x.UNAVAILABLE,()=>{s.phaseManager.unshiftNew("LoginPhase",!0),this.end()})}};h(fd,"UnavailablePhase");let kl=fd;function EC(T){switch(T){case xt.ENDLESS_MODE:return`${Lt.getModeName(fe.ENDLESS)} Mode`;case xt.MINI_BLACK_HOLE:return f.t("modifierType:ModifierType.MINI_BLACK_HOLE.name");case xt.SPLICED_ENDLESS_MODE:return`${Lt.getModeName(fe.SPLICED_ENDLESS)} Mode`;case xt.EVIOLITE:return f.t("modifierType:ModifierType.EVIOLITE.name")}}h(EC,"getUnlockableName");const gd=class gd extends Ge{phaseName="UnlockPhase";unlockable;constructor(e){super(),this.unlockable=e}start(){s.time.delayedCall(2e3,()=>{s.gameData.unlocks[this.unlockable]=!0,s.playSound("level_up_fanfare"),s.ui.setMode(x.MESSAGE),s.ui.showText(f.t("battle:unlockedSomething",{unlockedThing:EC(this.unlockable)}),null,()=>{s.time.delayedCall(1500,()=>s.arenaBg.setVisible(!0)),this.end()},null,!0,1500)})}};h(gd,"UnlockPhase");let Nl=gd;const md=class md extends Ot{phaseName="VictoryPhase";isExpOnly;constructor(e,t=!1){super(e),this.isExpOnly=t}start(){super.start();const e=s.currentBattle.isBattleMysteryEncounter();(!e||!s.currentBattle.mysteryEncounter?.preventGameStatsUpdates)&&s.gameData.gameStats.pokemonDefeated++;const t=this.getPokemon().getExpValue();if(s.applyPartyExp(t,!0),e)return xy(!1,this.isExpOnly),this.end();if(!s.getEnemyParty().find(i=>s.currentBattle.battleType===de.WILD?i.isOnField():!i?.isFainted(!0))){s.phaseManager.pushNew("BattleEndPhase",!0),s.currentBattle.battleType===de.TRAINER&&s.phaseManager.pushNew("TrainerVictoryPhase");const i=s.gameMode,n=s.currentBattle.waveIndex;if(i.isEndless||!i.isWaveFinal(n)){if(s.phaseManager.pushNew("EggLapsePhase"),i.isClassic)switch(n){case Ve.RIVAL_1:case Ve.RIVAL_2:cs.getFixedBattleEventRewards(n).map(a=>s.phaseManager.pushNew("ModifierRewardPhase",ze[a]));break;case Ve.EVIL_BOSS_2:s.phaseManager.pushNew("ModifierRewardPhase",ze.LOCK_CAPSULE);break}if(n%10)s.phaseManager.pushNew("SelectModifierPhase",void 0,void 0,i.isFixedBattle(n)?i.getFixedBattle(n).customModifierRewardSettings:void 0);else if(i.isDaily)s.phaseManager.pushNew("ModifierRewardPhase",ze.EXP_CHARM),n>10&&!i.isWaveFinal(n)&&s.phaseManager.pushNew("ModifierRewardPhase",ze.GOLDEN_POKEBALL);else{const a=i.isEndless?10:s.offsetGym?0:20;i.isEndless&&n===10&&s.phaseManager.pushNew("ModifierRewardPhase",ze.EXP_SHARE),i.isClassic&&n===10&&s.phaseManager.pushNew("ModifierRewardPhase",ze.EXP_CHARM),n<=750&&(n<=500||n%30===a)&&s.phaseManager.pushNew("ModifierRewardPhase",n%30!==a||n>250?ze.EXP_CHARM:ze.SUPER_EXP_CHARM),n<=150&&!(n%50)&&s.phaseManager.pushNew("ModifierRewardPhase",ze.GOLDEN_POKEBALL),i.isEndless&&!(n%50)&&(s.phaseManager.pushNew("ModifierRewardPhase",n%250?ze.VOUCHER_PLUS:ze.VOUCHER_PREMIUM),s.phaseManager.pushNew("AddEnemyBuffModifierPhase"))}(i.hasRandomBiomes||s.isNewBiome())&&s.phaseManager.pushNew("SelectBiomePhase"),s.phaseManager.pushNew("NewBattlePhase")}else s.currentBattle.battleType=de.CLEAR,s.score+=i.getClearScoreBonus(),s.updateScoreText(),s.phaseManager.pushNew("GameOverPhase",!0)}this.end()}};h(md,"VictoryPhase");let Pl=md;const yd=class yd extends gn{phaseName="WeatherEffectPhase";weather;constructor(){super(void 0,void 0,ti.SUNNY+((s?.arena?.weather?.weatherType||hn.NONE)-1)),this.weather=s?.arena?.weather}start(){if(this.weather=s?.arena?.weather,!this.weather)return this.end();if(this.setAnimation(ti.SUNNY+(this.weather.weatherType-1)),this.weather.isDamaging()){const e=new ft(!1);if(this.executeForAll(t=>ve("SuppressWeatherEffectAbAttr",{pokemon:t,weather:this.weather,cancelled:e})),!e.value){const t=h(i=>{const n=new ft(!1);if(ve("PreWeatherDamageAbAttr",{pokemon:i,weather:this.weather,cancelled:n}),ve("BlockNonDirectDamageAbAttr",{pokemon:i,cancelled:n}),n.value||i.getTag(ke.UNDERGROUND)||i.getTag(ke.UNDERWATER))return;const a=rg(i.getMaxHp()/16);s.phaseManager.queueMessage(wy(this.weather.weatherType,i)??""),i.damageAndUpdate(a,{result:Ze.INDIRECT,ignoreSegments:!0})},"inflictDamage");this.executeForAll(i=>{!i||i.getTypes(!0,!0).filter(a=>this.weather?.isTypeDamageImmune(a)).length>0||i.switchOutStatus||t(i)})}}s.ui.showText(_y(this.weather.weatherType)??"",null,()=>{this.executeForAll(e=>{e.switchOutStatus||ve("PostWeatherLapseAbAttr",{pokemon:e,weather:this.weather})}),super.start()})}};h(yd,"WeatherEffectPhase");let Rl=yd;const bC=Object.freeze({AddEnemyBuffModifierPhase:Jr,AttemptCapturePhase:eo,AttemptRunPhase:to,BattleEndPhase:so,BerryPhase:io,CheckInterludePhase:no,CheckStatusEffectPhase:ao,CheckSwitchPhase:ro,CommandPhase:oo,CommonAnimPhase:gn,DamageAnimPhase:lo,DynamicPhaseMarker:va,EggHatchPhase:uo,EggLapsePhase:fo,EggSummaryPhase:go,EncounterPhase:Aa,EndCardPhase:mo,EndEvolutionPhase:yo,EnemyCommandPhase:To,EvolutionPhase:xa,ExpPhase:Co,FaintPhase:So,FormChangePhase:Eo,GameOverPhase:Io,GameOverModifierRewardPhase:bo,HideAbilityPhase:In,HidePartyExpBarPhase:vo,InitEncounterPhase:Oo,LearnMovePhase:Ao,LevelCapPhase:xo,LevelUpPhase:_o,LoadMoveAnimPhase:wo,LoginPhase:Mo,MessagePhase:Ma,ModifierRewardPhase:Cn,MoneyRewardPhase:ko,MoveAnimPhase:No,MoveChargePhase:Po,MoveEffectPhase:Ro,MoveEndPhase:Bo,MoveHeaderPhase:Lo,MovePhase:Do,MysteryEncounterPhase:Uo,MysteryEncounterOptionSelectedPhase:Vo,MysteryEncounterBattlePhase:Wo,MysteryEncounterBattleStartCleanupPhase:Ho,MysteryEncounterRewardsPhase:Go,PostMysteryEncounterPhase:Yo,NewBattlePhase:Ko,NewBiomeEncounterPhase:zo,NextEncounterPhase:ka,ObtainStatusEffectPhase:jo,PartyExpPhase:$o,PartyHealPhase:Xo,PokemonAnimPhase:qo,PokemonHealPhase:Zo,PokemonTransformPhase:Qo,PositionalTagPhase:Jo,PostGameOverPhase:el,PostSummonPhase:ba,PostTurnStatusEffectPhase:tl,QuietFormChangePhase:sl,ReloadSessionPhase:il,ResetStatusPhase:nl,ReturnPhase:al,RevivalBlessingPhase:rl,RibbonModifierRewardPhase:ol,ScanIvsPhase:ll,SelectBiomePhase:hl,SelectChallengePhase:cl,SelectGenderPhase:ul,SelectModifierPhase:pl,SelectStarterPhase:ml,SelectTargetPhase:yl,ShinySparklePhase:Tl,ShowAbilityPhase:La,ShowPartyExpBarPhase:Cl,ShowTrainerPhase:Sl,StatStageChangePhase:El,SummonMissingPhase:bl,SummonPhase:vn,SwitchBiomePhase:Il,SwitchPhase:vl,SwitchSummonPhase:Na,TeraPhase:Ol,TitlePhase:Al,ToggleDoublePositionPhase:xl,TrainerVictoryPhase:_l,TurnEndPhase:wl,TurnInitPhase:Da,TurnStartPhase:Ml,UnavailablePhase:kl,UnlockPhase:Nl,VictoryPhase:Pl,WeatherEffectPhase:Rl}),IC=["WeatherEffectPhase","PositionalTagPhase","BerryPhase","CheckStatusEffectPhase","TurnEndPhase"],Td=class Td{phaseQueue=new Qr;dynamicQueueManager=new Zr;currentPhase;standbyPhase=null;toTitleScreen(e=!1){this.clearAllPhases(),e&&this.unshiftNew("LoginPhase"),this.unshiftNew("TitlePhase")}getCurrentPhase(){return this.currentPhase}getStandbyPhase(){return this.standbyPhase}pushPhase(...e){for(const t of e)this.phaseQueue.pushPhase(this.checkDynamic(t))}unshiftPhase(...e){for(const t of e){const i=this.checkDynamic(t);t.is("MovePhase")?this.phaseQueue.addAfter(i,"MoveEndPhase"):this.phaseQueue.addPhase(i)}}checkDynamic(e){return this.dynamicQueueManager.queueDynamicPhase(e)?new va(e.phaseName):e}clearPhaseQueue(e=!1){this.phaseQueue.clear(e)}clearAllPhases(){this.clearPhaseQueue(),this.dynamicQueueManager.clearQueues(),this.standbyPhase=null}shiftPhase(){if(this.standbyPhase){this.currentPhase=this.standbyPhase,this.standbyPhase=null;return}let e=this.phaseQueue.getNextPhase();e?.is("DynamicPhaseMarker")&&(e=this.dynamicQueueManager.popNextPhase(e.phaseType)),e==null?this.turnStart():this.currentPhase=e,this.startCurrentPhase()}startCurrentPhase(){`${this.currentPhase.phaseName}`,`${dC}`,this.currentPhase.start()}overridePhase(e){return this.standbyPhase?!1:(this.standbyPhase=this.currentPhase,this.currentPhase=e,this.startCurrentPhase(),!0)}hasPhaseOfType(e,t){return this.dynamicQueueManager.exists(e,t)||this.phaseQueue.exists(e,t)}tryRemovePhase(e,t){return this.dynamicQueueManager.removePhase(e,t)?!0:this.phaseQueue.remove(e,t)}removeAllPhasesOfType(e){this.phaseQueue.removeAll(e)}queueMessage(e,t,i,n,a){const r=new Ma(e,t,i,n);a?this.pushPhase(r):this.unshiftPhase(r)}queueAbilityDisplay(e,t,i){this.unshiftPhase(i?new La(e.getBattlerIndex(),t):new In)}hideAbilityBar(){s.abilityBar.isVisible()&&this.unshiftPhase(new In)}turnStart(){this.dynamicQueueManager.clearQueues(),this.currentPhase=new Da}create(e,...t){const i=bC[e];if(!i)throw new Error(`Phase ${e} does not exist in PhaseMap.`);return new i(...t)}pushNew(e,...t){this.pushPhase(this.create(e,...t))}unshiftNew(e,...t){this.unshiftPhase(this.create(e,...t))}queueFaintPhase(...e){this.phaseQueue.addPhase(this.create("FaintPhase",...e),!0)}queueDeferred(e,...t){this.phaseQueue.addPhase(this.create(e,...t),!0)}getMovePhase(e){return this.dynamicQueueManager.getMovePhase(e)}cancelMove(e){this.dynamicQueueManager.cancelMovePhase(e)}forceMoveNext(e){this.dynamicQueueManager.setMoveTimingModifier(e,fa.FIRST)}forceMoveLast(e){this.dynamicQueueManager.setMoveTimingModifier(e,fa.LAST)}changePhaseMove(e,t){this.dynamicQueueManager.setMoveForPhase(e,t)}redirectMoves(e,t){this.dynamicQueueManager.redirectMoves(e,t)}queueTurnEndPhases(){IC.forEach(e=>{this.pushNew(e)})}onInterlude(){const e=["WeatherEffectPhase","BerryPhase","CheckStatusEffectPhase"];for(const i of e)this.phaseQueue.removeAll(i);const t=this.phaseQueue.find("TurnEndPhase");t&&(t.upcomingInterlude=!0)}};h(Td,"PhaseManager");let Bl=Td;const vC=`/*
 * SPDX-FileCopyrightText: 2024-2025 Pagefault Games
 * SPDX-FileContributor: FlashfyreDev
 * SPDX-FileContributor: SirzBenjie
 *
 * SPDX-License-Identifier: AGPL-3.0-only
 */

#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif

uniform sampler2D uMainSampler[%count%];

varying vec2 outTexCoord;
varying float outTexId;
varying float outTintEffect;
varying vec4 outTint;

uniform float time;
uniform int ignoreTimeTint;
uniform int isOutside;
uniform vec3 dayTint;
uniform vec3 duskTint;
uniform vec3 nightTint;
uniform vec3 terrainColor;
uniform float terrainColorRatio;

float blendOverlay(float base, float blend) {
	return base<0.5?(2.0*base*blend):(1.0-2.0*(1.0-base)*(1.0-blend));
}

vec3 blendOverlay(vec3 base, vec3 blend) {
	return vec3(blendOverlay(base.r,blend.r),blendOverlay(base.g,blend.g),blendOverlay(base.b,blend.b));
}

vec3 blendHardLight(vec3 base, vec3 blend) {
	return blendOverlay(blend, base);
}

float hue2rgb(float f1, float f2, float hue) {
	if (hue < 0.0)
		hue += 1.0;
	else if (hue > 1.0)
		hue -= 1.0;
	float res;
	if ((6.0 * hue) < 1.0)
		res = f1 + (f2 - f1) * 6.0 * hue;
	else if ((2.0 * hue) < 1.0)
		res = f2;
	else if ((3.0 * hue) < 2.0)
		res = f1 + (f2 - f1) * ((2.0 / 3.0) - hue) * 6.0;
	else
		res = f1;
	return res;
}

vec3 rgb2hsl(vec3 color) {
	vec3 hsl;

	float fmin = min(min(color.r, color.g), color.b);
	float fmax = max(max(color.r, color.g), color.b);
	float delta = fmax - fmin;

	hsl.z = (fmax + fmin) / 2.0;

	if (delta == 0.0) {
		hsl.x = 0.0;
		hsl.y = 0.0;
	} else {
		if (hsl.z < 0.5)
			hsl.y = delta / (fmax + fmin);
		else
			hsl.y = delta / (2.0 - fmax - fmin);

		float deltaR = (((fmax - color.r) / 6.0) + (delta / 2.0)) / delta;
		float deltaG = (((fmax - color.g) / 6.0) + (delta / 2.0)) / delta;
		float deltaB = (((fmax - color.b) / 6.0) + (delta / 2.0)) / delta;

		if (color.r == fmax )
			hsl.x = deltaB - deltaG;
		else if (color.g == fmax)
			hsl.x = (1.0 / 3.0) + deltaR - deltaB;
		else if (color.b == fmax)
			hsl.x = (2.0 / 3.0) + deltaG - deltaR;

		if (hsl.x < 0.0)
			hsl.x += 1.0;
		else if (hsl.x > 1.0)
			hsl.x -= 1.0;
	}

	return hsl;
}

vec3 hsl2rgb(vec3 hsl) {
	vec3 rgb;

	if (hsl.y == 0.0)
		rgb = vec3(hsl.z);
	else {
		float f2;

		if (hsl.z < 0.5)
			f2 = hsl.z * (1.0 + hsl.y);
		else
			f2 = (hsl.z + hsl.y) - (hsl.y * hsl.z);

		float f1 = 2.0 * hsl.z - f2;

		rgb.r = hue2rgb(f1, f2, hsl.x + (1.0/3.0));
		rgb.g = hue2rgb(f1, f2, hsl.x);
		rgb.b = hue2rgb(f1, f2, hsl.x - (1.0/3.0));
	}

	return rgb;
}

vec3 blendHue(vec3 base, vec3 blend) {
	vec3 baseHSL = rgb2hsl(base);
	return hsl2rgb(vec3(rgb2hsl(blend).r, baseHSL.g, baseHSL.b));
}

void main() {
	vec4 texture;

	%forloop%

	vec4 texel = vec4(outTint.bgr * outTint.a, outTint.a);

	//  Multiply texture tint
	vec4 color = texture * texel;

	if (outTintEffect == 1.0) {
		//  Solid color + texture alpha
		color.rgb = mix(texture.rgb, outTint.bgr * outTint.a, texture.a);
	} else if (outTintEffect == 2.0) {
		//  Solid color, no texture
		color = texel;
	}

	/* Apply day/night tint */
	if (color.a > 0.0 && ignoreTimeTint == 0) {
		vec3 dayNightTint;

		if (time < 0.25) {
			dayNightTint = dayTint;
		} else if (isOutside == 0 && time < 0.5) {
			dayNightTint = mix(dayTint, nightTint, (time - 0.25) / 0.25);
		} else if (time < 0.375) {
			dayNightTint = mix(dayTint, duskTint, (time - 0.25) / 0.125);
		} else if (time < 0.5) {
			dayNightTint = mix(duskTint, nightTint, (time - 0.375) / 0.125);
		} else if (time < 0.75) {
			dayNightTint = nightTint;
		} else if (isOutside == 0) {
			dayNightTint = mix(nightTint, dayTint, (time - 0.75) / 0.25);
		} else if (time < 0.875) {
			dayNightTint = mix(nightTint, duskTint, (time - 0.75) / 0.125);
		} else {
			dayNightTint = mix(duskTint, dayTint, (time - 0.875) / 0.125);
		}

		color = vec4(blendHardLight(color.rgb, dayNightTint), color.a);
	}

	if (terrainColorRatio > 0.0 && (1.0 - terrainColorRatio) < outTexCoord.y) {
		if (color.a > 0.0 && (terrainColor.r > 0.0 || terrainColor.g > 0.0 || terrainColor.b > 0.0)) {
			color.rgb = mix(color.rgb, blendHue(color.rgb, terrainColor), 1.0);
		}
	}

	gl_FragColor = color;
}`,Lg=`/*
 * SPDX-FileCopyrightText: 2024-2025 Pagefault Games
 * SPDX-FileContributor: FlashfyreDev
 * SPDX-FileContributor: SirzBenjie
 *
 * SPDX-License-Identifier: AGPL-3.0-only
 */

precision mediump float;

uniform mat4 uProjectionMatrix;
uniform int uRoundPixels;
uniform vec2 uResolution;

attribute vec2 inPosition;
attribute vec2 inTexCoord;
attribute float inTexId;
attribute float inTintEffect;
attribute vec4 inTint;

varying vec2 outTexCoord;
varying float outTexId;
varying vec2 outPosition;
varying float outTintEffect;
varying vec4 outTint;

void main()
{
	gl_Position = uProjectionMatrix * vec4(inPosition, 1.0, 1.0);
	if (uRoundPixels == 1)
	{
		gl_Position.xy = floor(((gl_Position.xy + 1.0) * 0.5 * uResolution) + 0.5) / uResolution * 2.0 - 1.0;
	}
	outTexCoord = inTexCoord;
	outTexId = inTexId;
	outPosition = inPosition;
	outTint = inTint;
	outTintEffect = inTintEffect;
}`,Cd=class Cd extends Jt.Renderer.WebGL.Pipelines.MultiPipeline{constructor(e,t){super(t||{game:e,name:"field-sprite",fragShader:vC,vertShader:Lg})}onPreRender(){this.set1f("time",0),this.set1i("ignoreTimeTint",0),this.set1f("terrainColorRatio",0),this.set3fv("terrainColor",[0,0,0])}onBind(e){super.onBind();const i=e.pipelineData,n=i.ignoreTimeTint,a=i.terrainColorRatio||0,r=s.currentBattle?.waveIndex?(s.currentBattle.waveIndex+s.waveCycleOffset)%40/40:My();this.set1f("time",r),this.set1i("ignoreTimeTint",n?1:0),this.set1i("isOutside",s.arena.isOutside()?1:0),this.set3fv("dayTint",s.arena.getDayTint().map(o=>o/255)),this.set3fv("duskTint",s.arena.getDuskTint().map(o=>o/255)),this.set3fv("nightTint",s.arena.getNightTint().map(o=>o/255)),this.set3fv("terrainColor",ky(s.arena.terrain?.terrainType||Pi.NONE).map(o=>o/255)),this.set1f("terrainColorRatio",a)}onBatch(e){e&&this.flush()}};h(Cd,"FieldSpritePipeline");let Fa=Cd;const OC=`/*
 * SPDX-FileCopyrightText: 2024-2025 Pagefault Games
 * SPDX-FileContributor: FlashfyreDev
 * SPDX-FileContributor: SirzBenjie
 *
 * SPDX-License-Identifier: AGPL-3.0-only
 */

#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif

uniform sampler2D uMainSampler[%count%];

varying vec2 outTexCoord;
varying float outTexId;
varying vec2 outPosition;
varying float outTintEffect;
varying vec4 outTint;

uniform float time;
uniform int ignoreTimeTint;
uniform int isOutside;
uniform vec3 dayTint;
uniform vec3 duskTint;
uniform vec3 nightTint;
uniform float teraTime;
uniform vec3 teraColor;
uniform int hasShadow;
uniform int yCenter;
uniform float fieldScale;
uniform float vCutoff;
uniform vec2 relPosition;
uniform vec2 texFrameUv;
uniform vec2 size;
uniform vec2 texSize;
uniform float yOffset;
uniform float yShadowOffset;
uniform vec4 tone;
uniform vec4 baseVariantColors[32];
uniform vec4 variantColors[32];
uniform vec4 spriteColors[32];
uniform ivec4 fusionSpriteColors[32];

const vec3 lumaF = vec3(.299, .587, .114);

float blendOverlay(float base, float blend) {
	return base<0.5?(2.0*base*blend):(1.0-2.0*(1.0-base)*(1.0-blend));
}

vec3 blendOverlay(vec3 base, vec3 blend) {
	return vec3(blendOverlay(base.r,blend.r),blendOverlay(base.g,blend.g),blendOverlay(base.b,blend.b));
}

vec3 blendHardLight(vec3 base, vec3 blend) {
	return blendOverlay(blend, base);
}

float hue2rgb(float f1, float f2, float hue) {
	if (hue < 0.0)
		hue += 1.0;
	else if (hue > 1.0)
		hue -= 1.0;
	float res;
	if ((6.0 * hue) < 1.0)
		res = f1 + (f2 - f1) * 6.0 * hue;
	else if ((2.0 * hue) < 1.0)
		res = f2;
	else if ((3.0 * hue) < 2.0)
		res = f1 + (f2 - f1) * ((2.0 / 3.0) - hue) * 6.0;
	else
		res = f1;
	return res;
}

vec3 rgb2hsl(vec3 color) {
	vec3 hsl;
	float fmin = min(min(color.r, color.g), color.b);
	float fmax = max(max(color.r, color.g), color.b);
	float delta = fmax - fmin;

	hsl.z = (fmax + fmin) / 2.0;

	if (delta == 0.0) {
		hsl.x = 0.0;
		hsl.y = 0.0;
	} else {
		if (hsl.z < 0.5)
			hsl.y = delta / (fmax + fmin);
		else
			hsl.y = delta / (2.0 - fmax - fmin);

		float deltaR = (((fmax - color.r) / 6.0) + (delta / 2.0)) / delta;
		float deltaG = (((fmax - color.g) / 6.0) + (delta / 2.0)) / delta;
		float deltaB = (((fmax - color.b) / 6.0) + (delta / 2.0)) / delta;

		if (color.r == fmax )
			hsl.x = deltaB - deltaG;
		else if (color.g == fmax)
			hsl.x = (1.0 / 3.0) + deltaR - deltaB;
		else if (color.b == fmax)
			hsl.x = (2.0 / 3.0) + deltaG - deltaR;

		if (hsl.x < 0.0)
			hsl.x += 1.0;
		else if (hsl.x > 1.0)
			hsl.x -= 1.0;
	}

	return hsl;
}

vec3 hsl2rgb(vec3 hsl) {
	vec3 rgb;

	if (hsl.y == 0.0)
		rgb = vec3(hsl.z);
	else {
		float f2;

		if (hsl.z < 0.5)
			f2 = hsl.z * (1.0 + hsl.y);
		else
			f2 = (hsl.z + hsl.y) - (hsl.y * hsl.z);

		float f1 = 2.0 * hsl.z - f2;

		rgb.r = hue2rgb(f1, f2, hsl.x + (1.0/3.0));
		rgb.g = hue2rgb(f1, f2, hsl.x);
		rgb.b= hue2rgb(f1, f2, hsl.x - (1.0/3.0));
	}

	return rgb;
}

vec3 blendHue(vec3 base, vec3 blend) {
	vec3 baseHSL = rgb2hsl(base);
	return hsl2rgb(vec3(rgb2hsl(blend).r, baseHSL.g, baseHSL.b));
}

vec3 rgb2hsv(vec3 c) {
	vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
	vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));
	vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));

	float d = q.x - min(q.w, q.y);
	float e = 1.0e-10;
	return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);
}

vec3 hsv2rgb(vec3 c) {
	vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
	vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
	return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}

void main() {
	vec4 texture = texture2D(uMainSampler[0], outTexCoord);

	for (int i = 0; i < 32; i++) {
		if (baseVariantColors[i].a == 0.0)
			break;
		if (texture.a > 0.0 && all(lessThan(abs(texture.rgb - baseVariantColors[i].rgb), vec3(0.5/255.0)))) {
			texture.rgb = variantColors[i].rgb;
			break;
		}
	}

	for (int i = 0; i < 32; i++) {
		if (spriteColors[i][3] == 0.0)
			break;
		if (texture.a > 0.0 && all(lessThan(abs(texture.rgb - spriteColors[i].rgb), vec3(0.5/255.0)))) {
			vec3 fusionColor = vec3(fusionSpriteColors[i].rgb) / 255.0;
			vec3 bg = spriteColors[i].rgb;
			float gray = (bg.r + bg.g + bg.b) / 3.0;
			bg = vec3(gray);
			vec3 fg = fusionColor;
			texture.rgb = mix(1.0 - 2.0 * (1.0 - bg) * (1.0 - fg), 2.0 * bg * fg, step(bg, vec3(0.5)));
			break;
		}
	}

	vec4 texel = vec4(outTint.bgr * outTint.a, outTint.a);

	//  Multiply texture tint
	vec4 color = texture * texel;

	if (color.a > 0.0 && teraColor.r > 0.0 && teraColor.g > 0.0 && teraColor.b > 0.0) {
		vec2 relUv = (outTexCoord.xy - texFrameUv.xy) / (size.xy / texSize.xy);
		vec2 teraTexCoord = vec2(relUv.x * (size.x / 200.0), relUv.y * (size.y / 120.0));
		vec4 teraCol = texture2D(uMainSampler[1], teraTexCoord);
		float floorValue = 86.0 / 255.0;
		vec3 teraPatternHsv = rgb2hsv(teraCol.rgb);
		teraCol.rgb = hsv2rgb(vec3((teraPatternHsv.b - floorValue) * 4.0 + teraTexCoord.x * fieldScale / 2.0 + teraTexCoord.y * fieldScale / 2.0 + teraTime * 255.0, teraPatternHsv.b, teraPatternHsv.b));

		color.rgb = mix(color.rgb, blendHue(color.rgb, teraColor), 0.625);
		teraCol.rgb = mix(teraCol.rgb, teraColor, 0.5);
		color.rgb = blendOverlay(color.rgb, teraCol.rgb);

		if (any(lessThan(teraCol.rgb, vec3(1.0)))) {
			vec3 teraColHsv = rgb2hsv(teraColor);
			color.rgb = mix(color.rgb, teraColor, (1.0 - teraColHsv.g) / 2.0);
		}
	}

	if (outTintEffect == 1.0) {
		//  Solid color + texture alpha
		color.rgb = mix(texture.rgb, outTint.bgr * outTint.a, texture.a);
	} else if (outTintEffect == 2.0) {
		//  Solid color, no texture
		color = texel;
	}

	/* Apply gray */
	float luma = dot(color.rgb, lumaF);
	color.rgb = mix(color.rgb, vec3(luma), tone.w);

	/* Apply tone */
	color.rgb += tone.rgb * (color.a / 255.0);

	/* Apply day/night tint */
	if (color.a > 0.0 && ignoreTimeTint == 0) {
		vec3 dayNightTint;

		if (time < 0.25) {
			dayNightTint = dayTint;
		} else if (isOutside == 0 && time < 0.5) {
			dayNightTint = mix(dayTint, nightTint, (time - 0.25) / 0.25);
		} else if (time < 0.375) {
			dayNightTint = mix(dayTint, duskTint, (time - 0.25) / 0.125);
		} else if (time < 0.5) {
			dayNightTint = mix(duskTint, nightTint, (time - 0.375) / 0.125);
		} else if (time < 0.75) {
			dayNightTint = nightTint;
		} else if (isOutside == 0) {
			dayNightTint = mix(nightTint, dayTint, (time - 0.75) / 0.25);
		} else if (time < 0.875) {
			dayNightTint = mix(nightTint, duskTint, (time - 0.75) / 0.125);
		} else {
			dayNightTint = mix(duskTint, dayTint, (time - 0.875) / 0.125);
		}

		color.rgb = blendHardLight(color.rgb, dayNightTint);
	}

	if (hasShadow == 1) {
		float width = size.x - (yOffset / 2.0);

		float spriteX = ((floor(outPosition.x / fieldScale) - relPosition.x) / width) + 0.5;
		float spriteY = ((floor(outPosition.y / fieldScale) - relPosition.y - yShadowOffset) / size.y);

		if (yCenter == 1) {
			spriteY += 0.5;
		} else {
			spriteY += 1.0;
		}

		bool yOverflow = outTexCoord.y >= vCutoff;

		if ((spriteY >= 0.9 && (color.a == 0.0 || yOverflow))) {
			float shadowSpriteY = (spriteY - 0.9) * (1.0 / 0.15);
			if (distance(vec2(spriteX, shadowSpriteY), vec2(0.5)) < 0.5) {
				color = vec4(vec3(0.0), 0.5);
			} else if (yOverflow) {
				discard;
			}
		} else if (yOverflow) {
			discard;
		}
	}

	gl_FragColor = color;
}`,Sd=class Sd extends Fa{_tone;constructor(e){super(e,{game:e,name:"sprite",fragShader:OC,vertShader:Lg}),this._tone=[0,0,0,0]}onPreRender(){super.onPreRender(),this.set1f("teraTime",0),this.set3fv("teraColor",[0,0,0]),this.set1i("hasShadow",0),this.set1i("yCenter",0),this.set2f("relPosition",0,0),this.set2f("texFrameUv",0,0),this.set2f("size",0,0),this.set2f("texSize",0,0),this.set1f("yOffset",0),this.set1f("yShadowOffset",0),this.set4fv("tone",this._tone)}onBind(e){super.onBind(e);const t=e,i=t.pipelineData,n=i.tone,a=i.isTerastallized?i.teraColor??[0,0,0]:[0,0,0],r=i.hasShadow,o=i.yShadowOffset,l=i.ignoreFieldPos,c=i.ignoreOverride,u=t.parentContainer instanceof Js||t.parentContainer instanceof ls||t.parentContainer instanceof Qp,p=u?t.parentContainer.parentContainer:t.parentContainer,m=u?[t.parentContainer.x,t.parentContainer.y]:[t.x,t.y];if(p&&(m[0]+=p.x/p.scale,m[1]+=p.y/p.scale),m[0]+=-(t.width-t.frame.width)/2+t.frame.x+(l?0:t.x-p.x),t.originY===.5&&(m[1]+=t.height/2*((u?t.parentContainer:t).scale-1)+(l?0:t.y-p.y)),this.set1f("teraTime",this.game.getTime()%5e5/5e5),this.set3fv("teraColor",a.map(d=>d/255)),this.set1i("hasShadow",r?1:0),this.set1i("yCenter",t.originY===.5?1:0),this.set1f("fieldScale",p?.scale||1),this.set2f("relPosition",m[0],m[1]),this.set2f("texFrameUv",t.frame.u0,t.frame.v0),this.set2f("size",t.frame.width,t.height),this.set2f("texSize",t.texture.source[0].width,t.texture.source[0].height),this.set1f("yOffset",t.height-t.frame.height*(u?t.parentContainer.scale:t.scale)),this.set1f("yShadowOffset",o??0),this.set4fv("tone",n),this.bindTexture(this.game.textures.get("tera").source[0].glTexture,1),s.fusionPaletteSwaps){const d=c&&i.spriteColorsBase||i.spriteColors||[],y=c&&i.fusionSpriteColorsBase||i.fusionSpriteColors||[],g=[0,0,0,0],C=[],E=[];for(let I=0;I<32;I++)C.splice(C.length,0,...I<d.length?d[I].map(A=>A/255):g),E.splice(E.length,0,...I<y.length?y[I]:g);this.set4fv("spriteColors",C.flat()),this.set4iv("fusionSpriteColors",E.flat())}}onBatch(e){if(e){const t=e,i=t.pipelineData,n=i.hasOwnProperty("variant")?i.variant:t.parentContainer instanceof Js?t.parentContainer.variant:0;let a;const r=[0,0,0,0],o=[],l=[];if((t.parentContainer instanceof Js?t.parentContainer.shiny:i.shiny)&&(a=Ny[t.parentContainer instanceof Js?t.parentContainer.getSprite().texture.key:i.spriteKey])&&a.hasOwnProperty(n)){const c=Object.keys(a[n]);for(let u=0;u<32;u++)if(u<c.length){const p=Array.from(Object.values(Dt(c[u]))),m=Array.from(Object.values(Dt(a[n][c[u]])));o.splice(o.length,0,...p.map(d=>d/255)),l.splice(l.length,0,...m.map(d=>d/255))}else o.splice(o.length,0,...r),l.splice(l.length,0,...r)}else for(let c=0;c<32;c++)o.splice(o.length,0,...r),l.splice(l.length,0,...r);this.set4fv("baseVariantColors",o.flat()),this.set4fv("variantColors",l.flat())}super.onBatch(e)}batchQuad(e,t,i,n,a,r,o,l,c,u,p,m,d,y,g,C,E,I,A,_){const w=e;this.set1f("vCutoff",d);const L=w.pipelineData.hasShadow,V=w.pipelineData.yShadowOffset??0;if(L){const H=w.parentContainer instanceof Js||w.parentContainer instanceof ls||w.parentContainer instanceof Qp,W=H?w.parentContainer.parentContainer:w.parentContainer,ee=W.scale/6,me=(H?w.parentContainer.y:w.y+w.height)*6/ee,N=Math.ceil(w.height*.05+Math.max(V,0))*6/ee,j=(me-a)/W.scale;o=a=me+N;const v=(d-p)/(w.frame.height*(H?w.parentContainer.scale:w.scale));d+=(j+N/W.scale)*v}return super.batchQuad(e,t,i,n,a,r,o,l,c,u,p,m,d,y,g,C,E,I,A,_)}get tone(){return this._tone}set tone(e){this._tone=e}};h(Sd,"SpritePipeline");let Ll=Sd;var At=(T=>(T[T.UNLOCKED=1]="UNLOCKED",T[T.ENABLED=2]="ENABLED",T))(At||{});const Cf=120,Xs=8,AC=["HP","ATK","DEF","SPATK","SPDEF","SPD"],er=class er extends Phaser.GameObjects.Container{active=!1;statsLabels=[];statsRectangles=[];statsShadows=[];statsTotalLabel;statsBg;scale;width;constructor(e){super(s,e?.x,e?.y),this.scale=e?.scale||1,this.setScale(this.scale),this.width=(e?.width||er.getWidth(this.scale))/this.scale,this.statsBg=Ce(0,0,this.width,Cf),this.statsBg.setOrigin(0,0),this.add(this.statsBg);for(let t=0;t<6;t++){const i=s.add.rectangle(this.width-Xs+1,Xs+3+t*15,100,5,26720);i.setOrigin(1,0),this.statsShadows.push(i),this.add(i);const n=s.add.rectangle(this.width-Xs,Xs+2+t*15,100,5,6728345);n.setOrigin(1,0),this.statsRectangles.push(n),this.add(n);const a=P(Xs,Xs-2+t*15,"A",O.BATTLE_INFO);this.statsLabels.push(a),this.add(a)}this.statsTotalLabel=P(Xs,Xs+90,"A",O.MONEY_WINDOW),this.add(this.statsTotalLabel),this.setVisible(!1)}show(e,t){for(let i=0;i<6;i++)this.statsLabels[i].setText(f.t(`pokemonInfo:stat.${bt(AC[i])}Shortened`)+`: ${e[i]}`),this.statsShadows[i].setSize(e[i]/2,5),this.statsRectangles[i].setSize(e[i]/2,5);return this.statsTotalLabel.setText(`${f.t("pokedexUiHandler:baseTotal")}: ${t}`),this.setVisible(!0),this.active=!0,!0}clear(){this.setVisible(!1),this.active=!1}toggleInfo(e){e&&this.setVisible(!0),s.tweens.add({targets:this.statsLabels,duration:ge(125),ease:"Sine.easeInOut",alpha:e?1:0}),e||this.setVisible(!1)}isActive(){return this.active}static getWidth(e){return s.scaledCanvas.width/2}static getHeight(e,t){return Cf*e}};h(er,"BaseStatsOverlay");let Dl=er;const Ar=48,Zt=8,xC=6,tr=class tr extends Phaser.GameObjects.Container{active=!1;desc;descScroll=null;descBg;options;textMaskRect;maskPointOriginX;maskPointOriginY;width;constructor(e){super(s,e?.x,e?.y),this.setScale(1),this.options=e||{},this.width=e?.width||tr.getWidth(),this.descBg=Ce(0,0,this.width,Ar),this.descBg.setOrigin(0,0),this.add(this.descBg),this.desc=P(Zt,Zt-2,"",O.BATTLE_INFO,{wordWrap:{width:(this.width-(Zt-2)*2)*xC}}),this.maskPointOriginX=e?.x||0,this.maskPointOriginY=e?.y||0,this.maskPointOriginX<0&&(this.maskPointOriginX+=s.scaledCanvas.width),this.maskPointOriginY<0&&(this.maskPointOriginY+=s.scaledCanvas.height),this.textMaskRect=s.make.graphics(),this.textMaskRect.fillStyle(16711680),this.textMaskRect.fillRect(this.maskPointOriginX+Zt,this.maskPointOriginY+(Zt-2),this.width-Zt*2,Ar-(Zt-2)*2),this.textMaskRect.setScale(6);const t=this.createGeometryMask(this.textMaskRect);this.add(this.desc),this.desc.setMask(t),e?.hideBg&&this.descBg.setVisible(!1),this.setVisible(!1)}show(e){if(!s.enableMoveInfo)return!1;this.desc.setText(e??""),this.descScroll&&(this.descScroll.remove(),this.descScroll=null,this.desc.y=Zt-2);const t=Math.floor(this.desc.displayHeight*(96/72)/14.83),i=t>=3?48:t===2?36:24;this.textMaskRect.clear(),this.textMaskRect.fillStyle(16711680),this.textMaskRect.fillRect(this.maskPointOriginX+Zt,this.maskPointOriginY+(Zt-2)+(48-i),this.width-Zt*2,i-(Zt-2)*2);const n=this.createGeometryMask(this.textMaskRect);return this.desc.setMask(n),this.descBg.setSize(this.descBg.width,i),this.descBg.setY(48-i),this.desc.setY(Zt-2+(48-i)),t>3&&(this.descScroll=s.tweens.add({targets:this.desc,delay:ge(2e3),loop:-1,hold:ge(2e3),duration:ge((t-3)*2e3),y:`-=${14.83*(72/96)*(t-3)}`})),this.options.delayVisibility||this.setVisible(!0),this.active=!0,!0}clear(){this.setVisible(!1),this.active=!1}toggleInfo(e){e&&this.setVisible(!0),s.tweens.add({targets:this.desc,duration:ge(125),ease:"Sine.easeInOut",alpha:e?1:0}),e||this.setVisible(!1)}isActive(){return this.active}static getWidth(){return s.scaledCanvas.width/2}static getHeight(){return Ar}};h(tr,"PokedexInfoOverlay");let Ua=tr;function Jn(T){return T<Me.NORMAL||T>Me.FAIRY?0n:1n<<BigInt(T)}h(Jn,"getRibbonForType");function _C(T){return T<1||T>9?0n:1n<<BigInt(17+T)}h(_C,"getRibbonForGeneration");function wC(T){const e=[];let t=1n;for(;t<=T;)(T&t)!==0n&&e.push(t),t<<=1n;return e}h(wC,"extractRibbons");function MC(T){const e=[ae.CLASSIC,ae.NUZLOCKE,ae.FRIENDSHIP,ae.FLIP_STATS,ae.INVERSE,ae.FRESH_START,ae.HARDCORE,ae.LIMITED_CATCH,ae.NO_HEAL,ae.NO_SHOP,ae.NO_SUPPORT];let t=0n;const i=[T.speciesId];for(;i.length>0;){const a=i.pop();if(a==null)continue;const r=zt(a);t|=_C(r.generation),t|=Jn(r.type1),r.type2!=null&&(t|=Jn(r.type2));for(const o of r.forms)t|=Jn(o.type1),o.type2!=null&&(t|=Jn(o.type2));a&&hi.hasOwnProperty(a)&&hi[a].forEach(o=>{i.push(o.speciesId)})}const n=wC(t);return e.concat(n)}h(MC,"getAvailableRibbons");function kC(T){switch(T){case ae.CLASSIC:return"classic";case ae.NUZLOCKE:return"nuzlocke";case ae.FRIENDSHIP:return"friendship";case ae.FLIP_STATS:return"flipStats";case ae.INVERSE:return"inverse";case ae.FRESH_START:return"freshStart";case ae.HARDCORE:return"hardcore";case ae.LIMITED_CATCH:return"limitedCatch";case ae.NO_HEAL:return"noHeal";case ae.NO_SHOP:return"noShop";case ae.NO_SUPPORT:return"noSupport";case ae.MONO_NORMAL:return"monoNormal";case ae.MONO_FIGHTING:return"monoFighting";case ae.MONO_FLYING:return"monoFlying";case ae.MONO_POISON:return"monoPoison";case ae.MONO_GROUND:return"monoGround";case ae.MONO_ROCK:return"monoRock";case ae.MONO_BUG:return"monoBug";case ae.MONO_GHOST:return"monoGhost";case ae.MONO_STEEL:return"monoSteel";case ae.MONO_FIRE:return"monoFire";case ae.MONO_WATER:return"monoWater";case ae.MONO_GRASS:return"monoGrass";case ae.MONO_ELECTRIC:return"monoElectric";case ae.MONO_PSYCHIC:return"monoPsychic";case ae.MONO_ICE:return"monoIce";case ae.MONO_DRAGON:return"monoDragon";case ae.MONO_DARK:return"monoDark";case ae.MONO_FAIRY:return"monoFairy";case ae.MONO_GEN_1:return"monoGen1";case ae.MONO_GEN_2:return"monoGen2";case ae.MONO_GEN_3:return"monoGen3";case ae.MONO_GEN_4:return"monoGen4";case ae.MONO_GEN_5:return"monoGen5";case ae.MONO_GEN_6:return"monoGen6";case ae.MONO_GEN_7:return"monoGen7";case ae.MONO_GEN_8:return"monoGen8";case ae.MONO_GEN_9:return"monoGen9";default:return""}}h(kC,"getRibbonKey");const NC=[ae.CLASSIC,ae.FRIENDSHIP,ae.FRESH_START,ae.HARDCORE,ae.LIMITED_CATCH,ae.NUZLOCKE,ae.NO_HEAL,ae.NO_SHOP,ae.NO_SUPPORT,ae.MONO_GEN_1,ae.MONO_GEN_2,ae.MONO_GEN_3,ae.MONO_GEN_4,ae.MONO_GEN_5,ae.MONO_GEN_6,ae.MONO_GEN_7,ae.MONO_GEN_8,ae.MONO_GEN_9,ae.MONO_NORMAL,ae.MONO_FIGHTING,ae.MONO_FLYING,ae.MONO_POISON,ae.MONO_GROUND,ae.MONO_ROCK,ae.MONO_BUG,ae.MONO_GHOST,ae.MONO_STEEL,ae.MONO_FIRE,ae.MONO_WATER,ae.MONO_GRASS,ae.MONO_ELECTRIC,ae.MONO_PSYCHIC,ae.MONO_ICE,ae.MONO_DRAGON,ae.MONO_DARK,ae.MONO_FAIRY,ae.INVERSE,ae.FLIP_STATS],Ed=class Ed extends Phaser.GameObjects.Container{trayBg;ribbons=[];trayIcons=[];trayNumIcons;trayRows;trayColumns;trayCursorObj;trayCursor=0;handler;ribbonData;maxColumns=6;constructor(e,t,i){super(s,t,i),this.handler=e,this.setup()}setup(){this.trayBg=Ce(0,0,0,0).setOrigin(0),this.add(this.trayBg),this.trayCursorObj=s.add.image(0,0,"select_cursor").setOrigin(0),this.add(this.trayCursorObj)}processInput(e){let t=!1;const i=this.trayIcons.length,n=Math.ceil(i/this.maxColumns),a=Math.floor(this.trayCursor/this.maxColumns);switch(e){case b.UP:if(a>0)t=this.setTrayCursor(this.trayCursor-this.maxColumns);else{const r=this.trayCursor;i%this.maxColumns>r?t=this.setTrayCursor(i-i%this.maxColumns+r):t=this.setTrayCursor(Math.max(i-i%this.maxColumns+r-this.maxColumns,0))}break;case b.DOWN:a<n-1&&this.trayCursor+this.maxColumns<i?t=this.setTrayCursor(this.trayCursor+this.maxColumns):t=this.setTrayCursor(this.trayCursor%this.maxColumns);break;case b.LEFT:this.trayCursor!==0?t=this.setTrayCursor(this.trayCursor-1):t=this.setTrayCursor(i-1);break;case b.RIGHT:this.trayCursor!==i-1?t=this.setTrayCursor(this.trayCursor+1):t=this.setTrayCursor(0);break;case b.CANCEL:t=this.close();break}return t}setTrayCursor(e){e=Phaser.Math.Clamp(this.trayIcons.length-1,e,0);const t=this.trayCursor!==e;t&&(this.trayCursor=e),this.trayCursorObj.setPosition(5+e%this.maxColumns*18,4+Math.floor(e/this.maxColumns)*17);const i=f.t(`ribbons:${kC(this.ribbons[e])}`);return this.handler.showText(i),t}open(e){const t=this.ribbons=[];this.ribbonData=s.gameData.dexData[e.speciesId].ribbons,this.trayIcons=[];let i=0;const n=MC(e),a=NC.filter(o=>n.includes(o)),r=s.gameData.starterData[e.speciesId]?.classicWinCount??0;for(const o of a){const l=o===ae.CLASSIC&&r>0,c=(o===ae.NO_HEAL||o===ae.NO_SHOP)&&this.ribbonData.has(ae.NO_SUPPORT),u=this.ribbonData.has(o)||l||c;if(!u&&!s.dexForDevs&&!s.showMissingRibbons)continue;t.push(o);const p=Py(o);u||s.dexForDevs?p.clearTint():p.setTint(0),(u||s.dexForDevs||s.showMissingRibbons)&&(p.setPosition(14+i%this.maxColumns*18,14+Math.floor(i/this.maxColumns)*17),this.add(p),this.trayIcons.push(p),i++)}return this.trayNumIcons=t.length,this.trayRows=Math.floor(this.trayNumIcons/this.maxColumns)+(this.trayNumIcons%this.maxColumns===0?0:1),this.trayColumns=Math.min(this.trayNumIcons,this.maxColumns),this.trayBg.setSize(15+this.trayColumns*17,8+this.trayRows*18),this.setVisible(!0).setTrayCursor(0),!0}close(){return this.trayIcons.forEach(e=>{this.remove(e,!0)}),this.trayIcons=[],this.ribbons=[],this.setVisible(!1),!0}};h(Ed,"RibbonTray");let Fl=Ed;const Sf={en:{starterInfoTextSize:"56px",instructionTextSize:"38px"},de:{starterInfoTextSize:"54px",instructionTextSize:"35px",starterInfoXPos:35},"es-ES":{starterInfoTextSize:"50px",instructionTextSize:"38px",starterInfoYOffset:.5,starterInfoXPos:38},"es-419":{starterInfoTextSize:"50px",instructionTextSize:"38px",starterInfoYOffset:.5,starterInfoXPos:38},fr:{starterInfoTextSize:"54px",instructionTextSize:"38px"},it:{starterInfoTextSize:"56px",instructionTextSize:"38px"},"pt-BR":{starterInfoTextSize:"48px",instructionTextSize:"42px",starterInfoYOffset:.5,starterInfoXPos:33},zh:{starterInfoTextSize:"56px",instructionTextSize:"36px",starterInfoXPos:26},ko:{starterInfoTextSize:"60px",instructionTextSize:"38px",starterInfoYOffset:-.5,starterInfoXPos:30},ja:{starterInfoTextSize:"48px",instructionTextSize:"40px",starterInfoYOffset:1,starterInfoXPos:32},ca:{starterInfoTextSize:"48px",instructionTextSize:"38px",starterInfoYOffset:.5,starterInfoXPos:29},da:{starterInfoTextSize:"56px",instructionTextSize:"38px"},tr:{starterInfoTextSize:"56px",instructionTextSize:"38px"},ro:{starterInfoTextSize:"56px",instructionTextSize:"38px"},ru:{starterInfoTextSize:"46px",instructionTextSize:"38px",starterInfoYOffset:.5,starterInfoXPos:26},id:{starterInfoTextSize:"56px",instructionTextSize:"38px"},hi:{starterInfoTextSize:"56px",instructionTextSize:"38px"},"nb-NO":{starterInfoTextSize:"56px",instructionTextSize:"38px"}},Ef=2,PC=109;var en=(T=>(T[T.BASE_STATS=0]="BASE_STATS",T[T.ABILITIES=1]="ABILITIES",T[T.LEVEL_MOVES=2]="LEVEL_MOVES",T[T.EGG_MOVES=3]="EGG_MOVES",T[T.TM_MOVES=4]="TM_MOVES",T[T.BIOMES=5]="BIOMES",T[T.NATURES=6]="NATURES",T[T.RIBBONS=7]="RIBBONS",T[T.EVOLUTIONS=8]="EVOLUTIONS",T))(en||{});const bd=class bd extends Vt{starterSelectContainer;shinyOverlay;starterDexNoLabel;pokemonNumberText;pokemonSprite;pokemonNameText;pokemonGrowthRateLabelText;pokemonGrowthRateText;type1Icon;type2Icon;pokemonLuckLabelText;pokemonLuckText;pokemonGenderText;pokemonUncaughtText;pokemonCandyContainer;pokemonCandyIcon;pokemonCandyDarknessOverlay;pokemonCandyOverlayIcon;pokemonCandyCountText;pokemonCaughtHatchedContainer;pokemonCaughtCountText;pokemonFormText;pokemonCategoryText;pokemonHatchedIcon;pokemonHatchedCountText;pokemonShinyIcons;activeTooltip;instructionsContainer;filterInstructionsContainer;shinyIconElement;formIconElement;genderIconElement;ivIconElement;shinyLabel;formLabel;genderLabel;ivLabel;candyUpgradeIconElement;candyUpgradeLabel;showBackSpriteIconElement;showBackSpriteLabel;starterSelectMessageBox;starterSelectMessageBoxContainer;statsContainer;moveInfoOverlay;infoOverlay;baseStatsOverlay;statsMode;allSpecies=[];species;starterId;formIndex;speciesLoaded=new Map;levelMoves;eggMoves=[];hasEggMoves=[];tmMoves=[];ability1;ability2;abilityHidden;passive;hasPassive;hasAbilities;biomes;preBiomes;baseStats;baseTotal;evolutions;battleForms;prevolutions;speciesStarterDexEntry;canCycleShiny;canCycleForm;canCycleGender;assetLoadCancelled;cursorObj;instructionRowX=0;instructionRowY=0;instructionRowTextOffset=9;starterAttributes;savedStarterAttributes;previousSpecies;previousStarterAttributes;blockInput=!1;blockInputOverlay=!1;showBackSprite=!1;menuContainer;menuBg;optionSelectText;menuOptions;scale=.1666666667;menuDescriptions;isFormGender;filteredIndices=null;availableVariants;unlockedVariants;canUseCandies;exitCallback;ribbonContainer;isRibbonTrayOpen=!1;constructor(){super(x.POKEDEX_PAGE)}setup(){const e=this.getUi(),t=f.resolvedLanguage??"en",i=Object.keys(Sf).find(u=>t.includes(u))??"en",n=Sf[i];this.starterSelectContainer=s.add.container(0,-s.scaledCanvas.height),this.starterSelectContainer.setVisible(!1),e.add(this.starterSelectContainer);const a=s.add.rectangle(0,0,s.scaledCanvas.width,s.scaledCanvas.height,26720);a.setOrigin(0,0),this.starterSelectContainer.add(a);const r=s.add.image(0,0,"pokedex_summary_bg");r.setOrigin(0,0),this.starterSelectContainer.add(r),this.pokemonSprite=s.add.sprite(53,63,"pkmn__sub"),this.pokemonSprite.setPipeline(s.spritePipeline,{tone:[0,0,0,0],ignoreTimeTint:!0}),this.starterSelectContainer.add(this.pokemonSprite),this.starterDexNoLabel=s.add.image(6,14,Kt("summary_dexnb_label")),this.starterDexNoLabel.setOrigin(0,1),this.starterSelectContainer.add(this.starterDexNoLabel),this.shinyOverlay=s.add.image(6,111,Kt("summary_dexnb_label_overlay_shiny")),this.shinyOverlay.setOrigin(0,1),this.shinyOverlay.setVisible(!1),this.starterSelectContainer.add(this.shinyOverlay),this.pokemonNumberText=P(17,1,"0000",O.SUMMARY_DEX_NUM),this.pokemonNumberText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonNumberText),this.pokemonNameText=P(6,112,"",O.SUMMARY),this.pokemonNameText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonNameText),this.pokemonGrowthRateLabelText=P(8,106,f.t("pokedexUiHandler:growthRate"),O.SUMMARY_ALT,{fontSize:"36px"}),this.pokemonGrowthRateLabelText.setOrigin(0,0),this.pokemonGrowthRateLabelText.setVisible(!1),this.starterSelectContainer.add(this.pokemonGrowthRateLabelText),this.pokemonGrowthRateText=P(34,106,"",O.GROWTH_RATE_TYPE,{fontSize:"36px"}),this.pokemonGrowthRateText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonGrowthRateText),this.pokemonGenderText=P(96,112,"",O.SUMMARY_ALT),this.pokemonGenderText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonGenderText),this.pokemonUncaughtText=P(6,127,f.t("pokedexUiHandler:uncaught"),O.WINDOW,{fontSize:"56px"}),this.pokemonUncaughtText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonUncaughtText);const o=s.add.container(PC+6,9);for(const u of it)!$e.hasOwnProperty(u.speciesId)||!u.isObtainable()||(this.speciesLoaded.set(u.speciesId,!1),this.allSpecies.push(u));this.starterSelectContainer.add(o),this.type1Icon=s.add.sprite(8,98,Kt("types")),this.type1Icon.setScale(.5),this.type1Icon.setOrigin(0,0),this.starterSelectContainer.add(this.type1Icon),this.type2Icon=s.add.sprite(26,98,Kt("types")),this.type2Icon.setScale(.5),this.type2Icon.setOrigin(0,0),this.starterSelectContainer.add(this.type2Icon),this.pokemonLuckLabelText=P(8,89,f.t("common:luckIndicator"),O.WINDOW_ALT,{fontSize:"56px"}),this.pokemonLuckLabelText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonLuckLabelText),this.pokemonLuckText=P(8+this.pokemonLuckLabelText.displayWidth+2,89,"0",O.LUCK_VALUE,{fontSize:"56px"}),this.pokemonLuckText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonLuckText),this.pokemonCandyContainer=s.add.container(4.5,18),this.pokemonCandyIcon=s.add.sprite(0,0,"candy"),this.pokemonCandyIcon.setScale(.5),this.pokemonCandyIcon.setOrigin(0,0),this.pokemonCandyContainer.add(this.pokemonCandyIcon),this.pokemonCandyOverlayIcon=s.add.sprite(0,0,"candy_overlay"),this.pokemonCandyOverlayIcon.setScale(.5),this.pokemonCandyOverlayIcon.setOrigin(0,0),this.pokemonCandyContainer.add(this.pokemonCandyOverlayIcon),this.pokemonCandyDarknessOverlay=s.add.sprite(0,0,"candy"),this.pokemonCandyDarknessOverlay.setScale(.5),this.pokemonCandyDarknessOverlay.setOrigin(0,0),this.pokemonCandyDarknessOverlay.setTint(0),this.pokemonCandyDarknessOverlay.setAlpha(.5),this.pokemonCandyContainer.add(this.pokemonCandyDarknessOverlay),this.pokemonCandyCountText=P(9.5,0,"x0",O.WINDOW_ALT,{fontSize:"56px"}),this.pokemonCandyCountText.setOrigin(0,0),this.pokemonCandyContainer.add(this.pokemonCandyCountText),this.pokemonCandyContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,30,20),Phaser.Geom.Rectangle.Contains),this.starterSelectContainer.add(this.pokemonCandyContainer),this.pokemonFormText=P(6,42,"Form",O.WINDOW_ALT,{fontSize:"42px"}),this.pokemonFormText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonFormText),this.pokemonCategoryText=P(100,18,"Category",O.WINDOW_ALT,{fontSize:"42px"}),this.pokemonCategoryText.setOrigin(1,0),this.starterSelectContainer.add(this.pokemonCategoryText),this.pokemonCaughtHatchedContainer=s.add.container(2,25),this.pokemonCaughtHatchedContainer.setScale(.5),this.starterSelectContainer.add(this.pokemonCaughtHatchedContainer);const l=s.add.sprite(1,0,"items","pb");l.setOrigin(0,0),l.setScale(.75),this.pokemonCaughtHatchedContainer.add(l),this.pokemonCaughtCountText=P(24,4,"0",O.SUMMARY_ALT),this.pokemonCaughtCountText.setOrigin(0,0),this.pokemonCaughtHatchedContainer.add(this.pokemonCaughtCountText),this.pokemonHatchedIcon=s.add.sprite(1,14,"egg_icons"),this.pokemonHatchedIcon.setOrigin(.15,.2),this.pokemonHatchedIcon.setScale(.8),this.pokemonCaughtHatchedContainer.add(this.pokemonHatchedIcon),this.pokemonShinyIcons=[];for(let u=0;u<3;u++){const p=s.add.sprite(153+u*13,160,"shiny_icons");p.setOrigin(.15,.2),p.setScale(1),p.setFrame(os(u)),p.setVisible(!1),this.pokemonCaughtHatchedContainer.add(p),this.pokemonShinyIcons.push(p)}this.pokemonHatchedCountText=P(24,19,"0",O.SUMMARY_ALT),this.pokemonHatchedCountText.setOrigin(0,0),this.pokemonCaughtHatchedContainer.add(this.pokemonHatchedCountText);const c=n.instructionTextSize;this.instructionsContainer=s.add.container(4,128),this.instructionsContainer.setVisible(!0),this.starterSelectContainer.add(this.instructionsContainer),this.candyUpgradeIconElement=new Phaser.GameObjects.Sprite(s,this.instructionRowX,this.instructionRowY,"keyboard","C.png"),this.candyUpgradeIconElement.setName("sprite-candyUpgrade-icon-element"),this.candyUpgradeIconElement.setScale(.675),this.candyUpgradeIconElement.setOrigin(0,0),this.candyUpgradeLabel=P(this.instructionRowX+this.instructionRowTextOffset,this.instructionRowY,f.t("pokedexUiHandler:candyUpgrade"),O.INSTRUCTIONS_TEXT,{fontSize:c}),this.candyUpgradeLabel.setName("text-candyUpgrade-label"),this.shinyIconElement=new Phaser.GameObjects.Sprite(s,this.instructionRowX,this.instructionRowY,"keyboard","R.png"),this.shinyIconElement.setName("sprite-shiny-icon-element"),this.shinyIconElement.setScale(.675),this.shinyIconElement.setOrigin(0,0),this.shinyLabel=P(this.instructionRowX+this.instructionRowTextOffset,this.instructionRowY,f.t("pokedexUiHandler:cycleShiny"),O.INSTRUCTIONS_TEXT,{fontSize:c}),this.shinyLabel.setName("text-shiny-label"),this.formIconElement=new Phaser.GameObjects.Sprite(s,this.instructionRowX,this.instructionRowY,"keyboard","F.png"),this.formIconElement.setName("sprite-form-icon-element"),this.formIconElement.setScale(.675),this.formIconElement.setOrigin(0,0),this.formLabel=P(this.instructionRowX+this.instructionRowTextOffset,this.instructionRowY,f.t("pokedexUiHandler:cycleForm"),O.INSTRUCTIONS_TEXT,{fontSize:c}),this.formLabel.setName("text-form-label"),this.genderIconElement=new Phaser.GameObjects.Sprite(s,this.instructionRowX,this.instructionRowY,"keyboard","G.png"),this.genderIconElement.setName("sprite-gender-icon-element"),this.genderIconElement.setScale(.675),this.genderIconElement.setOrigin(0,0),this.genderLabel=P(this.instructionRowX+this.instructionRowTextOffset,this.instructionRowY,f.t("pokedexUiHandler:cycleGender"),O.INSTRUCTIONS_TEXT,{fontSize:c}),this.genderLabel.setName("text-gender-label"),this.ivIconElement=new Phaser.GameObjects.Sprite(s,this.instructionRowX,this.instructionRowY,"keyboard","V.png"),this.ivIconElement.setName("sprite-variant-icon-element"),this.ivIconElement.setScale(.675),this.ivIconElement.setOrigin(0,0),this.ivLabel=P(this.instructionRowX+this.instructionRowTextOffset,this.instructionRowY,f.t("pokedexUiHandler:toggleIVs"),O.INSTRUCTIONS_TEXT,{fontSize:c}),this.ivLabel.setName("text-iv-label"),this.showBackSpriteIconElement=new Phaser.GameObjects.Sprite(s,50,7,"keyboard","E.png"),this.showBackSpriteIconElement.setName("show-backSprite-icon-element"),this.showBackSpriteIconElement.setScale(.675),this.showBackSpriteIconElement.setOrigin(0,0),this.showBackSpriteLabel=P(60,7,f.t("pokedexUiHandler:showBackSprite"),O.INSTRUCTIONS_TEXT,{fontSize:c}),this.showBackSpriteLabel.setName("show-backSprite-label"),this.starterSelectContainer.add(this.showBackSpriteIconElement),this.starterSelectContainer.add(this.showBackSpriteLabel),this.hideInstructions(),this.filterInstructionsContainer=s.add.container(50,5),this.filterInstructionsContainer.setVisible(!0),this.starterSelectContainer.add(this.filterInstructionsContainer),this.starterSelectMessageBoxContainer=s.add.container(0,s.scaledCanvas.height),this.starterSelectMessageBoxContainer.setVisible(!1),this.starterSelectContainer.add(this.starterSelectMessageBoxContainer),this.starterSelectMessageBox=Ce(1,-1,318,28),this.starterSelectMessageBox.setOrigin(0,1),this.starterSelectMessageBoxContainer.add(this.starterSelectMessageBox),this.message=P(8,8,"",O.WINDOW,{maxLines:2}),this.message.setOrigin(0,0),this.starterSelectMessageBoxContainer.add(this.message),this.initPromptSprite(this.starterSelectMessageBoxContainer),this.statsContainer=new yn(6,16),s.add.existing(this.statsContainer),this.statsContainer.setVisible(!1),this.starterSelectContainer.add(this.statsContainer),this.menuContainer=s.add.container(-130,0),this.menuContainer.setName("menu"),this.menuContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,s.scaledCanvas.width,s.scaledCanvas.height),Phaser.Geom.Rectangle.Contains),this.menuContainer.setVisible(!1),this.menuOptions=ks(en),this.optionSelectText=It(0,0,this.menuOptions.map(u=>`${f.t(`pokedexUiHandler:${bt(`menu${en[u]}`)}`)}`).join(`
`),O.WINDOW,{maxLines:this.menuOptions.length,lineSpacing:12}),this.menuDescriptions=[f.t("pokedexUiHandler:showBaseStats"),f.t("pokedexUiHandler:showAbilities"),f.t("pokedexUiHandler:showLevelMoves"),f.t("pokedexUiHandler:showEggMoves"),f.t("pokedexUiHandler:showTmMoves"),f.t("pokedexUiHandler:showBiomes"),f.t("pokedexUiHandler:showNatures"),f.t("pokedexUiHandler:showRibbons"),f.t("pokedexUiHandler:showEvolutions")],this.scale=Vi(O.WINDOW).scale,this.menuBg=Ce(s.scaledCanvas.width-83,0,this.optionSelectText.displayWidth+19+24*this.scale,s.scaledCanvas.height-2),this.menuBg.setOrigin(0,0),this.optionSelectText.setPosition(this.menuBg.x+10+24*this.scale,this.menuBg.y+6),this.menuContainer.add(this.menuBg),this.menuContainer.add(this.optionSelectText),e.add(this.menuContainer),this.starterSelectContainer.add(this.menuContainer),this.baseStatsOverlay=new Dl({x:317,y:0,width:133}),this.menuContainer.add(this.baseStatsOverlay),this.menuContainer.bringToTop(this.baseStatsOverlay),this.moveInfoOverlay=new si({top:!0,x:1,y:s.scaledCanvas.height-si.getHeight()-29}),this.starterSelectContainer.add(this.moveInfoOverlay),this.infoOverlay=new Ua({x:1,y:s.scaledCanvas.height-Ua.getHeight()-29}),this.starterSelectContainer.add(this.infoOverlay),this.ribbonContainer=new Fl(this,192,0),this.starterSelectContainer.add(this.ribbonContainer),this.ribbonContainer.setVisible(!1),this.starterSelectContainer.bringToTop(this.starterSelectMessageBoxContainer),this.previousSpecies=[],this.previousStarterAttributes=[]}show(e){return this.canUseCandies=["TitlePhase","SelectStarterPhase","CommandPhase"].includes(s.phaseManager.getCurrentPhase().phaseName),e.length>0&&e[0]==="refresh"?!1:(this.species=e[0],this.savedStarterAttributes=e[1]??{shiny:!1,female:!0,variant:0,form:0},this.formIndex=this.savedStarterAttributes.form??0,this.filteredIndices=e[2]??null,this.starterSetup(),e[4]instanceof Function&&(this.exitCallback=e[4]),this.moveInfoOverlay.clear(),this.infoOverlay.clear(),super.show(e),this.starterSelectContainer.setVisible(!0),this.getUi().bringToTop(this.starterSelectContainer),this.starterAttributes=this.initStarterPrefs(),this.menuOptions=ks(en),this.menuContainer.setVisible(!0),this.speciesStarterDexEntry=this.species?s.gameData.dexData[this.species.speciesId]:null,this.setSpecies(),this.updateInstructions(),this.optionSelectText.setText(this.getMenuText()),this.setCursor(0),!0)}getMenuText(){const e=this.isSeen(),t=!!this.isCaught(this.getStarterSpecies(this.species));return this.menuOptions.map(i=>{const n=f.t(`pokedexUiHandler:${bt(`menu${en[i]}`)}`),a=!e||!t&&(i===6||i===7)||this.tmMoves.length===0&&i===4||!s.gameData.dexData[this.species.speciesId].ribbons.getRibbons()&&i===7&&!s.showMissingRibbons&&!s.gameData.starterData[this.species.speciesId]?.classicWinCount,r=le(a?O.SHADOW_TEXT:O.SETTINGS_VALUE,!1);return`[shadow=${le(a?O.SHADOW_TEXT:O.SETTINGS_VALUE,!0)}][color=${r}]${n}[/color][/shadow]`}).join(`
`)}starterSetup(){this.evolutions=[],this.prevolutions=[],this.battleForms=[];const e=this.species;let t=this.species?.forms.length>0?this.species.forms[this.formIndex].formKey:"";this.isFormGender=t==="male"||t==="female",this.isFormGender&&(this.savedStarterAttributes.female===!0&&t==="male"||this.savedStarterAttributes.female===!1&&t==="female")&&(this.formIndex=(this.formIndex+1)%2,t=this.species.forms[this.formIndex].formKey);const i=this.formIndex??0;this.starterId=this.getStarterSpeciesId(this.species.speciesId);const n=hi.hasOwnProperty(e.speciesId)?hi[e.speciesId]:[];if(e.forms.length>0){const g=e.forms[i];this.levelMoves=i>0&&Ms.hasOwnProperty(e.speciesId)&&Ms[e.speciesId].hasOwnProperty(i)?Ms[e.speciesId][i]:ya[e.speciesId],this.ability1=g.ability1,this.ability2=g.ability2===g.ability1?void 0:g.ability2,this.abilityHidden=g.abilityHidden===g.ability1?void 0:g.abilityHidden,this.evolutions=n.filter(C=>C.preFormKey===g.formKey||C.preFormKey===null),this.baseStats=g.baseStats,this.baseTotal=g.baseTotal}else this.levelMoves=ya[e.speciesId],this.ability1=e.ability1,this.ability2=e.ability2===e.ability1?void 0:e.ability2,this.abilityHidden=e.abilityHidden===e.ability1?void 0:e.abilityHidden,this.evolutions=n,this.baseStats=e.baseStats,this.baseTotal=e.baseTotal;this.eggMoves=Ht[this.starterId]??[],this.hasEggMoves=Array.from({length:4},(g,C)=>(s.gameData.starterData[this.starterId].eggMoves&1<<C)!==0),this.tmMoves=fg[e.speciesId]?.filter(g=>Array.isArray(g)?g[0]===t:!0).map(g=>Array.isArray(g)?g[1]:g).sort((g,C)=>We[g].name>We[C].name?1:-1)??[];const a=mr.hasOwnProperty(e.speciesId)?e.speciesId:mr.hasOwnProperty(this.starterId)?this.starterId:Bt[this.starterId],r=mr[a];this.passive=this.formIndex in r?r[i]:r[0];const o=s.gameData.starterData[this.starterId],l=o.abilityAttr;this.hasPassive=o.passiveAttr>0;const c=l&ht.ABILITY_1,u=l&ht.ABILITY_2,p=l&ht.ABILITY_HIDDEN;this.hasAbilities=[c,u,p];const m=Ta[e.speciesId]??[];this.preBiomes=this.sanitizeBiomes((Ta[this.starterId]??[]).filter(g=>!m.some(C=>g.biome===C.biome&&g.tier===C.tier)&&g.biome!==Je.TOWN),this.starterId),this.biomes=this.sanitizeBiomes(m,e.speciesId);const d=fi.hasOwnProperty(e.speciesId)?fi[e.speciesId]:[];this.battleForms=d.filter(g=>g.preFormKey===this.species.forms[this.formIndex].formKey);const y=Bt.hasOwnProperty(this.species.speciesId)?it.find(g=>g.speciesId===Bt[this.species.speciesId]):null;if(y){const g=hi.hasOwnProperty(y.speciesId)?hi[y.speciesId]:[];this.prevolutions=g.filter(C=>C.speciesId===e.speciesId&&((C.evoFormKey===""||C.evoFormKey===null)&&(y.forms.some(E=>E.formKey===e.forms[i]?.formKey)||y.forms.length>0&&e.forms.length===0||y.forms.length===0&&(e.forms.length===0||e.forms[i]?.formKey===""))||C.evoFormKey===e.forms[i]?.formKey))}this.availableVariants=e.getFullUnlocksData()&F.VARIANT_3?3:1}sanitizeBiomes(e,t){return t===ye.BURMY||t===ye.WORMADAM?e.filter(i=>{const n=(()=>{switch(i.biome){case Je.BEACH:return 1;case Je.SLUM:return 2;default:return 0}})();return this.formIndex===n}):t===ye.ROTOM?e.filter(i=>{const n=(()=>{switch(i.biome){case Je.VOLCANO:return 1;case Je.SEA:return 2;case Je.ICE_CAVE:return 3;case Je.MOUNTAIN:return 4;case Je.TALL_GRASS:return 5;default:return 0}})();return this.formIndex===n}):t===ye.LYCANROC?e.filter(i=>{const n=(()=>{switch(i.tod[0]){case hs.DAY:case hs.DAWN:return 0;case hs.DUSK:return 2;case hs.NIGHT:return 1;default:return 0}})();return this.formIndex===n}):e}isCaught(e){const t=e||this.species;return s.dexForDevs&&t.getFullUnlocksData(),(s.gameData.dexData[t.speciesId]?.caughtAttr??0n)&t.getFullUnlocksData()}isFormCaught(e,t){if(s.dexForDevs)return!0;const i=e||this.species,n=t!==void 0?t:this.formIndex,a=this.isCaught(i);return a&&(i.forms.length===0||i.forms.length===1)?!0:(a&s.gameData.getFormAttr(n??0))>0n}isSeen(){return this.speciesStarterDexEntry?.seenAttr?!0:!!this.isCaught(this.getStarterSpecies(this.species))}initStarterPrefs(){const e=this.species?{...this.savedStarterAttributes}:null,t=this.isCaught();if(!e||!this.isSeen())return{};const i=t&F.SHINY,n=t&F.NON_SHINY;if(!i||e.shiny===void 0&&n?(e.shiny=!1,e.variant=0):(!n||e.shiny===void 0&&i)&&(e.shiny=!0,e.variant=0),this.unlockedVariants=[!!(i&&t&F.DEFAULT_VARIANT),!!(i&&t&F.VARIANT_2),!!(i&&t&F.VARIANT_3)],e.variant===void 0||Number.isNaN(e.variant)||e.variant<0)e.variant=0;else if(!this.unlockedVariants[e.variant]){let a=-1;for(let r=0;r<=e.variant&&r<this.unlockedVariants.length;r++)this.unlockedVariants[r]&&(a=r);e.variant=a!==-1?a:0}return e.female!==void 0?(e.female&&!(t&F.FEMALE)||!e.female&&!(t&F.MALE))&&(e.female=!e.female):t&F.FEMALE?e.female=!0:t&F.MALE&&(e.female=!1),e}showText(e,t,i,n,a,r,o){super.showText(e,t,i,n,a,r);const l=e?.indexOf(`
`)===-1;this.starterSelectMessageBox.setSize(318,l?28:42),o?(this.starterSelectMessageBox.setOrigin(0,0),this.starterSelectMessageBoxContainer.setY(0),this.message.setY(4)):(this.starterSelectMessageBoxContainer.setY(s.scaledCanvas.height),this.starterSelectMessageBox.setOrigin(0,1),this.message.setY(l?-22:-37)),this.starterSelectMessageBoxContainer.setVisible(e?.length>0)}isUpgradeIconEnabled(){return s.candyUpgradeNotification!==0&&s.candyUpgradeDisplay===0}isUpgradeAnimationEnabled(){return s.candyUpgradeNotification!==0&&s.candyUpgradeDisplay===1}getStarterSpeciesId(e){return e===ye.PIKACHU?[0,1,8].includes(this.formIndex)?ye.PICHU:ye.PIKACHU:$e.hasOwnProperty(e)?e:Gr[e]}getStarterSpecies(e){return $e.hasOwnProperty(e.speciesId)?e:it.find(t=>t.speciesId===Gr[e.speciesId])??e}processInput(e){if(this.blockInput)return!1;const t=this.getUi();let i=!1,n=!1;const a=this.isCaught(),r=this.isFormCaught(),o=this.isSeen(),l=!!this.isCaught(this.getStarterSpecies(this.species));if(this.isRibbonTrayOpen)return e===b.CANCEL?(this.isRibbonTrayOpen=!1,this.ribbonContainer.close(),this.setCursor(7),t.playSelect(),i):this.ribbonContainer.processInput(e);if(this.blockInputOverlay){if(e===b.CANCEL||e===b.ACTION)return this.blockInputOverlay=!1,this.baseStatsOverlay.clear(),t.showText(""),!0;if(e===b.UP||e===b.DOWN)this.blockInputOverlay=!1,this.baseStatsOverlay.clear(),t.showText("");else return!1}if(e===b.SUBMIT)i=!0;else if(e===b.CANCEL)this.statsMode?(this.toggleStatsMode(!1),i=!0):this.previousSpecies.length>0?(this.blockInput=!0,t.setModeWithoutClear(x.OPTION_SELECT).then(()=>{const c=this.previousSpecies.pop(),u=this.previousStarterAttributes.pop();this.moveInfoOverlay.clear(),this.clearText(),t.setModeForceTransition(x.POKEDEX_PAGE,c,u),i=!0}),this.blockInput=!1):(t.revertMode().then(()=>{if(this.exitCallback instanceof Function){const c=this.exitCallback;this.exitCallback=null,c()}}),i=!0);else{const c=s.gameData.starterData[this.starterId],u=this.starterAttributes;if(e===b.ACTION)switch(this.cursor){case 0:o?(this.blockInput=!0,t.setMode(x.POKEDEX_PAGE,"refresh").then(()=>{t.showText(f.t("pokedexUiHandler:showBaseStats"),null,()=>(this.baseStatsOverlay.show(this.baseStats,this.baseTotal),this.blockInput=!1,this.blockInputOverlay=!0,!0)),i=!0})):n=!0;break;case 2:o?(this.blockInput=!0,t.setMode(x.POKEDEX_PAGE,"refresh").then(()=>{t.showText(f.t("pokedexUiHandler:showLevelMoves"),null,()=>{this.moveInfoOverlay.show(We[this.levelMoves[0][1]]),t.setModeWithoutClear(x.OPTION_SELECT,{options:this.levelMoves.map(p=>({label:(p[0]>0?String(p[0]):"").padEnd(4," ")+We[p[1]].name,handler:h(()=>!1,"handler"),onHover:h(()=>{this.moveInfoOverlay.show(We[p[1]]),p[0]===0?this.showText(f.t("pokedexUiHandler:onlyEvolutionMove")):p[0]===-1?this.showText(f.t("pokedexUiHandler:onlyRecallMove")):p[0]<=5?this.showText(f.t("pokedexUiHandler:onStarterSelectMove")):this.showText(f.t("pokedexUiHandler:byLevelUpMove"))},"onHover")})).concat({label:f.t("menu:cancel"),handler:h(()=>(this.moveInfoOverlay.clear(),this.clearText(),t.setMode(x.POKEDEX_PAGE,"refresh"),!0),"handler"),onHover:h(()=>{this.moveInfoOverlay.clear()},"onHover")}),supportHover:!0,maxOptions:8,yOffset:19}),this.blockInput=!1})}),i=!0):n=!0;break;case 3:o?(this.blockInput=!0,t.setMode(x.POKEDEX_PAGE,"refresh").then(()=>{if(this.eggMoves.length===0)return t.showText(f.t("pokedexUiHandler:noEggMoves")),this.blockInput=!1,!0;t.showText(f.t("pokedexUiHandler:showEggMoves"),null,()=>{this.moveInfoOverlay.show(We[this.eggMoves[0]]),t.setModeWithoutClear(x.OPTION_SELECT,{options:[{label:f.t("pokedexUiHandler:common"),skip:!0,style:O.MONEY_WINDOW,handler:h(()=>!1,"handler"),onHover:h(()=>this.moveInfoOverlay.clear(),"onHover")},...this.eggMoves.slice(0,3).map((p,m)=>({label:We[p].name,style:this.hasEggMoves[m]?O.SETTINGS_VALUE:O.SHADOW_TEXT,handler:h(()=>!1,"handler"),onHover:h(()=>this.moveInfoOverlay.show(We[p]),"onHover")})),{label:f.t("pokedexUiHandler:rare"),skip:!0,style:O.MONEY_WINDOW,handler:h(()=>!1,"handler"),onHover:h(()=>this.moveInfoOverlay.clear(),"onHover")},{label:We[this.eggMoves[3]].name,style:this.hasEggMoves[3]?O.SETTINGS_VALUE:O.SHADOW_TEXT,handler:h(()=>!1,"handler"),onHover:h(()=>this.moveInfoOverlay.show(We[this.eggMoves[3]]),"onHover")},{label:f.t("menu:cancel"),handler:h(()=>(this.moveInfoOverlay.clear(),this.clearText(),t.setMode(x.POKEDEX_PAGE,"refresh"),!0),"handler"),onHover:h(()=>this.moveInfoOverlay.clear(),"onHover")}],supportHover:!0,maxOptions:8,yOffset:19}),this.blockInput=!1})}),i=!0):n=!0;break;case 4:o?this.tmMoves.length===0?(t.showText(f.t("pokedexUiHandler:noTmMoves")),n=!0):(this.blockInput=!0,t.setMode(x.POKEDEX_PAGE,"refresh").then(()=>{t.showText(f.t("pokedexUiHandler:showTmMoves"),null,()=>{this.moveInfoOverlay.show(We[this.tmMoves[0]]),t.setModeWithoutClear(x.OPTION_SELECT,{options:this.tmMoves.map(p=>({label:We[p].name,handler:h(()=>!1,"handler"),onHover:h(()=>{this.moveInfoOverlay.show(We[p])},"onHover")})).concat({label:f.t("menu:cancel"),handler:h(()=>(this.moveInfoOverlay.clear(),this.clearText(),t.setMode(x.POKEDEX_PAGE,"refresh"),!0),"handler"),onHover:h(()=>{this.moveInfoOverlay.clear()},"onHover")}),supportHover:!0,maxOptions:8,yOffset:19}),this.blockInput=!1})}),i=!0):n=!0;break;case 1:o?(this.blockInput=!0,t.setMode(x.POKEDEX_PAGE,"refresh").then(()=>{t.showText(f.t("pokedexUiHandler:showAbilities"),null,()=>{this.infoOverlay.show(_t[this.ability1].description);const p=[];if(this.ability1&&p.push({label:_t[this.ability1].name,style:this.hasAbilities[0]>0?O.SETTINGS_VALUE:O.SHADOW_TEXT,handler:h(()=>!1,"handler"),onHover:h(()=>this.infoOverlay.show(_t[this.ability1].description),"onHover")}),this.ability2){const m=_t[this.ability2];p.push({label:m?.name,style:this.hasAbilities[1]>0?O.SETTINGS_VALUE:O.SHADOW_TEXT,handler:h(()=>!1,"handler"),onHover:h(()=>this.infoOverlay.show(m?.description),"onHover")})}if(this.abilityHidden){p.push({label:f.t("pokedexUiHandler:hidden"),skip:!0,style:O.MONEY_WINDOW,handler:h(()=>!1,"handler"),onHover:h(()=>this.infoOverlay.clear(),"onHover")});const m=_t[this.abilityHidden];p.push({label:_t[this.abilityHidden].name,style:this.hasAbilities[2]>0?O.SETTINGS_VALUE:O.SHADOW_TEXT,handler:h(()=>!1,"handler"),onHover:h(()=>this.infoOverlay.show(m?.description),"onHover")})}this.passive&&(p.push({label:f.t("pokedexUiHandler:passive"),skip:!0,style:O.MONEY_WINDOW,handler:h(()=>!1,"handler"),onHover:h(()=>this.infoOverlay.clear(),"onHover")}),p.push({label:_t[this.passive].name,style:this.hasPassive?O.SETTINGS_VALUE:O.SHADOW_TEXT,handler:h(()=>!1,"handler"),onHover:h(()=>this.infoOverlay.show(_t[this.passive].description),"onHover")})),p.push({label:f.t("menu:cancel"),handler:h(()=>(this.infoOverlay.clear(),this.clearText(),t.setMode(x.POKEDEX_PAGE,"refresh"),!0),"handler"),onHover:h(()=>this.infoOverlay.clear(),"onHover")}),t.setModeWithoutClear(x.OPTION_SELECT,{options:p,supportHover:!0,maxOptions:8,yOffset:19}),this.blockInput=!1})}),i=!0):n=!0;break;case 5:o?(this.blockInput=!0,t.setMode(x.POKEDEX_PAGE,"refresh").then(()=>{if((!this.biomes||this.biomes?.length===0)&&(!this.preBiomes||this.preBiomes?.length===0))return t.showText(f.t("pokedexUiHandler:noBiomes")),t.playError(),this.blockInput=!1,!0;const p=[];t.showText(f.t("pokedexUiHandler:showBiomes"),null,()=>{this.biomes.map(m=>{p.push({label:f.t(`biome:${bt(Je[m.biome])}`)+" - "+f.t(`biome:${bt(Jp[m.tier])}`)+(m.tod.length===1&&m.tod[0]===-1?"":" ("+m.tod.map(d=>f.t(`biome:${bt(hs[d])}`)).join(", ")+")"),handler:h(()=>!1,"handler")})}),this.preBiomes.length>0&&(p.push({label:f.t("pokedexUiHandler:preBiomes"),skip:!0,handler:h(()=>!1,"handler")}),this.preBiomes.map(m=>{p.push({label:f.t(`biome:${bt(Je[m.biome])}`)+" - "+f.t(`biome:${bt(Jp[m.tier])}`)+(m.tod.length===1&&m.tod[0]===-1?"":" ("+m.tod.map(d=>f.t(`biome:${bt(hs[d])}`)).join(", ")+")"),handler:h(()=>!1,"handler")})})),p.push({label:f.t("menu:cancel"),handler:h(()=>(this.moveInfoOverlay.clear(),this.clearText(),t.setMode(x.POKEDEX_PAGE,"refresh"),!0),"handler"),onHover:h(()=>this.moveInfoOverlay.clear(),"onHover")}),t.setModeWithoutClear(x.OPTION_SELECT,{options:p,supportHover:!0,maxOptions:8,yOffset:19}),this.blockInput=!1})}),i=!0):n=!0;break;case 8:o?(this.blockInput=!0,t.setMode(x.POKEDEX_PAGE,"refresh").then(()=>{const p=[];if((!this.prevolutions||this.prevolutions?.length===0)&&(!this.evolutions||this.evolutions?.length===0)&&(!this.battleForms||this.battleForms?.length===0))return t.showText(f.t("pokedexUiHandler:noEvolutions")),t.playError(),this.blockInput=!1,!0;t.showText(f.t("pokedexUiHandler:showEvolutions"),null,()=>{this.prevolutions?.length>0&&(p.push({label:f.t("pokedexUiHandler:prevolutions"),style:O.MONEY_WINDOW,skip:!0,handler:h(()=>!1,"handler")}),this.prevolutions.map(m=>{const d=it.find(C=>C.speciesId===Bt[this.species.speciesId]),y=d?.forms.find(C=>C.formKey===m.preFormKey)?.formIndex??0,g=m.description;p.push({label:m.preFormKey?(d??this.species).getFormNameToDisplay(y,!0):(d??this.species).getExpandedSpeciesName(),handler:h(()=>{this.previousSpecies.push(this.species),this.previousStarterAttributes.push({...this.savedStarterAttributes});const C=it.find(_=>_.speciesId===Bt[m.speciesId]),E=m.preFormKey?m.preFormKey:this.species.forms.length>0?this.species.forms[this.formIndex].formKey:"",I=C?.forms.find(_=>_.formKey===E),A=I?I.formIndex:0;return this.starterAttributes.form=A,this.savedStarterAttributes.form=A,this.moveInfoOverlay.clear(),this.clearText(),t.setMode(x.POKEDEX_PAGE,C,this.savedStarterAttributes),!0},"handler"),onHover:h(()=>this.showText(g),"onHover")})})),this.evolutions.length>0&&(p.push({label:f.t("pokedexUiHandler:evolutions"),style:O.MONEY_WINDOW,skip:!0,handler:h(()=>!1,"handler")}),this.evolutions.map(m=>{const d=it.find(_=>_.speciesId===m.speciesId),y=!!this.isCaught(d),g=m.evoFormKey?m.evoFormKey:this.species.forms.length>0?this.species.forms[this.formIndex].formKey:"",C=d?.forms.find(_=>_.formKey===g),E=C?C.formIndex:0,I=this.isFormCaught(d,E),A=m.description;p.push({label:m.evoFormKey?(d??this.species).getFormNameToDisplay(E,!0):(d??this.species).getExpandedSpeciesName(),style:y&&I?O.WINDOW:O.SHADOW_TEXT,handler:h(()=>(this.previousSpecies.push(this.species),this.previousStarterAttributes.push({...this.savedStarterAttributes}),this.starterAttributes.form=E,this.savedStarterAttributes.form=E,this.moveInfoOverlay.clear(),this.clearText(),t.setMode(x.POKEDEX_PAGE,d,this.savedStarterAttributes),!0),"handler"),onHover:h(()=>this.showText(A),"onHover")})})),this.battleForms.length>0&&(p.push({label:f.t("pokedexUiHandler:forms"),style:O.MONEY_WINDOW,skip:!0,handler:h(()=>!1,"handler")}),this.battleForms.map(m=>{const d=this.species?.forms.find(I=>I.formKey===m.formKey),y=d?d.formIndex:0;let g="";m.trigger?g=m.trigger.description:g="";let C=this.species.getFormNameToDisplay(y);C===""&&(C=this.species.name);const E=this.isFormCaught(this.species,y);g&&p.push({label:C,style:E?O.WINDOW:O.SHADOW_TEXT,handler:h(()=>{this.previousSpecies.push(this.species),this.previousStarterAttributes.push({...this.savedStarterAttributes});const I=this.species,A=this.species.forms.find(_=>_.formKey===m.formKey)?.formIndex;return this.starterAttributes.form=A,this.savedStarterAttributes.form=A,this.moveInfoOverlay.clear(),this.clearText(),t.setMode(x.POKEDEX_PAGE,I,this.savedStarterAttributes,this.filteredIndices),!0},"handler"),onHover:h(()=>this.showText(g),"onHover")})})),p.push({label:f.t("menu:cancel"),handler:h(()=>(this.moveInfoOverlay.clear(),this.clearText(),t.setMode(x.POKEDEX_PAGE,"refresh"),!0),"handler"),onHover:h(()=>this.moveInfoOverlay.clear(),"onHover")}),t.setModeWithoutClear(x.OPTION_SELECT,{options:p,supportHover:!0,maxOptions:8,yOffset:19}),this.blockInput=!1})}),i=!0):n=!0;break;case 7:l?!s.gameData.dexData[this.species.speciesId].ribbons.getRibbons()&&!s.showMissingRibbons&&!s.gameData.starterData[this.species.speciesId]?.classicWinCount?(t.showText(f.t("pokedexUiHandler:noRibbons")),n=!0):(this.isRibbonTrayOpen=!0,this.ribbonContainer.open(this.species),i=!0):n=!0;break;case 6:l?(this.blockInput=!0,t.setMode(x.POKEDEX_PAGE,"refresh").then(()=>{t.showText(f.t("pokedexUiHandler:showNature"),null,()=>{const p=s.gameData.dexData[this.getStarterSpeciesId(this.species.speciesId)],m=s.gameData.getNaturesForAttr(p.natureAttr);t.setModeWithoutClear(x.OPTION_SELECT,{options:m.map((d,y)=>({label:ki(d,!0,!0,!0),handler:h(()=>!1,"handler")})).concat({label:f.t("menu:cancel"),handler:h(()=>(this.clearText(),t.setMode(x.POKEDEX_PAGE,"refresh"),this.blockInput=!1,!0),"handler")}),maxOptions:8,yOffset:19})})}),i=!0):n=!0;break}else{const p=s.gameData.getSpeciesDexAttrProps(this.species,this.getCurrentDexProps(this.species.speciesId));switch(e){case b.CYCLE_SHINY:if(this.canCycleShiny)if(u.shiny){let m=p.variant;do if(m=(m+1)%3,m===0){if(this.isCaught()&F.DEFAULT_VARIANT)break}else if(m===1){if(this.isCaught()&F.VARIANT_2)break}else if(this.isCaught()&F.VARIANT_3)break;while(m!==p.variant);u.variant=m,this.savedStarterAttributes.variant=u.variant,this.isCaught()&F.NON_SHINY&&m<=p.variant?(this.setSpeciesDetails(this.species,{shiny:!1,variant:0}),i=!0,u.shiny=!1,this.savedStarterAttributes.shiny=u.shiny):(this.setSpeciesDetails(this.species,{variant:m}),i=!0)}else{const m=u.variant?u.variant:0;this.setSpeciesDetails(this.species,{shiny:!0,variant:m}),s.playSound("se/sparkle"),u.shiny=!0,this.savedStarterAttributes.shiny=u.shiny}break;case b.CYCLE_FORM:if(this.canCycleForm){const m=this.species.forms.length;let d=this.formIndex;do if(d=(d+1)%m,this.species.forms[d].isStarterSelectable||s.dexForDevs)break;while(d!==p.formIndex||this.species.forms[d].isUnobtainable);u.form=d,this.savedStarterAttributes.form=u.form,this.formIndex=d;let y=p.female;this.isFormGender&&(y=!p.female),u.female=y,this.savedStarterAttributes.female=u.female,this.starterSetup(),this.setSpeciesDetails(this.species,{formIndex:d,female:y}),i=this.setCursor(this.cursor)}break;case b.CYCLE_GENDER:if(this.canCycleGender){u.female=!p.female,this.savedStarterAttributes.female=u.female;let m=this.formIndex;this.isFormGender&&(m=this.formIndex===0?1:0),u.form=m,this.savedStarterAttributes.form=u.form,this.formIndex=m,this.starterSetup(),this.setSpeciesDetails(this.species,{female:!p.female,formIndex:m}),i=!0}break;case b.CYCLE_TERA:l?(this.toggleStatsMode(),t.setMode(x.POKEDEX_PAGE,"refresh"),i=!0):n=!0;break;case b.STATS:if(!a||!r||!this.canUseCandies)n=!0;else{const m=this.getUi();m.showText("");const d=[],y=c.passiveAttr,g=c.candyCount;if(!(y&At.UNLOCKED)){const A=cn($e[this.starterId]);d.push({label:`${A} ${f.t("pokedexUiHandler:unlockPassive")}`,handler:h(()=>ie.FREE_CANDY_UPGRADE_OVERRIDE||g>=A?(c.passiveAttr|=At.UNLOCKED|At.ENABLED,ie.FREE_CANDY_UPGRADE_OVERRIDE||(c.candyCount-=A),this.pokemonCandyCountText.setText(`${c.candyCount}`),s.gameData.saveSystem().then(_=>{if(!_)return s.reset(!0)}),this.setSpeciesDetails(this.species),s.playSound("se/buy"),m.setMode(x.POKEDEX_PAGE,"refresh"),!0):!1,"handler"),style:this.isPassiveAvailable()?O.WINDOW:O.SHADOW_TEXT,item:"candy",itemArgs:this.isPassiveAvailable()?vt[this.starterId]:["808080","808080"]})}const C=c.valueReduction;if(C<Ef){const A=un($e[this.starterId])[C];d.push({label:`${A} ${f.t("pokedexUiHandler:reduceCost")}`,handler:h(()=>ie.FREE_CANDY_UPGRADE_OVERRIDE||g>=A?(c.valueReduction++,ie.FREE_CANDY_UPGRADE_OVERRIDE||(c.candyCount-=A),this.pokemonCandyCountText.setText(`${c.candyCount}`),s.gameData.saveSystem().then(_=>{if(!_)return s.reset(!0)}),m.setMode(x.POKEDEX_PAGE,"refresh"),s.playSound("se/buy"),!0):!1,"handler"),style:this.isValueReductionAvailable()?O.WINDOW:O.SHADOW_TEXT,item:"candy",itemArgs:this.isValueReductionAvailable()?vt[this.starterId]:["808080","808080"]})}const E=s.gameData.dexData[this.starterId].hatchedCount,I=dn($e[this.starterId],E);d.push({label:`${I} ${f.t("pokedexUiHandler:sameSpeciesEgg")}`,handler:h(()=>ie.FREE_CANDY_UPGRADE_OVERRIDE||g>=I?s.gameData.eggs.length>=99&&!ie.UNLIMITED_EGG_COUNT_OVERRIDE?(this.showText(f.t("egg:tooManyEggs"),void 0,()=>this.showText("",0,()=>this.tutorialActive=!1),2e3,!1,void 0,!0),!1):(ie.FREE_CANDY_UPGRADE_OVERRIDE||(c.candyCount-=I),this.pokemonCandyCountText.setText(`${c.candyCount}`),new _i({scene:s,species:this.starterId,sourceType:gg.SAME_SPECIES_EGG}).addEggToGameData(),s.gameData.saveSystem().then(_=>{if(!_)return s.reset(!0)}),m.setMode(x.POKEDEX_PAGE,"refresh"),s.playSound("se/buy"),!0):!1,"handler"),style:this.isSameSpeciesEggAvailable()?O.WINDOW:O.SHADOW_TEXT,item:"candy",itemArgs:this.isSameSpeciesEggAvailable()?vt[this.starterId]:["808080","808080"]}),d.push({label:f.t("menu:cancel"),handler:h(()=>(m.setMode(x.POKEDEX_PAGE,"refresh"),!0),"handler")}),m.setModeWithoutClear(x.OPTION_SELECT,{options:d,yOffset:47}),i=!0}break;case b.CYCLE_ABILITY:this.showBackSprite=!this.showBackSprite,this.showBackSprite?this.showBackSpriteLabel.setText(f.t("pokedexUiHandler:showFrontSprite")):this.showBackSpriteLabel.setText(f.t("pokedexUiHandler:showBackSprite")),this.setSpeciesDetails(this.species,{},!0),i=!0;break;case b.UP:this.cursor?i=this.setCursor(this.cursor-1):i=this.setCursor(this.menuOptions.length-1);break;case b.DOWN:this.cursor+1<this.menuOptions.length?i=this.setCursor(this.cursor+1):i=this.setCursor(0);break;case b.LEFT:if(this.filteredIndices&&this.filteredIndices.length<=1)return t.playError(),this.blockInput=!1,!0;this.blockInput=!0,t.setModeWithoutClear(x.OPTION_SELECT).then(()=>{this.previousSpecies.length===0&&(this.previousSpecies.push(this.species),this.previousStarterAttributes.push({...this.savedStarterAttributes}));let m;if(this.filteredIndices){const g=this.filteredIndices.indexOf(this.species.speciesId),C=g<=0?this.filteredIndices.length-1:g-1;m=zt(this.filteredIndices[C])}else{const g=it.findIndex(E=>E.speciesId===this.species.speciesId),C=g<=0?it.length-1:g-1;m=it[C]}const d=m?.forms.find(g=>g.formKey===this.species?.forms[this.formIndex]?.formKey),y=d?d.formIndex:0;this.starterAttributes.form=y,this.savedStarterAttributes.form=y,this.moveInfoOverlay.clear(),this.clearText(),t.setModeForceTransition(x.POKEDEX_PAGE,m,this.savedStarterAttributes,this.filteredIndices)}),this.blockInput=!1;break;case b.RIGHT:if(this.filteredIndices&&this.filteredIndices.length<=1)return t.playError(),this.blockInput=!1,!0;t.setModeWithoutClear(x.OPTION_SELECT).then(()=>{this.previousSpecies.length===0&&(this.previousSpecies.push(this.species),this.previousStarterAttributes.push({...this.savedStarterAttributes}));let m;if(this.filteredIndices){const g=this.filteredIndices.indexOf(this.species.speciesId),C=g>=this.filteredIndices.length-1?0:g+1;m=zt(this.filteredIndices[C])}else{const g=it.findIndex(E=>E.speciesId===this.species.speciesId),C=g>=it.length-1?0:g+1;m=it[C]}const d=m?.forms.find(g=>g.formKey===this.species?.forms[this.formIndex]?.formKey),y=d?d.formIndex:0;this.starterAttributes.form=y,this.savedStarterAttributes.form=y,this.moveInfoOverlay.clear(),this.clearText(),t.setModeForceTransition(x.POKEDEX_PAGE,m,this.savedStarterAttributes,this.filteredIndices)});break}}}return i?t.playSelect():n&&t.playError(),i||n}updateButtonIcon(e,t,i,n){let a;if(t==="touch")switch(t="keyboard",e){case re.Button_Cycle_Shiny:a="R.png";break;case re.Button_Cycle_Form:a="F.png";break;case re.Button_Cycle_Gender:a="G.png";break;case re.Button_Cycle_Ability:a="E.png";break;case re.Button_Cycle_Tera:a="V.png";break}else a=s.inputController?.getIconForLatestInputRecorded(e);i.setTexture(t,a),i.setPosition(this.instructionRowX,this.instructionRowY),n.setPosition(this.instructionRowX+this.instructionRowTextOffset,this.instructionRowY),i.setVisible(!0),n.setVisible(!0),this.instructionsContainer.add([i,n]),this.instructionRowY+=8,this.instructionRowY>=24&&(this.instructionRowY=8,this.instructionRowX+=50)}updateInstructions(){this.instructionRowX=0,this.instructionRowY=0,this.hideInstructions(),this.instructionsContainer.removeAll(),this.filterInstructionsContainer.removeAll();let e;if(s.inputMethod==="gamepad"?e=s.inputController.getConfig(s.inputController.selectedDevice[Le.GAMEPAD]).padType:e=s.inputMethod,!e)return;const t=this.isFormCaught();this.isCaught()&&(t?(this.canUseCandies&&this.updateButtonIcon(re.Button_Stats,e,this.candyUpgradeIconElement,this.candyUpgradeLabel),this.canCycleShiny&&this.updateButtonIcon(re.Button_Cycle_Shiny,e,this.shinyIconElement,this.shinyLabel),this.canCycleGender&&this.updateButtonIcon(re.Button_Cycle_Gender,e,this.genderIconElement,this.genderLabel)):this.instructionRowY+=8,this.canCycleForm&&this.updateButtonIcon(re.Button_Cycle_Form,e,this.formIconElement,this.formLabel),this.updateButtonIcon(re.Button_Cycle_Tera,e,this.ivIconElement,this.ivLabel))}setCursor(e){const t=super.setCursor(e);this.cursorObj||(this.cursorObj=s.add.image(0,0,"cursor"),this.cursorObj.setOrigin(0,0),this.menuContainer.add(this.cursorObj)),this.cursorObj.setScale(this.scale*6),this.cursorObj.setPositionRelative(this.menuBg,7,6+(18+this.cursor*96)*this.scale);const i=this.getUi();return this.isCaught()&&this.isFormCaught()||this.isSeen()?i.showText(this.menuDescriptions[e]):i.showText(""),t}getFriendship(e){let t=s.gameData.starterData[this.starterId].friendship;(!t||t===void 0)&&(t=0);const i=Wh($e[this.starterId]);return{currentFriendship:t,friendshipCap:i}}isPassiveAvailable(){const e=s.gameData.starterData[this.starterId];return e.candyCount>=cn($e[this.starterId])&&!(e.passiveAttr&At.UNLOCKED)}isValueReductionAvailable(){const e=s.gameData.starterData[this.starterId];return e.candyCount>=un($e[this.starterId])[e.valueReduction]&&e.valueReduction<Ef}isSameSpeciesEggAvailable(){const e=s.gameData.starterData[this.starterId],t=s.gameData.dexData[this.starterId].hatchedCount;return e.candyCount>=dn($e[this.starterId],t)}setSpecies(){const e=this.species,t=e?{...this.starterAttributes}:null;if(!e&&s.ui.getTooltip().visible&&s.ui.hideTooltip(),this.statsMode&&(this.isCaught()?(this.statsContainer.setVisible(!0),this.showStats()):(this.statsContainer.setVisible(!1),this.statsContainer.updateIvs(null))),e&&(this.isSeen()||this.isCaught()))if(this.pokemonNumberText.setText(Hs(e.speciesId,4)),this.isCaught()){const i=this.getCurrentDexProps(e.speciesId),n=s.gameData.getSpeciesDexAttrProps(e,i);t?.variant&&!Number.isNaN(t.variant)&&n.shiny&&(n.variant=t.variant),n.form=t?.form??n.form,n.female=t?.female??n.female,this.setSpeciesDetails(e,{shiny:n.shiny,formIndex:n.form,female:n.female,variant:n.variant??0})}else{this.pokemonGrowthRateText.setText(""),this.pokemonGrowthRateLabelText.setVisible(!1),this.type1Icon.setVisible(!0),this.type2Icon.setVisible(!0),this.pokemonLuckLabelText.setVisible(!1),this.pokemonLuckText.setVisible(!1);for(const a of this.pokemonShinyIcons)a.setVisible(!1);this.pokemonUncaughtText.setVisible(!0),this.pokemonCaughtHatchedContainer.setVisible(!0),this.pokemonCandyContainer.setVisible(!1),this.pokemonFormText.setVisible(!1),this.pokemonCategoryText.setVisible(!1);const i=s.gameData.getSpeciesDefaultDexAttr(e,!0,!0),n=s.gameData.getSpeciesDexAttrProps(e,i);this.setSpeciesDetails(e,{shiny:n.shiny,formIndex:n.formIndex,female:n.female,variant:n.variant}),this.pokemonSprite.setTint(8421504)}else{this.pokemonNumberText.setText(e?Hs(e.speciesId,4):""),this.pokemonNameText.setText(e?"???":""),this.pokemonGrowthRateText.setText(""),this.pokemonGrowthRateLabelText.setVisible(!1),this.type1Icon.setVisible(!1),this.type2Icon.setVisible(!1),this.pokemonLuckLabelText.setVisible(!1),this.pokemonLuckText.setVisible(!1);for(const i of this.pokemonShinyIcons)i.setVisible(!1);this.pokemonUncaughtText.setVisible(!!e),this.pokemonCaughtHatchedContainer.setVisible(!1),this.pokemonCandyContainer.setVisible(!1),this.pokemonFormText.setVisible(!1),this.pokemonCategoryText.setVisible(!1),this.setSpeciesDetails(e,{shiny:!1,formIndex:0,female:!1,variant:0}),this.pokemonSprite.setTint(0)}}setSpeciesDetails(e,t={},i){let{shiny:n,formIndex:a,female:r,variant:o}=t;const l=e?this.starterAttributes:null,c=e?.genderDiffs&&r!=null||a!=null||n!=null||o!=null||i;if(this.activeTooltip==="CANDY")if(this.species&&this.pokemonCandyContainer.visible){const{currentFriendship:u,friendshipCap:p}=this.getFriendship(this.species.speciesId);s.ui.editTooltip("",`${u}/${p}`)}else s.ui.hideTooltip();if(e?.forms?.find(u=>u.formKey==="female")&&(r!==void 0?a=r?1:0:a!==void 0&&(r=a===1)),e&&(n===void 0&&(n=l?.shiny??!1),r===void 0&&(r=l?.female??!1),o===void 0&&(o=l?.variant??0),a===void 0&&(a=l?.form??0)),this.pokemonSprite.setVisible(!1),this.assetLoadCancelled&&(this.assetLoadCancelled.value=!0,this.assetLoadCancelled=null),e){const u=this.isCaught(e);if(!u){const A=this.starterAttributes;(n===void 0||n!==A.shiny)&&(n=A.shiny),(a===void 0||a!==A.form)&&(a=A.form),(r===void 0||r!==A.female)&&(r=A.female),(o===void 0||o!==A.variant)&&(o=A.variant)}const p=this.isFormCaught(),m=this.isSeen();this.shinyOverlay.setVisible(n??!1),this.pokemonNumberText.setColor(le(n?O.SUMMARY_DEX_NUM_GOLD:O.SUMMARY_DEX_NUM,!1)),this.pokemonNumberText.setShadowColor(le(n?O.SUMMARY_DEX_NUM_GOLD:O.SUMMARY_DEX_NUM,!0));const d=new ft(!1);if(this.assetLoadCancelled=d,c){const A=!!this.showBackSprite;e.loadAssets(r,a,n,o,!0,A).then(()=>{d.value||(this.assetLoadCancelled=null,this.speciesLoaded.set(e.speciesId,!0),this.pokemonSprite.play(e.getSpriteKey(r,a,n,o,A)),this.pokemonSprite.setPipelineData("shiny",n),this.pokemonSprite.setPipelineData("variant",o),this.pokemonSprite.setPipelineData("spriteKey",e.getSpriteKey(r,a,n,o,A)),this.pokemonSprite.setVisible(!this.statsMode))})}else this.pokemonSprite.setVisible(!this.statsMode);const y=!!(u&F.NON_SHINY),g=!!(u&F.SHINY),C=[F.DEFAULT_VARIANT,F.VARIANT_2,F.VARIANT_3].filter(A=>u&A);this.canCycleShiny=y&&g||g&&C.length>1;const E=!!(u&F.MALE),I=!!(u&F.FEMALE);if(this.canCycleGender=E&&I,this.canCycleForm=s.dexForDevs?e.forms.length>1:e.forms.filter(A=>A.isStarterSelectable).filter(A=>A).length>1,u&&e.malePercent!==null){const A=r?Ut.FEMALE:Ut.MALE;this.pokemonGenderText.setText(Fh(A)),this.pokemonGenderText.setColor(Mi(A)),this.pokemonGenderText.setShadowColor(Mi(A,!0))}else this.pokemonGenderText.setText("");if(p||m?this.pokemonNameText.setText(e.name):this.pokemonNameText.setText(e?"???":""),p?this.pokemonCategoryText.setText(e.category):this.pokemonCategoryText.setText(""),p?(this.species.loadAssets(r,a,n,o,!0).then(()=>{(this.species.forms&&this.species.forms.length>0?this.species.forms[a??this.formIndex]:this.species).cry()}),this.pokemonSprite.clearTint()):m?this.pokemonSprite.setTint(8421504):this.pokemonSprite.setTint(0),p){const A=s.gameData.getDexAttrLuck(this.isCaught());this.pokemonLuckText.setVisible(!!A),this.pokemonLuckText.setText(A.toString()),this.pokemonLuckText.setTint(Et(Math.min(A-1,2))),this.pokemonLuckLabelText.setVisible(this.pokemonLuckText.visible)}else this.pokemonLuckText.setVisible(!1),this.pokemonLuckLabelText.setVisible(!1);if(p){let A=Ri(mg[e.growthRate]);const _=bt(A);f.exists("growth:"+_)&&(A=f.t("growth:"+_)),this.pokemonGrowthRateText.setText(A),this.pokemonGrowthRateText.setColor(Ca(e.growthRate)),this.pokemonGrowthRateText.setShadowColor(Ca(e.growthRate,!0)),this.pokemonGrowthRateLabelText.setVisible(!0)}else this.pokemonGrowthRateText.setText(""),this.pokemonGrowthRateLabelText.setVisible(!1);if(p){const A=vt[this.starterId];this.pokemonUncaughtText.setVisible(!1),this.pokemonCaughtCountText.setText(`${this.speciesStarterDexEntry?.caughtCount}`),e.speciesId===ye.MANAPHY||e.speciesId===ye.PHIONE?this.pokemonHatchedIcon.setFrame("manaphy"):this.pokemonHatchedIcon.setFrame(ci(e)),this.pokemonHatchedCountText.setText(`${this.speciesStarterDexEntry?.hatchedCount}`);const _=this.getCurrentDexProps(e.speciesId),L=s.gameData.getSpeciesDexAttrProps(e,_).variant;for(let V=0;V<3;V++){const H=this.pokemonShinyIcons[V];if(V<this.availableVariants){if(!this.unlockedVariants[V])H.setTint(0);else if(n&&V===L){const W=Et(V);H.setTint(W)}else H.setTint(8421504);H.setVisible(!0)}else H.setVisible(!1)}if(this.pokemonCaughtHatchedContainer.setVisible(!0),this.pokemonCaughtHatchedContainer.setY(25),this.pokemonCandyIcon.setTint(qt(Dt(A[0]))),this.pokemonCandyOverlayIcon.setTint(qt(Dt(A[1]))),this.pokemonCandyCountText.setText(`${e.speciesId===ye.PIKACHU?0:s.gameData.starterData[this.starterId].candyCount}`),this.pokemonCandyContainer.setVisible(!0),Bt.hasOwnProperty(e.speciesId))this.pokemonHatchedIcon.setVisible(!1),this.pokemonHatchedCountText.setVisible(!1),this.pokemonFormText.setY(36);else{this.pokemonHatchedIcon.setVisible(!0),this.pokemonHatchedCountText.setVisible(!0),this.pokemonFormText.setY(42);const{currentFriendship:V,friendshipCap:H}=this.getFriendship(this.species.speciesId),W=16-16*(V/H);this.pokemonCandyDarknessOverlay.setCrop(0,0,16,W),this.pokemonCandyContainer.on("pointerover",()=>{s.ui.showTooltip("",`${V}/${H}`,!0),this.activeTooltip="CANDY"}),this.pokemonCandyContainer.on("pointerout",()=>{s.ui.hideTooltip(),this.activeTooltip=void 0})}}else{this.pokemonUncaughtText.setVisible(!0),this.pokemonCaughtHatchedContainer.setVisible(!1),this.pokemonCandyContainer.setVisible(!1);for(const A of this.pokemonShinyIcons)A.setVisible(!1)}if(p||m){const A=is(e.speciesId,a);this.setTypeIcons(A.type1,A.type2),yg.includes(e.speciesId)&&!a?this.pokemonFormText.setText(""):this.pokemonFormText.setText(e.getFormNameToDisplay(a)),this.pokemonFormText.setVisible(!0),p||this.pokemonFormText.setY(18)}else this.setTypeIcons(null,null),this.pokemonFormText.setText(""),this.pokemonFormText.setVisible(!1)}else this.shinyOverlay.setVisible(!1),this.pokemonNumberText.setColor(le(O.SUMMARY)),this.pokemonNumberText.setShadowColor(le(O.SUMMARY,!0)),this.pokemonGenderText.setText(""),this.setTypeIcons(null,null);this.updateInstructions()}setTypeIcons(e,t){e!==null?(this.type1Icon.setVisible(!0),this.type1Icon.setFrame(Me[e].toLowerCase())):this.type1Icon.setVisible(!1),t!==null?(this.type2Icon.setVisible(!0),this.type2Icon.setFrame(Me[t].toLowerCase())):this.type2Icon.setVisible(!1)}getCurrentDexProps(e){let t=0n;const i=it.find(a=>a.speciesId===e),n=s.gameData.dexData[e].caughtAttr&s.gameData.dexData[this.getStarterSpeciesId(e)].caughtAttr&(i?.getFullUnlocksData()??0n);return this.starterAttributes?.female||(n&F.FEMALE)>0n&&(n&F.MALE)===0n?t+=F.FEMALE:t+=F.MALE,this.starterAttributes?.shiny||(n&F.SHINY)>0n&&this.starterAttributes?.shiny!==!1?(t+=F.SHINY,this.starterAttributes?.variant!==void 0?t+=BigInt(Math.pow(2,this.starterAttributes?.variant))*F.DEFAULT_VARIANT:(n&F.VARIANT_3)>0?t+=F.VARIANT_3:(n&F.VARIANT_2)>0?t+=F.VARIANT_2:t+=F.DEFAULT_VARIANT):(t+=F.NON_SHINY,t+=F.DEFAULT_VARIANT),this.starterAttributes?.form?t+=BigInt(Math.pow(2,this.starterAttributes?.form))*F.DEFAULT_FORM:t+=s.gameData.getFormAttr(s.gameData.getFormIndex(n)),t}toggleStatsMode(e){e===void 0&&(e=!this.statsMode),e?(this.showStats(),this.statsMode=!0,this.pokemonSprite.setVisible(!1)):(this.statsMode=!1,this.statsContainer.setVisible(!1),this.pokemonSprite.setVisible(!0),this.statsContainer.updateIvs(null))}showStats(){if(!this.speciesStarterDexEntry)return;this.statsContainer.setVisible(!0);const e=s.gameData.dexData[this.getStarterSpeciesId(this.species.speciesId)].ivs;this.statsContainer.updateIvs(e)}clearText(){this.starterSelectMessageBoxContainer.setVisible(!1),super.clearText()}hideInstructions(){this.candyUpgradeIconElement.setVisible(!1),this.candyUpgradeLabel.setVisible(!1),this.shinyIconElement.setVisible(!1),this.shinyLabel.setVisible(!1),this.formIconElement.setVisible(!1),this.formLabel.setVisible(!1),this.genderIconElement.setVisible(!1),this.genderLabel.setVisible(!1),this.ivIconElement.setVisible(!1),this.ivLabel.setVisible(!1)}clear(){super.clear(),this.cursor=-1,this.hideInstructions(),this.activeTooltip=void 0,s.ui.hideTooltip(),this.starterSelectContainer.setVisible(!1),this.blockInput=!1,this.showBackSprite=!1,this.showBackSpriteLabel.setText(f.t("pokedexUiHandler:showBackSprite")),this.statsMode&&this.toggleStatsMode(!1)}checkIconId(e,t,i,n,a,r){e.frame.name!==t.getIconId(i,n,a,r)&&(`${t.name}${e.frame.name}${i}${n}${a}${r}`,e.setTexture(t.getIconAtlasKey(n,!1,r)),e.setFrame(t.getIconId(i,n,!1,r)))}};h(bd,"PokedexPageUiHandler");let On=bd;var Pe=(T=>(T[T.GEN=0]="GEN",T[T.TYPES=1]="TYPES",T[T.BIOME=2]="BIOME",T[T.CAUGHT=3]="CAUGHT",T[T.UNLOCKS=4]="UNLOCKS",T[T.MISC=5]="MISC",T[T.SORT=6]="SORT",T))(Pe||{});const Id=class Id extends Phaser.GameObjects.Container{bg;handleBody;handleBottom;currentRow;totalRows;maxRows;constructor(e,t,i,n,a){super(s,e,t),this.maxRows=a,this.totalRows=a,this.currentRow=0;const r=2;i=Math.max(i,4),this.bg=s.add.nineslice(0,0,"scroll_bar",void 0,i,n,r,r,r,r),this.bg.setOrigin(0,0),this.add(this.bg),this.handleBody=s.add.rectangle(1,1,i-2,4,11184810),this.handleBody.setOrigin(0,0),this.add(this.handleBody),this.handleBottom=s.add.nineslice(1,1,"scroll_bar_handle",void 0,i-2,2,2,0,0,0),this.handleBottom.setOrigin(0,0),this.add(this.handleBottom)}setScrollCursor(e){this.currentRow=e,this.updateHandlePosition()}setTotalRows(e){this.totalRows=e,this.handleBody.height=(this.bg.displayHeight-1-this.handleBottom.displayHeight)*this.maxRows/this.totalRows,this.updateHandlePosition(),this.setVisible(this.totalRows>this.maxRows)}updateHandlePosition(){this.handleBody.y=1+(this.bg.displayHeight-1-this.handleBottom.displayHeight)/this.totalRows*this.currentRow,this.handleBottom.y=this.handleBody.y+this.handleBody.displayHeight}};h(Id,"ScrollBar");let Ps=Id;var Q=(T=>(T[T.ON=0]="ON",T[T.OFF=1]="OFF",T[T.EXCLUDE=2]="EXCLUDE",T[T.UNLOCKABLE=3]="UNLOCKABLE",T[T.ONE=4]="ONE",T[T.TWO=5]="TWO",T))(Q||{}),Wt=(T=>(T[T.SINGLE=0]="SINGLE",T[T.MULTI=1]="MULTI",T[T.HYBRID=2]="HYBRID",T[T.RADIAL=3]="RADIAL",T))(Wt||{}),qe=(T=>(T[T.NUMBER=0]="NUMBER",T[T.COST=1]="COST",T[T.CANDY=2]="CANDY",T[T.IV=3]="IV",T[T.NAME=4]="NAME",T[T.CAUGHT=5]="CAUGHT",T[T.HATCHED=6]="HATCHED",T))(qe||{});const vd=class vd{state;text;sprite;constructor(e,t,i=1){this.text=e||"",this.sprite=t,this.state=i}};h(vd,"DropDownLabel");let oe=vd;const Od=class Od extends Phaser.GameObjects.Container{state=0;toggle;text;val;dir=-1;currentLabelIndex;labels;onColor=3390463;offColor=2565927;excludeColor=16733525;unlockableColor=16776960;oneColor=3390463;twoColor=3390463;constructor(e,t){super(s),this.val=e,Array.isArray(t)?this.labels=t:this.labels=t?[t]:[new oe("")],this.currentLabelIndex=0;const i=this.labels[this.currentLabelIndex];this.state=i.state,this.text=P(0,0,i.text||"",O.TOOLTIP_CONTENT),this.text.setOrigin(0,.5),this.add(this.text);for(let n=0;n<this.labels.length;n++){const a=this.labels[n].sprite;a&&(this.add(a),a.setOrigin(0,.5),n!==this.currentLabelIndex&&a.setVisible(!1))}}setupToggleIcon(e,t){e===0?(this.toggle=s.add.sprite(0,0,"cursor"),this.toggle.setScale(.5),this.toggle.setOrigin(0,.5),this.toggle.setRotation(Math.PI/180*-90)):(this.toggle=s.add.sprite(0,0,"candy"),this.toggle.setScale(.3),this.toggle.setOrigin(0,.5)),this.add(this.toggle),this.toggle.setVisible(t),this.updateToggleIconColor()}updateToggleIconColor(){switch(this.state){case 0:this.toggle.setTint(this.onColor);break;case 1:this.toggle.setTint(this.offColor);break;case 2:this.toggle.setTint(this.excludeColor);break;case 3:this.toggle.setTint(this.unlockableColor);break;case 4:this.toggle.setTint(this.oneColor);break;case 5:this.toggle.setTint(this.twoColor);break}}toggleOptionState(){if(this.labels.length>1)return this.setCurrentLabel((this.currentLabelIndex+1)%this.labels.length);const e=this.state===0?1:0;return this.setOptionState(e)}setOptionState(e){const t=this.labels.findIndex(i=>i.state===e);return t!==-1&&t!==this.currentLabelIndex?this.setCurrentLabel(t):(this.state=e,this.updateToggleIconColor(),e)}setCurrentLabel(e){const t=this.labels[this.currentLabelIndex],i=this.labels[e];return i?(this.currentLabelIndex=e,this.state=i.state,this.updateToggleIconColor(),t.sprite&&(this.text.x-=t.sprite.displayWidth+2,t.sprite.setVisible(!1)),i.sprite&&(this.text.x+=i.sprite.displayWidth+2,i.sprite.setVisible(!0)),this.text.setText(i.text),this.state):this.state}setDirection(e){this.dir=e,this.toggle.flipX=this.dir===1}toggleDirection(){this.setDirection(this.dir*-1)}setLabelPosition(e,t){let i=e;for(let n=0;n<this.labels.length;n++){const a=this.labels[n];a.sprite&&(a.sprite.x=e,a.sprite.y=t,n===this.currentLabelIndex&&(i+=a.sprite.displayWidth+2))}this.text&&(this.text.x=i,this.text.y=t)}setTogglePosition(e,t){this.toggle&&(this.toggle.x=e,this.toggle.y=t)}getCurrentLabelX(){return this.labels[this.currentLabelIndex].sprite?this.labels[this.currentLabelIndex].sprite?.x:this.text.x}getWidth(){let e=0;const t=this.text.text;for(const i of this.labels){this.text.setText(i.text);const n=i.sprite?i.sprite.displayWidth+2:0;e=Math.max(e,this.text.displayWidth+n)}return this.text.setText(t),e}};h(Od,"DropDownOption");let Oe=Od;const Ad=class Ad extends Phaser.GameObjects.Container{options;window;cursorObj;dropDownType=1;cursor=0;lastCursor=-1;defaultCursor=0;onChange;lastDir=-1;defaultSettings;dropDownScrollBar;totalOptions=0;maxOptions=0;shownOptions=0;tooManyOptions=!1;firstShown=0;optionHeight=0;optionSpacing=0;optionPaddingX=4;optionPaddingY=6;optionWidth=100;cursorOffset=0;constructor(e,t,i,n,a=1,r=2){super(s,e-7-5,t),this.optionWidth=100,this.optionHeight=7,this.optionSpacing=r,this.optionPaddingX=4,this.optionPaddingY=6,this.cursorOffset=7,this.options=i,this.dropDownType=a,this.onChange=n,this.cursorObj=s.add.image(this.optionPaddingX+3,0,"cursor"),this.cursorObj.setScale(.5),this.cursorObj.setOrigin(0,.5),this.cursorObj.setVisible(!1),(this.dropDownType===1||this.dropDownType===2)&&this.options.unshift(new Oe("ALL",new oe(f.t("filterBar:all"),void 0,this.checkForAllOn()?0:1))),this.maxOptions=19,this.totalOptions=this.options.length,this.tooManyOptions=this.totalOptions>this.maxOptions,this.shownOptions=this.tooManyOptions?this.maxOptions:this.totalOptions,this.defaultSettings=this.getSettings(),i.forEach((c,u)=>{const p=a!==0||c.state===0;c.setupToggleIcon(a,p),c.width=this.optionWidth,c.y=u*this.optionHeight+u*r+this.optionPaddingY;const m=7+this.optionPaddingX+3,d=this.optionHeight/2;c.setLabelPosition(m+8,d),a===0?c.setTogglePosition(m+3,d+1):c.setTogglePosition(m,d),u>=this.shownOptions&&(c.visible=!1),this.firstShown=0}),this.window=Ce(0,0,this.optionWidth,i[this.shownOptions-1].y+this.optionHeight+this.optionPaddingY,!1,!1,void 0,void 0,us.XTHIN),this.add(this.window),this.add(i),this.add(this.cursorObj),this.setVisible(!1),this.tooManyOptions&&(this.dropDownScrollBar=new Ps(this.window.width-3,5,5,this.window.height-10,1),this.add(this.dropDownScrollBar),this.dropDownScrollBar.setTotalRows(this.totalOptions),this.dropDownScrollBar.setScrollCursor(0))}getWidth(){return this.window?this.window.width:this.width}toggleVisibility(){this.setVisible(!this.visible)}setVisible(e){return super.setVisible(e),e&&this.autoSize(),this}resetCursor(){return this.dropDownType===2&&this.checkForAllOff()?this.setCursor(this.lastCursor):this.setCursor(this.defaultCursor)}setCursor(e){return this.tooManyOptions&&this.setLabels(e),this.cursor=e,e<0?(e=0,this.cursorObj.setVisible(!1),!1):e>=this.options.length?(e=this.options.length-1,this.cursorObj.y=this.options[e].y+3.5,this.cursorObj.setVisible(!0),!1):(this.cursorObj.y=this.options[e].y+3.5,this.cursorObj.setVisible(!0),this.dropDownType===2&&(this.lastCursor=e,this.onChange()),!0)}setLabels(e){e===0&&this.lastCursor===this.totalOptions-1?this.firstShown=0:e===this.totalOptions-1&&this.lastCursor===0?this.firstShown=this.totalOptions-this.shownOptions:e-this.firstShown>=this.shownOptions&&e>this.lastCursor?this.firstShown+=1:e<this.firstShown&&e<this.lastCursor&&(this.firstShown-=1),this.options.forEach((t,i)=>{t.y=(i-this.firstShown)*(this.optionHeight+this.optionSpacing)+this.optionPaddingY;const n=this.cursorOffset+this.optionPaddingX+3,a=this.optionHeight/2;t.setLabelPosition(n+8,a),this.dropDownType===0?t.setTogglePosition(n+3,a+1):t.setTogglePosition(n,a),i<this.firstShown||i>=this.firstShown+this.shownOptions?t.visible=!1:t.visible=!0}),this.dropDownScrollBar.setScrollCursor(e)}toggleOptionState(e=this.cursor){const t=this.options[e];if(this.dropDownType===1||this.dropDownType===2){const i=t.toggleOptionState();e===0?this.setAllOptions(i):i===0&&this.checkForAllOn()?this.options[0].setOptionState(0):this.options[0].setOptionState(1)}else this.dropDownType===0?t.state===1?(this.options.forEach(i=>{i.setOptionState(1),i.setDirection(-1),i.toggle.setVisible(!1)}),t.setOptionState(0),t.setDirection(this.lastDir),t.toggle.setVisible(!0)):(t.toggleDirection(),this.lastDir=this.options[this.cursor].dir):this.dropDownType===3&&t.toggleOptionState();this.onChange()}checkForAllOn(){return this.options.every((e,t)=>t===0||e.state===0)}checkForAllOff(){return this.options.every((e,t)=>t===0||e.state===1)}getVals(){if(this.dropDownType===1)return this.options.filter((e,t)=>t>0&&e.state===0).map(e=>e.val);if(this.dropDownType===2){const e=this.options.filter((t,i)=>i>0&&t.state===0).map(t=>t.val);return e.length>0?e:this.cursor===0?this.options.filter((t,i)=>i>0).map(t=>t.val):[this.options[this.cursor].val]}return this.dropDownType===3?this.options.map(e=>({val:e.val,state:e.state})):this.options.filter(e=>e.state===0).map(e=>({val:e.val,dir:e.dir}))}getSettings(){const e=[];for(let t=0;t<this.options.length;t++)e.push({val:this.options[t].val,state:this.options[t].state,cursor:this.cursor===t,dir:this.options[t].dir});return e}hasDefaultValues(){const e=this.getSettings(),t=h(i=>e.length===this.defaultSettings.length&&e.every((n,a)=>i.every(r=>n[r]===this.defaultSettings[a][r])),"compareValues");switch(this.dropDownType){case 1:case 3:return t(["val","state"]);case 2:return t(["val","state","cursor"]);case 0:return t(["val","state","dir"]);default:return!1}}resetToDefault(){if(this.defaultSettings.length>0){this.setCursor(this.defaultCursor),this.lastDir=-1;for(let e=0;e<this.options.length;e++)this.dropDownType===0?this.defaultSettings[e].state===1?(this.options[e].setOptionState(1),this.options[e].setDirection(-1),this.options[e].toggle.setVisible(!1)):(this.options[e].setOptionState(0),this.options[e].setDirection(-1),this.options[e].toggle.setVisible(!0)):this.defaultSettings[e]&&this.options[e].setOptionState(this.defaultSettings[e].state);this.onChange()}}setAllOptions(e){if(this.dropDownType!==0)for(const t of this.options)t.setOptionState(e)}selectAllOptions(){this.setAllOptions(0)}unselectAllOptions(){this.setAllOptions(1)}autoSize(){let e=0,t=0;for(const i of this.options){const n=i.getWidth();n>e&&(e=n,t=i.getCurrentLabelX()??0)}this.window.width=e+t-this.window.x+9,this.tooManyOptions&&(this.window.width+=6,this.dropDownScrollBar.x=this.window.width-9),this.x+this.window.width>this.parentContainer.width&&(this.x=this.parentContainer.width-this.window.width)}};h(Ad,"DropDown");let Gt=Ad;const xd=class xd extends Phaser.GameObjects.Container{window;labels=[];dropDowns=[];columns=[];cursorObj;numFilters=0;openDropDown=!1;lastCursor=-1;uiTheme;leftPaddingX;rightPaddingX;cursorOffset;constructor(e,t,i,n,a=6,r=6,o=8){super(s,e,t),this.width=i,this.height=n,this.leftPaddingX=a,this.rightPaddingX=r,this.cursorOffset=o,this.window=Ce(0,0,i,n,!1,!1,void 0,void 0,us.THIN),this.cursorObj=s.add.image(1,1,"cursor").setScale(.5).setVisible(!1).setOrigin(0),this.add([this.window,this.cursorObj])}addFilter(e,t,i){if(this.columns.includes(e))return!1;this.columns.push(e);const n=P(0,3,t,O.FILTER_BAR_MAIN);return this.labels.push(n),this.add(n),this.dropDowns.push(i),this.add(i),this.calcFilterPositions(),this.numFilters++,!0}getFilter(e){return this.dropDowns[this.columns.indexOf(e)]}getColumn(e){return this.columns[e]}updateFilterLabels(){for(let e=0;e<this.numFilters;e++)this.dropDowns[e].hasDefaultValues()?this.labels[e].setColor(le(O.TOOLTIP_CONTENT,!1)):this.labels[e].setColor(le(O.STATS_LABEL,!1))}calcFilterPositions(){let e=this.leftPaddingX+this.rightPaddingX+this.cursorOffset;this.labels.forEach(i=>{e+=i.displayWidth+this.cursorOffset});const t=(this.width-e)/(this.labels.length-1);for(let i=0;i<this.labels.length;i++){if(i===0)this.labels[i].x=this.leftPaddingX+this.cursorOffset;else{const n=this.labels[i-1].x+this.labels[i-1].displayWidth;this.labels[i].x=n+t+this.cursorOffset}this.dropDowns[i].x=this.labels[i].x-this.cursorOffset-this.leftPaddingX,this.dropDowns[i].y=this.height}}offsetHybridFilters(){for(const e of this.dropDowns)e.dropDownType===Wt.HYBRID&&(e.autoSize(),e.x=-e.getWidth(),e.y=0)}setCursor(e){this.lastCursor>-1&&this.dropDowns[this.lastCursor].visible&&(this.dropDowns[this.lastCursor].setVisible(!1),this.dropDowns[e].setVisible(!0),this.dropDowns[e].resetCursor()),this.cursorObj.setPosition(this.labels[e].x-this.cursorOffset+2,6),this.lastCursor=e}toggleDropDown(e){this.dropDowns[e].toggleVisibility(),this.openDropDown=this.dropDowns[e].visible,this.dropDowns[e].resetCursor()}hideDropDowns(){this.dropDowns.forEach(e=>{e.setVisible(!1)}),this.openDropDown=!1}incDropDownCursor(){return this.dropDowns[this.lastCursor].cursor===this.dropDowns[this.lastCursor].options.length-1?this.dropDowns[this.lastCursor].setCursor(0):this.dropDowns[this.lastCursor].setCursor(this.dropDowns[this.lastCursor].cursor+1)}decDropDownCursor(){return this.dropDowns[this.lastCursor].cursor===0?this.dropDowns[this.lastCursor].setCursor(this.dropDowns[this.lastCursor].options.length-1):this.dropDowns[this.lastCursor].setCursor(this.dropDowns[this.lastCursor].cursor-1)}toggleOptionState(){this.dropDowns[this.lastCursor].toggleOptionState()}getVals(e){return this.getFilter(e).getVals()}resetSelection(e){this.dropDowns[e].resetToDefault(),this.updateFilterLabels()}setValsToDefault(){for(const e of this.dropDowns)e.resetToDefault()}getNearestFilter(e){const t=e.x+e.icon.displayWidth/2;let i=0,n=1e3;for(let a=0;a<this.labels.length;a++){const r=Math.abs(t-(this.labels[a].x+this.labels[a].displayWidth/3));r<n&&(i=a,n=r)}return i}};h(xd,"FilterBar");let Va=xd;var mt=(T=>(T[T.NAME=0]="NAME",T[T.MOVE_1=1]="MOVE_1",T[T.MOVE_2=2]="MOVE_2",T[T.ABILITY_1=3]="ABILITY_1",T[T.ABILITY_2=4]="ABILITY_2",T))(mt||{});const _d=class _d extends Phaser.GameObjects.Container{window;labels=[];selections=[];rows=[];cursorObj;numFilters=0;uiTheme;menuMessageBoxContainer;dialogueMessageBox;message;textPadding=8;onChange;defaultText="---";constructor(e,t,i,n,a){super(s,e,t),this.onChange=a,this.width=i,this.height=n,this.window=Ce(0,0,i,n,!1,!1,void 0,void 0,us.THIN),this.add(this.window),this.cursorObj=s.add.image(1,1,"cursor"),this.cursorObj.setScale(.5),this.cursorObj.setVisible(!1),this.cursorObj.setOrigin(0,0),this.add(this.cursorObj),this.menuMessageBoxContainer=s.add.container(0,130),this.menuMessageBoxContainer.setName("menu-message-box"),this.menuMessageBoxContainer.setVisible(!1),this.dialogueMessageBox=Ce(-this.textPadding,0,s.scaledCanvas.width+this.textPadding*2,49,!1,!1,0,0,us.THIN),this.dialogueMessageBox.setOrigin(0,0),this.menuMessageBoxContainer.add(this.dialogueMessageBox);const r=P(this.textPadding,this.textPadding,"",O.WINDOW,{maxLines:2});r.setName("menu-message"),r.setOrigin(0,0),this.menuMessageBoxContainer.add(r),this.message=r}addFilter(e,t){if(this.rows.includes(e))return!1;this.rows.push(e);const r=P(14,3,t,O.TOOLTIP_CONTENT);this.labels.push(r),this.add(r);const o=P(54,3,this.defaultText,O.TOOLTIP_CONTENT);return this.selections.push(o),this.add(o),this.calcFilterPositions(),this.numFilters++,!0}resetSelection(e){this.selections[e].setText(this.defaultText),this.onChange()}setValsToDefault(){for(let e=0;e<this.numFilters;e++)this.resetSelection(e)}startSearch(e,t){t.playSelect();const i="",n={};n.buttonActions=[a=>{t.playSelect();const o=decodeURIComponent(escape(atob(a))),l=t.getHandler();l.tutorialActive=!0,this.selections[e].setText(o===""?this.defaultText:String(f.t(o))),t.revertMode(),this.onChange()},()=>{t.revertMode(),this.onChange}],t.setOverlayMode(x.POKEDEX_SCAN,n,i,e)}setCursor(e){this.cursorObj.setPosition(8,this.labels[e].y+3)}updateFilterLabels(){for(let e=0;e<this.numFilters;e++)this.selections[e].text===this.defaultText?this.labels[e].setColor(le(O.TOOLTIP_CONTENT,!1)):this.labels[e].setColor(le(O.STATS_LABEL,!1))}calcFilterPositions(){let t=16;this.labels.forEach(n=>{t+=n.displayHeight});const i=(this.height-t)/(this.labels.length-1);for(let n=0;n<this.labels.length;n++)if(n===0)this.labels[n].y=8,this.selections[n].y=8;else{const a=this.labels[n-1].y+this.labels[n-1].displayHeight;this.labels[n].y=a+i,this.selections[n].y=a+i}}getValue(e){return this.selections[e].getWrappedText()[0]}setValue(e,t){this.selections[e].setText(t),this.onChange()}getNearestFilter(e){const t=e.y+e.icon.displayHeight/2;let i=0,n=1e3;for(let a=0;a<this.labels.length;a++){const r=Math.abs(t-(this.labels[a].y+this.labels[a].displayHeight/3));r<n&&(i=a,n=r)}return i}};h(_d,"FilterText");let Ul=_d;const wd=class wd extends Phaser.GameObjects.Container{species;icon;shinyIcons=[];label;starterPassiveBgs;hiddenAbilityIcon;favoriteIcon;classicWinIcon;candyUpgradeIcon;candyUpgradeOverlayIcon;eggMove1Icon;tmMove1Icon;eggMove2Icon;tmMove2Icon;passive1Icon;passive2Icon;passive1OverlayIcon;passive2OverlayIcon;cost=0;constructor(e,t={}){super(s,0,0),this.setSpecies(e,t);const i=s.add.image(2,5,"passive_bg");i.setOrigin(0,0),i.setScale(.75),i.setVisible(!1),this.add(i),this.starterPassiveBgs=i;for(let I=0;I<3;I++){const A=s.add.image(I*-3+12,2,"shiny_star_small");A.setScale(.5),A.setOrigin(0,0),A.setVisible(!1),this.shinyIcons.push(A)}this.add(this.shinyIcons);const n=P(1,2,"0",O.WINDOW,{fontSize:"32px"});n.setShadowOffset(2,2),n.setOrigin(0,0),n.setVisible(!1),this.add(n),this.label=n;const a=s.add.image(12,7,"ha_capsule");a.setOrigin(0,0),a.setScale(.5),a.setVisible(!1),this.add(a),this.hiddenAbilityIcon=a;const r=s.add.image(0,7,"favorite");r.setOrigin(0,0),r.setScale(.5),r.setVisible(!1),this.add(r),this.favoriteIcon=r;const o=s.add.image(0,12,"champion_ribbon");o.setOrigin(0,0),o.setScale(.5),o.setVisible(!1),this.add(o),this.classicWinIcon=o;const l=s.add.image(12,12,"candy");l.setOrigin(0,0),l.setScale(.25),l.setVisible(!1),this.add(l),this.candyUpgradeIcon=l;const c=s.add.image(12,12,"candy_overlay");c.setOrigin(0,0),c.setScale(.25),c.setVisible(!1),this.add(c),this.candyUpgradeOverlayIcon=c;const u=s.add.image(0,12,"common_egg");u.setOrigin(0,-.03),u.setScale(.24),u.setVisible(!1),this.add(u),this.eggMove1Icon=u;const p=s.add.image(0,12,"normal_memory");p.setOrigin(0,0),p.setScale(.25),p.setVisible(!1),this.add(p),this.tmMove1Icon=p;const m=s.add.image(7,12,"common_egg");m.setOrigin(0,0),m.setScale(.25),m.setVisible(!1),this.add(m),this.eggMove2Icon=m;const d=s.add.image(7,12,"normal_memory");d.setOrigin(0,0),d.setScale(.25),d.setVisible(!1),this.add(d),this.tmMove2Icon=d;const y=s.add.image(3,3,"candy");y.setOrigin(0,0),y.setScale(.25),y.setVisible(!1),this.add(y),this.passive1Icon=y;const g=s.add.image(12,12,"candy_overlay");g.setOrigin(0,0),g.setScale(.25),g.setVisible(!1),this.add(g),this.passive1OverlayIcon=g;const C=s.add.image(12,3,"candy");C.setOrigin(0,0),C.setScale(.25),C.setVisible(!1),this.add(C),this.passive2Icon=C;const E=s.add.image(12,12,"candy_overlay");E.setOrigin(0,0),E.setScale(.25),E.setVisible(!1),this.add(E),this.passive2OverlayIcon=E}setSpecies(e,t={}){this.species=e;const{shiny:i,formIndex:n,female:a,variant:r}=t,o=s.gameData.getSpeciesDefaultDexAttr(e,!1,!0),l=s.gameData.getSpeciesDexAttrProps(e,o);n!=null&&(l.formIndex=n),i!=null&&(l.shiny=i),r!=null&&(l.variant=r),a!=null&&(l.female=a),this.icon&&(this.remove(this.icon),this.icon.destroy()),this.icon=s.add.sprite(-2,2,e.getIconAtlasKey(l.formIndex,l.shiny,l.variant)),this.icon.setScale(.5),this.icon.setOrigin(0,0),this.icon.setFrame(e.getIconId(l.female,l.formIndex,l.shiny,l.variant)),this.checkIconId(l.female,l.formIndex,l.shiny,l.variant),this.add(this.icon),[this.hiddenAbilityIcon,this.favoriteIcon,this.classicWinIcon,this.candyUpgradeIcon,this.candyUpgradeOverlayIcon,this.eggMove1Icon,this.tmMove1Icon,this.eggMove2Icon,this.tmMove2Icon,this.passive1Icon,this.passive2Icon,this.passive1OverlayIcon,this.passive2OverlayIcon].forEach(c=>{c&&this.bringToTop(c)})}checkIconId(e,t,i,n){this.icon.frame.name!==this.species.getIconId(e,t,i,n)&&(`${this.species.name}`,this.icon.setTexture(this.species.getIconAtlasKey(t,!1,n)),this.icon.setFrame(this.species.getIconId(e,t,!1,n)))}};h(wd,"PokedexMonContainer");let Ha=wd;const bf={en:{starterInfoTextSize:"56px",instructionTextSize:"38px"},de:{starterInfoTextSize:"48px",instructionTextSize:"35px",starterInfoXPos:33},"es-ES":{starterInfoTextSize:"56px",instructionTextSize:"35px"},fr:{starterInfoTextSize:"54px",instructionTextSize:"38px"},it:{starterInfoTextSize:"56px",instructionTextSize:"38px"},pt_BR:{starterInfoTextSize:"47px",instructionTextSize:"38px",starterInfoXPos:33},zh:{starterInfoTextSize:"47px",instructionTextSize:"38px",starterInfoYOffset:1,starterInfoXPos:24},pt:{starterInfoTextSize:"48px",instructionTextSize:"42px",starterInfoXPos:33},ko:{starterInfoTextSize:"52px",instructionTextSize:"38px"},ja:{starterInfoTextSize:"51px",instructionTextSize:"38px"},"ca-ES":{starterInfoTextSize:"56px",instructionTextSize:"38px"}},RC=2,ea=17,ta=143;function xr(T){const i=T%9*18,n=13+Math.floor(T/9)*17;return{x:i,y:n}}h(xr,"calcStarterPosition$1");const Md=class Md extends Vt{starterSelectContainer;starterSelectScrollBar;filterBarContainer;filterBar;pokemonContainers=[];filteredPokemonData=[];pokemonNumberText;pokemonSprite;pokemonNameText;pokemonFormText;type1Icon;type2Icon;starterSelectMessageBox;starterSelectMessageBoxContainer;filterMode;filterBarCursor=0;scrollCursor;oldCursor=-1;lastSpecies;speciesLoaded=new Map;pokerusSpecies=[];speciesStarterDexEntry;assetLoadCancelled;cursorObj;pokerusCursorObjs;iconAnimHandler;starterPreferences;blockInput=!1;textPadding=8;defaultMessageBoxWidth=220;defaultWordWrapWidth=1224;menuMessageBoxContainer;menuMessageBox;dialogueMessageBox;manageDataConfig;filterTextOptions;optionSelectText;scale=.1666666667;menuBg;filterTextContainer;filterText;filterTextMode;filterTextCursor=0;showDecorations=!1;goFilterIconElement1;goFilterIconElement2;goFilterLabel;toggleDecorationsIconElement;toggleDecorationsLabel;formTrayContainer;trayBg;trayForms;trayContainers=[];trayNumIcons;trayRows;trayColumns;trayCursorObj;trayCursor=0;showingTray=!1;showFormTrayIconElement;showFormTrayLabel;canShowFormTray;filteredIndices;gameData;exitCallback;blockOpenPage=!1;constructor(){super(x.POKEDEX)}setup(){const e=this.getUi(),t=f.resolvedLanguage??"en",i=Object.keys(bf).find(X=>t.includes(X))??"en",n=bf[i];this.starterSelectContainer=s.add.container(0,-s.scaledCanvas.height),this.starterSelectContainer.setVisible(!1),e.add(this.starterSelectContainer);const a=s.add.rectangle(0,0,s.scaledCanvas.width,s.scaledCanvas.height,26720);a.setOrigin(0,0),this.starterSelectContainer.add(a);const r=Ce(ta,ea+1,175,161),o=s.add.image(ta+1,ea+2,"starter_container_bg");o.setOrigin(0,0),this.starterSelectContainer.add(o),this.starterSelectContainer.add(r),this.filterTextContainer=s.add.container(0,0),this.filterText=new Ul(1,ea+2,140,100,this.updateStarters),this.filterText.addFilter(mt.NAME,f.t("filterText:nameField")),this.filterText.addFilter(mt.MOVE_1,f.t("filterText:move1Field")),this.filterText.addFilter(mt.MOVE_2,f.t("filterText:move2Field")),this.filterText.addFilter(mt.ABILITY_1,f.t("filterText:ability1Field")),this.filterText.addFilter(mt.ABILITY_2,f.t("filterText:ability2Field")),this.filterTextContainer.add(this.filterText),this.starterSelectContainer.add(this.filterTextContainer),this.filterBarContainer=s.add.container(0,0),this.filterBar=new Va(ta,1,175,ea,2,0,6);const l=[new Oe(1,new oe(f.t("pokedexUiHandler:gen1"))),new Oe(2,new oe(f.t("pokedexUiHandler:gen2"))),new Oe(3,new oe(f.t("pokedexUiHandler:gen3"))),new Oe(4,new oe(f.t("pokedexUiHandler:gen4"))),new Oe(5,new oe(f.t("pokedexUiHandler:gen5"))),new Oe(6,new oe(f.t("pokedexUiHandler:gen6"))),new Oe(7,new oe(f.t("pokedexUiHandler:gen7"))),new Oe(8,new oe(f.t("pokedexUiHandler:gen8"))),new Oe(9,new oe(f.t("pokedexUiHandler:gen9")))],c=new Gt(0,0,l,this.updateStarters,Wt.HYBRID);this.filterBar.addFilter(Pe.GEN,f.t("filterBar:genFilter"),c);const u=Object.keys(Me).filter(X=>Number.isNaN(Number(X))),p=[];u.forEach((X,J)=>{if(J===0||J===19)return;const R=s.add.sprite(0,0,Kt("types"));R.setScale(.5),R.setFrame(X.toLowerCase()),p.push(new Oe(J,new oe("",R)))}),this.filterBar.addFilter(Pe.TYPES,f.t("filterBar:typeFilter"),new Gt(0,0,p,this.updateStarters,Wt.HYBRID,.5));const m=Object.values(Je).filter(X=>typeof X=="number").map((X,J)=>new Oe(J,new oe(f.t(`biome:${bt(Je[X])}`))));m.push(new Oe(m.length,new oe(f.t("filterBar:uncatchable"))));const d=new Gt(0,0,m,this.updateStarters,Wt.HYBRID);this.filterBar.addFilter(Pe.BIOME,f.t("filterBar:biomeFilter"),d);const y=s.add.sprite(0,0,"shiny_icons");y.setOrigin(.15,.2),y.setScale(.6),y.setFrame(os(0)),y.setTint(Et(0));const g=s.add.sprite(0,0,"shiny_icons");g.setOrigin(.15,.2),g.setScale(.6),g.setFrame(os(1)),g.setTint(Et(1));const C=s.add.sprite(0,0,"shiny_icons");C.setOrigin(.15,.2),C.setScale(.6),C.setFrame(os(2)),C.setTint(Et(2));const E=[new Oe("SHINY3",new oe("",C)),new Oe("SHINY2",new oe("",g)),new Oe("SHINY",new oe("",y)),new Oe("NORMAL",new oe(f.t("filterBar:normal"))),new Oe("UNCAUGHT",new oe(f.t("filterBar:uncaught")))];this.filterBar.addFilter(Pe.CAUGHT,f.t("filterBar:caughtFilter"),new Gt(0,0,E,this.updateStarters,Wt.HYBRID));const I=[new oe(f.t("filterBar:passive"),void 0,Q.OFF),new oe(f.t("filterBar:passiveUnlocked"),void 0,Q.ON),new oe(f.t("filterBar:passiveUnlockable"),void 0,Q.UNLOCKABLE),new oe(f.t("filterBar:passiveLocked"),void 0,Q.EXCLUDE)],A=[new oe(f.t("filterBar:costReduction"),void 0,Q.OFF),new oe(f.t("filterBar:costReductionUnlocked"),void 0,Q.ON),new oe(f.t("filterBar:costReductionUnlockedOne"),void 0,Q.ONE),new oe(f.t("filterBar:costReductionUnlockedTwo"),void 0,Q.TWO),new oe(f.t("filterBar:costReductionUnlockable"),void 0,Q.UNLOCKABLE),new oe(f.t("filterBar:costReductionLocked"),void 0,Q.EXCLUDE)],_=[new Oe("PASSIVE",I),new Oe("COST_REDUCTION",A)];this.filterBar.addFilter(Pe.UNLOCKS,f.t("filterBar:unlocksFilter"),new Gt(0,0,_,this.updateStarters,Wt.RADIAL));const w=[new oe(f.t("filterBar:starter"),void 0,Q.OFF),new oe(f.t("filterBar:isStarter"),void 0,Q.ON),new oe(f.t("filterBar:notStarter"),void 0,Q.EXCLUDE)],L=[new oe(f.t("filterBar:favorite"),void 0,Q.OFF),new oe(f.t("filterBar:isFavorite"),void 0,Q.ON),new oe(f.t("filterBar:notFavorite"),void 0,Q.EXCLUDE)],V=[new oe(f.t("filterBar:ribbon"),void 0,Q.OFF),new oe(f.t("filterBar:hasWon"),void 0,Q.ON),new oe(f.t("filterBar:hasNotWon"),void 0,Q.EXCLUDE)],H=[new oe(f.t("filterBar:hiddenAbility"),void 0,Q.OFF),new oe(f.t("filterBar:hasHiddenAbility"),void 0,Q.ON),new oe(f.t("filterBar:noHiddenAbility"),void 0,Q.EXCLUDE)],W=[new oe(f.t("filterBar:seenSpecies"),void 0,Q.OFF),new oe(f.t("filterBar:isSeen"),void 0,Q.ON),new oe(f.t("filterBar:isUnseen"),void 0,Q.EXCLUDE)],ee=[new oe(f.t("filterBar:encounteredSpecies"),void 0,Q.OFF),new oe(f.t("filterBar:isEncountered"),void 0,Q.ON),new oe(f.t("filterBar:isNotEncountered"),void 0,Q.EXCLUDE)],me=[new oe(f.t("filterBar:egg"),void 0,Q.OFF),new oe(f.t("filterBar:eggPurchasable"),void 0,Q.ON)],N=[new oe(f.t("filterBar:pokerus"),void 0,Q.OFF),new oe(f.t("filterBar:hasPokerus"),void 0,Q.ON)],j=[new Oe("STARTER",w),new Oe("FAVORITE",L),new Oe("WIN",V),new Oe("HIDDEN_ABILITY",H),new Oe("SEEN_SPECIES",W),new Oe("ENCOUNTERED_SPECIES",ee),new Oe("EGG",me),new Oe("POKERUS",N)];this.filterBar.addFilter(Pe.MISC,f.t("filterBar:miscFilter"),new Gt(0,0,j,this.updateStarters,Wt.RADIAL));const v=[new Oe(qe.NUMBER,new oe(f.t("filterBar:sortByNumber"),void 0,Q.ON)),new Oe(qe.COST,new oe(f.t("filterBar:sortByCost"))),new Oe(qe.CANDY,new oe(f.t("filterBar:sortByCandies"))),new Oe(qe.IV,new oe(f.t("filterBar:sortByIVs"))),new Oe(qe.NAME,new oe(f.t("filterBar:sortByName"))),new Oe(qe.CAUGHT,new oe(f.t("filterBar:sortByNumCaught"))),new Oe(qe.HATCHED,new oe(f.t("filterBar:sortByNumHatched")))];this.filterBar.addFilter(Pe.SORT,f.t("filterBar:sortFilter"),new Gt(0,0,v,this.updateStarters,Wt.SINGLE)),this.filterBarContainer.add(this.filterBar),this.starterSelectContainer.add(this.filterBarContainer),this.filterBar.offsetHybridFilters(),s.uiTheme===Gh.DEFAULT&&r.setVisible(!1),this.iconAnimHandler=new lr,this.iconAnimHandler.setup(),this.pokemonNumberText=P(6,141,"",O.SUMMARY),this.pokemonNumberText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonNumberText),this.pokemonNameText=P(6,128,"",O.SUMMARY),this.pokemonNameText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonNameText),this.pokemonFormText=P(6,121,"",O.INSTRUCTIONS_TEXT,{fontSize:n.instructionTextSize}),this.pokemonFormText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonFormText);const z=s.add.container(ta+6,9);this.starterSelectScrollBar=new Ps(161,12,5,r.height-6,9),z.add(this.starterSelectScrollBar),this.pokerusCursorObjs=[];for(let X=0;X<Tg;X++){const J=s.add.image(0,0,"select_cursor_pokerus");J.setVisible(!1),J.setOrigin(0,0),z.add(J),this.pokerusCursorObjs.push(J)}this.cursorObj=s.add.image(0,0,"select_cursor"),this.cursorObj.setOrigin(0,0),z.add(this.cursorObj);for(const X of it)this.speciesLoaded.set(X.speciesId,!1);for(let X=0;X<81;X++){const J=new Ha(it[X]).setVisible(!1),R=xr(X);J.setPosition(R.x,R.y),this.iconAnimHandler.addOrUpdate(J.icon,Ft.NONE),this.pokemonContainers.push(J),z.add(J)}this.formTrayContainer=s.add.container(0,0),this.trayBg=Ce(0,0,0,0),this.trayBg.setOrigin(0,0),this.formTrayContainer.add(this.trayBg),this.trayCursorObj=s.add.image(0,0,"select_cursor"),this.trayCursorObj.setOrigin(0,0),this.formTrayContainer.add(this.trayCursorObj),z.add(this.formTrayContainer),z.bringToTop(this.formTrayContainer),this.formTrayContainer.setVisible(!1),this.starterSelectContainer.add(z),this.pokemonSprite=s.add.sprite(96,143,"pkmn__sub"),this.pokemonSprite.setPipeline(s.spritePipeline,{tone:[0,0,0,0],ignoreTimeTint:!0}),this.starterSelectContainer.add(this.pokemonSprite),this.type1Icon=s.add.sprite(10,158,Kt("types")),this.type1Icon.setScale(.5),this.type1Icon.setOrigin(0,0),this.starterSelectContainer.add(this.type1Icon),this.type2Icon=s.add.sprite(28,158,Kt("types")),this.type2Icon.setScale(.5),this.type2Icon.setOrigin(0,0),this.starterSelectContainer.add(this.type2Icon),this.starterSelectMessageBoxContainer=s.add.container(0,s.scaledCanvas.height),this.starterSelectMessageBoxContainer.setVisible(!1),this.starterSelectContainer.add(this.starterSelectMessageBoxContainer),this.starterSelectMessageBox=Ce(1,-1,318,28),this.starterSelectMessageBox.setOrigin(0,1),this.starterSelectMessageBoxContainer.add(this.starterSelectMessageBox);const ne=n.instructionTextSize;this.goFilterIconElement1=new Phaser.GameObjects.Sprite(s,10,2,"keyboard","C.png"),this.goFilterIconElement1.setName("sprite-goFilter1-icon-element"),this.goFilterIconElement1.setScale(.675),this.goFilterIconElement1.setOrigin(0,0),this.goFilterIconElement2=new Phaser.GameObjects.Sprite(s,20,2,"keyboard","V.png"),this.goFilterIconElement2.setName("sprite-goFilter2-icon-element"),this.goFilterIconElement2.setScale(.675),this.goFilterIconElement2.setOrigin(0,0),this.goFilterLabel=P(30,2,f.t("pokedexUiHandler:goFilters"),O.INSTRUCTIONS_TEXT,{fontSize:ne}),this.goFilterLabel.setName("text-goFilter-label"),this.starterSelectContainer.add(this.goFilterIconElement1),this.starterSelectContainer.add(this.goFilterIconElement2),this.starterSelectContainer.add(this.goFilterLabel),this.toggleDecorationsIconElement=new Phaser.GameObjects.Sprite(s,10,10,"keyboard","R.png"),this.toggleDecorationsIconElement.setName("sprite-toggleDecorations-icon-element"),this.toggleDecorationsIconElement.setScale(.675),this.toggleDecorationsIconElement.setOrigin(0,0),this.toggleDecorationsLabel=P(20,10,f.t("pokedexUiHandler:toggleDecorations"),O.INSTRUCTIONS_TEXT,{fontSize:ne}),this.toggleDecorationsLabel.setName("text-toggleDecorations-label"),this.starterSelectContainer.add(this.toggleDecorationsIconElement),this.starterSelectContainer.add(this.toggleDecorationsLabel),this.showFormTrayIconElement=new Phaser.GameObjects.Sprite(s,6,168,"keyboard","F.png"),this.showFormTrayIconElement.setName("sprite-showFormTray-icon-element"),this.showFormTrayIconElement.setScale(.675),this.showFormTrayIconElement.setOrigin(0,0),this.showFormTrayLabel=P(16,168,f.t("pokedexUiHandler:showForms"),O.INSTRUCTIONS_TEXT,{fontSize:ne}),this.showFormTrayLabel.setName("text-showFormTray-label"),this.showFormTrayIconElement.setVisible(!1),this.showFormTrayLabel.setVisible(!1),this.starterSelectContainer.add(this.showFormTrayIconElement),this.starterSelectContainer.add(this.showFormTrayLabel),this.message=P(8,8,"",O.WINDOW,{maxLines:2}),this.message.setOrigin(0,0),this.starterSelectMessageBoxContainer.add(this.message),this.initPromptSprite(this.starterSelectMessageBoxContainer),this.starterSelectContainer.bringToTop(this.filterBarContainer),this.initTutorialOverlay(this.starterSelectContainer),this.starterSelectContainer.bringToTop(this.starterSelectMessageBoxContainer),this.starterSelectContainer.bringToTop(this.pokemonNameText),this.starterSelectContainer.bringToTop(this.pokemonFormText)}show(e){if(this.starterPreferences||(this.starterPreferences=Cg()),this.pokerusSpecies=Sg(),e.length>0){if(e[0]==="refresh")return!1;[this.gameData,this.exitCallback]=e,this.blockOpenPage=!0}else this.gameData=s.gameData,this.blockOpenPage=!1;return super.show(e),this.starterSelectContainer.setVisible(!0),this.getUi().bringToTop(this.starterSelectContainer),this.pokemonContainers.forEach(t=>{const i=t.icon,n=t.species;this.starterPreferences[n.speciesId]=this.initStarterPrefs(n),this.setUpgradeAnimation(i,n)}),this.resetFilters(),this.updateStarters(),this.setFilterMode(!1),this.filterBarCursor=0,this.setFilterTextMode(!1),this.filterTextCursor=0,this.setCursor(0),this.filterTextContainer.setVisible(!0),!0}initStarterPrefs(e){const t=this.starterPreferences[e.speciesId],i=this.gameData.dexData[e.speciesId],n=this.gameData.starterData[e.speciesId];if(!t||!i.caughtAttr)return{};const a=i.caughtAttr&e.getFullUnlocksData(),r=a&F.SHINY,o=a&F.NON_SHINY;if(t.shiny&&!r?(t.shiny=void 0,t.variant=void 0):t.shiny===!1&&!o&&(t.shiny=void 0),t.variant!==void 0){const c=[r&&a&F.DEFAULT_VARIANT,r&&a&F.VARIANT_2,r&&a&F.VARIANT_3];(Number.isNaN(t.variant)||t.variant<0||!c[t.variant])&&(t.variant=void 0)}if(t.female!==void 0&&!(t.female?a&F.FEMALE:a&F.MALE)&&(t.female=void 0),t.ability!==void 0){const c=e.ability2===e.ability1,u=n.abilityAttr,p=u&ht.ABILITY_1,m=u&ht.ABILITY_2,d=u&ht.ABILITY_HIDDEN;[p,c?m&&!p:m,d][t.ability]||(t.ability=void 0)}const l=t.form;return l!==void 0&&(!e.forms[l]?.isStarterSelectable||!(a&this.gameData.getFormAttr(l)))&&(t.form=void 0),t.nature!==void 0&&this.gameData.getNaturesForAttr(i.natureAttr).indexOf(t.nature)<0&&(t.nature=void 0),t}resetFilters(){this.filterBar.setValsToDefault(),this.filterText.setValsToDefault()}showText(e,t,i,n,a,r,o){super.showText(e,t,i,n,a,r);const l=e?.indexOf(`
`)===-1;this.starterSelectMessageBox.setSize(318,l?28:42),o?(this.starterSelectMessageBox.setOrigin(0,0),this.starterSelectMessageBoxContainer.setY(0),this.message.setY(4)):(this.starterSelectMessageBoxContainer.setY(s.scaledCanvas.height),this.starterSelectMessageBox.setOrigin(0,1),this.message.setY(l?-22:-37)),this.starterSelectMessageBoxContainer.setVisible(e?.length>0)}isSeen(e,t,i){return t?.seenAttr?!0:i?!1:!!this.gameData.dexData[this.getStarterSpeciesId(e.speciesId)]?.caughtAttr}isEncountered(e,t,i){return!!t.seenCount}isUpgradeIconEnabled(){return s.candyUpgradeNotification!==0&&s.candyUpgradeDisplay===0}isUpgradeAnimationEnabled(){return s.candyUpgradeNotification!==0&&s.candyUpgradeDisplay===1}getStarterSpeciesId(e){return $e.hasOwnProperty(e)?e:Gr[e]}isPassiveAvailable(e){const t=this.gameData.starterData[this.getStarterSpeciesId(e)];return t.candyCount>=cn($e[this.getStarterSpeciesId(e)])&&!(t.passiveAttr&At.UNLOCKED)}isValueReductionAvailable(e){const t=this.gameData.starterData[this.getStarterSpeciesId(e)];return t.candyCount>=un($e[this.getStarterSpeciesId(e)])[t.valueReduction]&&t.valueReduction<RC}isSameSpeciesEggAvailable(e){const{gameData:t}=this,i=this.getStarterSpeciesId(e),n=t.starterData[i].candyCount,a=t.dexData[i].hatchedCount;return n>=dn($e[i],a)}setUpgradeAnimation(e,t,i=!1){if(s.tweens.killTweensOf(e),s.candyUpgradeDisplay===0||t.speciesId!==t.getRootSpeciesId(!1))return;e.y=2;const n={targets:e,loop:-1,paused:i,delay:Eg(0,50)*5,loopDelay:1e3,tweens:[{targets:e,y:-3,duration:ge(125),ease:"Cubic.easeOut",yoyo:!0},{targets:e,y:-1,duration:ge(150),ease:"Cubic.easeOut",yoyo:!0}]};if(this.isPassiveAvailable(t.speciesId)||s.candyUpgradeNotification===2&&(this.isValueReductionAvailable(t.speciesId)||this.isSameSpeciesEggAvailable(t.speciesId))){const a=s.tweens.chain(n);i||a.play()}}setUpgradeIcon(e){const t=e.species,i=!!t?.speciesId;if(!t||s.candyUpgradeNotification===0||t.speciesId!==t.getRootSpeciesId(!1)){e.candyUpgradeIcon.setVisible(!1),e.candyUpgradeOverlayIcon.setVisible(!1);return}const n=this.isPassiveAvailable(t.speciesId),a=this.isValueReductionAvailable(t.speciesId),r=this.isSameSpeciesEggAvailable(t.speciesId);s.candyUpgradeNotification===1?(e.candyUpgradeIcon.setVisible(i&&n),e.candyUpgradeOverlayIcon.setVisible(i&&e.candyUpgradeIcon.visible)):s.candyUpgradeNotification===2&&(e.candyUpgradeIcon.setVisible(i&&(n||a||r)),e.candyUpgradeOverlayIcon.setVisible(i&&e.candyUpgradeIcon.visible))}updateCandyUpgradeDisplay(e){this.isUpgradeIconEnabled()&&this.setUpgradeIcon(e),this.isUpgradeAnimationEnabled()&&this.setUpgradeAnimation(e.icon,this.lastSpecies,!0)}processInput(e){if(this.blockInput)return!1;const t=9,i=this.filteredPokemonData.length,n=Math.ceil(i/t),a=this.scrollCursor*t,r=Math.floor((a+this.cursor)/t),o=this.getUi();let l=!1,c=!1;if(e===b.SUBMIT)c=!0;else if(e===b.CANCEL)this.filterMode&&this.filterBar.openDropDown?(this.filterBar.toggleDropDown(this.filterBarCursor),l=!0):this.filterMode&&!this.filterBar.getFilter(this.filterBarCursor).hasDefaultValues()?(this.filterBar.resetSelection(this.filterBarCursor),this.updateStarters(),l=!0):this.filterTextMode&&this.filterText.getValue(this.filterTextCursor)!==this.filterText.defaultText?(this.filterText.resetSelection(this.filterTextCursor),l=!0):this.showingTray?l=this.closeFormTray():(this.tryExit(),l=!0);else if(e===b.STATS)!this.filterMode&&!this.showingTray?(this.cursorObj.setVisible(!1),this.setSpecies(null),this.filterText.cursorObj.setVisible(!1),this.filterTextMode=!1,this.filterBarCursor=0,this.setFilterMode(!0)):c=!0;else if(e===b.CYCLE_TERA)!this.filterTextMode&&!this.showingTray?(this.cursorObj.setVisible(!1),this.setSpecies(null),this.filterBar.cursorObj.setVisible(!1),this.filterMode=!1,this.filterTextCursor=0,this.setFilterTextMode(!0)):c=!0;else if(e===b.CYCLE_SHINY)this.showingTray?c=!0:(this.showDecorations=!this.showDecorations,this.updateScroll(),l=!0);else if(this.filterMode)switch(e){case b.LEFT:this.filterBarCursor>0?l=this.setCursor(this.filterBarCursor-1):l=this.setCursor(this.filterBar.numFilters-1);break;case b.RIGHT:this.filterBarCursor<this.filterBar.numFilters-1?l=this.setCursor(this.filterBarCursor+1):l=this.setCursor(0);break;case b.UP:if(this.filterBar.openDropDown)l=this.filterBar.decDropDownCursor();else if(i>0){this.setFilterMode(!1),this.scrollCursor=Math.max(0,n-9),this.updateScroll();const u=this.filterBarCursor/Math.max(1,this.filterBar.numFilters-1),p=Math.min(8,u<.5?Math.floor(u*8):Math.ceil(u*8));i%9>p?this.setCursor(i-i%9+p-this.scrollCursor*9):this.setCursor(Math.max(i-i%9+p-9-this.scrollCursor*9,0)),l=!0}break;case b.DOWN:if(this.filterBar.openDropDown)l=this.filterBar.incDropDownCursor();else if(i>0){this.setFilterMode(!1),this.scrollCursor=0,this.updateScroll();const u=this.filterBarCursor/Math.max(1,this.filterBar.numFilters-1),p=Math.min(8,u<.5?Math.floor(u*8):Math.ceil(u*8));this.setCursor(Math.min(p,i-1)),l=!0}break;case b.ACTION:this.filterBar.openDropDown?this.filterBar.toggleOptionState():this.filterBar.toggleDropDown(this.filterBarCursor),l=!0;break}else if(this.filterTextMode)switch(e){case b.LEFT:if(i>0){this.setFilterTextMode(!1);const u=this.filterTextCursor;this.setCursor(u<n-1?(u+1)*t-1:i-1),l=!0}break;case b.RIGHT:if(i>0){this.setFilterTextMode(!1);const u=this.filterTextCursor;this.setCursor(u<n?u*t:(n-1)*t),l=!0}break;case b.UP:this.filterTextCursor>0?l=this.setCursor(this.filterTextCursor-1):l=this.setCursor(this.filterText.numFilters-1);break;case b.DOWN:this.filterTextCursor<this.filterText.numFilters-1?l=this.setCursor(this.filterTextCursor+1):l=this.setCursor(0);break;case b.ACTION:this.filterText.startSearch(this.filterTextCursor,this.getUi()),l=!0;break}else if(this.showingTray)if(e===b.ACTION){const u=this.trayForms[this.trayCursor].formIndex;this.blockOpenPage?(l=!1,c=!0):(o.setOverlayMode(x.POKEDEX_PAGE,this.lastSpecies,{form:u},this.filteredIndices),l=!0)}else{const u=this.trayContainers.length,p=Math.ceil(u/t),m=Math.floor(this.trayCursor/t);switch(e){case b.UP:if(m>0)l=this.setTrayCursor(this.trayCursor-9);else{const d=this.trayCursor;u%9>d?l=this.setTrayCursor(u-u%9+d):l=this.setTrayCursor(Math.max(u-u%9+d-9,0))}break;case b.DOWN:m<p-1?l=this.setTrayCursor(this.trayCursor+9):l=this.setTrayCursor(this.trayCursor%9);break;case b.LEFT:this.trayCursor%9!==0?l=this.setTrayCursor(this.trayCursor-1):l=this.setTrayCursor(m<p-1?(m+1)*t-1:u-1);break;case b.RIGHT:this.trayCursor%9<(m<p-1?8:(u-1)%9)?l=this.setTrayCursor(this.trayCursor+1):l=this.setTrayCursor(m*9);break;case b.CYCLE_FORM:l=this.closeFormTray();break}}else if(e===b.ACTION)this.blockOpenPage?(l=!1,c=!0):(o.setOverlayMode(x.POKEDEX_PAGE,this.lastSpecies,null,this.filteredIndices),l=!0);else switch(e){case b.UP:r>0?this.scrollCursor>0&&r-this.scrollCursor===0?(this.scrollCursor--,this.updateScroll(),l=this.setCursor(this.cursor)):l=this.setCursor(this.cursor-9):(this.filterBarCursor=this.filterBar.getNearestFilter(this.pokemonContainers[this.cursor]),this.setFilterMode(!0),l=!0);break;case b.DOWN:r<n-1&&this.cursor+9<this.filteredPokemonData.length?r-this.scrollCursor===8?(this.scrollCursor++,this.updateScroll(),l=this.setCursor(this.cursor)):l=this.setCursor(this.cursor+9):n>1?(this.scrollCursor=0,this.updateScroll(),l=this.setCursor(this.cursor%9)):(this.filterBarCursor=this.filterBar.getNearestFilter(this.pokemonContainers[this.cursor]),this.setFilterMode(!0),l=!0);break;case b.LEFT:this.cursor%9!==0?l=this.setCursor(this.cursor-1):(this.filterTextCursor=this.filterText.getNearestFilter(this.pokemonContainers[this.cursor]),this.setFilterTextMode(!0),l=!0);break;case b.RIGHT:this.cursor%9<(r<n-1?8:(i-1)%9)?l=this.setCursor(this.cursor+1):(this.filterTextCursor=this.filterText.getNearestFilter(this.pokemonContainers[this.cursor]),this.setFilterTextMode(!0),l=!0);break;case b.CYCLE_FORM:{const u=this.pokemonContainers[this.cursor].species;this.canShowFormTray&&(l=this.openFormTray(u));break}}return l?o.playSelect():c&&o.playError(),l||c}updateButtonIcon(e,t,i,n){let a;if(t==="touch")switch(t="keyboard",e){case re.Button_Cycle_Shiny:a="R.png";break;case re.Button_Cycle_Form:a="F.png";break;case re.Button_Stats:a="C.png";break}else a=s.inputController?.getIconForLatestInputRecorded(e);i.setTexture(t,a),i.setVisible(!0),n.setVisible(!0)}updateFilterButtonIcon(e,t,i,n){let a;t==="touch"?(t="keyboard",a="C.png"):a=s.inputController?.getIconForLatestInputRecorded(e),i.setTexture(t,a),i.setVisible(!0),n.setVisible(!0)}getSanitizedProps(e){return{shiny:!1,female:e.female,variant:0,formIndex:e.formIndex}}hasFormLevelMove(e,t){return!Ms.hasOwnProperty(e.speciesId)||!Ms[e.speciesId].hasOwnProperty(e.formIndex)?!1:Ms[e.speciesId][e.formIndex].map(n=>We[n[1]].name).includes(t)}updateStarters=h(()=>{this.scrollCursor=0,this.filteredPokemonData=[],this.pokerusCursorObjs.forEach(t=>t.setVisible(!1)),this.filterBar.updateFilterLabels(),this.filterText.updateFilterLabels(),this.filteredPokemonData=[],it.forEach(t=>{const i=this.getStarterSpeciesId(t.speciesId),n=this.getCurrentDexProps(t.speciesId),a=this.getSanitizedProps(this.gameData.getSpeciesDexAttrProps(t,n)),r={species:t,cost:this.gameData.getSpeciesStarterValue(i),props:a},o=(this.gameData.dexData[t.speciesId]?.caughtAttr||BigInt(0))&(this.gameData.dexData[this.getStarterSpeciesId(t.speciesId)]?.caughtAttr||BigInt(0))&t.getFullUnlocksData(),l=this.gameData.starterData[i],c=Ht.hasOwnProperty(i),u=this.filterText.getValue(mt.NAME),p=t.name===u||u===this.filterText.defaultText,m=ya[t.speciesId].map(q=>We[q[1]].name),d=Ht[i]?.map(q=>We[q].name)??[],y=fg[t.speciesId]?.map(q=>We[Array.isArray(q)?q[1]:q].name)??[],g=this.filterText.getValue(mt.MOVE_1),C=this.filterText.getValue(mt.MOVE_2),E=t.forms.some(q=>this.hasFormLevelMove(q,g)),I=t.forms.some(q=>this.hasFormLevelMove(q,C)),A=m.includes(g)||E,_=d.includes(g),w=y.includes(g),L=m.includes(C)||I,V=d.includes(C),H=y.includes(C),W=A||_||w||g===this.filterText.defaultText,ee=L||V||H||C===this.filterText.defaultText,me=W&&ee;if(_&&!A){const q=d.indexOf(g);(l.eggMoves&1<<q)===0?r.eggMove1=!1:r.eggMove1=!0}else w&&!A&&(r.tmMove1=!0);if(V&&!L){const q=d.indexOf(C);(l.eggMoves&1<<q)===0?r.eggMove2=!1:r.eggMove2=!0}else H&&!L&&(r.tmMove2=!0);const N=[t.ability1,t.ability2,t.abilityHidden].map(q=>_t[q].name),j=[t.getPassiveAbility()];for(const q of t.forms)j.push(q.getPassiveAbility());const v=this.filterText.getValue(mt.ABILITY_1),z=t.forms.some(q=>[q.ability1,q.ability2,q.abilityHidden].map(bs=>_t[bs].name).includes(v)),ne=N.includes(v)||z||v===this.filterText.defaultText,X=Object.values(j).some(q=>_t[q].name===v),J=this.filterText.getValue(mt.ABILITY_2),R=t.forms.some(q=>[q.ability1,q.ability2,q.abilityHidden].map(bs=>_t[bs].name).includes(J)),Te=N.includes(J)||R||J===this.filterText.defaultText,Y=Object.values(j).some(q=>_t[q].name===J),U=ne&&(Y||J===this.filterText.defaultText)||Te&&(X||v===this.filterText.defaultText);(X||Y)&&(X?l.passiveAttr>0?r.passive1=!0:r.passive1=!1:l.passiveAttr>0?r.passive2=!0:r.passive2=!1);const Ee=this.filterBar.getVals(Pe.GEN).includes(t.generation),ue=this.filterBar.getVals(Pe.TYPES).some(q=>t.isOfType(q-1)),he=new Map(Object.values(Je).map((q,bs)=>typeof q=="string"?[bs,q]:void 0).filter(q=>q!==void 0));he.set(35,"Uncatchable");const be=Ta[t.speciesId].concat(Ta[i]).map(q=>Je[q.biome]);be.length===0&&be.push("Uncatchable");const _e=be.length===0&&this.filterBar.getVals(Pe.BIOME).length===36,we=this.filterBar.getVals(Pe.BIOME).some(q=>be.includes(he.get(q)??""))||_e,Ne=!!(o&F.NON_SHINY),ot=!!(o&F.SHINY),je=ot&&!!(o&F.DEFAULT_VARIANT),Ct=ot&&!!(o&F.VARIANT_2),Ae=ot&&!!(o&F.VARIANT_3),S=!Ne&&!je&&!Ct&&!Ae,Z=this.filterBar.getVals(Pe.CAUGHT).some(q=>{if(q==="SHINY3")return Ae;if(q==="SHINY2")return Ct&&!Ae;if(q==="SHINY")return je&&!Ct&&!Ae;if(q==="NORMAL")return Ne&&!je&&!Ct&&!Ae;if(q==="UNCAUGHT")return S}),$=l.passiveAttr>0,k=this.isPassiveAvailable(t.speciesId)&&!$,M=this.filterBar.getVals(Pe.UNLOCKS).some(q=>{if(q.val==="PASSIVE"&&q.state===Q.ON)return $;if(q.val==="PASSIVE"&&q.state===Q.EXCLUDE)return c&&!$;if(q.val==="PASSIVE"&&q.state===Q.UNLOCKABLE)return k;if(q.val==="PASSIVE"&&q.state===Q.OFF)return!0}),D=l.valueReduction===1,te=l.valueReduction===2,se=this.isValueReductionAvailable(t.speciesId),K=this.filterBar.getVals(Pe.UNLOCKS).some(q=>{if(q.val==="COST_REDUCTION"&&q.state===Q.ON)return D||te;if(q.val==="COST_REDUCTION"&&q.state===Q.ONE)return D;if(q.val==="COST_REDUCTION"&&q.state===Q.TWO)return te;if(q.val==="COST_REDUCTION"&&q.state===Q.EXCLUDE)return c&&!(D||te);if(q.val==="COST_REDUCTION"&&q.state===Q.UNLOCKABLE)return se;if(q.val==="COST_REDUCTION"&&q.state===Q.OFF)return!0}),ce=this.getStarterSpeciesId(t.speciesId)===t.speciesId,Se=this.filterBar.getVals(Pe.MISC).some(q=>{if(q.val==="STARTER"&&q.state===Q.ON)return ce;if(q.val==="STARTER"&&q.state===Q.EXCLUDE)return!ce;if(q.val==="STARTER"&&q.state===Q.OFF)return!0}),pe=this.starterPreferences[t.speciesId]?.favorite??!1,xe=this.filterBar.getVals(Pe.MISC).some(q=>{if(q.val==="FAVORITE"&&q.state===Q.ON)return pe;if(q.val==="FAVORITE"&&q.state===Q.EXCLUDE)return!pe;if(q.val==="FAVORITE"&&q.state===Q.OFF)return!0}),Qe=l.classicWinCount>0,Ue=l.classicWinCount===0,jt=l.classicWinCount===void 0,ni=this.filterBar.getVals(Pe.MISC).some(q=>{if(q.val==="WIN"&&q.state===Q.ON)return Qe;if(q.val==="WIN"&&q.state===Q.EXCLUDE)return Ue||jt;if(q.val==="WIN"&&q.state===Q.OFF)return!0}),rs=t.abilityHidden!==t.ability1&&t.abilityHidden!==Bn.NONE,Gs=l.abilityAttr&ht.ABILITY_HIDDEN,ut=this.filterBar.getVals(Pe.MISC).some(q=>{if(q.val==="HIDDEN_ABILITY"&&q.state===Q.ON)return Gs;if(q.val==="HIDDEN_ABILITY"&&q.state===Q.EXCLUDE)return rs&&!Gs;if(q.val==="HIDDEN_ABILITY"&&q.state===Q.OFF)return!0}),Ys=this.gameData.dexData[t.speciesId],gi=this.isSeen(t,Ys,!0)||!!Ys.caughtAttr,gs=this.filterBar.getVals(Pe.MISC).some(q=>{if(q.val==="SEEN_SPECIES"&&q.state===Q.ON)return gi;if(q.val==="SEEN_SPECIES"&&q.state===Q.EXCLUDE)return!gi;if(q.val==="SEEN_SPECIES"&&q.state===Q.OFF)return!0}),Wi=this.isEncountered(t,Ys,!0),hr=this.filterBar.getVals(Pe.MISC).some(q=>{if(q.val==="ENCOUNTERED_SPECIES"&&q.state===Q.ON)return Wi;if(q.val==="ENCOUNTERED_SPECIES"&&q.state===Q.EXCLUDE)return!Wi;if(q.val==="ENCOUNTERED_SPECIES"&&q.state===Q.OFF)return!0}),Un=this.isSameSpeciesEggAvailable(t.speciesId),cr=this.filterBar.getVals(Pe.MISC).some(q=>{if(q.val==="EGG"&&q.state===Q.ON)return Un;if(q.val==="EGG"&&q.state===Q.EXCLUDE)return c&&!Un;if(q.val==="EGG"&&q.state===Q.OFF)return!0}),Vn=this.filterBar.getVals(Pe.MISC).some(q=>{if(q.val==="POKERUS"&&q.state===Q.ON)return this.pokerusSpecies.includes(t);if(q.val==="POKERUS"&&q.state===Q.EXCLUDE)return!this.pokerusSpecies.includes(t);if(q.val==="POKERUS"&&q.state===Q.OFF)return!0});p&&U&&me&&Ee&&we&&ue&&Z&&M&&K&&Se&&xe&&ni&&ut&&gs&&hr&&cr&&Vn&&this.filteredPokemonData.push(r)}),this.starterSelectScrollBar.setTotalRows(Math.max(Math.ceil(this.filteredPokemonData.length/9),1)),this.starterSelectScrollBar.setScrollCursor(0);const e=this.filterBar.getVals(Pe.SORT)[0];this.filteredPokemonData.sort((t,i)=>{switch(e.val){case qe.NUMBER:return(t.species.speciesId-i.species.speciesId)*-e.dir;case qe.COST:return(t.cost-i.cost)*-e.dir;case qe.CANDY:{const n=this.gameData.starterData[this.getStarterSpeciesId(t.species.speciesId)].candyCount,a=this.gameData.starterData[this.getStarterSpeciesId(i.species.speciesId)].candyCount;return(n-a)*-e.dir}case qe.IV:{const n=this.gameData.dexData[t.species.speciesId].ivs.reduce((r,o)=>r+o,0)/this.gameData.dexData[t.species.speciesId].ivs.length,a=this.gameData.dexData[i.species.speciesId].ivs.reduce((r,o)=>r+o,0)/this.gameData.dexData[i.species.speciesId].ivs.length;return(n-a)*-e.dir}case qe.NAME:return t.species.name.localeCompare(i.species.name)*-e.dir;case qe.CAUGHT:return(this.gameData.dexData[t.species.speciesId].caughtCount-this.gameData.dexData[i.species.speciesId].caughtCount)*-e.dir;case qe.HATCHED:return(this.gameData.dexData[this.getStarterSpeciesId(t.species.speciesId)].hatchedCount-this.gameData.dexData[this.getStarterSpeciesId(i.species.speciesId)].hatchedCount)*-e.dir}return 0}),this.filteredIndices=this.filteredPokemonData.map(t=>t.species.speciesId),this.updateScroll()},"updateStarters");updateScroll=h(()=>{const t=this.scrollCursor*9;this.starterSelectScrollBar.setScrollCursor(this.scrollCursor),this.pokerusCursorObjs.forEach(n=>n.setVisible(!1));let i=0;this.pokemonContainers.forEach((n,a)=>{const r=a+t;if(r>=this.filteredPokemonData.length)n.setVisible(!1);else{n.setVisible(!0);const o=this.filteredPokemonData[r],l=o.props;n.setSpecies(o.species,l),n.icon.setTexture(o.species.getIconAtlasKey(l.formIndex,l.shiny,l.variant),n.species.getIconId(l.female,l.formIndex,l.shiny,l.variant)),n.checkIconId(l.female,l.formIndex,l.shiny,l.variant);const u=o.species.speciesId,p=this.gameData.dexData[u],m=p.caughtAttr&this.gameData.dexData[this.getStarterSpeciesId(u)].caughtAttr&o.species.getFullUnlocksData();if(m&o.species.getFullUnlocksData()||s.dexForDevs?n.icon.clearTint():this.isSeen(o.species,p)?n.icon.setTint(8421504):n.icon.setTint(0),[[o.eggMove1,n.eggMove1Icon],[o.eggMove2,n.eggMove2Icon],[o.tmMove1,n.tmMove1Icon],[o.tmMove2,n.tmMove2Icon],[o.passive1,n.passive1Icon],[o.passive2,n.passive2Icon]].forEach(([y,g])=>{y?(g.setVisible(!0),g.clearTint()):y===!1?(g.setVisible(!0),g.setTint(8421504)):g.setVisible(!1)}),this.showDecorations){this.pokerusSpecies.includes(o.species)&&(this.pokerusCursorObjs[i].setPosition(n.x-1,n.y+1),this.pokerusCursorObjs[i].setVisible(!0),i++),this.updateStarterValueLabel(n),n.label.setVisible(!0);const y=u&&m&F.SHINY?[F.DEFAULT_VARIANT,F.VARIANT_2,F.VARIANT_3].filter(g=>!!(m&g)):[];for(let g=0;g<3;g++){const C=y.length>g;n.shinyIcons[g].setVisible(C),C&&n.shinyIcons[g].setTint(Et(y[g]===F.DEFAULT_VARIANT?0:y[g]===F.VARIANT_2?1:2))}n.starterPassiveBgs.setVisible(!!this.gameData.starterData[this.getStarterSpeciesId(u)].passiveAttr),n.hiddenAbilityIcon.setVisible(!!m&&!!(this.gameData.starterData[this.getStarterSpeciesId(u)].abilityAttr&4)),n.classicWinIcon.setVisible(this.gameData.starterData[this.getStarterSpeciesId(u)].classicWinCount>0),n.favoriteIcon.setVisible(this.starterPreferences[u]?.favorite??!1),s.candyUpgradeDisplay===0?(vt[this.getStarterSpeciesId(u)]||(vt[this.getStarterSpeciesId(u)]=["ffffff","ffffff"]),n.candyUpgradeIcon.setTint(qt(Dt(vt[this.getStarterSpeciesId(u)][0]))),n.candyUpgradeOverlayIcon.setTint(qt(Dt(vt[this.getStarterSpeciesId(u)][1])))):s.candyUpgradeDisplay===1&&(n.candyUpgradeIcon.setVisible(!1),n.candyUpgradeOverlayIcon.setVisible(!1))}else{n.label.setVisible(!1);for(let y=0;y<3;y++)n.shinyIcons[y].setVisible(!1);n.starterPassiveBgs.setVisible(!1),n.hiddenAbilityIcon.setVisible(!1),n.classicWinIcon.setVisible(!1),n.favoriteIcon.setVisible(!1),n.candyUpgradeIcon.setVisible(!1),n.candyUpgradeOverlayIcon.setVisible(!1)}}})},"updateScroll");setCursor(e){let t=!1;if(this.oldCursor=this.cursor,this.filterMode)t=this.filterBarCursor!==e,this.filterBarCursor=e,this.filterBar.setCursor(e);else if(this.filterTextMode)t=this.filterTextCursor!==e,this.filterTextCursor=e,this.filterText.setCursor(e);else{e=Math.max(Math.min(this.pokemonContainers.length-1,e),0),t=super.setCursor(e);const i=xr(e);this.cursorObj.setPosition(i.x-1,i.y+1);const n=this.pokemonContainers[e]?.species;if(n)return this.setSpecies(n),!0}return t}setFilterMode(e){return this.cursorObj.setVisible(!e),this.filterBar.cursorObj.setVisible(e),this.pokemonSprite.setVisible(!1),this.showFormTrayIconElement.setVisible(!1),this.showFormTrayLabel.setVisible(!1),e!==this.filterMode?(this.filterMode=e,this.setCursor(e?this.filterBarCursor:this.cursor),e&&this.setSpecies(null),!0):!1}setFilterTextMode(e){return this.cursorObj.setVisible(!e),this.filterText.cursorObj.setVisible(e),this.pokemonSprite.setVisible(!1),this.showFormTrayIconElement.setVisible(!1),this.showFormTrayLabel.setVisible(!1),e!==this.filterTextMode?(this.filterTextMode=e,this.setCursor(e?this.filterTextCursor:this.cursor),e&&this.setSpecies(null),!0):!1}openFormTray(e){this.trayForms=e.forms.filter(g=>!g.isUnobtainable),this.trayNumIcons=this.trayForms.length,this.trayRows=Math.floor(this.trayNumIcons/9)+(this.trayNumIcons%9===0?0:1),this.trayColumns=Math.min(this.trayNumIcons,9);const t=9,i=this.cursor,n=Math.floor(i/t),a=i-n*9,r=8-n,o=9-a,l=xr(this.cursor),c=this.trayRows<=r-1?0:1,u=this.trayColumns<=o?0:1;this.trayBg.setSize(13+this.trayColumns*17,8+this.trayRows*18),this.formTrayContainer.setX((u?l.x-18*(this.trayColumns-o):l.x)-3),this.formTrayContainer.setY(c?l.y-this.trayBg.height:l.y+17);const p=this.gameData.dexData[e.speciesId],m=this.getCurrentDexProps(e.speciesId),d=this.getSanitizedProps(this.gameData.getSpeciesDexAttrProps(this.lastSpecies,m));this.trayContainers=[];const y=this.isSeen(e,p);return this.trayForms.map((g,C)=>{const E=p?(p.caughtAttr&e.getFullUnlocksData()&this.gameData.getFormAttr(g.formIndex??0))>0n:!1,I=new Ha(e,{formIndex:g.formIndex,female:d.female,shiny:d.shiny,variant:d.variant});this.iconAnimHandler.addOrUpdate(I.icon,Ft.NONE),E||s.dexForDevs?I.icon.clearTint():y?I.icon.setTint(8421504):I.icon.setTint(0),I.setPosition(5+C%9*18,4+Math.floor(C/9)*17),this.formTrayContainer.add(I),this.trayContainers.push(I)}),this.showingTray=!0,this.setTrayCursor(0),this.formTrayContainer.setVisible(!0),this.showFormTrayIconElement.setVisible(!1),this.showFormTrayLabel.setVisible(!1),!0}closeFormTray(){return this.trayContainers.forEach(e=>{this.formTrayContainer.remove(e,!0)}),this.trayContainers=[],this.formTrayContainer.setVisible(!1),this.showingTray=!1,this.setSpeciesDetails(this.lastSpecies),!0}setTrayCursor(e){if(!this.showingTray)return!1;e=Phaser.Math.Clamp(this.trayContainers.length-1,e,0);const t=this.trayCursor!==e;t&&(this.trayCursor=e),this.trayCursorObj.setPosition(5+e%9*18,4+Math.floor(e/9)*17);const i=this.lastSpecies,n=this.trayForms[e].formIndex;return this.setSpeciesDetails(i,{formIndex:n}),t}getFriendship(e){let t=this.gameData.starterData[this.getStarterSpeciesId(e)].friendship;(!t||t===void 0)&&(t=0);const i=Wh($e[e]);return{currentFriendship:t,friendshipCap:i}}startIconAnimation(e){const i=this.pokemonContainers[e].icon;this.isUpgradeAnimationEnabled()&&(s.tweens.getTweensOf(i).forEach(n=>n.pause()),i.x=-2,i.y=2),this.iconAnimHandler.addOrUpdate(i,Ft.PASSIVE)}stopIconAnimation(e){const t=this.pokemonContainers[e];if(t){const i=t.icon,n=this.getCurrentDexProps(t.species.speciesId),a=this.getSanitizedProps(this.gameData.getSpeciesDexAttrProps(t.species,n));this.checkIconId(i,t.species,a.female,a.formIndex,a.shiny,a.variant),this.iconAnimHandler.addOrUpdate(i,Ft.NONE),s.tweens.getTweensOf(i).forEach(r=>r.play())}}setSpecies(e){if(this.speciesStarterDexEntry=e?this.gameData.dexData[e.speciesId]:null,!e&&s.ui.getTooltip().visible&&s.ui.hideTooltip(),this.lastSpecies&&this.stopIconAnimation(this.oldCursor),e&&(this.lastSpecies=e),e&&(this.speciesStarterDexEntry?.seenAttr||this.speciesStarterDexEntry?.caughtAttr||s.dexForDevs))if(this.pokemonNumberText.setText(f.t("pokedexUiHandler:pokemonNumber")+Hs(e.speciesId,4)),this.pokemonNameText.setText(e.name),this.speciesStarterDexEntry?.caughtAttr||s.dexForDevs){this.startIconAnimation(this.cursor);const t=is(e.speciesId,0);this.setTypeIcons(t.type1,t.type2),this.setSpeciesDetails(e,{}),this.pokemonSprite.clearTint(),this.type1Icon.clearTint(),this.type2Icon.clearTint()}else this.type1Icon.setVisible(!0),this.type2Icon.setVisible(!0),this.setSpeciesDetails(e),this.pokemonSprite.setTint(8421504);else this.pokemonNumberText.setText(e?f.t("pokedexUiHandler:pokemonNumber")+Hs(e.speciesId,4):""),this.pokemonNameText.setText(e?"???":""),this.pokemonFormText.setText(""),this.type1Icon.setVisible(!1),this.type2Icon.setVisible(!1),e&&(this.pokemonSprite.setTint(0),this.setSpeciesDetails(e,{}))}setSpeciesDetails(e,t={}){let{shiny:i,formIndex:n,female:a,variant:r}=t;if(e?.forms?.find(o=>o.formKey==="female")&&(a!==void 0?n=a?1:0:n!==void 0&&(a=n===1)),this.pokemonSprite.setVisible(!1),this.assetLoadCancelled&&(this.assetLoadCancelled.value=!0,this.assetLoadCancelled=null),e){const o=this.gameData.dexData[e.speciesId],l=o.caughtAttr&this.gameData.dexData[this.getStarterSpeciesId(e.speciesId)].caughtAttr&e.getFullUnlocksData();if(l){const m=this.getSanitizedProps(this.gameData.getSpeciesDexAttrProps(e,this.getCurrentDexProps(e.speciesId)));i===void 0&&(i=m.shiny),n===void 0&&(n=m.formIndex),a===void 0&&(a=m.female),r===void 0&&(r=m.variant)}const c=o?(l&this.gameData.getFormAttr(n??0))>0n:!1,u=this.isSeen(e,o),p=new ft(!1);if(this.assetLoadCancelled=p,e.loadAssets(a,n,i,r,!0).then(()=>{p.value||(this.assetLoadCancelled=null,this.speciesLoaded.set(e.speciesId,!0),this.pokemonSprite.play(e.getSpriteKey(a,n,i,r)),this.pokemonSprite.setPipelineData("shiny",i),this.pokemonSprite.setPipelineData("variant",r),this.pokemonSprite.setPipelineData("spriteKey",e.getSpriteKey(a,n,i,r)),this.pokemonSprite.setVisible(!0))}),c||s.dexForDevs?this.pokemonSprite.clearTint():u?this.pokemonSprite.setTint(8421504):this.pokemonSprite.setTint(0),c||u||s.dexForDevs?yg.includes(e.speciesId)&&!n?this.pokemonFormText.setText(""):this.pokemonFormText.setText(e.getFormNameToDisplay(n,!1)):this.pokemonFormText.setText(""),c||u||s.dexForDevs){const m=is(e.speciesId,n??0);this.setTypeIcons(m.type1,m.type2)}else this.setTypeIcons(null,null);e?.forms?.filter(m=>!m.isUnobtainable).length>1?(this.showingTray||(this.showFormTrayIconElement.setVisible(!0),this.showFormTrayLabel.setVisible(!0)),this.canShowFormTray=!0):(this.showFormTrayIconElement.setVisible(!1),this.showFormTrayLabel.setVisible(!1),this.canShowFormTray=!1)}else this.setTypeIcons(null,null)}setTypeIcons(e,t){e!==null?(this.type1Icon.setVisible(!0),this.type1Icon.setFrame(Me[e].toLowerCase())):this.type1Icon.setVisible(!1),t!==null?(this.type2Icon.setVisible(!0),this.type2Icon.setFrame(Me[t].toLowerCase())):this.type2Icon.setVisible(!1)}updateStarterValueLabel(e){const t=e.species.speciesId,i=$e[t],n=this.gameData.getSpeciesStarterValue(this.getStarterSpeciesId(t));e.cost=n;let a=n.toString();a.startsWith("0.")&&(a=a.slice(1)),e.label.setText(a);let r;switch(i-n){case 0:r=O.WINDOW;break;case 1:case .5:r=O.SUMMARY_BLUE;break;default:r=O.SUMMARY_GOLD;break}i-n>0&&(e.label.setColor(le(r)),e.label.setShadowColor(le(r,!0)))}tryExit(){this.blockInput=!0;const e=this.getUi(),t=h(()=>{e.setMode(x.POKEDEX,"refresh"),this.clearText(),this.blockInput=!1},"cancel");return e.showText(f.t("pokedexUiHandler:confirmExit"),null,()=>{e.setModeWithoutClear(x.CONFIRM,()=>{e.setMode(x.POKEDEX,"refresh"),this.clearText(),this.clear(),e.revertMode()},t,null,null,19)}),!0}getCurrentDexProps(e){let t=0n;const i=it.find(a=>a.speciesId===e),n=this.gameData.dexData[e].caughtAttr&this.gameData.dexData[this.getStarterSpeciesId(e)].caughtAttr&(i?.getFullUnlocksData()??0n);return this.starterPreferences[e]?.female||(n&F.FEMALE)>0n&&(n&F.MALE)===0n?t+=F.FEMALE:t+=F.MALE,this.starterPreferences[e]?.shiny||(n&F.SHINY)>0n&&this.starterPreferences[e]?.shiny!==!1?(t+=F.SHINY,this.starterPreferences[e]?.variant!==void 0?t+=BigInt(Math.pow(2,this.starterPreferences[e]?.variant))*F.DEFAULT_VARIANT:(n&F.VARIANT_3)>0?t+=F.VARIANT_3:(n&F.VARIANT_2)>0?t+=F.VARIANT_2:t+=F.DEFAULT_VARIANT):(t+=F.NON_SHINY,t+=F.DEFAULT_VARIANT),this.starterPreferences[e]?.form?t+=BigInt(Math.pow(2,this.starterPreferences[e]?.form))*F.DEFAULT_FORM:t+=this.gameData.getFormAttr(this.gameData.getFormIndex(n)),t}destroy(){this.pokemonContainers=[],this.filteredPokemonData=[]}clearText(){this.starterSelectMessageBoxContainer.setVisible(!1),super.clearText()}clear(){super.clear(),this.cursor=-1,this.oldCursor=-1,s.ui.hideTooltip(),this.starterSelectContainer.setVisible(!1),this.blockInput=!1;const e=this.exitCallback;e!=null&&(this.exitCallback=void 0,e())}checkIconId(e,t,i,n,a,r){e.frame.name!==t.getIconId(i,n,a,r)&&(`${t.name}${e.frame.name}${i}${n}${a}${r}`,e.setTexture(t.getIconAtlasKey(n,!1,r)),e.setFrame(t.getIconId(i,n,!1,r)))}};h(Md,"PokedexUiHandler");let An=Md;const Vl="LEFT",Dg="RIGHT",Qs=class Qs{modes;selectedMode=x.SETTINGS;navigationMenus=[];labels;constructor(){this.modes=[x.SETTINGS,x.SETTINGS_DISPLAY,x.SETTINGS_AUDIO,x.SETTINGS_GAMEPAD,x.SETTINGS_KEYBOARD],this.labels=[f.t("settings:general"),f.t("settings:display"),f.t("settings:audio"),f.t("settings:gamepad"),f.t("settings:keyboard")]}reset(){this.selectedMode=x.SETTINGS,this.updateNavigationMenus()}static getInstance(){return Qs.instance||(Qs.instance=new Qs),Qs.instance}navigate(e){const t=this.modes.indexOf(this.selectedMode),i=this.modes.length-1,n=e===Vl?-1:1;t===0&&e===Vl?this.selectedMode=this.modes[i]:t===i&&e===Dg?this.selectedMode=this.modes[0]:this.selectedMode=this.modes[t+n],s.ui.setMode(this.selectedMode),this.updateNavigationMenus()}updateNavigationMenus(){for(const e of this.navigationMenus)e.update()}updateIcons(){for(const e of this.navigationMenus)e.updateIcons()}clearNavigationMenus(){this.navigationMenus.length=0}};h(Qs,"NavigationManager"),Gi(Qs,"instance");let as=Qs;const kd=class kd extends Phaser.GameObjects.Container{navigationIcons;headerTitles=[];constructor(e,t){super(s,e,t),this.setup()}setup(){const e=as.getInstance(),t=Ce(0,0,s.scaledCanvas.width-2,24);t.setOrigin(0,0),this.add(t),this.width=t.width,this.height=t.height,this.navigationIcons={};const i=s.add.sprite(8,4,"keyboard");i.setOrigin(0,-.1),i.setPositionRelative(t,8,4),this.navigationIcons.BUTTON_CYCLE_FORM=i;const n=s.add.sprite(0,0,"keyboard");n.setOrigin(0,-.1),n.setPositionRelative(t,t.width-20,4),this.navigationIcons.BUTTON_CYCLE_SHINY=n;let a=i,r=i.width*6;for(const o of e.labels){const l=P(0,0,o,O.SETTINGS_LABEL_NAVBAR);l.setOrigin(0,0),l.setPositionRelative(a,6+r/6,0),this.add(l),this.headerTitles.push(l),a=l,r=l.width}this.add(i),this.add(n),e.navigationMenus.push(this),e.updateNavigationMenus()}update(){const e=as.getInstance(),t=e.modes.indexOf(e.selectedMode);for(const[i,n]of this.headerTitles.entries())Ry(n,i===t?O.SETTINGS_SELECTED:O.SETTINGS_LABEL)}updateIcons(){const e={BUTTON_HOME:"HOME.png",BUTTON_DELETE:"DEL.png"};for(const t of Object.keys(this.navigationIcons)){if(Object.keys(e).includes(t)){this.navigationIcons[t].setTexture("keyboard"),this.navigationIcons[t].setFrame(e[t]),this.navigationIcons[t].alpha=1;continue}const i=s.inputController?.getIconForLatestInputRecorded(t);if(i){const n=s.inputController?.getLastSourceType();this.navigationIcons[t].setTexture(n),this.navigationIcons[t].setFrame(i),this.navigationIcons[t].alpha=1}else this.navigationIcons[t].alpha=0}}navigate(e){const t=as.getInstance();switch(e){case b.CYCLE_FORM:return t.navigate(Vl),!0;case b.CYCLE_SHINY:return t.navigate(Dg),!0}return!1}};h(kd,"NavigationMenu");let Wa=kd;const Nd=class Nd extends Vt{settingsContainer;optionsContainer;messageBoxContainer;navigationContainer;scrollCursor;scrollBar;optionsBg;optionCursors;settingLabels;optionValueLabels;navigationIcons;cursorObj;reloadRequired;rowsToDisplay;title;settings;localStorageKey;constructor(e,t=null){super(t),this.settings=bg.filter(i=>i.type===e&&!i?.isHidden?.()),this.reloadRequired=!1,this.rowsToDisplay=8}setup(){const e=this.getUi(),t=s.scaledCanvas.width,i=s.scaledCanvas.height;this.settingsContainer=s.add.container(1,-i+1).setName(`settings-${this.title}`).setInteractive(new Phaser.Geom.Rectangle(0,0,t,i-20),Phaser.Geom.Rectangle.Contains),this.navigationIcons={},this.navigationContainer=new Wa(0,0);const n=this.navigationContainer.width,a=this.navigationContainer.height;this.optionsBg=Ce(0,a,t-2,i-16-a-2).setName("window-options-bg").setOrigin(0);const r=Ce(0,i-a,t-2,22).setOrigin(0),o=s.add.sprite(0,0,"keyboard").setOrigin(0,-.1).setPositionRelative(r,n-32,4);this.navigationIcons.BUTTON_ACTION=o;const l=P(0,0,f.t("settings:action"),O.SETTINGS_LABEL).setOrigin(0,.15);l.setPositionRelative(o,-l.width/6-2,0);const c=s.add.sprite(0,0,"keyboard").setOrigin(0,-.1).setPositionRelative(r,l.x-28,4);this.navigationIcons.BUTTON_CANCEL=c;const u=P(0,0,f.t("settings:back"),O.SETTINGS_LABEL).setOrigin(0,.15);u.setPositionRelative(c,-u.width/6-2,0),this.optionsContainer=s.add.container(),this.settingLabels=[],this.optionValueLabels=[];let p=!1;this.settings.forEach((y,g)=>{let C=y.label;y?.requireReload&&(C+="*",p=!0),this.settingLabels[g]=P(8,28+g*16,C,O.SETTINGS_LABEL).setOrigin(0),this.optionsContainer.add(this.settingLabels[g]),this.optionValueLabels.push(y.options.map((L,V)=>{const H=P(0,0,L.label,y.default===V?O.SETTINGS_SELECTED:O.SETTINGS_VALUE);return H.setOrigin(0),this.optionsContainer.add(H),H}));const E=this.optionValueLabels[g].map(L=>L.width).reduce((L,V)=>L+=V,0),I=Math.max(78,this.settingLabels[g].displayWidth+8),A=297-I-E/6,_=Math.floor(A/(this.optionValueLabels[g].length-1));let w=0;for(const L of this.optionValueLabels[g])L.setPositionRelative(this.settingLabels[g],I+w,0),w+=L.width/6+_}),this.optionCursors=this.settings.map(y=>y.default),this.scrollBar=new Ps(this.optionsBg.width-9,this.optionsBg.y+5,4,this.optionsBg.height-11,this.rowsToDisplay),this.scrollBar.setTotalRows(this.settings.length),this.messageBoxContainer=s.add.container(0,s.scaledCanvas.height).setName("settings-message-box").setVisible(!1);const m=Ce(0,-1,s.scaledCanvas.width-2,48);m.setOrigin(0,1),this.messageBoxContainer.add(m);const d=P(8,-40,"",O.WINDOW,{maxLines:2}).setWordWrapWidth(s.game.canvas.width-60).setName("settings-message").setOrigin(0);if(this.messageBoxContainer.add(d),this.message=d,this.settingsContainer.add([this.optionsBg,this.scrollBar,this.navigationContainer,r,this.optionsContainer,o,c,l]),p){const y=P(0,0,`*${f.t("settings:requireReload")}`,O.SETTINGS_LABEL).setOrigin(0,.15).setPositionRelative(r,6,0).setY(l.y);this.settingsContainer.add(y)}this.settingsContainer.add([u,this.messageBoxContainer]),e.add(this.settingsContainer),this.setCursor(0),this.setScrollCursor(0),this.settingsContainer.setVisible(!1)}updateBindings(){for(const e of Object.keys(this.navigationIcons)){if(e==="BUTTON_HOME"){this.navigationIcons[e].setTexture("keyboard").setFrame("HOME.png").alpha=1;continue}const t=s.inputController?.getIconForLatestInputRecorded(e);if(t){const i=s.inputController?.getLastSourceType();this.navigationIcons[e].setTexture(i).setFrame(t).alpha=1}else this.navigationIcons[e].alpha=0}as.getInstance().updateIcons()}show(e){super.show(e),this.updateBindings();const t=localStorage.hasOwnProperty(this.localStorageKey)?JSON.parse(localStorage.getItem(this.localStorageKey)):{};this.settings.forEach((n,a)=>{this.setOptionCursor(a,t.hasOwnProperty(n.key)?t[n.key]:this.settings[a].default)}),this.settingsContainer.setVisible(!0),this.setCursor(0),this.setScrollCursor(0);const i=this.getUi();return i.moveTo(this.settingsContainer,i.length-1),i.hideTooltip(),!0}processLeftRightInput(e,t){let i=Phaser.Math.Wrap,n=this.optionValueLabels[e].length;return this.settings[e]?.clamp&&(i=Phaser.Math.Clamp,n-=1),this.setOptionCursor(e,i(this.optionCursors[e]+t,0,n),!0)}processInput(e){const t=this.getUi();let i=!1;if(e===b.CANCEL)i=!0,as.getInstance().reset(),s.ui.revertMode();else{const n=this.cursor+this.scrollCursor;switch(e){case b.UP:if(n)this.cursor?i=this.setCursor(this.cursor-1):i=this.setScrollCursor(this.scrollCursor-1);else{const a=this.setCursor(this.rowsToDisplay-1),r=this.setScrollCursor(this.optionValueLabels.length-this.rowsToDisplay);i=a&&r}break;case b.DOWN:if(n<this.optionValueLabels.length-1)this.cursor<this.rowsToDisplay-1?i=this.setCursor(this.cursor+1):this.scrollCursor<this.optionValueLabels.length-this.rowsToDisplay&&(i=this.setScrollCursor(this.scrollCursor+1));else{const a=this.setCursor(0),r=this.setScrollCursor(0);i=a&&r}break;case b.LEFT:i=this.processLeftRightInput(n,-1);break;case b.RIGHT:i=this.processLeftRightInput(n,1);break;case b.CYCLE_FORM:case b.CYCLE_SHINY:i=this.navigationContainer.navigate(e);break;case b.ACTION:{const a=this.settings[n];a?.activatable&&(i=this.activateSetting(a));break}}}return i&&t.playSelect(),i}activateSetting(e){switch(e.key){case Vs.Move_Touch_Controls:return s.inputController.moveTouchControlsHandler.enableConfigurationMode(this.getUi()),!0}return!1}setCursor(e){const t=super.setCursor(e);if(!this.cursorObj){const i=s.scaledCanvas.width-(this.scrollBar.visible?16:10);this.cursorObj=s.add.nineslice(0,0,"summary_moves_cursor",void 0,i,16,1,1,1,1).setOrigin(0),this.optionsContainer.add(this.cursorObj)}return this.cursorObj.setPositionRelative(this.optionsBg,4,4+(this.cursor+this.scrollCursor)*16),t}setOptionCursor(e,t,i){e===-1&&(e=this.cursor+this.scrollCursor);const n=this.settings[e],a=this.optionCursors[e];if(t===a)return!1;if(this.optionValueLabels[e][a].setColor(le(O.SETTINGS_VALUE)).setShadowColor(le(O.SETTINGS_VALUE,!0)),this.optionCursors[e]=t,this.optionValueLabels[e][t].setColor(le(O.SETTINGS_SELECTED)).setShadowColor(le(O.SETTINGS_SELECTED,!0)),i){const r=h(()=>{s.gameData.saveSetting(n.key,t),n.requireReload&&(this.reloadRequired=!0)},"saveSetting");if(n.options[t].needConfirmation){const o=h(()=>{s.ui.revertMode(),this.showText(""),r()},"confirmUpdateSetting"),l=h(()=>{s.ui.revertMode(),this.showText(""),this.setOptionCursor(e,a,!1)},"cancelUpdateSetting"),c=n.options[t].confirmationMessage??f.t("settings:defaultConfirmMessage");s.ui.showText(c,null,()=>{s.ui.setOverlayMode(x.CONFIRM,o,l,null,null,1,750)})}else r()}return!0}setScrollCursor(e){return e===this.scrollCursor?!1:(this.scrollCursor=e,this.scrollBar.setScrollCursor(this.scrollCursor),this.updateSettingsScroll(),this.setCursor(this.cursor),!0)}updateSettingsScroll(){this.optionsContainer.setY(-16*this.scrollCursor);for(let e=0;e<this.settingLabels.length;e++){const t=e>=this.scrollCursor&&e<this.scrollCursor+this.rowsToDisplay;this.settingLabels[e].setVisible(t);for(const i of this.optionValueLabels[e])i.setVisible(t)}}clear(){super.clear(),this.settingsContainer.setVisible(!1),this.setScrollCursor(0),this.eraseCursor(),this.getUi().bgmBar.toggleBgmBar(s.showBgmBar),this.getUi().handlers[x.TITLE]?.updateUsername(),this.reloadRequired&&(this.reloadRequired=!1,s.reset(!0,!1,!0))}eraseCursor(){this.cursorObj&&this.cursorObj.destroy(),this.cursorObj=null}showText(e,t,i,n,a,r){this.messageBoxContainer.setVisible(e?.length>0),super.showText(e,t,i,n,a,r)}};h(Nd,"AbstractSettingsUiHandler");let xn=Nd;const Pd=class Pd extends xn{constructor(e=null){super(Yh.AUDIO,e),this.title="Audio",this.localStorageKey="settings",this.rowsToDisplay=6}};h(Pd,"SettingsAudioUiHandler");let Ga=Pd;const Rd=class Rd extends xn{constructor(e=null){super(Yh.DISPLAY,e),this.title="Display";const t=this.settings.findIndex(i=>i.key===Vs.Language);if(t>=0)switch(localStorage.getItem("prLang")){case"en":this.settings[t].options[0]={value:"English",label:"English"};break;case"es-ES":this.settings[t].options[0]={value:"Espaol (ES)",label:"Espaol (ES)"};break;case"es-419":this.settings[t].options[0]={value:"Espaol (LATAM)",label:"Espaol (LATAM)"};break;case"fr":this.settings[t].options[0]={value:"Franais",label:"Franais"};break;case"de":this.settings[t].options[0]={value:"Deutsch",label:"Deutsch"};break;case"it":this.settings[t].options[0]={value:"Italiano",label:"Italiano"};break;case"pt-BR":this.settings[t].options[0]={value:"Portugus (BR)",label:"Portugus (BR)"};break;case"ko":case"ko-KR":this.settings[t].options[0]={value:"",label:""};break;case"ja":this.settings[t].options[0]={value:"",label:""};break;case"zh-Hans":this.settings[t].options[0]={value:"",label:""};break;case"zh-Hant":this.settings[t].options[0]={value:"",label:""};break;case"ca":this.settings[t].options[0]={value:"Catal",label:"Catal (Needs Help)"};break;case"tr":this.settings[t].options[0]={value:"Trke",label:"Trke (Needs Help)"};break;case"ru":this.settings[t].options[0]={value:"",label:" (Needs Help)"};break;case"id":this.settings[t].options[0]={value:"Bahasa Indonesia",label:"Bahasa Indonesia (Needs Help)"};break;case"hi":this.settings[t].options[0]={value:"",label:" (Needs Help)"};break;case"da":this.settings[t].options[0]={value:"Dansk",label:"Dansk (Needs Help)"};break;case"nb-NO":this.settings[t].options[0]={value:"Norsk bokml",label:"Norsk bokml (Needs Help)"};break;case"ro":this.settings[t].options[0]={value:"Romn",label:"Romn (Needs Help)"};break;case"tl":this.settings[t].options[0]={value:"Tagalog",label:"Tagalog (Needs Help)"};break;default:this.settings[t].options[0]={value:"English",label:"English"};break}this.localStorageKey="settings"}};h(Rd,"SettingsDisplayUiHandler");let Ya=Rd;const Bd=class Bd extends fs{settingsContainer;optionsContainer;navigationContainer;scrollBar;scrollCursor;optionCursors;cursorObj;optionsBg;actionsBg;settingLabels;optionValueLabels;layout=new Map;inputsIcons;navigationIcons;keys;bindingSettings;setting;settingBlacklisted;settingDeviceDefaults;settingDeviceOptions;configs;commonSettingsCount;textureOverride;titleSelected;localStoragePropertyName;rowsToDisplay;device;constructor(e=null){super(e),this.rowsToDisplay=8}getLocalStorageSetting(){return localStorage.hasOwnProperty(this.localStoragePropertyName)?JSON.parse(localStorage.getItem(this.localStoragePropertyName)):{}}setup(){const e=this.getUi();this.navigationIcons={},this.settingsContainer=s.add.container(1,-s.scaledCanvas.height+1),this.settingsContainer.setName(`settings-${this.titleSelected}`),this.settingsContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,s.scaledCanvas.width,s.scaledCanvas.height),Phaser.Geom.Rectangle.Contains),this.navigationContainer=new Wa(0,0),this.optionsBg=Ce(0,this.navigationContainer.height,s.scaledCanvas.width-2,s.scaledCanvas.height-16-this.navigationContainer.height-2),this.optionsBg.setOrigin(0,0),this.actionsBg=Ce(0,s.scaledCanvas.height-this.navigationContainer.height,s.scaledCanvas.width-2,22),this.actionsBg.setOrigin(0,0);const t=s.add.sprite(0,0,"keyboard");t.setOrigin(0,-.1),t.setPositionRelative(this.actionsBg,this.navigationContainer.width-32,4),this.navigationIcons.BUTTON_ACTION=t;const i=P(0,0,f.t("settings:action"),O.SETTINGS_LABEL);i.setOrigin(0,.15),i.setPositionRelative(t,-i.width/6-2,0);const n=s.add.sprite(0,0,"keyboard");n.setOrigin(0,-.1),n.setPositionRelative(this.actionsBg,i.x-28,4),this.navigationIcons.BUTTON_CANCEL=n;const a=P(0,0,f.t("settings:back"),O.SETTINGS_LABEL);a.setOrigin(0,.15),a.setPositionRelative(n,-a.width/6-2,0);const r=s.add.sprite(0,0,"keyboard");r.setOrigin(0,-.1),r.setPositionRelative(this.actionsBg,a.x-28,4),this.navigationIcons.BUTTON_HOME=r;const o=P(0,0,f.t("settings:reset"),O.SETTINGS_LABEL);o.setOrigin(0,.15),o.setPositionRelative(r,-o.width/6-2,0),this.settingsContainer.add(this.optionsBg),this.settingsContainer.add(this.actionsBg),this.settingsContainer.add(this.navigationContainer),this.settingsContainer.add(t),this.settingsContainer.add(n),this.settingsContainer.add(r),this.settingsContainer.add(i),this.settingsContainer.add(a),this.settingsContainer.add(o);for(const l of this.configs){this.layout[l.padType]=new Map;const c=s.add.container(0,0);c.setVisible(!1);const u=Object.keys(l.settings),p=[],m=[],d={},g=[...Object.keys(this.setting).slice(0,this.commonSettingsCount).map(I=>this.setting[I]),...Object.keys(l.settings)],C=Object.values(Object.keys(this.settingDeviceDefaults).filter(I=>g.includes(I)).map(I=>this.settingDeviceDefaults[I]));Object.keys(this.setting).filter(I=>g.includes(this.setting[I])).forEach((I,A)=>{const _=bt(I.replace(/Alt(_| )/,"")),w=this.settingBlacklisted.includes(this.setting[I]),L=w?O.SETTINGS_LOCKED:O.SETTINGS_LABEL,V=I.includes("Alt");let H;V?H=`${f.t(`settings:${_}`)}${f.t("settings:alt")}`:H=f.t(`settings:${_}`),p[A]=P(8,28+A*16,H,L),p[A].setOrigin(0,0),c.add(p[A]);const W=[];for(const[z,ne]of this.settingDeviceOptions[this.setting[I]].entries()){if(u.includes(this.setting[I])){if(z){const R=P(0,0,w?"":ne,O.WINDOW);R.setOrigin(0,0),c.add(R),W.push(R);continue}const J=s.add.sprite(0,0,this.textureOverride?this.textureOverride:l.padType);J.setOrigin(0,-.15),d[this.setting[I]]=J,c.add(J),W.push(J);continue}const X=P(0,0,ne,this.settingDeviceDefaults[this.setting[I]]===z?O.SETTINGS_SELECTED:O.WINDOW);X.setOrigin(0,0),c.add(X),W.push(X)}m.push(W);const ee=m[A].map(z=>z.width).reduce((z,ne)=>z+=ne,0),me=Math.max(130,p[A].displayWidth+8),N=297-me-ee/6,j=Math.floor(N/(m[A].length-1));let v=0;for(const z of m[A])z.setPositionRelative(p[A],me+v,0),v+=z.width/6+j}),this.layout[l.padType].optionsContainer=c,this.layout[l.padType].inputsIcons=d,this.layout[l.padType].settingLabels=p,this.layout[l.padType].optionValueLabels=m,this.layout[l.padType].optionCursors=C,this.layout[l.padType].keys=g,this.layout[l.padType].bindingSettings=u,this.settingsContainer.add(c)}this.scrollBar=new Ps(this.optionsBg.width-9,this.optionsBg.y+5,4,this.optionsBg.height-11,this.rowsToDisplay),this.settingsContainer.add(this.scrollBar),e.add(this.settingsContainer),this.settingsContainer.setVisible(!1)}getActiveConfig(){return s.inputController.getActiveConfig(this.device)}updateBindings(){Object.keys(this.layout).forEach(i=>this.layout[i].optionsContainer.setVisible(!1));const e=this.getActiveConfig();if(!this.setLayout(e))return;const t=this.getLocalStorageSetting();if(this.keys.forEach((i,n)=>{this.setOptionCursor(n,t.hasOwnProperty(i)?t[i]:this.optionCursors[n])}),!!e.custom){for(const i of this.bindingSettings){const n=Ea(e,i);n?(this.inputsIcons[i].setFrame(n),this.inputsIcons[i].alpha=1):this.inputsIcons[i].alpha=0}this.setCursor(this.cursor),this.setScrollCursor(this.scrollCursor)}}updateNavigationDisplay(){const e={BUTTON_HOME:"HOME.png",BUTTON_DELETE:"DEL.png"};for(const t of Object.keys(this.navigationIcons)){if(Object.keys(e).includes(t)){this.navigationIcons[t].setTexture("keyboard"),this.navigationIcons[t].setFrame(e[t]),this.navigationIcons[t].alpha=1;continue}const i=s.inputController?.getIconForLatestInputRecorded(t);if(i){const n=s.inputController?.getLastSourceType();this.navigationIcons[t].setTexture(n),this.navigationIcons[t].setFrame(i),this.navigationIcons[t].alpha=1}else this.navigationIcons[t].alpha=0}}show(e){return super.show(e),this.updateNavigationDisplay(),as.getInstance().updateIcons(),this.updateBindings(),this.settingsContainer.setVisible(!0),this.resetScroll(),this.getUi().moveTo(this.settingsContainer,this.getUi().length-1),this.getUi().hideTooltip(),!0}setLayout(e){if(!e)return this.layout.noGamepads.optionsContainer.setVisible(!0),!1;const t=e.padType,i=this.layout[t];return this.keys=i.keys,this.optionsContainer=i.optionsContainer,this.optionsContainer.setVisible(!0),this.settingLabels=i.settingLabels,this.optionValueLabels=i.optionValueLabels,this.optionCursors=i.optionCursors,this.inputsIcons=i.inputsIcons,this.bindingSettings=i.bindingSettings,this.scrollBar.setTotalRows(i.settingLabels.length),this.scrollBar.setScrollCursor(0),!0}processInput(e){const t=this.getUi();let i=!1;if(this.updateNavigationDisplay(),e===b.CANCEL)i=!0,as.getInstance().reset(),s.ui.revertMode();else{const n=this.cursor+this.scrollCursor,a=this.setting[Object.keys(this.setting)[n]];switch(e){case b.ACTION:if(!this.optionCursors||!this.optionValueLabels)return!1;this.settingBlacklisted.includes(a)||!a.includes("BUTTON_")?i=!1:i=this.setSetting(a,1);break;case b.UP:if(!this.optionValueLabels)return!1;if(n)this.cursor?i=this.setCursor(this.cursor-1):i=this.setScrollCursor(this.scrollCursor-1);else{const r=this.setCursor(this.rowsToDisplay-1),o=this.setScrollCursor(this.optionValueLabels.length-this.rowsToDisplay);i=r&&o}break;case b.DOWN:if(!this.optionValueLabels)return!1;if(n<this.optionValueLabels.length-1)this.cursor<this.rowsToDisplay-1?i=this.setCursor(this.cursor+1):this.scrollCursor<this.optionValueLabels.length-this.rowsToDisplay&&(i=this.setScrollCursor(this.scrollCursor+1));else{const r=this.setCursor(0),o=this.setScrollCursor(0);i=r&&o}break;case b.LEFT:if(!this.optionCursors||!this.optionValueLabels)return!1;this.settingBlacklisted.includes(a)||a.includes("BUTTON_")?i=!1:i=this.setOptionCursor(n,Phaser.Math.Wrap(this.optionCursors[n]-1,0,this.optionValueLabels[n].length),!0);break;case b.RIGHT:if(!this.optionCursors||!this.optionValueLabels)return!1;this.settingBlacklisted.includes(a)||a.includes("BUTTON_")?i=!1:i=this.setOptionCursor(n,Phaser.Math.Wrap(this.optionCursors[n]+1,0,this.optionValueLabels[n].length),!0);break;case b.CYCLE_FORM:case b.CYCLE_SHINY:i=this.navigationContainer.navigate(e);break}}return i&&t.playSelect(),i}resetScroll(){this.cursorObj?.destroy(),this.cursorObj=null,this.cursor=0,this.setCursor(0),this.setScrollCursor(0),this.updateSettingsScroll()}setCursor(e){const t=super.setCursor(e);if(!this.optionsContainer)return t;if(!this.cursorObj){const i=s.scaledCanvas.width-(this.scrollBar.visible?16:10);this.cursorObj=s.add.nineslice(0,0,"summary_moves_cursor",void 0,i,16,1,1,1,1),this.cursorObj.setOrigin(0,0),this.optionsContainer.add(this.cursorObj)}return this.cursorObj.setPositionRelative(this.optionsBg,4,4+(this.cursor+this.scrollCursor)*16),t}setScrollCursor(e){return e===this.scrollCursor?!1:(this.scrollCursor=e,this.scrollBar.setScrollCursor(this.scrollCursor),this.updateSettingsScroll(),this.setCursor(this.cursor),!0)}setOptionCursor(e,t,i){const n=this.setting[Object.keys(this.setting)[e]],a=this.optionCursors[e];if(!this.bindingSettings.includes(n)&&!n.includes("BUTTON_")){const r=this.optionValueLabels[e][a];r.setColor(le(O.WINDOW)),r.setShadowColor(le(O.WINDOW,!0)),this.optionCursors[e]=t;const o=this.optionValueLabels[e][t];o.setColor(le(O.SETTINGS_SELECTED)),o.setShadowColor(le(O.SETTINGS_SELECTED,!0))}return i&&this.saveSettingToLocalStorage(n,t),!0}updateSettingsScroll(){if(this.optionsContainer){this.optionsContainer.setY(-16*this.scrollCursor);for(let e=0;e<this.settingLabels.length;e++){const t=e>=this.scrollCursor&&e<this.scrollCursor+this.rowsToDisplay;this.settingLabels[e].setVisible(t);for(const i of this.optionValueLabels[e])i.setVisible(t)}}}clear(){super.clear(),this.settingsContainer.setVisible(!1),this.eraseCursor()}eraseCursor(){this.cursorObj&&this.cursorObj.destroy(),this.cursorObj=null}};h(Bd,"AbstractControlSettingsUiHandler");let Ka=Bd;const Ld=class Ld extends Ka{constructor(e=null){super(e),this.titleSelected="Gamepad",this.setting=G,this.settingDeviceDefaults=kg,this.settingDeviceOptions=Mg,this.configs=[Rg,Ng,Pg],this.commonSettingsCount=2,this.localStoragePropertyName="settingsGamepad",this.settingBlacklisted=oC,this.device=Le.GAMEPAD}setSetting=ha;setup(){super.setup(),this.layout.noGamepads=new Map;const e=s.add.container(0,0);e.setVisible(!1);const t=P(8,28,f.t("settings:gamepadPleasePlug"),O.SETTINGS_LABEL);t.setOrigin(0,0),e.add(t),this.settingsContainer.add(e),this.layout.noGamepads.optionsContainer=e,this.layout.noGamepads.label=t}setLayout(e){return e?super.setLayout(e):(this.layout.noGamepads.optionsContainer.setVisible(!0),!1)}updateChosenGamepadDisplay(){this.updateBindings(),this.resetScroll();for(const[e,t]of Object.keys(this.setting).entries())if(this.setting[t]===this.setting.Controller)for(const n of Object.keys(this.layout))n!=="noGamepads"&&this.layout[n].optionValueLabels[e][0].setText(Rn(s.inputController.selectedDevice[Le.GAMEPAD],20))}saveSettingToLocalStorage(e,t){this.setting[e]!==this.setting.Controller&&s.gameData.saveControlSetting(this.device,this.localStoragePropertyName,e,this.settingDeviceDefaults,t)}};h(Ld,"SettingsGamepadUiHandler");let za=Ld;const Dd=class Dd extends Ka{constructor(e=null){super(e),this.titleSelected="Keyboard",this.setting=re,this.settingDeviceDefaults=QT,this.settingDeviceOptions=ZT,this.configs=[Kr],this.commonSettingsCount=0,this.textureOverride="keyboard",this.localStoragePropertyName="settingsKeyboard",this.settingBlacklisted=JT,this.device=Le.KEYBOARD;const t=s.input.keyboard?.addKey(Phaser.Input.Keyboard.KeyCodes.DELETE),i=s.input.keyboard?.addKey(Phaser.Input.Keyboard.KeyCodes.HOME);t?.on("up",this.onDeleteDown,this),i?.on("up",this.onHomeDown,this)}setSetting=_g;setup(){super.setup(),this.layout.noKeyboard=new Map;const e=s.add.container(0,0);e.setVisible(!1);const t=P(8,28,f.t("settings:keyboardPleasePress"),O.SETTINGS_LABEL);t.setOrigin(0,0),e.add(t),this.settingsContainer.add(e);const i=s.add.sprite(0,0,"keyboard");i.setOrigin(0,-.1),i.setPositionRelative(this.actionsBg,this.navigationContainer.width-260,4),this.navigationIcons.BUTTON_DELETE=i;const n=P(0,0,f.t("settings:delete"),O.SETTINGS_LABEL);n.setOrigin(0,.15),n.setPositionRelative(i,-n.width/6-2,0),this.settingsContainer.add(i),this.settingsContainer.add(n),this.layout.noKeyboard.optionsContainer=e,this.layout.noKeyboard.label=t}onHomeDown(){[x.SETTINGS_KEYBOARD,x.SETTINGS_GAMEPAD].includes(s.ui.getMode())&&(s.gameData.resetMappingToFactory(),as.getInstance().updateIcons())}onDeleteDown(){if(s.ui.getMode()!==x.SETTINGS_KEYBOARD)return;const e=this.cursor+this.scrollCursor,t=this.settingLabels[e].text,i=zT(t),n=re[i],a=this.getActiveConfig();nC(this.getActiveConfig(),n)&&(this.saveCustomKeyboardMappingToLocalStorage(a),this.updateBindings(),as.getInstance().updateIcons())}setLayout(e){return e?super.setLayout(e):(this.layout.noKeyboard.optionsContainer.setVisible(!0),!1)}updateChosenKeyboardDisplay(){this.updateBindings();for(const[e,t]of Object.keys(this.setting).entries())if(this.setting[t]===this.setting.Default_Layout)for(const n of Object.keys(this.layout))n!=="noKeyboard"&&this.layout[n].optionValueLabels[e][0].setText(Rn(s.inputController.selectedDevice[Le.KEYBOARD],22))}saveCustomKeyboardMappingToLocalStorage(e){s.gameData.saveMappingConfigs(s.inputController?.selectedDevice[Le.KEYBOARD],e)}saveSettingToLocalStorage(e,t){this.setting[e]!==this.setting.Default_Layout&&s.gameData.saveControlSetting(this.device,this.localStoragePropertyName,e,this.settingDeviceDefaults,t)}};h(Dd,"SettingsKeyboardUiHandler");let ja=Dd;const Fd=class Fd extends xn{constructor(e=null){super(Yh.GENERAL,e),this.title="General",this.localStorageKey="settings"}};h(Fd,"SettingsUiHandler");let $a=Fd;const Ud=class Ud extends Phaser.GameObjects.Container{species;icon;shinyIcons=[];label;starterPassiveBgs;hiddenAbilityIcon;favoriteIcon;classicWinIcon;candyUpgradeIcon;candyUpgradeOverlayIcon;cost=0;constructor(e){super(s,0,0),this.species=e;const t=s.gameData.getSpeciesDefaultDexAttr(e,!1,!0),i=s.gameData.getSpeciesDexAttrProps(e,t),n=s.add.image(2,5,"passive_bg");n.setOrigin(0,0),n.setScale(.75),n.setVisible(!1),this.add(n),this.starterPassiveBgs=n,this.icon=s.add.sprite(-2,2,e.getIconAtlasKey(i.formIndex,i.shiny,i.variant)),this.icon.setScale(.5),this.icon.setOrigin(0,0),this.icon.setFrame(e.getIconId(i.female,i.formIndex,i.shiny,i.variant)),this.checkIconId(i.female,i.formIndex,i.shiny,i.variant),this.icon.setTint(0),this.add(this.icon);for(let p=0;p<3;p++){const m=s.add.image(p*-3+12,2,"shiny_star_small");m.setScale(.5),m.setOrigin(0,0),m.setVisible(!1),this.shinyIcons.push(m)}this.add(this.shinyIcons);const a=P(1,2,"0",O.WINDOW,{fontSize:"32px"});a.setShadowOffset(2,2),a.setOrigin(0,0),a.setVisible(!1),this.add(a),this.label=a;const r=s.add.image(12,7,"ha_capsule");r.setOrigin(0,0),r.setScale(.5),r.setVisible(!1),this.add(r),this.hiddenAbilityIcon=r;const o=s.add.image(0,7,"favorite");o.setOrigin(0,0),o.setScale(.5),o.setVisible(!1),this.add(o),this.favoriteIcon=o;const l=s.add.image(0,12,"champion_ribbon");l.setOrigin(0,0),l.setScale(.5),l.setVisible(!1),this.add(l),this.classicWinIcon=l;const c=s.add.image(12,12,"candy");c.setOrigin(0,0),c.setScale(.25),c.setVisible(!1),this.add(c),this.candyUpgradeIcon=c;const u=s.add.image(12,12,"candy_overlay");u.setOrigin(0,0),u.setScale(.25),u.setVisible(!1),this.add(u),this.candyUpgradeOverlayIcon=u}checkIconId(e,t,i,n){this.icon.frame.name!==this.species.getIconId(e,t,i,n)&&(`${this.species.name}`,this.icon.setTexture(this.species.getIconAtlasKey(t,!1,n)),this.icon.setFrame(this.species.getIconId(e,t,!1,n)))}};h(Ud,"StarterContainer");let Hl=Ud;const If={en:{starterInfoTextSize:"56px",instructionTextSize:"38px"},de:{starterInfoTextSize:"54px",instructionTextSize:"35px",starterInfoXPos:35},"es-ES":{starterInfoTextSize:"50px",instructionTextSize:"38px",starterInfoYOffset:.5,starterInfoXPos:38},"es-419":{starterInfoTextSize:"50px",instructionTextSize:"38px",starterInfoYOffset:.5,starterInfoXPos:38},fr:{starterInfoTextSize:"54px",instructionTextSize:"38px"},it:{starterInfoTextSize:"56px",instructionTextSize:"38px"},"pt-BR":{starterInfoTextSize:"48px",instructionTextSize:"42px",starterInfoYOffset:.5,starterInfoXPos:33},zh:{starterInfoTextSize:"56px",instructionTextSize:"36px",starterInfoXPos:26},ko:{starterInfoTextSize:"60px",instructionTextSize:"38px",starterInfoYOffset:-.5,starterInfoXPos:30},ja:{starterInfoTextSize:"48px",instructionTextSize:"40px",starterInfoYOffset:1,starterInfoXPos:32},ca:{starterInfoTextSize:"48px",instructionTextSize:"38px",starterInfoYOffset:.5,starterInfoXPos:29},da:{starterInfoTextSize:"56px",instructionTextSize:"38px"},tr:{starterInfoTextSize:"56px",instructionTextSize:"38px",starterInfoXPos:34},ro:{starterInfoTextSize:"56px",instructionTextSize:"38px"},ru:{starterInfoTextSize:"46px",instructionTextSize:"38px",starterInfoYOffset:.5,starterInfoXPos:26},id:{starterInfoTextSize:"48px",instructionTextSize:"42px",starterInfoYOffset:.5,starterInfoXPos:37},hi:{starterInfoTextSize:"56px",instructionTextSize:"38px"},tl:{starterInfoTextSize:"56px",instructionTextSize:"38px"},"nb-NO":{starterInfoTextSize:"56px",instructionTextSize:"38px"}},vf=2,_r=17,sa=109,Os=285,ca=38,ia=34,_n=107,Of=20;function Wl(T,e=0){const n=T%9*18,a=13+(Math.floor(T/9)-e)*17;return{x:n,y:a}}h(Wl,"calcStarterPosition");function jh(T){const e=_n/7,t=ca+e/2;return Math.round(t+e*T)}h(jh,"calcStarterIconY");function Af(T,e=6){let t=_n,i=0;for(let n=0;n<e;n++){const a=Math.abs(T-(jh(n)-13));a<t&&(i=n,t=a)}return i}h(Af,"findClosestStarterIndex");function xf(T,e){const t=jh(T)-13;let i=_n,n=0;for(let a=0;a<e;a++){const r=Math.abs(t-Wl(a*9).y);r<i&&(n=a,i=r)}return n}h(xf,"findClosestStarterRow");const Vd=class Vd extends Vt{starterSelectContainer;starterSelectScrollBar;filterBarContainer;filterBar;shinyOverlay;starterContainers=[];filteredStarterContainers=[];validStarterContainers=[];pokemonNumberText;pokemonSprite;pokemonNameText;pokemonGrowthRateLabelText;pokemonGrowthRateText;type1Icon;type2Icon;pokemonLuckLabelText;pokemonLuckText;pokemonGenderText;pokemonUncaughtText;pokemonAbilityLabelText;pokemonAbilityText;pokemonPassiveLabelText;pokemonPassiveText;pokemonNatureLabelText;pokemonNatureText;pokemonMovesContainer;pokemonMoveContainers;pokemonMoveBgs;pokemonMoveLabels;pokemonAdditionalMoveCountLabel;eggMovesLabel;pokemonEggMovesContainer;pokemonEggMoveContainers;pokemonEggMoveBgs;pokemonEggMoveLabels;pokemonCandyContainer;pokemonCandyIcon;pokemonCandyDarknessOverlay;pokemonCandyOverlayIcon;pokemonCandyCountText;pokemonCaughtHatchedContainer;pokemonCaughtCountText;pokemonFormText;pokemonHatchedIcon;pokemonHatchedCountText;pokemonShinyIcon;pokemonPassiveDisabledIcon;pokemonPassiveLockedIcon;teraIcon;activeTooltip;instructionsContainer;filterInstructionsContainer;shinyIconElement;formIconElement;abilityIconElement;genderIconElement;natureIconElement;teraIconElement;goFilterIconElement;shinyLabel;formLabel;genderLabel;abilityLabel;natureLabel;teraLabel;goFilterLabel;starterSelectMessageBox;starterSelectMessageBoxContainer;statsContainer;moveInfoOverlay;statsMode;starterIconsCursorXOffset=-3;starterIconsCursorYOffset=1;starterIconsCursorIndex;filterMode;dexAttrCursor=0n;abilityCursor=-1;natureCursor=-1;teraCursor=Me.UNKNOWN;filterBarCursor=0;starterMoveset;scrollCursor;allSpecies=[];lastSpecies;speciesLoaded=new Map;starters=[];starterSpecies=[];pokerusSpecies=[];speciesStarterDexEntry;speciesStarterMoves;canCycleShiny;canCycleForm;canCycleGender;canCycleAbility;canCycleNature;canCycleTera;assetLoadCancelled;cursorObj;starterCursorObjs;pokerusCursorObjs;starterIcons;starterIconsCursorObj;valueLimitLabel;startCursorObj;randomCursorObj;iconAnimHandler;instructionRowX=0;instructionRowY=0;instructionRowTextOffset=9;filterInstructionRowX=0;filterInstructionRowY=0;starterSelectCallback;starterPreferences;originalStarterPreferences;hasSwappedMoves=!1;blockInput=!1;allowTera;constructor(){super(x.STARTER_SELECT)}setup(){const e=this.getUi(),t=f.resolvedLanguage??"en",i=Object.keys(If).find(be=>t.includes(be))??"en",n=If[i],a=s.scaledCanvas.height,r=s.scaledCanvas.width;this.starterSelectContainer=s.add.container(0,-a).setVisible(!1),e.add(this.starterSelectContainer);const o=s.add.rectangle(0,0,r,a,26720).setOrigin(0),l=s.add.image(6,14,Kt("summary_dexnb_label")).setOrigin(0,1),c=s.add.image(0,0,"starter_select_bg").setOrigin(0);this.shinyOverlay=s.add.image(6,111,Kt("summary_dexnb_label_overlay_shiny")).setOrigin(0,1).setVisible(!1);const u=Ce(sa,_r+1,175,161),p=s.add.image(sa+1,_r+2,"starter_container_bg").setOrigin(0);this.filterBarContainer=s.add.container(0,0),this.filterBar=new Va(Math.min(sa,Os),1,210,_r);const m=Array.from({length:9},(be,_e)=>new Oe(_e+1,new oe(f.t(`starterSelectUiHandler:gen${_e+1}`)))),d=new Gt(0,0,m,this.updateStarters,Wt.HYBRID);this.filterBar.addFilter(Pe.GEN,f.t("filterBar:genFilter"),d);const y=Object.keys(Me).filter(be=>Number.isNaN(Number(be))),g=[];y.forEach((be,_e)=>{if(_e===0||_e===19)return;const we=s.add.sprite(0,0,Kt("types"));we.setScale(.5),we.setFrame(be.toLowerCase()),g.push(new Oe(_e,new oe("",we)))}),this.filterBar.addFilter(Pe.TYPES,f.t("filterBar:typeFilter"),new Gt(0,0,g,this.updateStarters,Wt.HYBRID,.5));const C=s.add.sprite(0,0,"shiny_icons").setOrigin(.15,.2).setScale(.6).setFrame(os(0)).setTint(Et(0)),E=s.add.sprite(0,0,"shiny_icons").setOrigin(.15,.2).setScale(.6).setFrame(os(1)).setTint(Et(1)),I=s.add.sprite(0,0,"shiny_icons").setOrigin(.15,.2).setScale(.6).setFrame(os(2)).setTint(Et(2)),A=[new Oe("SHINY3",new oe("",I)),new Oe("SHINY2",new oe("",E)),new Oe("SHINY",new oe("",C)),new Oe("NORMAL",new oe(f.t("filterBar:normal"))),new Oe("UNCAUGHT",new oe(f.t("filterBar:uncaught")))];this.filterBar.addFilter(Pe.CAUGHT,f.t("filterBar:caughtFilter"),new Gt(0,0,A,this.updateStarters,Wt.HYBRID));const _=[new oe(f.t("filterBar:passive"),void 0,Q.OFF),new oe(f.t("filterBar:passiveUnlocked"),void 0,Q.ON),new oe(f.t("filterBar:passiveUnlockable"),void 0,Q.UNLOCKABLE),new oe(f.t("filterBar:passiveLocked"),void 0,Q.EXCLUDE)],w=[new oe(f.t("filterBar:costReduction"),void 0,Q.OFF),new oe(f.t("filterBar:costReductionUnlocked"),void 0,Q.ON),new oe(f.t("filterBar:costReductionUnlockedOne"),void 0,Q.ONE),new oe(f.t("filterBar:costReductionUnlockedTwo"),void 0,Q.TWO),new oe(f.t("filterBar:costReductionUnlockable"),void 0,Q.UNLOCKABLE),new oe(f.t("filterBar:costReductionLocked"),void 0,Q.EXCLUDE)],L=[new Oe("PASSIVE",_),new Oe("COST_REDUCTION",w)];this.filterBar.addFilter(Pe.UNLOCKS,f.t("filterBar:unlocksFilter"),new Gt(0,0,L,this.updateStarters,Wt.RADIAL));const V=[new oe(f.t("filterBar:favorite"),void 0,Q.OFF),new oe(f.t("filterBar:isFavorite"),void 0,Q.ON),new oe(f.t("filterBar:notFavorite"),void 0,Q.EXCLUDE)],H=[new oe(f.t("filterBar:ribbon"),void 0,Q.OFF),new oe(f.t("filterBar:hasWon"),void 0,Q.ON),new oe(f.t("filterBar:hasNotWon"),void 0,Q.EXCLUDE)],W=[new oe(f.t("filterBar:hiddenAbility"),void 0,Q.OFF),new oe(f.t("filterBar:hasHiddenAbility"),void 0,Q.ON),new oe(f.t("filterBar:noHiddenAbility"),void 0,Q.EXCLUDE)],ee=[new oe(f.t("filterBar:egg"),void 0,Q.OFF),new oe(f.t("filterBar:eggPurchasable"),void 0,Q.ON)],me=[new oe(f.t("filterBar:pokerus"),void 0,Q.OFF),new oe(f.t("filterBar:hasPokerus"),void 0,Q.ON)],N=[new Oe("FAVORITE",V),new Oe("WIN",H),new Oe("HIDDEN_ABILITY",W),new Oe("EGG",ee),new Oe("POKERUS",me)];this.filterBar.addFilter(Pe.MISC,f.t("filterBar:miscFilter"),new Gt(0,0,N,this.updateStarters,Wt.RADIAL));const j=[new Oe(qe.NUMBER,new oe(f.t("filterBar:sortByNumber"),void 0,Q.ON)),new Oe(qe.COST,new oe(f.t("filterBar:sortByCost"))),new Oe(qe.CANDY,new oe(f.t("filterBar:sortByCandies"))),new Oe(qe.IV,new oe(f.t("filterBar:sortByIVs"))),new Oe(qe.NAME,new oe(f.t("filterBar:sortByName"))),new Oe(qe.CAUGHT,new oe(f.t("filterBar:sortByNumCaught"))),new Oe(qe.HATCHED,new oe(f.t("filterBar:sortByNumHatched")))];this.filterBar.addFilter(Pe.SORT,f.t("filterBar:sortFilter"),new Gt(0,0,j,this.updateStarters,Wt.SINGLE)),this.filterBarContainer.add(this.filterBar),this.filterBar.offsetHybridFilters(),s.uiTheme===Gh.DEFAULT&&u.setVisible(!1),this.iconAnimHandler=new lr,this.iconAnimHandler.setup(),this.pokemonSprite=s.add.sprite(53,63,"pkmn__sub"),this.pokemonSprite.setPipeline(s.spritePipeline,{tone:[0,0,0,0],ignoreTimeTint:!0}),this.pokemonNumberText=P(17,1,"0000",O.SUMMARY_DEX_NUM).setOrigin(0),this.pokemonNameText=P(6,112,"",O.SUMMARY).setOrigin(0),this.pokemonGrowthRateLabelText=P(8,106,f.t("starterSelectUiHandler:growthRate"),O.SUMMARY_ALT,{fontSize:"36px"}).setOrigin(0).setVisible(!1),this.pokemonGrowthRateText=P(34,106,"",O.GROWTH_RATE_TYPE,{fontSize:"36px"}).setOrigin(0),this.pokemonGenderText=P(96,112,"",O.SUMMARY_ALT).setOrigin(0),this.pokemonUncaughtText=P(6,127,f.t("starterSelectUiHandler:uncaught"),O.SUMMARY_ALT,{fontSize:"56px"}).setOrigin(0);const v=n?.starterInfoXPos||31,z=n?.starterInfoYOffset||0,ne=n?.starterInfoTextSize||56;this.pokemonAbilityLabelText=P(6,127+z,f.t("starterSelectUiHandler:ability"),O.SUMMARY_ALT,{fontSize:ne}).setOrigin(0).setVisible(!1),this.pokemonAbilityText=P(v,127+z,"",O.SUMMARY_ALT,{fontSize:ne}).setOrigin(0).setInteractive(new Phaser.Geom.Rectangle(0,0,250,55),Phaser.Geom.Rectangle.Contains),this.pokemonPassiveLabelText=P(6,136+z,f.t("starterSelectUiHandler:passive"),O.SUMMARY_ALT,{fontSize:ne}).setOrigin(0).setVisible(!1),this.pokemonPassiveText=P(v,136+z,"",O.SUMMARY_ALT,{fontSize:ne}).setOrigin(0).setInteractive(new Phaser.Geom.Rectangle(0,0,250,55),Phaser.Geom.Rectangle.Contains),this.pokemonPassiveDisabledIcon=s.add.sprite(v,137+z,"icon_stop").setOrigin(0,.5).setScale(.35).setVisible(!1),this.pokemonPassiveLockedIcon=s.add.sprite(v,137+z,"icon_lock").setOrigin(0,.5).setScale(.42,.38).setVisible(!1),this.pokemonNatureLabelText=P(6,145+z,f.t("starterSelectUiHandler:nature"),O.SUMMARY_ALT,{fontSize:ne}).setOrigin(0).setVisible(!1),this.pokemonNatureText=It(v,145+z,"",O.SUMMARY_ALT,{fontSize:ne}).setOrigin(0),this.pokemonMoveContainers=[],this.pokemonMoveBgs=[],this.pokemonMoveLabels=[],this.pokemonEggMoveContainers=[],this.pokemonEggMoveBgs=[],this.pokemonEggMoveLabels=[],this.valueLimitLabel=P(Os+17,150,"0/10",O.STARTER_VALUE_LIMIT).setOrigin(.5,0);const X=P(Os+17,162,f.t("common:start"),O.TOOLTIP_CONTENT).setOrigin(.5,0);this.startCursorObj=s.add.nineslice(Os+4,160,"select_cursor",void 0,26,15,6,6,6,6).setVisible(!1).setOrigin(0);const J=P(Os+17,23,f.t("starterSelectUiHandler:randomize"),O.TOOLTIP_CONTENT).setOrigin(.5,0);this.randomCursorObj=s.add.nineslice(Os+4,21,"select_cursor",void 0,26,15,6,6,6,6).setVisible(!1).setOrigin(0);const R=[],Te=s.add.container(sa+6,9);this.starterSelectScrollBar=new Ps(161,12,5,u.height-6,9),Te.add(this.starterSelectScrollBar),this.pokerusCursorObjs=[];for(let be=0;be<Tg;be++){const _e=s.add.image(0,0,"select_cursor_pokerus");_e.setVisible(!1),_e.setOrigin(0),Te.add(_e),this.pokerusCursorObjs.push(_e)}this.starterCursorObjs=[];for(let be=0;be<6;be++){const _e=s.add.image(0,0,"select_cursor_highlight");_e.setVisible(!1),_e.setOrigin(0),Te.add(_e),this.starterCursorObjs.push(_e)}this.cursorObj=s.add.image(0,0,"select_cursor").setOrigin(0),this.starterIconsCursorObj=s.add.image(289,64,"select_gen_cursor").setName("starter-icons-cursor").setVisible(!1).setOrigin(0),Te.add(this.cursorObj);for(const be of it){if(!$e.hasOwnProperty(be.speciesId)||!be.isObtainable())continue;R.push(be.speciesId),this.speciesLoaded.set(be.speciesId,!1),this.allSpecies.push(be);const _e=new Hl(be).setVisible(!1);this.iconAnimHandler.addOrUpdate(_e.icon,Ft.NONE),this.starterContainers.push(_e),Te.add(_e)}this.starterIcons=[];for(let be=0;be<6;be++){const _e=s.add.sprite(Os+7,jh(be),"pokemon_icons_0").setScale(.5).setOrigin(0).setFrame("unknown");this.iconAnimHandler.addOrUpdate(_e,Ft.PASSIVE),this.starterIcons.push(_e)}this.type1Icon=s.add.sprite(8,98,Kt("types")).setScale(.5).setOrigin(0),this.type2Icon=s.add.sprite(26,98,Kt("types")).setScale(.5).setOrigin(0),this.pokemonLuckLabelText=P(8,89,f.t("common:luckIndicator"),O.WINDOW_ALT,{fontSize:"56px"}).setOrigin(0),this.pokemonLuckText=P(8+this.pokemonLuckLabelText.displayWidth+2,89,"0",O.LUCK_VALUE,{fontSize:"56px"}).setOrigin(0),this.pokemonCandyContainer=s.add.container(4.5,18).setInteractive(new Phaser.Geom.Rectangle(0,0,30,20),Phaser.Geom.Rectangle.Contains),this.pokemonCandyIcon=s.add.sprite(0,0,"candy").setScale(.5).setOrigin(0),this.pokemonCandyOverlayIcon=s.add.sprite(0,0,"candy_overlay").setScale(.5).setOrigin(0),this.pokemonCandyDarknessOverlay=s.add.sprite(0,0,"candy").setScale(.5).setOrigin(0).setTint(0).setAlpha(.5),this.pokemonCandyCountText=P(9.5,0,"x0",O.WINDOW_ALT,{fontSize:"56px"}).setOrigin(0),this.pokemonCandyContainer.add([this.pokemonCandyIcon,this.pokemonCandyOverlayIcon,this.pokemonCandyDarknessOverlay,this.pokemonCandyCountText]),this.pokemonFormText=P(6,42,"Form",O.WINDOW_ALT,{fontSize:"42px"}).setOrigin(0),this.pokemonCaughtHatchedContainer=s.add.container(2,25).setScale(.5);const Y=s.add.sprite(1,0,"items","pb").setOrigin(0).setScale(.75);this.pokemonCaughtCountText=P(24,4,"0",O.SUMMARY_ALT).setOrigin(0),this.pokemonHatchedIcon=s.add.sprite(1,14,"egg_icons").setOrigin(.15,.2).setScale(.8),this.pokemonShinyIcon=s.add.sprite(14,76,"shiny_icons").setOrigin(.15,.2).setScale(1),this.pokemonHatchedCountText=P(24,19,"0",O.SUMMARY_ALT).setOrigin(0),this.pokemonMovesContainer=s.add.container(102,16).setScale(.375),this.pokemonCaughtHatchedContainer.add([Y,this.pokemonCaughtCountText,this.pokemonHatchedIcon,this.pokemonShinyIcon,this.pokemonHatchedCountText]);for(let be=0;be<4;be++){const _e=s.add.container(0,14*be),we=s.add.nineslice(0,0,"type_bgs","unknown",92,14,2,2,2,2);we.setOrigin(1,0);const Ne=P(-we.width/2,0,"-",O.MOVE_LABEL);Ne.setOrigin(.5,0),this.pokemonMoveBgs.push(we),this.pokemonMoveLabels.push(Ne),_e.add([we,Ne]),this.pokemonMoveContainers.push(_e),this.pokemonMovesContainer.add(_e)}this.pokemonAdditionalMoveCountLabel=P(-this.pokemonMoveBgs[0].width/2,56,"(+0)",O.MOVE_LABEL).setOrigin(.5,0),this.pokemonMovesContainer.add(this.pokemonAdditionalMoveCountLabel),this.pokemonEggMovesContainer=s.add.container(102,85).setScale(.375),this.eggMovesLabel=P(-46,0,f.t("starterSelectUiHandler:eggMoves"),O.WINDOW_ALT).setOrigin(.5,0),this.pokemonEggMovesContainer.add(this.eggMovesLabel);for(let be=0;be<4;be++){const _e=s.add.container(0,16+14*be),we=s.add.nineslice(0,0,"type_bgs","unknown",92,14,2,2,2,2);we.setOrigin(1,0);const Ne=P(-we.width/2,0,"???",O.MOVE_LABEL);Ne.setOrigin(.5,0),this.pokemonEggMoveBgs.push(we),this.pokemonEggMoveLabels.push(Ne),_e.add([we,Ne]),this.pokemonEggMoveContainers.push(_e),this.pokemonEggMovesContainer.add(_e)}this.teraIcon=s.add.sprite(85,63,"button_tera").setName("terastallize-icon").setFrame("fire");const U=n.instructionTextSize;this.instructionsContainer=s.add.container(4,156).setVisible(!0);const Ee=this.instructionRowX,ue=this.instructionRowY,he=Ee+this.instructionRowTextOffset;this.shinyIconElement=new Phaser.GameObjects.Sprite(s,Ee,ue,"keyboard","R.png").setName("sprite-shiny-icon-element").setScale(.675).setOrigin(0),this.shinyLabel=P(he,ue,f.t("starterSelectUiHandler:cycleShiny"),O.INSTRUCTIONS_TEXT,{fontSize:U}).setName("text-shiny-label"),this.formIconElement=new Phaser.GameObjects.Sprite(s,Ee,ue,"keyboard","F.png").setName("sprite-form-icon-element").setScale(.675).setOrigin(0),this.formLabel=P(he,ue,f.t("starterSelectUiHandler:cycleForm"),O.INSTRUCTIONS_TEXT,{fontSize:U}).setName("text-form-label"),this.genderIconElement=new Phaser.GameObjects.Sprite(s,Ee,ue,"keyboard","G.png").setName("sprite-gender-icon-element").setScale(.675).setOrigin(0),this.genderLabel=P(he,ue,f.t("starterSelectUiHandler:cycleGender"),O.INSTRUCTIONS_TEXT,{fontSize:U}).setName("text-gender-label"),this.abilityIconElement=new Phaser.GameObjects.Sprite(s,Ee,ue,"keyboard","E.png").setName("sprite-ability-icon-element").setScale(.675).setOrigin(0),this.abilityLabel=P(he,ue,f.t("starterSelectUiHandler:cycleAbility"),O.INSTRUCTIONS_TEXT,{fontSize:U}).setName("text-ability-label"),this.natureIconElement=new Phaser.GameObjects.Sprite(s,Ee,ue,"keyboard","N.png").setName("sprite-nature-icon-element").setScale(.675).setOrigin(0),this.natureLabel=P(he,ue,f.t("starterSelectUiHandler:cycleNature"),O.INSTRUCTIONS_TEXT,{fontSize:U}).setName("text-nature-label"),this.teraIconElement=new Phaser.GameObjects.Sprite(s,Ee,ue,"keyboard","V.png").setName("sprite-tera-icon-element").setScale(.675).setOrigin(0),this.teraLabel=P(he,ue,f.t("starterSelectUiHandler:cycleTera"),O.INSTRUCTIONS_TEXT,{fontSize:U}).setName("text-tera-label"),this.goFilterIconElement=new Phaser.GameObjects.Sprite(s,this.filterInstructionRowX,this.filterInstructionRowY,"keyboard","C.png").setName("sprite-goFilter-icon-element").setScale(.675).setOrigin(0),this.goFilterLabel=P(this.filterInstructionRowX+this.instructionRowTextOffset,this.filterInstructionRowY,f.t("starterSelectUiHandler:goFilter"),O.INSTRUCTIONS_TEXT,{fontSize:U}).setName("text-goFilter-label"),this.hideInstructions(),this.filterInstructionsContainer=s.add.container(50,5).setVisible(!0),this.starterSelectMessageBoxContainer=s.add.container(0,a).setVisible(!1),this.starterSelectMessageBox=Ce(1,-1,318,28).setOrigin(0,1),this.starterSelectMessageBoxContainer.add(this.starterSelectMessageBox),this.message=P(8,8,"",O.WINDOW,{maxLines:2}).setOrigin(0),this.starterSelectMessageBoxContainer.add(this.message),this.initPromptSprite(this.starterSelectMessageBoxContainer),this.statsContainer=new yn(6,16).setVisible(!1),s.add.existing(this.statsContainer),this.moveInfoOverlay=new si({top:!0,x:1,y:s.scaledCanvas.height-si.getHeight()-29}),this.starterSelectContainer.add([o,c,l,this.shinyOverlay,p,Ce(Os,ca-Of,ia,Of,!0),Ce(Os,ca,ia,_n),Ce(Os,ca+_n,ia,ia,!0),u,this.pokemonSprite,this.pokemonNumberText,this.pokemonNameText,this.pokemonGrowthRateLabelText,this.pokemonGrowthRateText,this.pokemonGenderText,this.pokemonUncaughtText,this.pokemonAbilityLabelText,this.pokemonAbilityText,this.pokemonPassiveLabelText,this.pokemonPassiveText,this.pokemonPassiveDisabledIcon,this.pokemonPassiveLockedIcon,this.pokemonNatureLabelText,this.pokemonNatureText,this.valueLimitLabel,X,this.startCursorObj,J,this.randomCursorObj,this.starterIconsCursorObj,Te,...this.starterIcons,this.type1Icon,this.type2Icon,this.pokemonLuckLabelText,this.pokemonLuckText,this.pokemonCandyContainer,this.pokemonFormText,this.pokemonCaughtHatchedContainer,this.pokemonMovesContainer,this.pokemonEggMovesContainer,this.teraIcon,this.instructionsContainer,this.filterInstructionsContainer,this.starterSelectMessageBoxContainer,this.statsContainer,this.moveInfoOverlay,this.filterBarContainer]),this.initTutorialOverlay(this.starterSelectContainer),this.starterSelectContainer.bringToTop(this.starterSelectMessageBoxContainer),s.eventTarget.addEventListener(Si.CANDY_UPGRADE_NOTIFICATION_CHANGED,be=>this.onCandyUpgradeDisplayChanged(be)),this.updateInstructions()}show(e){if(this.moveInfoOverlay.clear(),this.pokerusSpecies=Sg(),this.allowTera=s.gameData.achvUnlocks.hasOwnProperty(Fe.TERASTALLIZE.id),e.length>0&&e[0]instanceof Function){super.show(e),this.starterSelectCallback=e[0],this.starterSelectContainer.setVisible(!0),this.starterPreferences=Cg(),this.originalStarterPreferences=Br(this.starterPreferences),this.allSpecies.forEach((i,n)=>{const a=this.starterContainers[n].icon,{dexEntry:r}=this.getSpeciesData(i.speciesId);this.starterPreferences[i.speciesId]=this.initStarterPrefs(i,this.starterPreferences),this.originalStarterPreferences[i.speciesId]=this.initStarterPrefs(i,this.originalStarterPreferences,!0),r.caughtAttr?a.clearTint():r.seenAttr&&a.setTint(8421504),this.setUpgradeAnimation(a,i)});const t=!s.gameMode.hasChallenge(Pt.FRESH_START);for(const i of this.pokemonEggMoveContainers)i.setVisible(t);return this.eggMovesLabel.setVisible(t),this.pokemonPassiveDisabledIcon.setVisible(t),this.pokemonPassiveLabelText.setVisible(t),this.pokemonPassiveLockedIcon.setVisible(t),this.pokemonPassiveText.setVisible(t),this.resetFilters(),this.updateStarters(),this.setFilterMode(!1),this.filterBarCursor=0,this.setCursor(0),this.tryUpdateValue(0),ii(ds.Starter_Select),!0}return!1}initStarterPrefs(e,t,i=!1){t[e.speciesId]??={};const n=t[e.speciesId],{dexEntry:a,starterDataEntry:r}=this.getSpeciesData(e.speciesId,!i);if(!n||!a.caughtAttr)return{};const o=a.caughtAttr,l=o&F.SHINY,c=o&F.NON_SHINY;if(n.shiny&&!l?(n.shiny=void 0,n.variant=void 0):n.shiny===!1&&!c&&(n.shiny=void 0),n.variant!==void 0){const p=[l&&o&F.DEFAULT_VARIANT,l&&o&F.VARIANT_2,l&&o&F.VARIANT_3];(Number.isNaN(n.variant)||n.variant<0||!p[n.variant])&&(n.variant=void 0)}if(n.female!==void 0&&!(n.female?o&F.FEMALE:o&F.MALE)&&(n.female=void 0),n.ability!==void 0){const p=e.ability2===e.ability1,m=r.abilityAttr,d=m&ht.ABILITY_1,y=m&ht.ABILITY_2,g=m&ht.ABILITY_HIDDEN;[d,p?y&&!d:y,g][n.ability]||(n.ability=void 0)}const u=n.form;return u!==void 0&&(!e.forms[u]?.isStarterSelectable||!(o&s.gameData.getFormAttr(u)))&&(n.form=void 0),n.nature!==void 0&&s.gameData.getNaturesForAttr(a.natureAttr).indexOf(n.nature)<0&&(n.nature=void 0),n.tera!==void 0&&(n.tera===e.type1||n.tera===e?.type2||(n.tera=e.type1),s.gameMode.hasChallenge(Pt.FRESH_START)&&!i&&(n.tera=e.type1)),n}resetFilters(){this.filterBar.setValsToDefault(),this.resetCaughtDropdown()}resetCaughtDropdown(){const e=this.filterBar.getFilter(Pe.CAUGHT);e.resetToDefault();for(let t=0;t<e.options.length;t++)e.options[t].val!=="ALL"&&e.options[t].val!=="UNCAUGHT"&&e.toggleOptionState(t)}showText(e,t,i,n,a,r,o){super.showText(e,t,i,n,a,r);const l=e?.indexOf(`
`)===-1;this.starterSelectMessageBox.setSize(318,l?28:42),o?(this.starterSelectMessageBox.setOrigin(0),this.starterSelectMessageBoxContainer.setY(0),this.message.setY(4)):(this.starterSelectMessageBoxContainer.setY(s.scaledCanvas.height),this.starterSelectMessageBox.setOrigin(0,1),this.message.setY(l?-22:-37)),this.starterSelectMessageBoxContainer.setVisible(e?.length>0)}isUpgradeIconEnabled(){return s.candyUpgradeNotification!==0&&s.candyUpgradeDisplay===0}isUpgradeAnimationEnabled(){return s.candyUpgradeNotification!==0&&s.candyUpgradeDisplay===1}isPassiveAvailable(e){const t=s.gameData.starterData[e];return t.candyCount>=cn($e[e])&&!(t.passiveAttr&At.UNLOCKED)}isValueReductionAvailable(e){const t=s.gameData.starterData[e];return t.candyCount>=un($e[e])[t.valueReduction]&&t.valueReduction<vf}isSameSpeciesEggAvailable(e){const t=s.gameData.starterData[e],i=s.gameData.dexData[e].hatchedCount;return t.candyCount>=dn($e[e],i)}setUpgradeAnimation(e,t,i=!1){if(s.tweens.killTweensOf(e),s.candyUpgradeDisplay===0||t.speciesId!==t.getRootSpeciesId(!1))return;e.y=2;const n={targets:e,paused:i,loop:-1,delay:Eg(0,50)*5,loopDelay:ge(1e3),tweens:[{targets:e,y:"-=5",duration:ge(125),ease:"Cubic.easeOut",yoyo:!0},{targets:e,y:"-=3",duration:ge(150),ease:"Cubic.easeOut",yoyo:!0}]};if(this.isPassiveAvailable(t.speciesId)||s.candyUpgradeNotification===2&&(this.isValueReductionAvailable(t.speciesId)||this.isSameSpeciesEggAvailable(t.speciesId))){const a=s.tweens.chain(n);i||a.play()}}setUpgradeIcon(e){const t=e.species,i=!!t?.speciesId;if(!t||s.candyUpgradeNotification===0||t.speciesId!==t.getRootSpeciesId(!1)){e.candyUpgradeIcon.setVisible(!1),e.candyUpgradeOverlayIcon.setVisible(!1);return}const n=this.isPassiveAvailable(t.speciesId),a=this.isValueReductionAvailable(t.speciesId),r=this.isSameSpeciesEggAvailable(t.speciesId);s.candyUpgradeNotification===1?(e.candyUpgradeIcon.setVisible(i&&n),e.candyUpgradeOverlayIcon.setVisible(i&&e.candyUpgradeIcon.visible)):s.candyUpgradeNotification===2&&(e.candyUpgradeIcon.setVisible(i&&(n||a||r)),e.candyUpgradeOverlayIcon.setVisible(i&&e.candyUpgradeIcon.visible))}updateCandyUpgradeDisplay(e){this.isUpgradeIconEnabled()&&this.setUpgradeIcon(e),this.isUpgradeAnimationEnabled()&&this.setUpgradeAnimation(e.icon,this.lastSpecies,!0)}onCandyUpgradeDisplayChanged(e){if(e){if(s.candyUpgradeDisplay===0){this.filteredStarterContainers.forEach(i=>{this.setUpgradeIcon(i)});return}this.filteredStarterContainers.forEach((i,n)=>{const a=this.filteredStarterContainers[n].icon;this.setUpgradeAnimation(a,i.species)})}}processInput(e){if(this.blockInput)return!1;const t=9,i=9,n=this.filteredStarterContainers.length,a=Math.ceil(n/t),r=Math.floor(this.cursor/t),o=this.scrollCursor*t,l=Math.min(this.filteredStarterContainers.length-1,o+i*t-1),c=l-o+1,u=Math.ceil(c/t),p=Math.floor((this.cursor-o)/t),m=this.getUi();let d=!1,y=!1;if(e===b.SUBMIT)this.tryStart(!0)?d=!0:y=!0;else if(e===b.CANCEL)this.filterMode&&this.filterBar.openDropDown?(this.filterBar.toggleDropDown(this.filterBarCursor),d=!0):this.filterMode&&!this.filterBar.getFilter(this.filterBar.getColumn(this.filterBarCursor)).hasDefaultValues()?(this.filterBar.getColumn(this.filterBarCursor)===Pe.CAUGHT?this.resetCaughtDropdown():this.filterBar.resetSelection(this.filterBarCursor),this.updateStarters(),d=!0):this.statsMode?(this.toggleStatsMode(!1),d=!0):this.starterSpecies.length>0?(this.popStarter(this.starterSpecies.length-1),d=!0,this.updateInstructions()):(this.tryExit(),d=!0);else if(e===b.STATS)this.filterMode||(this.startCursorObj.setVisible(!1),this.starterIconsCursorObj.setVisible(!1),this.randomCursorObj.setVisible(!1),this.setSpecies(null),this.filterBarCursor=0,this.setFilterMode(!0),this.filterBar.toggleDropDown(this.filterBarCursor));else if(this.startCursorObj.visible)switch(e){case b.ACTION:this.tryStart(!0)?d=!0:y=!0;break;case b.UP:this.startCursorObj.setVisible(!1),this.starterSpecies.length>0?(this.starterIconsCursorIndex=this.starterSpecies.length-1,this.moveStarterIconsCursor(this.starterIconsCursorIndex)):(this.startCursorObj.setVisible(!1),this.randomCursorObj.setVisible(!0)),d=!0;break;case b.DOWN:this.startCursorObj.setVisible(!1),this.filterBarCursor=Math.max(1,this.filterBar.numFilters-1),this.setFilterMode(!0),d=!0;break;case b.LEFT:n>0&&(this.startCursorObj.setVisible(!1),this.cursorObj.setVisible(!0),this.setCursor(o+(u-1)*9+8),d=!0);break;case b.RIGHT:n>0&&(this.startCursorObj.setVisible(!1),this.cursorObj.setVisible(!0),this.setCursor(o+(u-1)*9),d=!0);break}else if(this.filterMode)switch(e){case b.LEFT:this.filterBarCursor>0?d=this.setCursor(this.filterBarCursor-1):d=this.setCursor(this.filterBar.numFilters-1);break;case b.RIGHT:this.filterBarCursor<this.filterBar.numFilters-1?d=this.setCursor(this.filterBarCursor+1):d=this.setCursor(0);break;case b.UP:if(this.filterBar.openDropDown)d=this.filterBar.decDropDownCursor();else if(this.filterBarCursor===this.filterBar.numFilters-1)this.setFilterMode(!1),this.cursorObj.setVisible(!1),this.starterSpecies.length>0?this.startCursorObj.setVisible(!0):this.randomCursorObj.setVisible(!0),d=!0;else if(n>0){this.setFilterMode(!1),this.scrollCursor=Math.max(0,a-9),this.updateScroll();const g=(this.filterBarCursor+.5)/this.filterBar.numFilters,C=Math.min(8,Math.floor(g*11));n%9>C?this.setCursor(n-n%9+C):this.setCursor(Math.max(n-n%9+C-9,0)),d=!0}break;case b.DOWN:if(this.filterBar.openDropDown)d=this.filterBar.incDropDownCursor();else if(this.filterBarCursor===this.filterBar.numFilters-1)this.setFilterMode(!1),this.cursorObj.setVisible(!1),this.randomCursorObj.setVisible(!0),d=!0;else if(n>0){this.setFilterMode(!1),this.scrollCursor=0,this.updateScroll();const g=this.filterBarCursor/Math.max(1,this.filterBar.numFilters-1),C=Math.min(8,Math.floor(g*11));this.setCursor(Math.min(C,n)),d=!0}break;case b.ACTION:this.filterBar.openDropDown?this.filterBar.toggleOptionState():this.filterBar.toggleDropDown(this.filterBarCursor),d=!0;break}else if(this.randomCursorObj.visible)switch(e){case b.ACTION:{if(this.starterSpecies.length>=6){y=!0;break}const g=this.starterSpecies.map(me=>me.generation).reduce((me,N,j)=>me+s.gameData.getSpeciesStarterValue(this.starterSpecies[j].speciesId),0),C=this.filteredStarterContainers.filter(me=>{const N=me.species,[j]=this.isInParty(N),v=s.gameData.getSpeciesStarterValue(N.speciesId),z=ai(N,s.gameData.getSpeciesDexAttrProps(N,this.getCurrentDexProps(N.speciesId)),this.isPartyValid()),ne=this.getSpeciesData(N.speciesId).dexEntry.caughtAttr;return!j&&z&&g+v<=this.getValueLimit()&&ne});if(C.length===0){y=!0;break}const I=C[Math.floor(Math.random()*C.length)].species;this.setSpecies(I);const A=this.getCurrentDexProps(I.speciesId),_=s.gameData.getSpeciesDexAttrProps(I,A),w=this.abilityCursor,L=this.natureCursor,V=this.teraCursor,H=this.starterMoveset?.slice(0),W=s.gameData.getSpeciesStarterValue(I.speciesId);is(I.speciesId,_.formIndex).loadAssets(_.female,_.formIndex,_.shiny,_.variant,!0).then(()=>{this.tryUpdateValue(W,!0)&&(this.addToParty(I,A,w,L,H,V,!0),m.playSelect())});break}case b.UP:this.randomCursorObj.setVisible(!1),this.filterBarCursor=this.filterBar.numFilters-1,this.setFilterMode(!0),d=!0;break;case b.DOWN:this.randomCursorObj.setVisible(!1),this.starterSpecies.length>0?(this.starterIconsCursorIndex=0,this.moveStarterIconsCursor(this.starterIconsCursorIndex)):(this.filterBarCursor=this.filterBar.numFilters-1,this.setFilterMode(!0)),d=!0;break;case b.LEFT:n>0&&(this.randomCursorObj.setVisible(!1),this.cursorObj.setVisible(!0),this.setCursor(o+8),d=!0);break;case b.RIGHT:n>0&&(this.randomCursorObj.setVisible(!1),this.cursorObj.setVisible(!0),this.setCursor(o),d=!0);break}else{let g;const C=this.getSpeciesData(this.lastSpecies.speciesId).starterDataEntry,E=s.gameData.starterData[this.lastSpecies.speciesId];this.starterPreferences[this.lastSpecies.speciesId]===void 0&&(this.starterPreferences[this.lastSpecies.speciesId]={}),this.originalStarterPreferences[this.lastSpecies.speciesId]===void 0&&(this.originalStarterPreferences[this.lastSpecies.speciesId]={});const I=this.starterPreferences[this.lastSpecies.speciesId],A=this.originalStarterPreferences[this.lastSpecies.speciesId];if(this.starterIconsCursorObj.visible?g=this.filteredStarterContainers[this.filteredStarterContainers.findIndex(_=>_.species===this.lastSpecies)]:g=this.filteredStarterContainers[this.cursor],e===b.ACTION){if(!this.speciesStarterDexEntry?.caughtAttr)y=!0;else if(this.starterSpecies.length<=6){const _=this.getUi();let w=[];const[L,V]=this.isInParty(this.lastSpecies),H=this.isPartyValid(),W=ai(this.lastSpecies,s.gameData.getSpeciesDexAttrProps(this.lastSpecies,this.getCurrentDexProps(this.lastSpecies.speciesId)),H),ee=this.starterSpecies.map(ne=>ne.generation).reduce((ne,X,J)=>ne+=s.gameData.getSpeciesStarterValue(this.starterSpecies[J].speciesId),0),me=s.gameData.getSpeciesStarterValue(this.lastSpecies.speciesId);if(!L&&W&&ee+me<=this.getValueLimit()&&this.starterSpecies.length<ua?w=[{label:f.t("starterSelectUiHandler:addToParty"),handler:h(()=>{_.setMode(x.STARTER_SELECT);const ne=this.tryUpdateValue(s.gameData.getSpeciesStarterValue(this.lastSpecies.speciesId),!0);return!L&&W&&ne?(this.starterCursorObjs[this.starterSpecies.length].setVisible(!0).setPosition(this.cursorObj.x,this.cursorObj.y),this.addToParty(this.lastSpecies,this.dexAttrCursor,this.abilityCursor,this.natureCursor,this.starterMoveset?.slice(0),this.teraCursor),_.playSelect()):_.playError(),!0},"handler"),overrideSound:!0}]:L&&(w=[{label:f.t("starterSelectUiHandler:removeFromParty"),handler:h(()=>(this.popStarter(V),_.setMode(x.STARTER_SELECT),!0),"handler")}]),w.push({label:f.t("starterSelectUiHandler:toggleIVs"),handler:h(()=>(this.toggleStatsMode(),_.setMode(x.STARTER_SELECT),!0),"handler")}),this.speciesStarterMoves.length>1){const ne=h(X=>{this.blockInput=!0,_.setMode(x.STARTER_SELECT).then(()=>{_.showText(f.t("starterSelectUiHandler:selectMoveSwapOut"),null,()=>{this.moveInfoOverlay.show(We[X[0]]),_.setModeWithoutClear(x.OPTION_SELECT,{options:X.map((J,R)=>({label:We[J].name,handler:h(()=>(this.blockInput=!0,_.setMode(x.STARTER_SELECT).then(()=>{_.showText(`${f.t("starterSelectUiHandler:selectMoveSwapWith")} ${We[J].name}.`,null,()=>{const Y=this.speciesStarterMoves.filter(U=>U!==J);this.moveInfoOverlay.show(We[Y[0]]),_.setModeWithoutClear(x.OPTION_SELECT,{options:Y.map(U=>({label:We[U].name,handler:h(()=>(this.switchMoveHandler(R,U,J),ne(this.starterMoveset),!0),"handler"),onHover:h(()=>{this.moveInfoOverlay.show(We[U])},"onHover")})).concat({label:f.t("menu:cancel"),handler:h(()=>(ne(this.starterMoveset),!0),"handler"),onHover:h(()=>{this.moveInfoOverlay.clear()},"onHover")}),supportHover:!0,maxOptions:8,yOffset:19}),this.blockInput=!1})}),!0),"handler"),onHover:h(()=>{this.moveInfoOverlay.show(We[J])},"onHover")})).concat({label:f.t("menu:cancel"),handler:h(()=>(this.moveInfoOverlay.clear(),this.clearText(),this.hasSwappedMoves&&s.gameData.saveSystem().then(J=>{if(!J)return s.reset(!0)}),_.setMode(x.STARTER_SELECT),!0),"handler"),onHover:h(()=>{this.moveInfoOverlay.clear()},"onHover")}),supportHover:!0,maxOptions:8,yOffset:19}),this.blockInput=!1})})},"showSwapOptions");w.push({label:f.t("starterSelectUiHandler:manageMoves"),handler:h(()=>(this.hasSwappedMoves=!1,ne(this.starterMoveset),!0),"handler")})}if(this.canCycleNature){const ne=h(()=>{this.blockInput=!0,_.setMode(x.STARTER_SELECT).then(()=>{_.showText(f.t("starterSelectUiHandler:selectNature"),null,()=>{const X=s.gameData.getNaturesForAttr(this.speciesStarterDexEntry?.natureAttr);_.setModeWithoutClear(x.OPTION_SELECT,{options:X.map((J,R)=>({label:ki(J,!0,!0,!0),handler:h(()=>(I.nature=J,A.nature=I.nature,this.clearText(),_.setMode(x.STARTER_SELECT),this.setSpeciesDetails(this.lastSpecies,{natureIndex:J}),this.blockInput=!1,!0),"handler")})).concat({label:f.t("menu:cancel"),handler:h(()=>(this.clearText(),_.setMode(x.STARTER_SELECT),this.blockInput=!1,!0),"handler")}),maxOptions:8,yOffset:19})})})},"showNatureOptions");w.push({label:f.t("starterSelectUiHandler:manageNature"),handler:h(()=>(ne(),!0),"handler")})}const N=C.passiveAttr;if(N&At.UNLOCKED){const ne=f.t(N&At.ENABLED?"starterSelectUiHandler:disablePassive":"starterSelectUiHandler:enablePassive");w.push({label:ne,handler:h(()=>(C.passiveAttr^=At.ENABLED,E.passiveAttr^=At.ENABLED,_.setMode(x.STARTER_SELECT),this.setSpeciesDetails(this.lastSpecies),!0),"handler")})}I?.favorite??!1?w.push({label:f.t("starterSelectUiHandler:removeFromFavorites"),handler:h(()=>(I.favorite=!1,A.favorite=!1,g&&g.favoriteIcon.setVisible(I.favorite),_.setMode(x.STARTER_SELECT),!0),"handler")}):w.push({label:f.t("starterSelectUiHandler:addToFavorites"),handler:h(()=>(I.favorite=!0,A.favorite=!0,g&&g.favoriteIcon.setVisible(I.favorite),_.setMode(x.STARTER_SELECT),!0),"handler")}),w.push({label:f.t("menu:rename"),handler:h(()=>{_.playSelect();let ne=I.nickname?String(I.nickname):"";return ne=decodeURIComponent(escape(atob(ne))),_.setModeWithoutClear(x.RENAME_POKEMON,{buttonActions:[X=>{_.playSelect(),I.nickname=X,A.nickname=X;const J=decodeURIComponent(escape(atob(I.nickname)));J.length>0?this.pokemonNameText.setText(J):this.pokemonNameText.setText(this.lastSpecies.name),this.truncateName(),_.setMode(x.STARTER_SELECT)},()=>{_.setMode(x.STARTER_SELECT)}]},ne),!0},"handler")});const v=C.candyCount,z=h(()=>{const ne=[];if(!(N&At.UNLOCKED)&&!s.gameMode.hasChallenge(Pt.FRESH_START)){const Y=cn($e[this.lastSpecies.speciesId]);ne.push({label:`${Y} ${f.t("starterSelectUiHandler:unlockPassive")}`,handler:h(()=>ie.FREE_CANDY_UPGRADE_OVERRIDE||v>=Y?(E.passiveAttr|=At.UNLOCKED|At.ENABLED,C.passiveAttr=E.passiveAttr,ie.FREE_CANDY_UPGRADE_OVERRIDE||(E.candyCount-=Y,C.candyCount=E.candyCount),this.pokemonCandyCountText.setText(`${C.candyCount}`),s.gameData.saveSystem().then(U=>{if(!U)return s.reset(!0)}),_.setMode(x.STARTER_SELECT),this.setSpeciesDetails(this.lastSpecies),s.playSound("se/buy"),g&&(this.updateCandyUpgradeDisplay(g),g.starterPassiveBgs.setVisible(!!C.passiveAttr)),!0):!1,"handler"),item:"candy",itemArgs:vt[this.lastSpecies.speciesId]})}const X=C.valueReduction;if(X<vf&&!s.gameMode.hasChallenge(Pt.FRESH_START)){const Y=un($e[this.lastSpecies.speciesId])[X];ne.push({label:`${Y} ${f.t("starterSelectUiHandler:reduceCost")}`,handler:h(()=>ie.FREE_CANDY_UPGRADE_OVERRIDE||v>=Y?(E.valueReduction++,C.valueReduction=E.valueReduction,ie.FREE_CANDY_UPGRADE_OVERRIDE||(E.candyCount-=Y,C.candyCount=E.candyCount),this.pokemonCandyCountText.setText(`${C.candyCount}`),s.gameData.saveSystem().then(U=>{if(!U)return s.reset(!0)}),this.tryUpdateValue(0),_.setMode(x.STARTER_SELECT),s.playSound("se/buy"),g&&(this.updateStarterValueLabel(g),this.updateCandyUpgradeDisplay(g)),!0):!1,"handler"),item:"candy",itemArgs:vt[this.lastSpecies.speciesId]})}const J=this.lastSpecies.speciesId,R=s.gameData.dexData[J].hatchedCount,Te=dn($e[J],R);ne.push({label:`${Te} ${f.t("starterSelectUiHandler:sameSpeciesEgg")}`,handler:h(()=>ie.FREE_CANDY_UPGRADE_OVERRIDE||v>=Te?s.gameData.eggs.length>=99&&!ie.UNLIMITED_EGG_COUNT_OVERRIDE?(this.showText(f.t("egg:tooManyEggs"),void 0,()=>this.showText("",0,()=>this.tutorialActive=!1),2e3,!1,void 0,!0),!1):(ie.FREE_CANDY_UPGRADE_OVERRIDE||(E.candyCount-=Te,C.candyCount=E.candyCount),this.pokemonCandyCountText.setText(`${C.candyCount}`),new _i({species:this.lastSpecies.speciesId,sourceType:gg.SAME_SPECIES_EGG}).addEggToGameData(),s.gameData.saveSystem().then(U=>{if(!U)return s.reset(!0)}),_.setMode(x.STARTER_SELECT),s.playSound("se/buy"),g&&this.updateCandyUpgradeDisplay(g),!0):!1,"handler"),item:"candy",itemArgs:vt[this.lastSpecies.speciesId]}),ne.push({label:f.t("menu:cancel"),handler:h(()=>(_.setMode(x.STARTER_SELECT),!0),"handler")}),_.setModeWithoutClear(x.OPTION_SELECT,{options:ne,yOffset:47})},"showUseCandies");w.push({label:f.t("menuUiHandler:pokedex"),handler:h(()=>(_.setMode(x.STARTER_SELECT).then(()=>{const ne={shiny:I.shiny,variant:I.variant,form:I.form,female:I.female};_.setOverlayMode(x.POKEDEX_PAGE,this.lastSpecies,ne,null,null,()=>{if(this.lastSpecies){g=this.filteredStarterContainers[this.cursor];const X=s.gameData.starterData[this.lastSpecies.speciesId];this.updateCandyUpgradeDisplay(g),this.updateStarterValueLabel(g),g.starterPassiveBgs.setVisible(!!X.passiveAttr&&!s.gameMode.hasChallenge(Pt.FRESH_START)),this.setSpecies(this.lastSpecies)}})}),!0),"handler")}),Bt.hasOwnProperty(this.lastSpecies.speciesId)||w.push({label:f.t("starterSelectUiHandler:useCandies"),handler:h(()=>(_.setMode(x.STARTER_SELECT).then(()=>z()),!0),"handler")}),w.push({label:f.t("menu:cancel"),handler:h(()=>(_.setMode(x.STARTER_SELECT),!0),"handler")}),_.setModeWithoutClear(x.OPTION_SELECT,{options:w,yOffset:47}),d=!0}}else{const _=s.gameData.getSpeciesDexAttrProps(this.lastSpecies,this.getCurrentDexProps(this.lastSpecies.speciesId));switch(e){case b.CYCLE_SHINY:if(this.canCycleShiny)if(I.shiny===!1){const w=s.gameData.getSpeciesDexAttrProps(this.lastSpecies,this.getCurrentDexProps(this.lastSpecies.speciesId)),L=I.variant?I.variant:w.variant;I.shiny=!0,A.shiny=!0,I.variant=L,A.variant=L,this.setSpeciesDetails(this.lastSpecies,{shiny:!0,variant:L}),s.playSound("se/sparkle");const V=Et(L);this.pokemonShinyIcon.setFrame(os(L)).setTint(V).setVisible(!0)}else{let w=_.variant;do if(w=(w+1)%3,w===0){if(this.speciesStarterDexEntry.caughtAttr&F.DEFAULT_VARIANT)break}else if(w===1){if(this.speciesStarterDexEntry.caughtAttr&F.VARIANT_2)break}else if(this.speciesStarterDexEntry.caughtAttr&F.VARIANT_3)break;while(w!==_.variant);if(I.variant=w,A.variant=w,this.speciesStarterDexEntry.caughtAttr&F.NON_SHINY&&w<=_.variant)I.shiny=!1,A.shiny=!1,this.setSpeciesDetails(this.lastSpecies,{shiny:!1,variant:0}),this.pokemonShinyIcon.setVisible(!1),d=!0;else{this.setSpeciesDetails(this.lastSpecies,{variant:w});const L=Et(w);this.pokemonShinyIcon.setFrame(os(w)).setTint(L),d=!0}}break;case b.CYCLE_FORM:if(this.canCycleForm){const w=this.lastSpecies.forms.length;let L=_.formIndex;do if(L=(L+1)%w,this.lastSpecies.forms[L].isStarterSelectable&&this.speciesStarterDexEntry.caughtAttr&s.gameData.getFormAttr(L))break;while(L!==_.formIndex);I.form=L,A.form=L,I.tera=this.lastSpecies.forms[L].type1,A.tera=I.tera,this.setSpeciesDetails(this.lastSpecies,{formIndex:L,teraType:I.tera}),d=!0}break;case b.CYCLE_GENDER:this.canCycleGender&&(I.female=!_.female,A.female=I.female,this.setSpeciesDetails(this.lastSpecies,{female:!_.female}),d=!0);break;case b.CYCLE_ABILITY:if(this.canCycleAbility){const w=this.lastSpecies.getAbilityCount(),L=C.abilityAttr,V=L&ht.ABILITY_1;let H=this.abilityCursor;do if(H=(H+1)%w,H===0){if(V)break}else if(H===1){this.lastSpecies.ability1===this.lastSpecies.ability2&&V&&(H=(H+1)%w);break}else if(L&ht.ABILITY_HIDDEN)break;while(H!==this.abilityCursor);I.ability=H,A.ability=H;const{visible:W}=s.ui.getTooltip();if(W&&this.activeTooltip==="ABILITY"){const ee=_t[this.lastSpecies.getAbility(H)];s.ui.editTooltip(`${ee.name}`,`${ee.description}`)}this.setSpeciesDetails(this.lastSpecies,{abilityIndex:H}),d=!0}break;case b.CYCLE_NATURE:if(this.canCycleNature){const w=s.gameData.getNaturesForAttr(this.speciesStarterDexEntry?.natureAttr),L=w.indexOf(this.natureCursor),V=w[L<w.length-1?L+1:0];I.nature=V,A.nature=I.nature,this.setSpeciesDetails(this.lastSpecies,{natureIndex:V}),d=!0}break;case b.CYCLE_TERA:if(this.canCycleTera){const w=is(this.lastSpecies.speciesId,I.form??0);w.type1===this.teraCursor&&w.type2!=null?(I.tera=w.type2,A.tera=I.tera,this.setSpeciesDetails(this.lastSpecies,{teraType:w.type2})):(I.tera=w.type1,A.tera=I.tera,this.setSpeciesDetails(this.lastSpecies,{teraType:w.type1})),d=!0}break;case b.UP:this.starterIconsCursorObj.visible?(this.starterIconsCursorIndex===0?(this.starterIconsCursorObj.setVisible(!1),this.setSpecies(null),this.randomCursorObj.setVisible(!0)):(this.starterIconsCursorIndex--,this.moveStarterIconsCursor(this.starterIconsCursorIndex)),d=!0):r>0?(this.scrollCursor>0&&r-this.scrollCursor===0&&(this.scrollCursor--,this.updateScroll()),d=this.setCursor(this.cursor-9)):(this.filterBarCursor=this.filterBar.getNearestFilter(this.filteredStarterContainers[this.cursor]),this.setFilterMode(!0),d=!0);break;case b.DOWN:this.starterIconsCursorObj.visible?(this.starterIconsCursorIndex<=this.starterSpecies.length-2?(this.starterIconsCursorIndex++,this.moveStarterIconsCursor(this.starterIconsCursorIndex)):(this.starterIconsCursorObj.setVisible(!1),this.setSpecies(null),this.startCursorObj.setVisible(!0)),d=!0):r<a-1?(r-this.scrollCursor===8&&this.scrollCursor++,d=this.setCursor(this.cursor+9),this.updateScroll()):a>1?(this.scrollCursor=0,this.updateScroll(),d=this.setCursor(this.cursor%9)):(this.filterBarCursor=this.filterBar.getNearestFilter(this.filteredStarterContainers[this.cursor]),this.setFilterMode(!0),d=!0);break;case b.LEFT:if(!this.starterIconsCursorObj.visible)this.cursor%9!==0?d=this.setCursor(this.cursor-1):(p===0?(this.cursorObj.setVisible(!1),this.randomCursorObj.setVisible(!0)):this.starterSpecies.length===0?d=this.setCursor(this.cursor+Math.min(8,n-this.cursor)):p<7?(this.cursorObj.setVisible(!1),this.starterIconsCursorIndex=Af(this.cursorObj.y-1,this.starterSpecies.length),this.moveStarterIconsCursor(this.starterIconsCursorIndex)):(this.cursorObj.setVisible(!1),this.setSpecies(null),this.startCursorObj.setVisible(!0)),d=!0);else if(n>0){const w=xf(this.starterIconsCursorIndex,u);this.starterIconsCursorObj.setVisible(!1),this.cursorObj.setVisible(!0),this.setCursor(Math.min(o+w*9+8,l)),d=!0}else d=!1;break;case b.RIGHT:if(!this.starterIconsCursorObj.visible)this.cursor%9<(r<a-1?8:(n-1)%9)?d=this.setCursor(this.cursor+1):(p===0?(this.cursorObj.setVisible(!1),this.randomCursorObj.setVisible(!0)):this.starterSpecies.length===0?d=this.setCursor(this.cursor-Math.min(8,this.cursor%9)):p<7?(this.cursorObj.setVisible(!1),this.starterIconsCursorIndex=Af(this.cursorObj.y-1,this.starterSpecies.length),this.moveStarterIconsCursor(this.starterIconsCursorIndex)):(this.cursorObj.setVisible(!1),this.setSpecies(null),this.startCursorObj.setVisible(!0)),d=!0);else if(n>0){const w=xf(this.starterIconsCursorIndex,u);this.starterIconsCursorObj.setVisible(!1),this.cursorObj.setVisible(!0),this.setCursor(Math.min(o+w*9,l-l%9)),d=!0}else d=!1;break}}}return d?m.playSelect():y&&m.playError(),d||y}isInParty(e){let t=0,i=!1;for(let n=0;n<this.starterSpecies.length;n++)if(this.starterSpecies[n]===e){i=!0,t=n;break}return[i,t]}addToParty(e,t,i,n,a,r,o=!1){const l=s.gameData.getSpeciesDexAttrProps(e,t);this.starterIcons[this.starterSpecies.length].setTexture(e.getIconAtlasKey(l.formIndex,l.shiny,l.variant)),this.starterIcons[this.starterSpecies.length].setFrame(e.getIconId(l.female,l.formIndex,l.shiny,l.variant)),this.checkIconId(this.starterIcons[this.starterSpecies.length],e,l.female,l.formIndex,l.shiny,l.variant);const{dexEntry:c,starterDataEntry:u}=this.getSpeciesData(e.speciesId),p={speciesId:e.speciesId,shiny:l.shiny,variant:l.variant,formIndex:l.formIndex,female:l.female,abilityIndex:i,passive:!(u.passiveAttr^(At.ENABLED|At.UNLOCKED)),nature:n,moveset:a,pokerus:this.pokerusSpecies.includes(e),nickname:this.starterPreferences[e.speciesId]?.nickname,teraType:r,ivs:c.ivs};this.starters.push(p),this.starterSpecies.push(e),(this.speciesLoaded.get(e.speciesId)||o)&&is(e.speciesId,l.formIndex).cry(),this.updateInstructions()}updatePartyIcon(e,t){const i=s.gameData.getSpeciesDexAttrProps(e,this.getCurrentDexProps(e.speciesId));this.starterIcons[t].setTexture(e.getIconAtlasKey(i.formIndex,i.shiny,i.variant)),this.starterIcons[t].setFrame(e.getIconId(i.female,i.formIndex,i.shiny,i.variant)),this.checkIconId(this.starterIcons[t],e,i.female,i.formIndex,i.shiny,i.variant)}switchMoveHandler(e,t,i){const n=this.starterMoveset;if(n==null){console.warn("Trying to update a non-existing moveset");return}const a=this.lastSpecies.speciesId,r=n.indexOf(t);n[e]=t,r!==-1&&(n[r]=i);const o=n.slice(),l=s.gameData.getSpeciesDexAttrProps(this.lastSpecies,this.dexAttrCursor).formIndex,c=s.gameData.starterData[a];Ms.hasOwnProperty(a)?((!c.moveset||Array.isArray(c.moveset))&&(c.moveset={}),c.moveset[l]=o):c.moveset=o,this.hasSwappedMoves=!0,this.setSpeciesDetails(this.lastSpecies,{forSeen:!1}),this.updateSelectedStarterMoveset(a)}updateSelectedStarterMoveset(e){if(this.starterMoveset!==null)for(const[t,i]of this.starterSpecies.entries())i.speciesId===e&&(this.starters[t].moveset=this.starterMoveset)}updateButtonIcon(e,t,i,n){let a;if(t==="touch")switch(t="keyboard",e){case re.Button_Cycle_Shiny:a="R.png";break;case re.Button_Cycle_Form:a="F.png";break;case re.Button_Cycle_Gender:a="G.png";break;case re.Button_Cycle_Ability:a="E.png";break;case re.Button_Cycle_Nature:a="N.png";break;case re.Button_Cycle_Tera:a="V.png";break;case re.Button_Stats:a="C.png";break}else a=s.inputController?.getIconForLatestInputRecorded(e);i.setTexture(t,a).setPosition(this.instructionRowX,this.instructionRowY).setVisible(!0),n.setPosition(this.instructionRowX+this.instructionRowTextOffset,this.instructionRowY).setVisible(!0),this.instructionsContainer.add([i,n]),this.instructionRowY+=8,this.instructionRowY>=24&&(this.instructionRowY=0,this.instructionRowX+=50)}updateFilterButtonIcon(e,t,i,n){let a;t==="touch"?(t="keyboard",a="C.png"):a=s.inputController?.getIconForLatestInputRecorded(e),i.setTexture(t,a).setPosition(this.filterInstructionRowX,this.filterInstructionRowY).setVisible(!0),n.setPosition(this.filterInstructionRowX+this.instructionRowTextOffset,this.filterInstructionRowY).setVisible(!0),this.filterInstructionsContainer.add([i,n]),this.filterInstructionRowY+=8,this.filterInstructionRowY>=24&&(this.filterInstructionRowY=0,this.filterInstructionRowX+=50)}updateInstructions(){this.instructionRowX=0,this.instructionRowY=0,this.filterInstructionRowX=0,this.filterInstructionRowY=0,this.hideInstructions(),this.instructionsContainer.removeAll(),this.filterInstructionsContainer.removeAll();let e;s.inputMethod==="gamepad"?e=s.inputController.getConfig(s.inputController.selectedDevice[Le.GAMEPAD]).padType:e=s.inputMethod,e&&(this.speciesStarterDexEntry?.caughtAttr&&(this.canCycleShiny&&this.updateButtonIcon(re.Button_Cycle_Shiny,e,this.shinyIconElement,this.shinyLabel),this.canCycleForm&&this.updateButtonIcon(re.Button_Cycle_Form,e,this.formIconElement,this.formLabel),this.canCycleGender&&this.updateButtonIcon(re.Button_Cycle_Gender,e,this.genderIconElement,this.genderLabel),this.canCycleAbility&&this.updateButtonIcon(re.Button_Cycle_Ability,e,this.abilityIconElement,this.abilityLabel),this.canCycleNature&&this.updateButtonIcon(re.Button_Cycle_Nature,e,this.natureIconElement,this.natureLabel),this.canCycleTera&&this.updateButtonIcon(re.Button_Cycle_Tera,e,this.teraIconElement,this.teraLabel)),this.filterMode||this.updateFilterButtonIcon(re.Button_Stats,e,this.goFilterIconElement,this.goFilterLabel))}getValueLimit(){const e=new ct(0);switch(s.gameMode.modeId){case fe.ENDLESS:case fe.SPLICED_ENDLESS:e.value=15;break;default:e.value=10}return Cs(Ss.STARTER_POINTS,e),e.value}updateStarters=h(()=>{this.scrollCursor=0,this.filteredStarterContainers=[],this.validStarterContainers=[],this.pokerusCursorObjs.forEach(t=>t.setVisible(!1)),this.starterCursorObjs.forEach(t=>t.setVisible(!1)),this.filterBar.updateFilterLabels(),s.gameMode.modeId===fe.CHALLENGE?this.starterContainers.forEach(t=>{const i=t.species;let n=!1;if(i.forms?.length>0)for(let a=0;a<i.forms.length;a++){if(!i.forms[a].isStarterSelectable)continue;const r=BigInt(Math.pow(2,a))*F.DEFAULT_FORM,o=ai(t.species,s.gameData.getSpeciesDexAttrProps(i,r),!0);n||=o}else n=ai(t.species,s.gameData.getSpeciesDexAttrProps(i,s.gameData.getSpeciesDefaultDexAttr(t.species,!1,!0)),!0);n?this.validStarterContainers.push(t):t.setVisible(!1)}):this.validStarterContainers=this.starterContainers;for(const t of this.validStarterContainers){const i=t.icon,n=this.getCurrentDexProps(t.species.speciesId),a=s.gameData.getSpeciesDexAttrProps(t.species,n);i.setTexture(t.species.getIconAtlasKey(a.formIndex,a.shiny,a.variant),t.species.getIconId(a.female,a.formIndex,a.shiny,a.variant)),t.checkIconId(a.female,a.formIndex,a.shiny,a.variant)}this.validStarterContainers.forEach(t=>{t.setVisible(!1),t.cost=s.gameData.getSpeciesStarterValue(t.species.speciesId);const{dexEntry:i,starterDataEntry:n}=this.getSpeciesData(t.species.speciesId),a=i?.caughtAttr??BigInt(0),r=Ht.hasOwnProperty(t.species.speciesId),o=this.filterBar.getVals(Pe.GEN).includes(t.species.generation),l=this.filterBar.getVals(Pe.TYPES).some(R=>t.species.isOfType(R-1)),c=!!(a&F.NON_SHINY),u=!!(a&F.SHINY),p=u&&!!(a&F.DEFAULT_VARIANT),m=u&&!!(a&F.VARIANT_2),d=u&&!!(a&F.VARIANT_3),y=!c&&!p&&!m&&!d,g=this.filterBar.getVals(Pe.CAUGHT).some(R=>{if(R==="SHINY3")return d;if(R==="SHINY2")return m&&!d;if(R==="SHINY")return p&&!m&&!d;if(R==="NORMAL")return c&&!p&&!m&&!d;if(R==="UNCAUGHT")return y}),C=n.passiveAttr>0,E=this.isPassiveAvailable(t.species.speciesId)&&!C,I=this.filterBar.getVals(Pe.UNLOCKS).some(R=>{if(R.val==="PASSIVE"&&R.state===Q.ON)return C;if(R.val==="PASSIVE"&&R.state===Q.EXCLUDE)return r&&!C;if(R.val==="PASSIVE"&&R.state===Q.UNLOCKABLE)return E;if(R.val==="PASSIVE"&&R.state===Q.OFF)return!0}),A=n.valueReduction===1,_=n.valueReduction===2,w=this.isValueReductionAvailable(t.species.speciesId),L=this.filterBar.getVals(Pe.UNLOCKS).some(R=>{if(R.val==="COST_REDUCTION"&&R.state===Q.ON)return A||_;if(R.val==="COST_REDUCTION"&&R.state===Q.ONE)return A;if(R.val==="COST_REDUCTION"&&R.state===Q.TWO)return _;if(R.val==="COST_REDUCTION"&&R.state===Q.EXCLUDE)return r&&!(A||_);if(R.val==="COST_REDUCTION"&&R.state===Q.UNLOCKABLE)return w;if(R.val==="COST_REDUCTION"&&R.state===Q.OFF)return!0}),V=this.starterPreferences[t.species.speciesId]?.favorite??!1,H=this.filterBar.getVals(Pe.MISC).some(R=>{if(R.val==="FAVORITE"&&R.state===Q.ON)return V;if(R.val==="FAVORITE"&&R.state===Q.EXCLUDE)return!V;if(R.val==="FAVORITE"&&R.state===Q.OFF)return!0}),W=n.classicWinCount>0,ee=n.classicWinCount===0,me=n.classicWinCount===void 0,N=this.filterBar.getVals(Pe.MISC).some(R=>{if(R.val==="WIN"&&R.state===Q.ON)return W;if(R.val==="WIN"&&R.state===Q.EXCLUDE)return ee||me;if(R.val==="WIN"&&R.state===Q.OFF)return!0}),j=t.species.abilityHidden!==t.species.ability1&&t.species.abilityHidden!==Bn.NONE,v=n.abilityAttr&ht.ABILITY_HIDDEN,z=this.filterBar.getVals(Pe.MISC).some(R=>{if(R.val==="HIDDEN_ABILITY"&&R.state===Q.ON)return v;if(R.val==="HIDDEN_ABILITY"&&R.state===Q.EXCLUDE)return j&&!v;if(R.val==="HIDDEN_ABILITY"&&R.state===Q.OFF)return!0}),ne=this.isSameSpeciesEggAvailable(t.species.speciesId),X=this.filterBar.getVals(Pe.MISC).some(R=>{if(R.val==="EGG"&&R.state===Q.ON)return ne;if(R.val==="EGG"&&R.state===Q.EXCLUDE)return r&&!ne;if(R.val==="EGG"&&R.state===Q.OFF)return!0}),J=this.filterBar.getVals(Pe.MISC).some(R=>{if(R.val==="POKERUS"&&R.state===Q.ON)return this.pokerusSpecies.includes(t.species);if(R.val==="POKERUS"&&R.state===Q.EXCLUDE)return!this.pokerusSpecies.includes(t.species);if(R.val==="POKERUS"&&R.state===Q.OFF)return!0});o&&l&&g&&I&&L&&H&&N&&z&&X&&J&&this.filteredStarterContainers.push(t)}),this.starterSelectScrollBar.setTotalRows(Math.max(Math.ceil(this.filteredStarterContainers.length/9),1)),this.starterSelectScrollBar.setScrollCursor(0);const e=this.filterBar.getVals(Pe.SORT)[0];this.filteredStarterContainers.sort((t,i)=>{switch(e.val){case qe.NUMBER:return(t.species.speciesId-i.species.speciesId)*-e.dir;case qe.COST:return(t.cost-i.cost)*-e.dir;case qe.CANDY:{const n=s.gameData.starterData[t.species.speciesId].candyCount,a=s.gameData.starterData[i.species.speciesId].candyCount;return(n-a)*-e.dir}case qe.IV:{const n=s.gameData.dexData[t.species.speciesId].ivs.reduce((r,o)=>r+o,0)/s.gameData.dexData[t.species.speciesId].ivs.length,a=s.gameData.dexData[i.species.speciesId].ivs.reduce((r,o)=>r+o,0)/s.gameData.dexData[i.species.speciesId].ivs.length;return(n-a)*-e.dir}case qe.NAME:return t.species.name.localeCompare(i.species.name)*-e.dir;case qe.CAUGHT:return(s.gameData.dexData[t.species.speciesId].caughtCount-s.gameData.dexData[i.species.speciesId].caughtCount)*-e.dir;case qe.HATCHED:return(s.gameData.dexData[t.species.speciesId].hatchedCount-s.gameData.dexData[i.species.speciesId].hatchedCount)*-e.dir}return 0}),this.updateScroll()},"updateStarters");destroy(){this.starterContainers=[]}updateScroll=h(()=>{const i=this.scrollCursor*9,n=Math.min(this.filteredStarterContainers.length-1,i+81-1);this.starterSelectScrollBar.setScrollCursor(this.scrollCursor);let a=0;this.filteredStarterContainers.forEach((r,o)=>{const{dexEntry:l,starterDataEntry:c}=this.getSpeciesData(r.species.speciesId),u=Wl(o,this.scrollCursor);if(r.setPosition(u.x,u.y),o<i||o>n){r.setVisible(!1),this.pokerusSpecies.includes(r.species)&&(this.pokerusCursorObjs[a].setPosition(u.x-1,u.y+1).setVisible(!1),a++),this.starterSpecies.includes(r.species)&&this.starterCursorObjs[this.starterSpecies.indexOf(r.species)].setPosition(u.x-1,u.y+1).setVisible(!1);return}r.setVisible(!0),this.pokerusSpecies.includes(r.species)&&(this.pokerusCursorObjs[a].setPosition(u.x-1,u.y+1).setVisible(!0),a++),this.starterSpecies.includes(r.species)&&this.starterCursorObjs[this.starterSpecies.indexOf(r.species)].setPosition(u.x-1,u.y+1).setVisible(!0);const p=r.species.speciesId;this.updateStarterValueLabel(r),r.label.setVisible(!0);const m=p&&l.caughtAttr&F.SHINY?[F.DEFAULT_VARIANT,F.VARIANT_2,F.VARIANT_3].filter(d=>!!(l.caughtAttr&d)):[];for(let d=0;d<3;d++){const y=m.length>d;r.shinyIcons[d].setVisible(y),y&&r.shinyIcons[d].setTint(Et(m[d]===F.DEFAULT_VARIANT?0:m[d]===F.VARIANT_2?1:2))}r.starterPassiveBgs.setVisible(!!c.passiveAttr),r.hiddenAbilityIcon.setVisible(!!l.caughtAttr&&!!(c.abilityAttr&4)),r.classicWinIcon.setVisible(c.classicWinCount>0).setTexture(l.ribbons.has(ae.NUZLOCKE)?"champion_ribbon_emerald":"champion_ribbon"),r.favoriteIcon.setVisible(this.starterPreferences[p]?.favorite??!1),s.candyUpgradeDisplay===0?(vt[p]||(vt[p]=["ffffff","ffffff"]),r.candyUpgradeIcon.setTint(qt(Dt(vt[p][0]))),r.candyUpgradeOverlayIcon.setTint(qt(Dt(vt[p][1]))),this.setUpgradeIcon(r)):s.candyUpgradeDisplay===1&&(r.candyUpgradeIcon.setVisible(!1),r.candyUpgradeOverlayIcon.setVisible(!1))})},"updateScroll");setCursor(e){let t=!1;if(this.filterMode)t=this.filterBarCursor!==e,this.filterBarCursor=e,this.filterBar.setCursor(e);else{e=Math.max(Math.min(this.filteredStarterContainers.length-1,e),0),t=super.setCursor(e);const i=Wl(e,this.scrollCursor);this.cursorObj.setPosition(i.x-1,i.y+1);const n=this.filteredStarterContainers[e]?.species;if(n){const a=this.getCurrentDexProps(n.speciesId),r=s.gameData.getSpeciesDexAttrProps(n,a),o=this.starterPreferences[n.speciesId]?.variant?this.starterPreferences[n.speciesId].variant:r.variant,l=Et(o);this.pokemonShinyIcon.setFrame(os(o)).setTint(l),this.setSpecies(n),this.updateInstructions()}}return t}setFilterMode(e){return this.cursorObj.setVisible(!e),this.filterBar.cursorObj.setVisible(e),e!==this.filterMode?(this.filterMode=e,this.setCursor(e?this.filterBarCursor:this.cursor),e&&(this.setSpecies(null),this.updateInstructions()),!0):!1}moveStarterIconsCursor(e){this.starterIconsCursorObj.setPositionRelative(this.starterIcons[e],this.starterIconsCursorXOffset,this.starterIconsCursorYOffset),this.starterSpecies.length>0?(this.starterIconsCursorObj.setVisible(!0),this.setSpecies(this.starterSpecies[e])):(this.starterIconsCursorObj.setVisible(!1),this.setSpecies(null))}getFriendship(e){let t=s.gameData.starterData[e].friendship;(!t||t===void 0)&&(t=0);const i=Wh($e[e]);return{currentFriendship:t,friendshipCap:i}}setSpecies(e){if(this.speciesStarterDexEntry=null,this.dexAttrCursor=0n,this.abilityCursor=0,this.natureCursor=0,this.teraCursor=Me.UNKNOWN,e){const{dexEntry:i}=this.getSpeciesData(e.speciesId);this.speciesStarterDexEntry=i,this.dexAttrCursor=this.getCurrentDexProps(e.speciesId),this.abilityCursor=s.gameData.getStarterSpeciesDefaultAbilityIndex(e),this.natureCursor=s.gameData.getSpeciesDefaultNature(e,i),this.teraCursor=e.type1}!e&&s.ui.getTooltip().visible&&s.ui.hideTooltip(),this.pokemonAbilityText.off("pointerover"),this.pokemonPassiveText.off("pointerover");const t=e?{...this.starterPreferences[e.speciesId]}:null;if(t?.nature&&(this.natureCursor=t.nature),t?.ability&&!Number.isNaN(t.ability)&&(this.abilityCursor=t.ability),t?.tera&&(this.teraCursor=t.tera),this.statsMode&&(this.speciesStarterDexEntry?.caughtAttr?(this.statsContainer.setVisible(!0),this.showStats()):(this.statsContainer.setVisible(!1),this.statsContainer.updateIvs(null))),this.lastSpecies){const i=this.getCurrentDexProps(this.lastSpecies.speciesId),n=s.gameData.getSpeciesDexAttrProps(this.lastSpecies,i),a=this.allSpecies.indexOf(this.lastSpecies),r=this.starterContainers[a].icon;this.checkIconId(r,this.lastSpecies,n.female,n.formIndex,n.shiny,n.variant),this.iconAnimHandler.addOrUpdate(r,Ft.NONE);const o=this.starterContainers[a].icon;s.tweens.getTweensOf(o).forEach(l=>l.play())}if(this.lastSpecies=e,e&&(this.speciesStarterDexEntry?.seenAttr||this.speciesStarterDexEntry?.caughtAttr)){if(this.pokemonNumberText.setText(Hs(e.speciesId,4)),t?.nickname){const i=decodeURIComponent(escape(atob(t.nickname)));this.pokemonNameText.setText(i)}else this.pokemonNameText.setText(e.name);if(this.truncateName(),this.speciesStarterDexEntry?.caughtAttr){const i=vt[e.speciesId],n=s.gameData.getDexAttrLuck(this.speciesStarterDexEntry.caughtAttr);this.pokemonLuckText.setVisible(!!n).setText(n.toString()).setTint(Et(Math.min(n-1,2))),this.pokemonLuckLabelText.setVisible(this.pokemonLuckText.visible);let a=Ri(mg[e.growthRate]);const r=bt(a);f.exists("growth:"+r)&&(a=f.t("growth:"+r)),this.pokemonGrowthRateText.setText(a).setColor(Ca(e.growthRate)).setShadowColor(Ca(e.growthRate,!0)),this.pokemonGrowthRateLabelText.setVisible(!0),this.pokemonUncaughtText.setVisible(!1),this.pokemonAbilityLabelText.setVisible(!0),this.pokemonPassiveLabelText.setVisible(!0),this.pokemonNatureLabelText.setVisible(!0),this.pokemonCaughtCountText.setText(`${this.speciesStarterDexEntry.caughtCount}`),e.speciesId===ye.MANAPHY||e.speciesId===ye.PHIONE?this.pokemonHatchedIcon.setFrame("manaphy"):this.pokemonHatchedIcon.setFrame(ci(e)),this.pokemonHatchedCountText.setText(`${this.speciesStarterDexEntry.hatchedCount}`);const o=this.getCurrentDexProps(e.speciesId),l=s.gameData.getSpeciesDexAttrProps(e,o),c=l.variant,u=Et(c);if(this.pokemonShinyIcon.setFrame(os(c)).setTint(u).setVisible(l.shiny),this.pokemonCaughtHatchedContainer.setVisible(!0),this.pokemonFormText.setVisible(!0),Bt.hasOwnProperty(e.speciesId))this.pokemonCaughtHatchedContainer.setY(16),this.pokemonShinyIcon.setY(135).setFrame(os(c)),[this.pokemonCandyContainer,this.pokemonHatchedIcon,this.pokemonHatchedCountText].map(C=>C.setVisible(!1)),this.pokemonFormText.setY(25);else{this.pokemonCaughtHatchedContainer.setY(25),this.pokemonShinyIcon.setY(117),this.pokemonCandyIcon.setTint(qt(Dt(i[0]))),this.pokemonCandyOverlayIcon.setTint(qt(Dt(i[1]))),this.pokemonCandyCountText.setText(`${s.gameData.starterData[e.speciesId].candyCount}`),this.pokemonFormText.setY(42),this.pokemonHatchedIcon.setVisible(!0),this.pokemonHatchedCountText.setVisible(!0);const{currentFriendship:C,friendshipCap:E}=this.getFriendship(this.lastSpecies.speciesId),I=16-16*(C/E);this.pokemonCandyDarknessOverlay.setCrop(0,0,16,I),this.pokemonCandyContainer.setVisible(!0).on("pointerover",()=>{s.ui.showTooltip("",`${C}/${E}`,!0),this.activeTooltip="CANDY"}).on("pointerout",()=>{s.ui.hideTooltip(),this.activeTooltip=void 0})}const p=this.allSpecies.indexOf(e),m=this.starterContainers[p].icon;this.isUpgradeAnimationEnabled()&&(s.tweens.getTweensOf(m).forEach(C=>C.pause()),m.x=-2,m.y=2),this.iconAnimHandler.addOrUpdate(m,Ft.PASSIVE);const d=this.starterSpecies.indexOf(e),y=s.gameData.getSpeciesDexAttrProps(e,o);if(d>-1){const C=this.starters[d];this.setSpeciesDetails(e,{shiny:C.shiny,formIndex:C.formIndex,female:C.female,variant:C.variant,abilityIndex:C.abilityIndex,natureIndex:C.nature,teraType:C.teraType},!1)}else{const C=t?.ability??s.gameData.getStarterSpeciesDefaultAbilityIndex(e),{dexEntry:E}=this.getSpeciesData(e.speciesId),I=t?.nature||s.gameData.getSpeciesDefaultNature(e,E);t?.variant&&!Number.isNaN(t.variant)&&y.shiny&&(y.variant=t.variant),y.formIndex=t?.form??y.formIndex,y.female=t?.female??y.female,this.setSpeciesDetails(e,{shiny:y.shiny,formIndex:y.formIndex,female:y.female,variant:y.variant,abilityIndex:C,natureIndex:I,teraType:t?.tera},!1)}y.formIndex!=null&&this.updateSelectedStarterMoveset(e.speciesId);const g=is(e.speciesId,y.formIndex);this.setTypeIcons(g.type1,g.type2),this.pokemonSprite.clearTint(),this.pokerusSpecies.includes(e)&&ii(ds.Pokerus)}else{this.pokemonGrowthRateText.setText(""),this.pokemonGrowthRateLabelText.setVisible(!1),this.type1Icon.setVisible(!1),this.type2Icon.setVisible(!1),this.pokemonLuckLabelText.setVisible(!1),this.pokemonLuckText.setVisible(!1),this.pokemonShinyIcon.setVisible(!1),this.pokemonUncaughtText.setVisible(!0),this.pokemonAbilityLabelText.setVisible(!1),this.pokemonPassiveLabelText.setVisible(!1),this.pokemonNatureLabelText.setVisible(!1),this.pokemonCaughtHatchedContainer.setVisible(!1),this.pokemonCandyContainer.setVisible(!1),this.pokemonFormText.setVisible(!1),this.teraIcon.setVisible(!1);const i=s.gameData.getSpeciesDefaultDexAttr(e,!0,!0),n=s.gameData.getStarterSpeciesDefaultAbilityIndex(e),a=s.gameData.getSpeciesDefaultNature(e),r=s.gameData.getSpeciesDexAttrProps(e,i);this.setSpeciesDetails(e,{shiny:r.shiny,formIndex:r.formIndex,female:r.female,variant:r.variant,abilityIndex:n,natureIndex:a,forSeen:!0},!1),this.pokemonSprite.setTint(8421504)}}else this.pokemonNumberText.setText(Hs(0,4)),this.pokemonNameText.setText(e?"???":""),this.pokemonGrowthRateText.setText(""),this.pokemonGrowthRateLabelText.setVisible(!1),this.type1Icon.setVisible(!1),this.type2Icon.setVisible(!1),this.pokemonLuckLabelText.setVisible(!1),this.pokemonLuckText.setVisible(!1),this.pokemonShinyIcon.setVisible(!1),this.pokemonUncaughtText.setVisible(!!e),this.pokemonAbilityLabelText.setVisible(!1),this.pokemonPassiveLabelText.setVisible(!1),this.pokemonNatureLabelText.setVisible(!1),this.pokemonCaughtHatchedContainer.setVisible(!1),this.pokemonCandyContainer.setVisible(!1),this.pokemonFormText.setVisible(!1),this.teraIcon.setVisible(!1),this.setSpeciesDetails(e,{shiny:!1,formIndex:0,female:!1,variant:0,abilityIndex:0,natureIndex:0},!1),this.pokemonSprite.clearTint()}getSpeciesData(e,t=!0){const i=s.gameData.dexData[e],n=s.gameData.starterData[e],a={...i};a.ivs=[...i.ivs];const r={...n};return t&&Cs(Ss.STARTER_SELECT_MODIFY,e,a,r),{dexEntry:{...a},starterDataEntry:{...r}}}setSpeciesDetails(e,t={},i=!0){let{shiny:n,formIndex:a,female:r,variant:o,abilityIndex:l,natureIndex:c,teraType:u}=t;const p=t.forSeen??!1,m=e?s.gameData.getSpeciesDexAttrProps(e,this.dexAttrCursor):null,d=this.abilityCursor>-1?this.abilityCursor:s.gameData.getStarterSpeciesDefaultAbilityIndex(e);let y=-1;if(e){const{dexEntry:_}=this.getSpeciesData(e.speciesId);y=this.natureCursor>-1?this.natureCursor:s.gameData.getSpeciesDefaultNature(e,_)}const g=this.teraCursor>-1?this.teraCursor:e?e.type1:Me.UNKNOWN;this.dexAttrCursor=0n,this.abilityCursor=-1,this.natureCursor=-1,this.teraCursor=Me.UNKNOWN;const C=e?.genderDiffs&&r!=null||a!=null||n!=null||o!=null,E=s.gameMode.hasChallenge(Pt.FRESH_START);if(this.activeTooltip==="CANDY")if(this.lastSpecies&&this.pokemonCandyContainer.visible){const{currentFriendship:_,friendshipCap:w}=this.getFriendship(this.lastSpecies.speciesId);s.ui.editTooltip("",`${_}/${w}`)}else s.ui.hideTooltip();if(e?.forms?.find(_=>_.formKey==="female")&&(r!==void 0?a=r?1:0:a!==void 0&&(r=a===1)),e){this.dexAttrCursor|=(n!==void 0?!n:!(n=m?.shiny))?F.NON_SHINY:F.SHINY,this.dexAttrCursor|=(r!==void 0?!r:!(r=m?.female))?F.MALE:F.FEMALE,this.dexAttrCursor|=(o!==void 0?!o:!(o=m?.variant))?F.DEFAULT_VARIANT:o===1?F.VARIANT_2:F.VARIANT_3,this.dexAttrCursor|=s.gameData.getFormAttr(a!==void 0?a:a=m.formIndex),this.abilityCursor=l!==void 0?l:l=d,this.natureCursor=c!==void 0?c:c=y,this.teraCursor=u??(u=g);const[_,w]=this.isInParty(e);_&&this.updatePartyIcon(e,w)}if(this.pokemonSprite.setVisible(!1),this.pokemonPassiveLabelText.setVisible(!1),this.pokemonPassiveText.setVisible(!1),this.pokemonPassiveDisabledIcon.setVisible(!1),this.pokemonPassiveLockedIcon.setVisible(!1),this.teraIcon.setVisible(!1),this.assetLoadCancelled&&(this.assetLoadCancelled.value=!0,this.assetLoadCancelled=null),this.starterMoveset=null,this.speciesStarterMoves=[],e){const{dexEntry:_,starterDataEntry:w}=this.getSpeciesData(e.speciesId),L=_.caughtAttr||BigInt(0),V=w.abilityAttr;if(!L){const H=s.gameData.getSpeciesDexAttrProps(e,this.getCurrentDexProps(e.speciesId)),W=s.gameData.getStarterSpeciesDefaultAbilityIndex(e),ee=s.gameData.getSpeciesDefaultNature(e,_);(n===void 0||n!==H.shiny)&&(n=H.shiny),(a===void 0||a!==H.formIndex)&&(a=H.formIndex),(r===void 0||r!==H.female)&&(r=H.female),(o===void 0||o!==H.variant)&&(o=H.variant),(l===void 0||l!==W)&&(l=W),(c===void 0||c!==ee)&&(c=ee)}if(this.shinyOverlay.setVisible(n??!1),this.pokemonNumberText.setColor(le(n?O.SUMMARY_DEX_NUM_GOLD:O.SUMMARY_DEX_NUM,!1)),this.pokemonNumberText.setShadowColor(le(n?O.SUMMARY_DEX_NUM_GOLD:O.SUMMARY_DEX_NUM,!0)),p?this.speciesStarterDexEntry?.seenAttr:this.speciesStarterDexEntry?.caughtAttr){const H=this.starterSpecies.indexOf(e);if(H>-1){const R=this.starters[H],Te=s.gameData.getSpeciesDexAttrProps(e,this.dexAttrCursor);R.shiny=Te.shiny,R.variant=Te.variant,R.female=Te.female,R.formIndex=Te.formIndex,R.abilityIndex=this.abilityCursor,R.nature=this.natureCursor,R.teraType=this.teraCursor}const W=new ft(!1);this.assetLoadCancelled=W,r??=!1,C?e.loadAssets(r,a,n,o,!0).then(()=>{W.value||(this.assetLoadCancelled=null,this.speciesLoaded.set(e.speciesId,!0),this.pokemonSprite.play(e.getSpriteKey(r,a,n,o)).setPipelineData("shiny",n).setPipelineData("variant",o).setPipelineData("spriteKey",e.getSpriteKey(r,a,n,o)).setVisible(!this.statsMode))}):this.pokemonSprite.setVisible(!this.statsMode);const ee=this.filteredStarterContainers.find(R=>R.species.speciesId===e.speciesId);ee&&(ee.icon.setTexture(e.getIconAtlasKey(a,n,o),e.getIconId(r,a,n,o)),ee.checkIconId(r,a,n,o));const me=!!(L&F.NON_SHINY),N=!!(L&F.SHINY),j=[F.DEFAULT_VARIANT,F.VARIANT_2,F.VARIANT_3].filter(R=>L&R);this.canCycleShiny=me&&N||N&&j.length>1;const v=!!(L&F.MALE),z=!!(L&F.FEMALE);this.canCycleGender=v&&z;const ne=V&ht.ABILITY_1;let X=V&ht.ABILITY_2;const J=V&ht.ABILITY_HIDDEN;ne&&X&&e.ability1===e.ability2&&(X=0),this.canCycleAbility=[ne,X,J].filter(R=>R).length>1,this.canCycleForm=e.forms.filter(R=>R.isStarterSelectable||!fi[e.speciesId]?.find(Te=>Te.formKey)).map((R,Te)=>_.caughtAttr&s.gameData.getFormAttr(Te)).filter(R=>R).length>1,this.canCycleNature=s.gameData.getNaturesForAttr(_.natureAttr).length>1,this.canCycleTera=!this.statsMode&&this.allowTera&&is(e.speciesId,a??0).type2!=null&&!s.gameMode.hasChallenge(Pt.FRESH_START)}if(_.caughtAttr&&e.malePercent!==null){const H=r?Ut.FEMALE:Ut.MALE;this.pokemonGenderText.setText(Fh(H)).setColor(Mi(H)).setShadowColor(Mi(H,!0))}else this.pokemonGenderText.setText("");if(_.caughtAttr){let H;this.lastSpecies.forms?.length>1?H=_t[this.lastSpecies.forms[a??0].getAbility(l)]:H=_t[this.lastSpecies.getAbility(l)];const W=l===(this.lastSpecies.ability2?2:1);this.pokemonAbilityText.setText(H.name).setColor(le(W?O.SUMMARY_GOLD:O.SUMMARY_ALT)).setShadowColor(le(W?O.SUMMARY_GOLD:O.SUMMARY_ALT,!0));const ee=w.passiveAttr,me=_t[this.lastSpecies.getPassiveAbility(a)];if(this.pokemonAbilityText.visible&&(this.activeTooltip==="ABILITY"&&s.ui.editTooltip(`${H.name}`,`${H.description}`),this.pokemonAbilityText.on("pointerover",()=>{s.ui.showTooltip(`${H.name}`,`${H.description}`,!0),this.activeTooltip="ABILITY"}),this.pokemonAbilityText.on("pointerout",()=>{s.ui.hideTooltip(),this.activeTooltip=void 0})),me){const J=!!(ee&At.UNLOCKED),R=!!(ee&At.ENABLED),Te=J&&R?O.SUMMARY_ALT:O.SUMMARY_GRAY,Y=J&&R?1:.5;this.pokemonPassiveLabelText.setVisible(!E).setColor(le(O.SUMMARY_ALT)).setShadowColor(le(O.SUMMARY_ALT,!0)),this.pokemonPassiveText.setVisible(!E).setText(me.name).setColor(le(Te)).setAlpha(Y).setShadowColor(le(Te,!0)),this.activeTooltip==="PASSIVE"&&s.ui.editTooltip(`${me.name}`,`${me.description}`),this.pokemonPassiveText.visible&&(this.pokemonPassiveText.on("pointerover",()=>{s.ui.showTooltip(`${me.name}`,`${me.description}`,!0),this.activeTooltip="PASSIVE"}),this.pokemonPassiveText.on("pointerout",()=>{s.ui.hideTooltip(),this.activeTooltip=void 0}));const U={x:this.pokemonPassiveText.x+this.pokemonPassiveText.displayWidth+1,y:this.pokemonPassiveText.y+this.pokemonPassiveText.displayHeight/2};this.pokemonPassiveDisabledIcon.setVisible(J&&!R&&!E).setPosition(U.x,U.y),this.pokemonPassiveLockedIcon.setVisible(!J&&!E).setPosition(U.x,U.y)}else this.activeTooltip==="PASSIVE"&&s.ui.hideTooltip();this.pokemonNatureText.setText(ki(c,!0,!0,!1));let N;if(Ms.hasOwnProperty(e.speciesId)&&a&&Ms[e.speciesId].hasOwnProperty(a)?N=Ms[e.speciesId][a]:N=ya[e.speciesId],this.speciesStarterMoves.push(...N.filter(J=>J[0]>0&&J[0]<=5).map(J=>J[1])),Ht.hasOwnProperty(e.speciesId))for(let J=0;J<4;J++)w.eggMoves&1<<J&&this.speciesStarterMoves.push(Ht[e.speciesId][J]);const j=w.moveset,v=j?Array.isArray(j)?j:j[a]:null,z=this.speciesStarterMoves.concat(Ht.hasOwnProperty(e.speciesId)?Ht[e.speciesId].filter((J,R)=>w.eggMoves&1<<R):[]);this.starterMoveset=(v||this.speciesStarterMoves.slice(0,4)).filter(J=>z.find(R=>R===J)),this.starterMoveset.length<4&&this.starterMoveset.length<z.length&&this.starterMoveset.push(...z.filter(J=>this.starterMoveset?.indexOf(J)===-1).slice(0,4-this.starterMoveset.length)),this.starterMoveset=this.starterMoveset.filter((J,R)=>this.starterMoveset?.indexOf(J)===R);const ne=is(e.speciesId,a),X=e.getFormNameToDisplay(a);this.pokemonFormText.setText(X),this.setTypeIcons(ne.type1,ne.type2),this.teraIcon.setFrame(Me[this.teraCursor].toLowerCase()),this.teraIcon.setVisible(!this.statsMode&&this.allowTera)}else this.pokemonAbilityText.setText(""),this.pokemonPassiveText.setText(""),this.pokemonNatureText.setText(""),this.teraIcon.setVisible(!1),this.setTypeIcons(null,null)}else this.shinyOverlay.setVisible(!1),this.pokemonNumberText.setColor(le(O.SUMMARY)).setShadowColor(le(O.SUMMARY,!0)),this.pokemonGenderText.setText(""),this.pokemonAbilityText.setText(""),this.pokemonPassiveText.setText(""),this.pokemonNatureText.setText(""),this.teraIcon.setVisible(!1),this.setTypeIcons(null,null);this.starterMoveset||(this.starterMoveset=this.speciesStarterMoves.slice(0,4));for(let _=0;_<4;_++){const w=_<this.starterMoveset.length?We[this.starterMoveset[_]]:null;this.pokemonMoveBgs[_].setFrame(Me[w?w.type:Me.UNKNOWN].toString().toLowerCase()),this.pokemonMoveLabels[_].setText(w?w.name:"-"),this.pokemonMoveContainers[_].setVisible(!!w)}const I=e&&Ht.hasOwnProperty(e.speciesId);let A=0;if(e){const{starterDataEntry:_}=this.getSpeciesData(this.lastSpecies.speciesId);A=_.eggMoves}for(let _=0;_<4;_++){const w=I?We[Ht[e.speciesId][_]]:null,L=w&&A&1<<_;this.pokemonEggMoveBgs[_].setFrame(Me[w?w.type:Me.UNKNOWN].toString().toLowerCase()),this.pokemonEggMoveLabels[_].setText(w&&L?w.name:"???")}this.pokemonEggMovesContainer.setVisible(!!this.speciesStarterDexEntry?.caughtAttr&&I),this.pokemonAdditionalMoveCountLabel.setText(`(+${Math.max(this.speciesStarterMoves.length-4,0)})`).setVisible(this.speciesStarterMoves.length>4),this.tryUpdateValue(),this.updateInstructions(),i&&ef(this.originalStarterPreferences)}setTypeIcons(e,t){e!==null?this.type1Icon.setVisible(!0).setFrame(Me[e].toLowerCase()):this.type1Icon.setVisible(!1),t!==null?this.type2Icon.setVisible(!0).setFrame(Me[t].toLowerCase()):this.type2Icon.setVisible(!1)}popStarter(e){this.starterSpecies.splice(e,1),this.starters.splice(e,1);for(let t=0;t<this.starterSpecies.length;t++){const i=this.starterSpecies[t],n=this.getCurrentDexProps(i.speciesId),a=s.gameData.getSpeciesDexAttrProps(i,n);this.starterIcons[t].setTexture(i.getIconAtlasKey(a.formIndex,a.shiny,a.variant)).setFrame(i.getIconId(a.female,a.formIndex,a.shiny,a.variant)),this.checkIconId(this.starterIcons[t],i,a.female,a.formIndex,a.shiny,a.variant),t>=e&&this.starterCursorObjs[t].setPosition(this.starterCursorObjs[t+1].x,this.starterCursorObjs[t+1].y).setVisible(this.starterCursorObjs[t+1].visible)}this.starterCursorObjs[this.starterSpecies.length].setVisible(!1),this.starterIcons[this.starterSpecies.length].setTexture("pokemon_icons_0").setFrame("unknown"),this.starterIconsCursorObj.visible?(this.starterIconsCursorIndex===this.starterSpecies.length&&(this.starterSpecies.length>0?this.starterIconsCursorIndex--:(this.starterIconsCursorObj.setVisible(!1),this.setSpecies(null),this.filterBarCursor=Math.max(1,this.filterBar.numFilters-1),this.setFilterMode(!0))),this.moveStarterIconsCursor(this.starterIconsCursorIndex)):this.startCursorObj.visible&&this.starterSpecies.length===0&&(this.startCursorObj.setVisible(!1),this.filteredStarterContainers.length>0?(this.cursorObj.setVisible(!0),this.setCursor(this.scrollCursor*9)):(this.filterBarCursor=Math.max(1,this.filterBar.numFilters-1),this.setFilterMode(!0))),this.tryUpdateValue()}updateStarterValueLabel(e){const t=e.species.speciesId,i=$e[t],n=s.gameData.getSpeciesStarterValue(t);e.cost=n;let a=n.toString();a.startsWith("0.")&&(a=a.slice(1)),e.label.setText(a);let r;switch(i-n){case 0:r=O.WINDOW;break;case 1:case .5:r=O.SUMMARY_BLUE;break;default:r=O.SUMMARY_GOLD;break}e.label.setColor(le(r)).setShadowColor(le(r,!0))}tryUpdateValue(e,t){const n=this.starterSpecies.map(u=>u.generation).reduce((u,p,m)=>u+=s.gameData.getSpeciesStarterValue(this.starterSpecies[m].speciesId),0)+(e||0),a=this.getValueLimit(),r=n>a;let o=n.toString();if(o.startsWith("0.")&&(o=o.slice(1)),this.valueLimitLabel.setText(`${o}/${a}`).setColor(le(r?O.SUMMARY_PINK:O.TOOLTIP_CONTENT)).setShadowColor(le(r?O.SUMMARY_PINK:O.TOOLTIP_CONTENT,!0)),r)return s.time.delayedCall(ge(500),()=>this.tryUpdateValue()),!1;let l=this.isPartyValid();if(t){const u=this.filteredStarterContainers[this.cursor].species,p=ai(u,s.gameData.getSpeciesDexAttrProps(u,this.getCurrentDexProps(u.speciesId)),!1);l||=p}const c=a-n;for(let u=0;u<this.allSpecies.length;u++){const p=s.gameData.getSpeciesStarterValue(this.allSpecies[u].speciesId),m=this.starterContainers[u].icon,d=ai(this.allSpecies[u],s.gameData.getSpeciesDexAttrProps(this.allSpecies[u],this.getCurrentDexProps(this.allSpecies[u].speciesId)),l),y=c>=p&&d,g=this.isInParty(this.allSpecies[u])[0];y||g&&c>=p?m.setAlpha(1):m.setAlpha(.375)}return!0}tryExit(){this.blockInput=!0;const e=this.getUi(),t=h(()=>{e.setMode(x.STARTER_SELECT),this.clearText(),this.blockInput=!1},"cancel");e.showText(f.t("starterSelectUiHandler:confirmExit"),null,()=>{e.setModeWithoutClear(x.CONFIRM,()=>{e.setMode(x.STARTER_SELECT),s.gameMode.isChallenge?(s.phaseManager.clearPhaseQueue(),s.phaseManager.pushNew("SelectChallengePhase"),s.phaseManager.pushNew("EncounterPhase")):s.phaseManager.toTitleScreen(),this.clearText(),s.phaseManager.getCurrentPhase().end()},t,null,null,19)})}tryStart(e=!1){if(this.starterSpecies.length===0)return!1;const t=this.getUi(),i=h(()=>{t.setMode(x.STARTER_SELECT),e||this.popStarter(this.starterSpecies.length-1),this.clearText()},"cancel");return this.isPartyValid()?t.showText(f.t("starterSelectUiHandler:confirmStartTeam"),null,()=>{t.setModeWithoutClear(x.CONFIRM,()=>{h(()=>{s.money=s.gameMode.getStartingMoney();const r=this.starters.slice(0);t.setMode(x.STARTER_SELECT);const o=this.starterSelectCallback;this.starterSelectCallback=null,o?.(r)},"startRun")()},i,null,null,19)}):(this.tutorialActive=!0,this.showText(f.t("starterSelectUiHandler:invalidParty"),void 0,()=>this.showText("",0,()=>this.tutorialActive=!1),void 0,!0)),!0}isPartyValid(){let e=!1;for(let t=0;t<this.starterSpecies.length;t++){const i=this.starterSpecies[t],n=this.starters[t],a=ai(i,{formIndex:n.formIndex,shiny:n.shiny,variant:n.variant,female:n.female??!1},!1);e||=a}return e}getCurrentDexProps(e){let t=0n;const{dexEntry:i}=this.getSpeciesData(e),n=i.caughtAttr;return this.starterPreferences[e]?.female||(n&F.FEMALE)>0n&&(n&F.MALE)===0n?t+=F.FEMALE:t+=F.MALE,this.starterPreferences[e]?.shiny||(n&F.SHINY)>0n&&this.starterPreferences[e]?.shiny!==!1?(t+=F.SHINY,this.starterPreferences[e]?.variant!==void 0?t+=BigInt(Math.pow(2,this.starterPreferences[e]?.variant))*F.DEFAULT_VARIANT:(n&F.VARIANT_3)>0?t+=F.VARIANT_3:(n&F.VARIANT_2)>0?t+=F.VARIANT_2:t+=F.DEFAULT_VARIANT):(t+=F.NON_SHINY,t+=F.DEFAULT_VARIANT),this.starterPreferences[e]?.form?t+=BigInt(Math.pow(2,this.starterPreferences[e]?.form))*F.DEFAULT_FORM:t+=s.gameData.getFormAttr(s.gameData.getFormIndex(n)),t}toggleStatsMode(e){if(e===void 0&&(e=!this.statsMode),e)this.showStats(),this.statsMode=!0,this.pokemonSprite.setVisible(!1),this.teraIcon.setVisible(!1),this.canCycleTera=!1,this.updateInstructions();else{this.statsMode=!1,this.statsContainer.setVisible(!1),this.pokemonSprite.setVisible(!!this.speciesStarterDexEntry?.caughtAttr),this.statsContainer.updateIvs(null),this.teraIcon.setVisible(this.allowTera);const i=s.gameData.getSpeciesDexAttrProps(this.lastSpecies,this.getCurrentDexProps(this.lastSpecies.speciesId)).formIndex;this.canCycleTera=!this.statsMode&&this.allowTera&&is(this.lastSpecies.speciesId,i??0).type2!=null&&!s.gameMode.hasChallenge(Pt.FRESH_START),this.updateInstructions()}}showStats(){this.speciesStarterDexEntry&&(this.statsContainer.setVisible(!0),this.statsContainer.updateIvs(this.speciesStarterDexEntry.ivs))}clearText(){this.starterSelectMessageBoxContainer.setVisible(!1),super.clearText()}hideInstructions(){this.shinyIconElement.setVisible(!1),this.shinyLabel.setVisible(!1),this.formIconElement.setVisible(!1),this.formLabel.setVisible(!1),this.genderIconElement.setVisible(!1),this.genderLabel.setVisible(!1),this.abilityIconElement.setVisible(!1),this.abilityLabel.setVisible(!1),this.natureIconElement.setVisible(!1),this.natureLabel.setVisible(!1),this.teraIconElement.setVisible(!1),this.teraLabel.setVisible(!1),this.goFilterIconElement.setVisible(!1),this.goFilterLabel.setVisible(!1)}clear(){for(super.clear(),ef(this.originalStarterPreferences),this.clearStarterPreferences(),this.cursor=-1,this.hideInstructions(),this.activeTooltip=void 0,s.ui.hideTooltip(),this.starterSelectContainer.setVisible(!1),this.blockInput=!1;this.starterSpecies.length>0;)this.popStarter(this.starterSpecies.length-1);this.statsMode&&this.toggleStatsMode(!1)}checkIconId(e,t,i,n,a,r){e.frame.name!==t.getIconId(i,n,a,r)&&(`${t.name}${e.frame.name}${i}${n}${a}${r}`,e.setTexture(t.getIconAtlasKey(n,!1,r)).setFrame(t.getIconId(i,n,!1,r)))}clearStarterPreferences(){this.starterPreferences={},this.originalStarterPreferences={}}truncateName(){const e=this.pokemonNameText.text;this.pokemonNameText.setText(Rn(e,15))}};h(Vd,"StarterSelectUiHandler");let wn=Vd;const Hd=class Hd{events;inputsController;constructor(e){this.inputsController=e,this.init()}init(){this.events=this.inputsController.events,this.listenInputs()}detectInputMethod(e){e.controller_type==="keyboard"?e.hasOwnProperty("isTouch")&&e.isTouch?s.inputMethod="touch":s.inputMethod="keyboard":e.controller_type==="gamepad"&&(s.inputMethod="gamepad")}listenInputs(){this.events.on("input_down",e=>{this.detectInputMethod(e);const t=this.getActionsKeyDown();t.hasOwnProperty(e.button)&&t[e.button]()},this),this.events.on("input_up",e=>{const t=this.getActionsKeyUp();t.hasOwnProperty(e.button)&&t[e.button]()},this)}doVibration(e,t){e&&s.enableVibration&&typeof navigator.vibrate<"u"&&navigator.vibrate(t)}getActionsKeyDown(){return{[b.UP]:()=>this.buttonDirection(b.UP),[b.DOWN]:()=>this.buttonDirection(b.DOWN),[b.LEFT]:()=>this.buttonDirection(b.LEFT),[b.RIGHT]:()=>this.buttonDirection(b.RIGHT),[b.SUBMIT]:()=>this.buttonTouch(),[b.ACTION]:()=>this.buttonAb(b.ACTION),[b.CANCEL]:()=>this.buttonAb(b.CANCEL),[b.MENU]:()=>this.buttonMenu(),[b.STATS]:()=>this.buttonGoToFilter(b.STATS),[b.CYCLE_SHINY]:()=>this.buttonCycleOption(b.CYCLE_SHINY),[b.CYCLE_FORM]:()=>this.buttonCycleOption(b.CYCLE_FORM),[b.CYCLE_GENDER]:()=>this.buttonCycleOption(b.CYCLE_GENDER),[b.CYCLE_ABILITY]:()=>this.buttonCycleOption(b.CYCLE_ABILITY),[b.CYCLE_NATURE]:()=>this.buttonCycleOption(b.CYCLE_NATURE),[b.CYCLE_TERA]:()=>this.buttonCycleOption(b.CYCLE_TERA),[b.SPEED_UP]:()=>this.buttonSpeedChange(),[b.SLOW_DOWN]:()=>this.buttonSpeedChange(!1)}}getActionsKeyUp(){return{[b.UP]:()=>{},[b.DOWN]:()=>{},[b.LEFT]:()=>{},[b.RIGHT]:()=>{},[b.SUBMIT]:()=>{},[b.ACTION]:()=>{},[b.CANCEL]:()=>{},[b.MENU]:()=>{},[b.STATS]:()=>this.buttonStats(!1),[b.CYCLE_SHINY]:()=>{},[b.CYCLE_FORM]:()=>{},[b.CYCLE_GENDER]:()=>{},[b.CYCLE_ABILITY]:()=>{},[b.CYCLE_NATURE]:()=>{},[b.CYCLE_TERA]:()=>this.buttonInfo(!1),[b.SPEED_UP]:()=>{},[b.SLOW_DOWN]:()=>{}}}buttonDirection(e){const t=s.ui.processInput(e);this.doVibration(t,5)}buttonAb(e){s.ui.processInput(e)}buttonTouch(){s.ui.processInput(b.SUBMIT)||s.ui.processInput(b.ACTION)}buttonStats(e=!0){for(const t of s.getInfoToggles(!0))t.toggleInfo(e);for(const t of s.getField().filter(i=>i?.isActive(!0)))t.toggleStats(e)}buttonGoToFilter(e){const t=[wn,An,On],i=s.ui?.getHandler();t.some(n=>i instanceof n)?s.ui.processInput(e):this.buttonStats(!0)}buttonInfo(e=!0){if(s.showMovesetFlyout)for(const t of s.getEnemyField().filter(i=>i?.isActive(!0)))t.toggleFlyout(e);s.showArenaFlyout&&s.ui.processInfoButton(e)}buttonMenu(){if(!s.disableMenu)switch(s.ui?.getMode()){case x.MESSAGE:{const e=s.ui.getHandler();if(!e.pendingPrompt||e.isTextAnimationInProgress())return}case x.TITLE:case x.COMMAND:case x.MODIFIER_SELECT:case x.MYSTERY_ENCOUNTER:s.ui.setOverlayMode(x.MENU);break;case x.STARTER_SELECT:case x.POKEDEX_PAGE:this.buttonTouch();break;case x.MENU:s.ui.revertMode(),s.playSound("ui/select");break;default:return}}buttonCycleOption(e){const t=[wn,An,On,$a,Ra,Ya,Ga,za,ja],i=s.ui?.getHandler();t.some(n=>i instanceof n)?s.ui.processInput(e):e===b.CYCLE_TERA&&this.buttonInfo(!0)}buttonSpeedChange(e=!0){const t=By(Vs.Game_Speed),i=bg[t].options;let n=i.findIndex(r=>r.value===s.gameSpeed.toString());n===-1&&(n=5);let a;if(e&&s.gameSpeed<5)a=1;else if(!e&&s.gameSpeed>1)a=-1;else return;s.gameData.saveSetting(Vs.Game_Speed,Jt.Math.Clamp(n+a,0,i.length-1)),s.ui?.getMode()===x.SETTINGS&&s.ui.getHandler().show([])}};h(Hd,"UiInputs");let Gl=Hd;const Wd=class Wd{damageNumbers;constructor(){this.damageNumbers=new Map}add(e,t,i=Ze.EFFECTIVE,n=!1){if(!s?.damageNumbersMode)return;const a=e.getBattlerIndex(),r=e.getSpriteScale()/6,o=P(e.x,-s.scaledCanvas.height+e.y-e.getSprite().height/2,Ly(t,!0),O.SUMMARY);o.setName("text-damage-number"),o.setOrigin(.5,1),o.setScale(r);let[l,c]=[null,null];switch(i){case Ze.SUPER_EFFECTIVE:[l,c]=["#f8d030","#b8a038"];break;case Ze.NOT_VERY_EFFECTIVE:[l,c]=["#f08030","#c03028"];break;case Ze.INDIRECT_KO:case Ze.ONE_HIT_KO:[l,c]=["#a040a0","#483850"];break;case Ze.HEAL:[l,c]=["#78c850","#588040"];break;default:[l,c]=["#ffffff","#636363"];break}l&&o.setColor(l),c&&(n?(o.setShadowOffset(0,0),o.setStroke(c,12)):o.setShadowColor(c)),s.fieldUI.add(o),this.damageNumbers.has(a)||this.damageNumbers.set(a,[]);const u=this.damageNumbers.get(a).length*-10;if(u&&(o.y+=u),this.damageNumbers.get(a).push(o),s.damageNumbersMode===1){s.tweens.add({targets:o,duration:ge(750),alpha:1,y:"-=32"}),s.tweens.add({delay:375,targets:o,duration:ge(625),alpha:0,ease:"Sine.easeIn",onComplete:h(()=>{this.damageNumbers.get(a).splice(this.damageNumbers.get(a).indexOf(o),1),o.destroy(!0)},"onComplete")});return}o.setAlpha(0),s.tweens.chain({targets:o,tweens:[{duration:ge(250),alpha:1,scaleX:.75*r,scaleY:1.25*r,y:"-=16",ease:"Cubic.easeOut"},{duration:ge(175),alpha:1,scaleX:.875*r,scaleY:1.125*r,y:"+=16",ease:"Cubic.easeIn"},{duration:ge(100),scaleX:1.25*r,scaleY:.75*r,ease:"Cubic.easeOut"},{duration:ge(175),scaleX:.875*r,scaleY:1.125*r,y:"-=8",ease:"Cubic.easeOut"},{duration:ge(50),scaleX:.925*r,scaleY:1.075*r,y:"+=8",ease:"Cubic.easeIn"},{duration:ge(100),scaleX:1.125*r,scaleY:.875*r,ease:"Cubic.easeOut"},{duration:ge(175),scaleX:.925*r,scaleY:1.075*r,y:"-=4",ease:"Cubic.easeOut"},{duration:ge(50),scaleX:.975*r,scaleY:1.025*r,y:"+=4",ease:"Cubic.easeIn"},{duration:ge(100),scaleX:1.075*r,scaleY:.925*r,ease:"Cubic.easeOut"},{duration:ge(25),scaleX:r,scaleY:r,ease:"Cubic.easeOut"},{delay:ge(500),alpha:0,onComplete:h(()=>{this.damageNumbers.get(a).splice(this.damageNumbers.get(a).indexOf(o),1),o.destroy(!0)},"onComplete")}]})}};h(Wd,"DamageNumberHandler");let Yl=Wd;const Gd=class Gd{sprites;counterTween;setup(){this.sprites=new Set,this.counterTween=s.tweens.addCounter({duration:ge(200),from:0,to:1,yoyo:!0,repeat:-1,onRepeat:h(()=>this.onLapse(),"onRepeat")})}onLapse(){Array.from(this.sprites.values()).filter(e=>!e.scene).map(e=>this.sprites.delete(e));for(const e of this.sprites.values()){if(!e.pipelineData.teraColor||!e.pipelineData.teraColor.find(m=>m)||!e.visible||e.parentContainer instanceof Js&&!e.parentContainer.parentContainer||!(e.parentContainer instanceof Js)||!e.parentContainer.isTerastallized)continue;const t=e.parentContainer instanceof Js?e.parentContainer:null,i=(t||e).parentContainer,n=e.texture,[a,r]=[n.source[0].width,n.source[0].height],[o,l]=[ns(a),ns(r)],c=e.width/a,u=e.height/r;if(n.manager.getPixel(o,l,n.key,"__BASE")?.alpha){const[m,d]=[-e.originX*e.width,-e.originY*e.height],y=s.addFieldSprite((t?.x||0)+e.x+o*c+m,(t?.y||0)+e.y+l*u+d,"tera_sparkle");y.pipelineData.ignoreTimeTint=e.pipelineData.ignoreTimeTint,y.setName("sprite-tera-sparkle"),y.play("tera_sparkle"),i.add(y),e.scene.time.delayedCall(ge(Math.floor(1e3/12*13)),()=>y.destroy())}}}add(e){e=tf(e);for(const t of e)this.sprites.has(t)||this.sprites.add(t)}remove(e){e=tf(e);for(const t of e)this.sprites.delete(t)}removeAll(){for(const e of this.sprites.values())this.sprites.delete(e)}destroy(){this.removeAll(),this.counterTween&&(this.counterTween.destroy(),this.counterTween=void 0)}};h(Gd,"PokemonSpriteSparkleHandler");let Kl=Gd;var tt=(T=>(T[T.SYSTEM=0]="SYSTEM",T[T.SESSION=1]="SESSION",T[T.SETTINGS=2]="SETTINGS",T[T.TUTORIALS=3]="TUTORIALS",T[T.SEEN_DIALOGUES=4]="SEEN_DIALOGUES",T[T.RUN_HISTORY=5]="RUN_HISTORY",T))(tt||{});const Yd=class Yd{id;tier;sourceType;hatchWaves;timestamp;variantTier;isShiny;species;eggMoveIndex;overrideHiddenAbility;constructor(e){const t=e instanceof _i?e:null;this.id=t?t.id:e.id,this.tier=t?t.tier:e.tier??Math.floor(this.id/Lr),e.species===0?this.sourceType=e.gachaType??e.sourceType:this.sourceType=t?t.sourceType:e.sourceType,this.hatchWaves=t?t.hatchWaves:e.hatchWaves,this.timestamp=t?t.timestamp:e.timestamp,this.variantTier=t?t.variantTier:e.variantTier,this.isShiny=t?t.isShiny:e.isShiny,this.species=t?t.species:e.species,this.eggMoveIndex=t?t.eggMoveIndex:e.eggMoveIndex,this.overrideHiddenAbility=t?t.overrideHiddenAbility:e.overrideHiddenAbility}toEgg(){return this.species?new _i({id:this.id,tier:this.tier,sourceType:this.sourceType,hatchWaves:this.hatchWaves,timestamp:this.timestamp,variantTier:this.variantTier,isShiny:this.isShiny,species:this.species,eggMoveIndex:this.eggMoveIndex,overrideHiddenAbility:this.overrideHiddenAbility}):new _i({id:this.id,hatchWaves:this.hatchWaves,sourceType:this.sourceType,timestamp:this.timestamp,tier:Math.floor(this.id/Lr)})}};h(Yd,"EggData");let Xa=Yd;const Kd=class Kd{playTime;battles;classicSessionsPlayed;sessionsWon;ribbonsOwned;dailyRunSessionsPlayed;dailyRunSessionsWon;endlessSessionsPlayed;highestEndlessWave;highestLevel;highestMoney;highestDamage;highestHeal;pokemonSeen;pokemonDefeated;pokemonCaught;pokemonHatched;subLegendaryPokemonSeen;subLegendaryPokemonCaught;subLegendaryPokemonHatched;legendaryPokemonSeen;legendaryPokemonCaught;legendaryPokemonHatched;mythicalPokemonSeen;mythicalPokemonCaught;mythicalPokemonHatched;shinyPokemonSeen;shinyPokemonCaught;shinyPokemonHatched;pokemonFused;trainersDefeated;eggsPulled;rareEggsPulled;epicEggsPulled;legendaryEggsPulled;manaphyEggsPulled;constructor(e){this.playTime=e?.playTime||0,this.battles=e?.battles||0,this.classicSessionsPlayed=e?.classicSessionsPlayed||0,this.sessionsWon=e?.sessionsWon||0,this.ribbonsOwned=e?.ribbonsOwned||0,this.dailyRunSessionsPlayed=e?.dailyRunSessionsPlayed||0,this.dailyRunSessionsWon=e?.dailyRunSessionsWon||0,this.endlessSessionsPlayed=e?.endlessSessionsPlayed||0,this.highestEndlessWave=e?.highestEndlessWave||0,this.highestLevel=e?.highestLevel||0,this.highestMoney=e?.highestMoney||0,this.highestDamage=e?.highestDamage||0,this.highestHeal=e?.highestHeal||0,this.pokemonSeen=e?.pokemonSeen||0,this.pokemonDefeated=e?.pokemonDefeated||0,this.pokemonCaught=e?.pokemonCaught||0,this.pokemonHatched=e?.pokemonHatched||0,this.subLegendaryPokemonSeen=e?.subLegendaryPokemonSeen??0,this.subLegendaryPokemonCaught=e?.subLegendaryPokemonCaught??0,this.subLegendaryPokemonHatched=e?.subLegendaryPokemonHatched??0,this.legendaryPokemonSeen=e?.legendaryPokemonSeen||0,this.legendaryPokemonCaught=e?.legendaryPokemonCaught||0,this.legendaryPokemonHatched=e?.legendaryPokemonHatched||0,this.mythicalPokemonSeen=e?.mythicalPokemonSeen||0,this.mythicalPokemonCaught=e?.mythicalPokemonCaught||0,this.mythicalPokemonHatched=e?.mythicalPokemonHatched||0,this.shinyPokemonSeen=e?.shinyPokemonSeen||0,this.shinyPokemonCaught=e?.shinyPokemonCaught||0,this.shinyPokemonHatched=e?.shinyPokemonHatched||0,this.pokemonFused=e?.pokemonFused||0,this.trainersDefeated=e?.trainersDefeated||0,this.eggsPulled=e?.eggsPulled||0,this.rareEggsPulled=e?.rareEggsPulled||0,this.epicEggsPulled=e?.epicEggsPulled||0,this.legendaryEggsPulled=e?.legendaryEggsPulled||0,this.manaphyEggsPulled=e?.manaphyEggsPulled||0}};h(Kd,"GameStats");let qa=Kd;const BC=/^[v^~<>=]*?(\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+))?(?:-([\da-z\-]+(?:\.[\da-z\-]+)*))?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i,_f=h(T=>{if(typeof T!="string")throw new TypeError("Invalid argument expected string");const e=T.match(BC);if(!e)throw new Error(`Invalid argument not valid semver ('${T}' received)`);return e.shift(),e},"validateAndParse"),wf=h(T=>T==="*"||T==="x"||T==="X","isWildcard"),Mf=h(T=>{const e=parseInt(T,10);return isNaN(e)?T:e},"tryParse"),LC=h((T,e)=>typeof T!=typeof e?[String(T),String(e)]:[T,e],"forceType"),DC=h((T,e)=>{if(wf(T)||wf(e))return 0;const[t,i]=LC(Mf(T),Mf(e));return t>i?1:t<i?-1:0},"compareStrings"),kf=h((T,e)=>{for(let t=0;t<Math.max(T.length,e.length);t++){const i=DC(T[t]||"0",e[t]||"0");if(i!==0)return i}return 0},"compareSegments"),Dn=h((T,e)=>{const t=_f(T),i=_f(e),n=t.pop(),a=i.pop(),r=kf(t,i);return r!==0?r:n&&a?kf(n.split("."),a.split(".")):n||a?n?-1:1:0},"compareVersions"),FC={version:"1.0.4",migrate:h(T=>{T.starterData&&T.dexData&&Object.keys(T.starterData).forEach(e=>{T.dexData[e]?.caughtAttr&&T.starterData[e]&&!T.starterData[e].abilityAttr&&(T.starterData[e].abilityAttr=1)})},"migrate")},UC={version:"1.0.4",migrate:h(T=>{T.gameStats&&T.gameStats.legendaryPokemonCaught!==void 0&&T.gameStats.subLegendaryPokemonCaught===void 0&&(T.gameStats.subLegendaryPokemonSeen=0,T.gameStats.subLegendaryPokemonCaught=0,T.gameStats.subLegendaryPokemonHatched=0,it.filter(e=>e.subLegendary).forEach(e=>{const t=T.dexData[e.speciesId];T.gameStats.subLegendaryPokemonSeen+=t.seenCount,T.gameStats.legendaryPokemonSeen=Math.max(T.gameStats.legendaryPokemonSeen-t.seenCount,0),T.gameStats.subLegendaryPokemonCaught+=t.caughtCount,T.gameStats.legendaryPokemonCaught=Math.max(T.gameStats.legendaryPokemonCaught-t.caughtCount,0),T.gameStats.subLegendaryPokemonHatched+=t.hatchedCount,T.gameStats.legendaryPokemonHatched=Math.max(T.gameStats.legendaryPokemonHatched-t.hatchedCount,0)}),T.gameStats.subLegendaryPokemonSeen=Math.max(T.gameStats.subLegendaryPokemonSeen,T.gameStats.subLegendaryPokemonCaught),T.gameStats.legendaryPokemonSeen=Math.max(T.gameStats.legendaryPokemonSeen,T.gameStats.legendaryPokemonCaught),T.gameStats.mythicalPokemonSeen=Math.max(T.gameStats.mythicalPokemonSeen,T.gameStats.mythicalPokemonCaught))},"migrate")},VC={version:"1.0.4",migrate:h(T=>{if(T.starterData!=null)for(const e of Qi)T.starterData[e]?.abilityAttr&&(T.starterData[e].abilityAttr|=ht.ABILITY_1),T.dexData[e]?.caughtAttr&&(T.dexData[e].caughtAttr|=F.FEMALE)},"migrate")},HC=[FC,UC,VC],WC={version:"1.0.4",migrate:h(T=>{T.hasOwnProperty("REROLL_TARGET")&&!T.hasOwnProperty(Vs.Shop_Cursor_Target)&&(T[Vs.Shop_Cursor_Target]=T.REROLL_TARGET,delete T.REROLL_TARGET,localStorage.setItem("settings",JSON.stringify(T)))},"migrate")},GC=[WC],YC={version:"1.0.4",migrate:h(T=>{for(const e of T.modifiers)if(e.className==="PokemonBaseStatModifier")e.className="BaseStatModifier";else if(e.className==="PokemonResetNegativeStatStageModifier")e.className="ResetNegativeStatStageModifier";else if(e.className==="TempBattleStatBoosterModifier")if(e.typeId!=="DIRE_HIT"){e.className="TempStatStageBoosterModifier",e.typeId="TEMP_STAT_STAGE_BOOSTER";const i=e.typePregenArgs[0]+1;e.typePregenArgs[0]=i,e.args=[i,5,Math.min(e.args[1],5)]}else e.className="TempCritBoosterModifier",e.typePregenArgs=[],e.args=[5,Math.min(e.args[1],5)];else if(e.className==="DoubleBattleChanceBoosterModifier"&&e.args.length===1){let t;switch(e.typeId){case"MAX_LURE":t=30;break;case"SUPER_LURE":t=15;break;default:t=10;break}e.args=[t,Math.min(e.args[0],t)]}for(const e of T.enemyModifiers)e.className==="PokemonBaseStatModifier"?e.className="BaseStatModifier":e.className==="PokemonResetNegativeStatStageModifier"&&(e.className="ResetNegativeStatStageModifier")},"migrate")},KC={version:"1.0.4",migrate:h(T=>{for(const e of T.party)e.mysteryEncounterPokemonData&&(e.customPokemonData=new yr(e.mysteryEncounterPokemonData),e.mysteryEncounterPokemonData=null),e.fusionMysteryEncounterPokemonData&&(e.fusionCustomPokemonData=new yr(e.fusionMysteryEncounterPokemonData),e.fusionMysteryEncounterPokemonData=null),e.customPokemonData=e.customPokemonData??new yr,e.natureOverride!=null&&e.natureOverride>=0&&(e.customPokemonData.nature=e.natureOverride,e.natureOverride=-1)},"migrate")},zC=[YC,KC],jC={version:"1.7.0",migrate:h(T=>{T.starterData&&T.dexData&&Object.keys(T.starterData).forEach(e=>{const t=T.dexData[e]?.caughtAttr,i=Number(e);if(!i)return;const n=zt(i);t&&n.forms?.length>1&&n.forms.filter((r,o)=>r.isStarterSelectable&&t&s.gameData.getFormAttr(o)).length===0&&(T.dexData[e].caughtAttr+=F.DEFAULT_FORM)})},"migrate")},$C=[jC],XC={version:"1.7.0",migrate:h(T=>{for(let e=0;e<T.modifiers.length;)T.modifiers[e].className==="TerastallizeModifier"?(T.party.forEach(t=>{t.id===T.modifiers[e].args[0]&&(t.teraType=T.modifiers[e].args[1])}),T.modifiers.splice(e,1)):e++;for(let e=0;e<T.enemyModifiers.length;)T.enemyModifiers[e].className==="TerastallizeModifier"?(T.enemyParty.forEach(t=>{t.id===T.enemyModifiers[e].args[0]&&(t.teraType=T.enemyModifiers[e].args[1])}),T.enemyModifiers.splice(e,1)):e++;T.party.forEach(e=>{e.teraType==null&&(e.teraType=is(e.species,e.formIndex).type1)}),T.enemyParty.forEach(e=>{e.teraType==null&&(e.teraType=is(e.species,e.formIndex).type1)})},"migrate")},qC=[XC],ZC={version:"1.8.3",migrate:h(T=>{if(T.starterData&&T.dexData){const t=T.dexData[172]?.caughtAttr,i=zt(172);i.speciesId===ye.PICHU&&t&&(T.dexData[172].caughtAttr&=i.getFullUnlocksData(),T.dexData[172].caughtAttr|=F.DEFAULT_FORM)}},"migrate")},QC=[ZC],JC={version:"1.9.0",migrate:h(T=>{const e=h(t=>(t.moveset=(t.moveset??[new Fs(st.TACKLE),new Fs(st.GROWL)]).filter(i=>!!i).map(i=>Fs.loadMove(i)),t.summonData.moveset&&=t.summonData.moveset.filter(i=>!!i).map(i=>Fs.loadMove(i)),t.customPokemonData&&"hitsRecCount"in t.customPokemonData&&typeof t.customPokemonData.hitsRecCount=="number"&&(t.battleData.hitCount=t.customPokemonData.hitsRecCount,t.customPokemonData.hitsRecCount=null),t),"mapParty");T.party=T.party.map(e),T.enemyParty=T.enemyParty.map(e)},"migrate")},eS=[JC],tS={version:"1.10.0",migrate:h(T=>{const e=h(t=>({move:t.move,targets:t.targets,result:t.result,turn:t.turn,useMode:t.virtual?Rt.FOLLOW_UP:t.ignorePP?Rt.IGNORE_PP:Rt.NORMAL}),"mapTurnMove");T.party.forEach(t=>{t.summonData.moveHistory=t.summonData.moveHistory.map(e),t.summonData.moveQueue=t.summonData.moveQueue.map(e)}),T.enemyParty.forEach(t=>{t.summonData.moveHistory=t.summonData.moveHistory.map(e),t.summonData.moveQueue=t.summonData.moveQueue.map(e)})},"migrate")},sS=[tS],$h=xg,Fn=[];Fn.push(...HC);Fn.push(...$C);Fn.push(...QC);const Hi=[];Hi.push(...zC);Hi.push(...qC);Hi.push(...eS);Hi.push(...sS);const Xh=[];Xh.push(...GC);const qh=h(T=>{T.sort((e,t)=>Dn(e.version,t.version))},"sortMigrators");qh(Fn);qh(Hi);qh(Xh);const Zh=h((T,e,t)=>{for(const i of T)Dn(t,i.version)===-1&&i.migrate(e)},"applyMigrators");function iS(T){const e=T.gameVersion;Dn(e,$h)===-1&&Zh(Fn,T,e)}h(iS,"applySystemVersionMigration");function nS(T){const e=T.gameVersion;Dn(e,$h)===-1&&(T.money=Math.floor(T.money),Zh(Hi,T,e))}h(nS,"applySessionVersionMigration");function aS(T){const e=T.hasOwnProperty("gameVersion")?T.gameVersion:"1.0.0";Dn(e,$h)===-1&&Zh(Xh,T,e)}h(aS,"applySettingsVersionMigration");const rS=25,zd=class zd extends Vt{maxRows=3;runSelectContainer;runsContainer;runs;scrollCursor=0;cursorObj;runContainerInitialY;constructor(){super(x.RUN_HISTORY)}setup(){const e=this.getUi();this.runSelectContainer=s.add.container(0,0),this.runSelectContainer.setVisible(!1),e.add(this.runSelectContainer);const t=s.add.rectangle(0,0,s.scaledCanvas.width,-s.scaledCanvas.height,26720);t.setOrigin(0,0),this.runSelectContainer.add(t),this.runContainerInitialY=-s.scaledCanvas.height+8,this.runsContainer=s.add.container(8,this.runContainerInitialY),this.runSelectContainer.add(this.runsContainer),this.runs=[],s.loadImage("hall_of_fame_red","ui"),s.loadImage("hall_of_fame_blue","ui"),s.loadAtlas("rival_f","trainer"),s.loadAtlas("rival_m","trainer")}show(e){return super.show(e),this.getUi().bringToTop(this.runSelectContainer),this.runSelectContainer.setVisible(!0),this.populateRuns().then(()=>{this.setScrollCursor(0),this.setCursor(0),this.runs.length===0&&this.clearCursor()}),!0}processInput(e){const t=this.getUi();let i=!1;const n=!1;if([b.ACTION,b.CANCEL].includes(e)){if(e===b.ACTION){const a=this.cursor+this.scrollCursor;if(this.runs[a])s.ui.setOverlayMode(x.RUN_INFO,this.runs[a].entryData,zh.RUN_HISTORY,!0);else return!1;return i=!0,i}i=!0,s.ui.revertMode()}else if(this.runs.length>0)switch(e){case b.UP:this.cursor?i=this.setCursor(this.cursor-1):this.scrollCursor?i=this.setScrollCursor(this.scrollCursor-1):this.runs.length>1&&(i=this.setCursor(Math.min(this.runs.length-1,this.maxRows-1)),i=this.setScrollCursor(Math.max(0,this.runs.length-this.maxRows))||i);break;case b.DOWN:this.cursor<Math.min(this.maxRows-1,this.runs.length-this.scrollCursor-1)?i=this.setCursor(this.cursor+1):this.scrollCursor<this.runs.length-this.maxRows?i=this.setScrollCursor(this.scrollCursor+1):this.runs.length>1&&(i=this.setCursor(0),i=this.setScrollCursor(0)||i);break}return i&&t.playSelect(),i||n}async populateRuns(){const e=await s.gameData.getRunHistoryData(),t=Object.keys(e);if(t.length===0){this.showEmpty();return}const i=t.map(Number);t.length>1&&i.sort((a,r)=>r-a);const n=t.length;for(let a=0;a<n;a++){const r=new jl(e[i[a]],a);s.add.existing(r),this.runsContainer.add(r),this.runs.push(r)}this.cursorObj&&t.length>0&&this.runsContainer.bringToTop(this.cursorObj)}async showEmpty(){const e=Ce(0,0,304,165);this.runsContainer.add(e);const t=e.getCenter(),i=P(0,0,f.t("saveSlotSelectUiHandler:empty"),O.WINDOW,{fontSize:"128px"});i.setPosition(t.x-18,t.y-15),this.runsContainer.add(i)}setCursor(e){const t=super.setCursor(e);return this.cursorObj||(this.cursorObj=s.add.nineslice(0,0,"select_cursor_highlight_thick",void 0,296,46,6,6,6,6),this.cursorObj.setOrigin(0,0),this.runsContainer.add(this.cursorObj)),this.cursorObj.setPosition(4,4+(e+this.scrollCursor)*56),t}setScrollCursor(e){const t=e!==this.scrollCursor;return t&&(this.scrollCursor=e,this.setCursor(this.cursor),s.tweens.add({targets:this.runsContainer,y:this.runContainerInitialY-56*e,duration:ge(325),ease:"Sine.easeInOut"})),t}clear(){super.clear(),this.runSelectContainer.setVisible(!1),this.setScrollCursor(0),this.clearCursor(),this.clearRuns()}clearCursor(){this.cursorObj&&this.cursorObj.destroy(),this.cursorObj=null}clearRuns(){this.runs.splice(0,this.runs.length),this.runsContainer.removeAll(!0)}};h(zd,"RunHistoryUiHandler");let zl=zd;const jd=class jd extends Phaser.GameObjects.Container{entryData;constructor(e,t){super(s,0,t*56),this.entryData=e,this.setup(this.entryData)}setup(e){const t=e.isVictory,i=s.gameData.parseSessionData(JSON.stringify(e.entry)),n=Ce(0,0,304,52);if(this.add(n),t){const c=P(8,5,`${f.t("runHistory:victory")}`,O.WINDOW);this.add(c)}else{const c=s.gameData.gender??De.UNSET,u=De[c].toLowerCase();if(i.battleType===de.WILD||i.battleType===de.MYSTERY_ENCOUNTER&&!i.trainer){const p=s.add.container(8,5),m=P(0,0,`${f.t("runHistory:defeatedWild",{context:u})}`,O.WINDOW);p.add(m),i.enemyParty.forEach((d,y)=>{const g=s.add.container(65+y*25,-8);g.setScale(.75),d.boss=!1,d.player=!0;const C=d.toPokemon(),E=s.addPokemonIcon(C,0,0,0,0),I=P(32,20,`${f.t("saveSlotSelectUiHandler:lv")}${xi(C.level,1e3)}`,O.PARTY,{fontSize:"54px",color:"#f8f8f8"});I.setShadow(0,0,void 0),I.setStroke("#424242",14),I.setOrigin(1,0),g.add(E),g.add(I),p.add(g),C.destroy()}),this.add(p)}else if(i.battleType===de.TRAINER||i.battleType===de.MYSTERY_ENCOUNTER&&i.trainer){const p=i.trainer.toTrainer();if(i.trainer.trainerType>=375){const d=p.variant===Xe.FEMALE?"trainerNames:rivalFemale":"trainerNames:rival",y=P(8,5,`${f.t("runHistory:defeatedRival",{context:u})} ${f.t(d)}`,O.WINDOW);this.add(y)}else{const d=P(8,5,`${f.t("runHistory:defeatedTrainer",{context:u})}${p.getName(0,!0)}`,O.WINDOW);this.add(d)}}}const a=P(8,19,"",O.WINDOW);let r="";switch(i.gameMode){case fe.DAILY:r=f.t("gameMode:dailyRun");break;case fe.SPLICED_ENDLESS:case fe.ENDLESS:r=f.t("gameMode:endless");break;case fe.CLASSIC:r=f.t("gameMode:classic");break;case fe.CHALLENGE:r=f.t("gameMode:challenge");break}if(a.appendText(r,!1),i.gameMode===fe.SPLICED_ENDLESS){const c=s.add.image(0,0,"icon_spliced");c.setScale(.75);const u=a.getTopRight();c.setPosition(u.x+5,27),this.add(c),a.appendText("    - ",!1)}else a.appendText(" - ",!1);a.appendText(f.t("saveSlotSelectUiHandler:wave")+" "+i.waveIndex,!1),this.add(a);const o=P(8,33,new Date(i.timestamp).toLocaleString(),O.WINDOW);this.add(o);const l=s.add.container(140,17);i.party.forEach((c,u)=>{const p=s.add.container(26*u,0);p.setScale(.75);const m=c.toPokemon(),d=s.addPokemonIcon(m,0,0,0,0),y=P(32,20,`${f.t("saveSlotSelectUiHandler:lv")}${xi(m.level,1e3)}`,O.PARTY,{fontSize:"54px",color:"#f8f8f8"});y.setShadow(0,0,void 0),y.setStroke("#424242",14),y.setOrigin(1,0),p.add(d),p.add(y),l.add(p),m.destroy()}),this.add(l)}};h(jd,"RunEntryContainer");let jl=jd;function Ci(T,e=0){switch(T){case tt.SYSTEM:return"data";case tt.SESSION:{let t="sessionData";return e&&(t+=e),t}case tt.SETTINGS:return"settings";case tt.TUTORIALS:return"tutorials";case tt.SEEN_DIALOGUES:return"seenDialogues";case tt.RUN_HISTORY:return"runHistoryData"}}h(Ci,"getDataTypeKey");const na={seenAttr:"$sa",caughtAttr:"$ca",natureAttr:"$na",seenCount:"$s",caughtCount:"$c",hatchedCount:"$hc",ivs:"$i",moveset:"$m",eggMoves:"$em",candyCount:"$x",friendship:"$f",abilityAttr:"$a",passiveAttr:"$pa",valueReduction:"$vr",classicWinCount:"$wc"},Bs=class Bs{trainerId;secretId;gender;dexData;defaultDexData;starterData;gameStats;runHistory;unlocks;achvUnlocks;voucherUnlocks;voucherCounts;eggs;eggPity;unlockPity;constructor(e=!1){e?(this.trainerId=0,this.secretId=0):(this.loadSettings(),this.loadGamepadSettings(),this.loadMappingConfigs(),this.trainerId=ns(65536),this.secretId=ns(65536)),this.starterData={},this.gameStats=new qa,this.runHistory={},this.unlocks={[xt.ENDLESS_MODE]:!1,[xt.MINI_BLACK_HOLE]:!1,[xt.SPLICED_ENDLESS_MODE]:!1,[xt.EVIOLITE]:!1},this.achvUnlocks={},this.voucherUnlocks={},this.voucherCounts={[kt.REGULAR]:0,[kt.PLUS]:0,[kt.PREMIUM]:0,[kt.GOLDEN]:0},this.eggs=[],this.eggPity=[0,0,0,0],this.unlockPity=[0,0,0,0],this.initDexData(),this.initStarterData()}getSystemSaveData(){return{trainerId:this.trainerId,secretId:this.secretId,gender:this.gender,dexData:this.dexData,starterData:this.starterData,gameStats:this.gameStats,unlocks:this.unlocks,achvUnlocks:this.achvUnlocks,voucherUnlocks:this.voucherUnlocks,voucherCounts:this.voucherCounts,eggs:this.eggs.map(e=>new Xa(e)),gameVersion:s.game.config.gameVersion,timestamp:Date.now(),eggPity:this.eggPity.slice(0),unlockPity:this.unlockPity.slice(0)}}isUnlocked(e){return ie.ITEM_UNLOCK_OVERRIDE.includes(e)?!0:this.unlocks[e]}saveSystem(){return new Promise(e=>{s.ui.savingIcon.show();const t=this.getSystemSaveData(),i=2147483648,n=JSON.stringify(t,(a,r)=>typeof r=="bigint"?r<=i?Number(r):r.toString():r);localStorage.setItem(`data_${Be?.username}`,Ks(n)),at.savedata.system.update({clientSessionId:Qt},n).then(a=>{if(s.ui.savingIcon.hide(),a)return a.startsWith("session out of date")&&(s.phaseManager.clearPhaseQueue(),s.phaseManager.unshiftNew("ReloadSessionPhase")),console.error(a),e(!1);e(!0)})})}loadSystem(){return new Promise(e=>{at.savedata.system.get({clientSessionId:Qt}).then(t=>{if(typeof t=="number"||!t||t.length===0||t[0]!=="{")return t===404?(s.phaseManager.queueMessage("Save data could not be found. If this is a new account, you can safely ignore this message.",null,!0),e(!0)):(typeof t=="string"&&t?.includes("Too many connections")&&s.phaseManager.queueMessage("Too many people are trying to connect and the server is overloaded. Please try again later.",null,!0),e(!1));const i=localStorage.getItem(`data_${Be?.username}`);this.initSystem(t,i?zi.AES.decrypt(i,Tr).toString(zi.enc.Utf8):void 0).then(e)})})}static fromRawSystem(e){const t=new Bs(!0),i=Bs.parseSystemData(e);return t.initParsedSystem(i),t}initParsedSystem(e){if(iS(e),this.trainerId=e.trainerId,this.secretId=e.secretId,this.gender=e.gender,this.saveSetting(Vs.Player_Gender,e.gender===De.FEMALE?1:0),e.starterData)this.starterData=e.starterData;else{if(this.initStarterData(),e.starterMoveData){const i=e.starterMoveData;for(const n of Object.keys(i))this.starterData[n].moveset=i[n]}if(e.starterEggMoveData){const i=e.starterEggMoveData;for(const n of Object.keys(i))this.starterData[n].eggMoves=i[n]}this.migrateStarterAbilities(e,this.starterData);const t=Object.keys(this.starterData).map(i=>Number.parseInt(i));for(const i of t)this.starterData[i].candyCount+=e.dexData[i].caughtCount,this.starterData[i].candyCount+=e.dexData[i].hatchedCount*2,e.dexData[i].caughtAttr&F.SHINY&&(this.starterData[i].candyCount+=4)}if(e.gameStats&&(this.gameStats=e.gameStats),e.unlocks)for(const t of Object.keys(e.unlocks))this.unlocks.hasOwnProperty(t)&&(this.unlocks[t]=e.unlocks[t]);if(e.achvUnlocks)for(const t of Object.keys(e.achvUnlocks))Fe.hasOwnProperty(t)&&(this.achvUnlocks[t]=e.achvUnlocks[t]);if(e.voucherUnlocks)for(const t of Object.keys(e.voucherUnlocks))Yt.hasOwnProperty(t)&&(this.voucherUnlocks[t]=e.voucherUnlocks[t]);e.voucherCounts&&Dy(kt).forEach(t=>{const i=kt[t];this.voucherCounts[i]=e.voucherCounts[i]||0}),this.eggs=e.eggs?e.eggs.map(t=>t.toEgg()):[],this.eggPity=e.eggPity?e.eggPity.slice(0):[0,0,0,0],this.unlockPity=e.unlockPity?e.unlockPity.slice(0):[0,0,0,0],this.dexData=Object.assign(this.dexData,e.dexData),this.consolidateDexData(this.dexData),this.defaultDexData=null}initSystem(e,t){const{promise:i,resolve:n}=Promise.withResolvers();try{let a=Bs.parseSystemData(e);if(t){const l=Bs.parseSystemData(t);l.timestamp>a.timestamp?(console.debug("Use cached system"),a=l,e=t):this.clearLocalData()}localStorage.setItem(`data_${Be?.username}`,Ks(e,pn));const r=`runHistoryData_${Be?.username}`;localStorage.getItem(r)||localStorage.setItem(r,""),this.initParsedSystem(a),n(!0)}catch(a){console.error(a),n(!1)}return i}async getRunHistoryData(){const e=`runHistoryData_${Be?.username}`,t=localStorage.getItem(e);if(t){const i=t;return i?JSON.parse(ji(i)):{}}return localStorage.setItem(`runHistoryData_${Be?.username}`,""),{}}async saveRunHistory(e,t){const i=await this.getRunHistoryData();let n=Object.keys(i).map(Number);for(;n.length>=rS;){const r=Math.min.apply(Math,n).toString();delete i[r],n=Object.keys(i).map(Number)}const a=e.timestamp.toString();return i[a]={entry:e,isVictory:t,isFavorite:!1},localStorage.setItem(`runHistoryData_${Be?.username}`,Ks(JSON.stringify(i))),!0}static parseSystemData(e){return JSON.parse(e,(t,i)=>{if(t==="gameStats")return new qa(i);if(t==="eggs"){const n=[];i===null&&(i=[]);for(const a of i)n.push(new Xa(a));return n}return t==="ribbons"?ae.fromJSON(i):t.endsWith("Attr")&&!["natureAttr","abilityAttr","passiveAttr"].includes(t)?BigInt(i??0):i})}convertSystemDataStr(e,t=!1){t||(e=e.replace(/\$pAttr/g,"$pa")),e=e.replace(/"trainerId":\d+/g,`"trainerId":${this.trainerId}`),e=e.replace(/"secretId":\d+/g,`"secretId":${this.secretId}`);const i=t?Object.keys(na):Object.values(na),n=t?Object.values(na):Object.keys(na);for(const a in i)e=e.replace(new RegExp(`${i[a].replace("$","\\$")}`,"g"),n[a]);return e}async verify(){const e=await at.savedata.system.verify({clientSessionId:Qt});return e?(s.phaseManager.clearPhaseQueue(),s.phaseManager.unshiftNew("ReloadSessionPhase",JSON.stringify(e)),this.clearLocalData(),!1):!0}clearLocalData(){localStorage.removeItem(`data_${Be?.username}`);for(let e=0;e<5;e++)localStorage.removeItem(`sessionData${e||""}_${Be?.username}`)}saveSetting(e,t){let i={};return localStorage.hasOwnProperty("settings")&&(i=JSON.parse(localStorage.getItem("settings"))),sf(e,t),i[e]=t,i.gameVersion=s.game.config.gameVersion,localStorage.setItem("settings",JSON.stringify(i)),!0}saveMappingConfigs(e,t){const i=e.toLowerCase();let n={};return localStorage.hasOwnProperty("mappingConfigs")&&(n=JSON.parse(localStorage.getItem("mappingConfigs"))),n[i]||(n[i]={}),n[i].custom=t.custom,localStorage.setItem("mappingConfigs",JSON.stringify(n)),!0}loadMappingConfigs(){if(!localStorage.hasOwnProperty("mappingConfigs"))return!1;const e=JSON.parse(localStorage.getItem("mappingConfigs"));for(const t of Object.keys(e))s.inputController.injectConfig(t,e[t]);return!0}resetMappingToFactory(){return localStorage.hasOwnProperty("mappingConfigs")?(localStorage.removeItem("mappingConfigs"),s.inputController.resetConfigs(),!0):!1}saveControlSetting(e,t,i,n,a){let r={};return localStorage.hasOwnProperty(t)&&(r=JSON.parse(localStorage.getItem(t))),e===Le.GAMEPAD?ha(i,a):e===Le.KEYBOARD&&_g(i,a),Object.keys(n).forEach(o=>{o===i&&(r[o]=a)}),localStorage.setItem(t,JSON.stringify(r)),!0}loadSettings(){if(Fy(),!localStorage.hasOwnProperty("settings"))return!1;const e=JSON.parse(localStorage.getItem("settings"));aS(e);for(const t of Object.keys(e))sf(t,e[t]);return!0}loadGamepadSettings(){if(Object.values(G).forEach(t=>{ha(t,kg[t])}),!localStorage.hasOwnProperty("settingsGamepad"))return;const e=JSON.parse(localStorage.getItem("settingsGamepad"));for(const t of Object.keys(e))ha(t,e[t])}saveTutorialFlag(e,t){const i=Ci(tt.TUTORIALS),n=localStorage.hasOwnProperty(i)?JSON.parse(localStorage.getItem(i)):{};for(const a of Object.values(ds))a===e?n[a]=t:n[a]??=!1;localStorage.setItem(i,JSON.stringify(n))}getTutorialFlags(){const e=Ci(tt.TUTORIALS),t=Object.values(ds).reduce((n,a)=>(n[ds[a]]=!1,n),{});if(!localStorage.hasOwnProperty(e))return t;const i=JSON.parse(localStorage.getItem(e));for(const n of Object.keys(i))t[n]=i[n];return t}saveSeenDialogue(e){const t=Ci(tt.SEEN_DIALOGUES),i=this.getSeenDialogues();return i[e]=!0,localStorage.setItem(t,JSON.stringify(i)),!0}getSeenDialogues(){const e=Ci(tt.SEEN_DIALOGUES),t={};if(!localStorage.hasOwnProperty(e))return t;const i=JSON.parse(localStorage.getItem(e));for(const n of Object.keys(i))t[n]=i[n];return t}getSessionSaveData(){return{seed:s.seed,playTime:s.sessionPlayTime,gameMode:s.gameMode.modeId,party:s.getPlayerParty().map(e=>new an(e)),enemyParty:s.getEnemyParty().map(e=>new an(e)),modifiers:s.findModifiers(()=>!0).map(e=>new ui(e,!0)),enemyModifiers:s.findModifiers(()=>!0,!1).map(e=>new ui(e,!1)),arena:new Sn(s.arena),pokeballCounts:s.pokeballCounts,money:Math.floor(s.money),score:s.score,waveIndex:s.currentBattle.waveIndex,battleType:s.currentBattle.battleType,trainer:s.currentBattle.battleType===de.TRAINER?new bn(s.currentBattle.trainer):null,gameVersion:s.game.config.gameVersion,timestamp:Date.now(),challenges:s.gameMode.challenges.map(e=>new En(e)),mysteryEncounterType:s.currentBattle.mysteryEncounter?.encounterType??-1,mysteryEncounterSaveData:s.mysteryEncounterSaveData,playerFaints:s.arena.playerFaints}}async getSession(e){const{promise:t,resolve:i,reject:n}=Promise.withResolvers();if(e<0)return i(null),t;const a=h(async o=>{try{const l=this.parseSessionData(o);i(l)}catch(l){n(l);return}},"handleSessionData");if(!localStorage.getItem(`sessionData${e||""}_${Be?.username}`)){const o=await at.savedata.session.get({slot:e,clientSessionId:Qt});return!o||o?.length===0||o?.[0]!=="{"?(console.error(o),i(null),t):(localStorage.setItem(`sessionData${e||""}_${Be?.username}`,Ks(o)),await a(o),t)}const r=localStorage.getItem(`sessionData${e||""}_${Be?.username}`);return r?(await a(ji(r)),t):(i(null),t)}async renameSession(e,t){if(e<0)return!1;if(t==="")return!0;const i=await this.getSession(e);if(!i)return!1;i.name=t,i.timestamp+=1;const n=JSON.stringify(i),a=Ks(n),r=this.secretId,o=this.trainerId;if(await at.savedata.session.update({slot:e,trainerId:o,secretId:r,clientSessionId:Qt},n))return!1;localStorage.setItem(`sessionData${e||""}_${Be?.username}`,a);const c=await Ts();return!(c!==null&&!c)}async loadSession(e,t){const{promise:i,resolve:n,reject:a}=Promise.withResolvers();try{const r=h(o=>{s.gameMode=Sa(o.gameMode||fe.CLASSIC),o.challenges&&(s.gameMode.challenges=o.challenges.map(y=>y.toChallenge())),s.setSeed(o.seed||s.game.config.seed[0]),s.resetSeed(),s.seed,s.sessionPlayTime=o.playTime||0,s.lastSavePlayTime=0;const l=[],c=s.getPlayerParty();c.splice(0,c.length);for(const y of o.party){const g=y.toPokemon();g.setVisible(!1),l.push(g.loadAssets(!1)),c.push(g)}Object.keys(s.pokeballCounts).forEach(y=>{s.pokeballCounts[y]=o.pokeballCounts[y]||0}),ie.POKEBALL_OVERRIDE.active&&(s.pokeballCounts=ie.POKEBALL_OVERRIDE.pokeballs),s.money=Math.floor(o.money||0),s.updateMoneyText(),s.money>this.gameStats.highestMoney&&(this.gameStats.highestMoney=s.money),s.score=o.score,s.updateScoreText(),s.mysteryEncounterSaveData=new Fi(o.mysteryEncounterSaveData),s.newArena(o.arena.biome,o.playerFaints);const u=o.battleType||0,p=o.trainer?Ii[o.trainer.trainerType]:null,m=o.mysteryEncounterType!==-1?o.mysteryEncounterType:void 0,d=s.newBattle(o.waveIndex,u,o.trainer,u===de.TRAINER?p?.doubleOnly||o.trainer?.variant===Xe.DOUBLE:o.enemyParty.length>1,m);if(d.enemyLevels=o.enemyParty.map(y=>y.level),s.arena.init(),o.enemyParty.forEach((y,g)=>{const C=y.toPokemon(u,g,o.trainer?.variant===Xe.DOUBLE);d.enemyParty[g]=C,u===de.WILD&&d.seenEnemyPartyMemberIds.add(C.id),l.push(C.loadAssets())}),s.arena.weather=o.arena.weather,s.arena.eventTarget.dispatchEvent(new Ji(hn.NONE,s.arena.weather?.weatherType,s.arena.weather?.turnsLeft,s.arena.weather?.maxDuration)),s.arena.terrain=o.arena.terrain,s.arena.eventTarget.dispatchEvent(new Ig(Pi.NONE,s.arena.terrain?.terrainType,s.arena.terrain?.turnsLeft,s.arena.terrain?.maxDuration)),s.arena.playerTerasUsed=o.arena.playerTerasUsed,s.arena.tags=o.arena.tags,s.arena.tags)for(const y of s.arena.tags)if(y instanceof Lh){const{tagType:g,side:C,turnCount:E,maxDuration:I,layers:A,maxLayers:_}=y;s.arena.eventTarget.dispatchEvent(new Yr(g,C,E,I,A,_))}else s.arena.eventTarget.dispatchEvent(new Yr(y.tagType,y.side,y.turnCount,y.maxDuration));s.arena.positionalTagManager.tags=o.arena.positionalTags.map(y=>Uy(y)),s.modifiers.length>0&&(console.warn("Existing modifiers not cleared on session load, deleting..."),s.modifiers=[]);for(const y of o.modifiers){const g=y.toModifier(ma[y.className]);g&&s.addModifier(g,!0)}s.updateModifiers(!0);for(const y of o.enemyModifiers){const g=y.toModifier(ma[y.className]);g&&s.addEnemyModifier(g,!0)}s.updateModifiers(!1),Promise.all(l).then(()=>n(!0))},"initSessionFromData");t?r(t):this.getSession(e).then(o=>o&&r(o)).catch(o=>{a(o)})}catch(r){a(r)}return i}deleteSession(e){return new Promise(t=>{Ts().then(i=>{if(i!==null&&!i)return t(!1);at.savedata.session.delete({slot:e,clientSessionId:Qt}).then(n=>{n?(n.startsWith("session out of date")&&(s.phaseManager.clearPhaseQueue(),s.phaseManager.unshiftNew("ReloadSessionPhase")),console.error(n),t(!1)):(Be&&(Be.lastSessionSlot=-1),localStorage.removeItem(`sessionData${e||""}_${Be?.username}`),t(!0))})})})}offlineNewClear(){return new Promise(e=>{const t=this.getSessionSaveData(),i=t.seed;let n=[];return t.gameMode===fe.DAILY?localStorage.hasOwnProperty("daily")?(n=JSON.parse(atob(localStorage.getItem("daily"))),n.includes(i)?e(!1):(n.push(i),localStorage.setItem("daily",btoa(JSON.stringify(n))),e(!0))):(n.push(i),localStorage.setItem("daily",btoa(JSON.stringify(n))),e(!0)):e(!0)})}async tryClearSession(e){let t=[!1,!1];{const i=this.getSessionSaveData(),{trainerId:n}=this,a=await at.savedata.session.clear({slot:e,trainerId:n,clientSessionId:Qt},i);a?.error?(a?.error?.startsWith("session out of date")&&(s.phaseManager.clearPhaseQueue(),s.phaseManager.unshiftNew("ReloadSessionPhase")),console.error(a),t=[!1,!1]):(t=[!0,a?.success??!1],Be&&(Be.lastSessionSlot=-1),localStorage.removeItem(`sessionData${e||""}_${Be?.username}`))}return await Ts(),t}parseSessionData(e){const t=JSON.parse(e,(i,n)=>{switch(i){case"party":case"enemyParty":{const a=[];for(const r of n??[])a.push(new an(r));return a}case"trainer":return n?new bn(n):null;case"modifiers":case"enemyModifiers":{const a=[];for(const r of n??[])r?.className==="ExpBalanceModifier"&&(r.stackCount=Math.min(r.stackCount,4)),!(r instanceof tg&&(r.effect===lt.FREEZE||r.effect===lt.SLEEP))&&a.push(new ui(r,i==="modifiers"));return a}case"arena":return new Sn(n);case"challenges":{const a=[];for(const r of n??[])a.push(new En(r));return a}case"mysteryEncounterType":return n;case"mysteryEncounterSaveData":return new Fi(n);default:return n}});return nS(t),t}saveAll(e=!1,t=!1,i=!1,n=!1){return new Promise(a=>{Hh(!e,Ts).then(r=>{if(r!==null&&!r)return a(!1);t&&s.ui.savingIcon.show();const o=i?this.parseSessionData(ji(localStorage.getItem(`sessionData${s.sessionSlotId?s.sessionSlotId:""}_${Be?.username}`))):this.getSessionSaveData(),l=2147483648,c=n?Bs.parseSystemData(ji(localStorage.getItem(`data_${Be?.username}`))):this.getSystemSaveData(),u={system:c,session:o,sessionSlotId:s.sessionSlotId,clientSessionId:Qt};localStorage.setItem(`data_${Be?.username}`,Ks(JSON.stringify(c,(p,m)=>typeof m=="bigint"?m<=l?Number(m):m.toString():m))),localStorage.setItem(`sessionData${s.sessionSlotId?s.sessionSlotId:""}_${Be?.username}`,Ks(JSON.stringify(o))),console.debug("Session data saved!"),t?at.savedata.updateAll(u).then(p=>{if(t&&(s.lastSavePlayTime=0,s.ui.savingIcon.hide()),p)return p.startsWith("session out of date")&&(s.phaseManager.clearPhaseQueue(),s.phaseManager.unshiftNew("ReloadSessionPhase")),console.error(p),a(!1);a(!0)}):this.verify().then(p=>{s.ui.savingIcon.hide(),a(p)})})})}tryExportData(e,t=0){return new Promise(i=>{const n=`${Ci(e,t)}_${Be?.username}`,a=h(r=>{switch(e){case tt.SYSTEM:r=this.convertSystemDataStr(r,!0);break}const o=zi.AES.encrypt(r,Tr),l=new Blob([o.toString()],{type:"text/json"}),c=document.createElement("a");c.href=window.URL.createObjectURL(l),c.download=`${n}.prsv`,c.click(),c.remove()},"handleData");if(e<tt.SETTINGS){let r=Promise.resolve(null);e===tt.SYSTEM?r=at.savedata.system.get({clientSessionId:Qt}):e===tt.SESSION&&(r=at.savedata.session.get({slot:t,clientSessionId:Qt})),r.then(o=>{if(typeof o!="string"||o.length===0||o.charAt(0)!=="{"){console.error(o),i(!1);return}a(o),i(!0)})}else{const r=localStorage.getItem(n);r&&a(ji(r)),i(!!r)}})}importData(e,t=0){const i=`${Ci(e,t)}_${Be?.username}`;let n=document.getElementById("saveFile");n&&n.remove(),n=document.createElement("input"),n.id="saveFile",n.type="file",n.accept=".prsv",n.style.display="none",n.addEventListener("change",a=>{const r=new FileReader;r.onload=(o=>l=>{const c=f.t(`gameData:${bt(tt[e])}`);let u=zi.AES.decrypt(l.target?.result?.toString(),Tr).toString(zi.enc.Utf8),p=!1;try{switch(e){case tt.SYSTEM:{u=this.convertSystemDataStr(u),u=u.replace(/"playTime":\d+/,`"playTime":${this.gameStats.playTime+60}`);const d=Bs.parseSystemData(u);p=!!d.dexData&&!!d.timestamp;break}case tt.SESSION:{const d=this.parseSessionData(u);p=!!d.party&&!!d.enemyParty&&!!d.timestamp;break}case tt.RUN_HISTORY:{const d=JSON.parse(u);Object.keys(d).forEach(g=>{const C=Object.keys(d[g]);p=["isFavorite","isVictory","entry"].every(E=>C.includes(E))&&C.length===3});break}case tt.SETTINGS:case tt.TUTORIALS:p=!0;break}}catch(d){console.error(d)}const m=h(d=>s.ui.showText(d,null,()=>s.ui.showText("",0),ge(1500)),"displayError");if(!p)return m(f.t("menuUiHandler:importCorrupt",{dataName:c}));s.ui.showText(f.t("menuUiHandler:confirmImport",{dataName:c}),null,()=>{s.ui.setOverlayMode(x.CONFIRM,()=>{localStorage.setItem(i,Ks(u)),e<tt.SETTINGS?Ts().then(d=>{if(!d[0])return m(f.t("menuUiHandler:importNoServer",{dataName:c}));const{trainerId:y,secretId:g}=this;let C;e===tt.SESSION?C=at.savedata.session.update({slot:t,trainerId:y,secretId:g,clientSessionId:Qt},u):C=at.savedata.system.update({trainerId:y,secretId:g,clientSessionId:Qt},u),C.then(E=>{if(E)return console.error(E),m(f.t("menuUiHandler:importError",{dataName:c}));window.location.reload()})}):window.location.reload()},()=>{s.ui.revertMode(),s.ui.showText("",0)},!1,-98)})})(a.target.files[0]),r.readAsText(a.target.files[0])}),n.click()}initDexData(){const e={};for(const n of it)e[n.speciesId]={seenAttr:0n,caughtAttr:0n,natureAttr:0,seenCount:0,caughtCount:0,hatchedCount:0,ivs:[0,0,0,0,0,0],ribbons:new ae(0)};const t=F.NON_SHINY|F.MALE|F.FEMALE|F.DEFAULT_VARIANT|F.DEFAULT_FORM,i=[];s.executeWithSeedOffset(()=>{const n=[Mt.HARDY,Mt.DOCILE,Mt.SERIOUS,Mt.BASHFUL,Mt.QUIRKY];for(const a of Qi)i.push(Pn(n))},0,"default");for(let n=0;n<Qi.length;n++){const a=e[Qi[n]];a.seenAttr=t,a.caughtAttr=t,a.natureAttr=1<<i[n]+1;for(const r in a.ivs)a.ivs[r]=15}this.defaultDexData={...e},this.dexData=e}initStarterData(){const e={},t=Object.keys($e).map(i=>Number.parseInt(i));for(const i of t)e[i]={moveset:null,eggMoves:0,candyCount:0,friendship:0,abilityAttr:Qi.includes(i)?ht.ABILITY_1:0,passiveAttr:0,valueReduction:0,classicWinCount:0};this.starterData=e}setPokemonSeen(e,t=!0,i=!1){if(s.currentBattle?.isBattleMysteryEncounter()&&s.currentBattle.mysteryEncounter?.preventGameStatsUpdates)return;const n=this.dexData[e.species.speciesId];n.seenAttr|=e.getDexAttr(),t&&(n.seenCount++,this.gameStats.pokemonSeen++,!i&&e.species.subLegendary?this.gameStats.subLegendaryPokemonSeen++:!i&&e.species.legendary?this.gameStats.legendaryPokemonSeen++:!i&&e.species.mythical&&this.gameStats.mythicalPokemonSeen++,!i&&e.isShiny()&&this.gameStats.shinyPokemonSeen++)}setPokemonCaught(e,t=!0,i=!1,n=!0){const a=e.species.getRootSpeciesId();return!t&&!s.gameData.dexData[a].caughtAttr?Promise.resolve(!1):this.setPokemonSpeciesCaught(e,e.species,t,i,n)}setPokemonSpeciesCaught(e,t,i=!0,n=!1,a=!0){return new Promise(r=>{const o=this.dexData[t.speciesId],l=o.caughtAttr,c=e.formIndex,u=e.getDexAttr()&t.getFullUnlocksData();o.caughtAttr|=u;const p=e.getFormKey();c>0&&(e.species.speciesId===ye.PIKACHU&&t.speciesId===ye.PICHU&&(o.caughtAttr|=s.gameData.getFormAttr(0)),e.species.speciesId===ye.URSHIFU?c===2?o.caughtAttr|=s.gameData.getFormAttr(0):c===3&&(o.caughtAttr|=s.gameData.getFormAttr(1)):e.species.speciesId===ye.ZYGARDE?c===4?o.caughtAttr|=s.gameData.getFormAttr(2):c===5&&(o.caughtAttr|=s.gameData.getFormAttr(3)):(fi.hasOwnProperty(t.speciesId)?fi[t.speciesId]:[]).filter(I=>I.formKey===p).length>0&&(o.caughtAttr|=s.gameData.getFormAttr(0))),$e.hasOwnProperty(t.speciesId)&&(this.starterData[t.speciesId].abilityAttr|=e.abilityIndex!==1||e.species.ability2?1<<e.abilityIndex:ht.ABILITY_HIDDEN),o.natureAttr|=1<<e.nature+1;const m=Bt.hasOwnProperty(t.speciesId),d=!l,y=(l&u)!==u;i&&(n?(o.hatchedCount++,this.gameStats.pokemonHatched++,e.species.subLegendary?this.gameStats.subLegendaryPokemonHatched++:e.species.legendary?this.gameStats.legendaryPokemonHatched++:e.species.mythical&&this.gameStats.mythicalPokemonHatched++,e.isShiny()&&this.gameStats.shinyPokemonHatched++):(o.caughtCount++,this.gameStats.pokemonCaught++,e.species.subLegendary?this.gameStats.subLegendaryPokemonCaught++:e.species.legendary?this.gameStats.legendaryPokemonCaught++:e.species.mythical&&this.gameStats.mythicalPokemonCaught++,e.isShiny()&&this.gameStats.shinyPokemonCaught++),!m&&(!s.gameMode.isDaily||y||n)&&this.addStarterCandy(t,1*(e.isShiny()?5*(1<<(e.variant??0)):1)*(n||e.isBoss()?2:1)));const g=h(C=>{if(m){const E=Bt[t.speciesId];this.setPokemonSpeciesCaught(e,zt(E),i,n,a).then(I=>r(I))}else r(C)},"checkPrevolution");if(d&&$e.hasOwnProperty(t.speciesId)){if(!a){r(!0);return}s.playSound("level_up_fanfare"),s.ui.showText(f.t("battle:addedAsAStarter",{pokemonName:t.name}),null,()=>g(!0),null,!0)}else g(!1)})}incrementRibbonCount(e,t=!1){const i=e.getRootSpeciesId(t);this.starterData[i].classicWinCount||(this.starterData[i].classicWinCount=0),this.starterData[i].classicWinCount||s.gameData.gameStats.ribbonsOwned++;const n=s.gameData.gameStats.ribbonsOwned;return n>=100&&s.validateAchv(Fe._100_RIBBONS),n>=75&&s.validateAchv(Fe._75_RIBBONS),n>=50&&s.validateAchv(Fe._50_RIBBONS),n>=25&&s.validateAchv(Fe._25_RIBBONS),n>=10&&s.validateAchv(Fe._10_RIBBONS),++this.starterData[i].classicWinCount}addStarterCandy(e,t){s.candyBar.showStarterSpeciesCandy(e.speciesId,t),this.starterData[e.speciesId].candyCount+=t}setEggMoveUnlocked(e,t,i=!0,n=!1){return new Promise(a=>{const r=e.speciesId;if(!Ht.hasOwnProperty(r)||!Ht[r][t]){a(!1);return}this.starterData[r].eggMoves||(this.starterData[r].eggMoves=0);const o=1<<t;if(this.starterData[r].eggMoves&o){a(!1);return}if(this.starterData[r].eggMoves|=o,!i){a(!0);return}s.playSound("level_up_fanfare");const l=We[Ht[r][t]].name;let c=n?e.getName()+" ":"";c+=t===3?f.t("egg:rareEggMoveUnlock",{moveName:l}):f.t("egg:eggMoveUnlock",{moveName:l}),s.ui.showText(c,null,()=>a(!0),null,!0)})}isRootSpeciesUnlocked(e){return!!this.dexData[e.getRootSpeciesId()]?.caughtAttr}unlockSpeciesNature(e,t){if(!this.isRootSpeciesUnlocked(e))return;const i=h(n=>{this.dexData[n].natureAttr|=1<<t+1,Bt.hasOwnProperty(n)&&i(Bt[n])},"_unlockSpeciesNature");i(e.speciesId)}updateSpeciesDexIvs(e,t){let i;do{i=s.gameData.dexData[e];const n=i.ivs;for(let a=0;a<n.length;a++)n[a]<t[a]&&(n[a]=t[a]);n.filter(a=>a===31).length===6&&s.validateAchv(Fe.PERFECT_IVS)}while(Bt.hasOwnProperty(e)&&(e=Bt[e]))}getSpeciesCount(e){const t=Object.keys(this.dexData);let i=0;for(const n of t)e(this.dexData[n])&&i++;return i}getStarterCount(e){const t=Object.keys($e);let i=0;for(const n of t){const a=this.dexData[n];e(a)&&i++}return i}getSpeciesDefaultDexAttr(e,t=!1,i=!1){let n=0n;const r=this.dexData[e.speciesId].caughtAttr;return i?r&F.SHINY?(n|=F.SHINY,r&F.VARIANT_3?n|=F.VARIANT_3:r&F.VARIANT_2?n|=F.VARIANT_2:n|=F.DEFAULT_VARIANT):(n|=F.NON_SHINY,n|=F.DEFAULT_VARIANT):(n|=r&F.NON_SHINY||!(r&F.SHINY)?F.NON_SHINY:F.SHINY,r&F.DEFAULT_VARIANT?n|=F.DEFAULT_VARIANT:r&F.VARIANT_2?n|=F.VARIANT_2:r&F.VARIANT_3?n|=F.VARIANT_3:n|=F.DEFAULT_VARIANT),n|=r&F.MALE||!(r&F.FEMALE)?F.MALE:F.FEMALE,n|=this.getFormAttr(this.getFormIndex(r)),n}getSpeciesDexAttrProps(e,t){const i=!(t&F.NON_SHINY),n=!(t&F.MALE);let a=0;t&F.DEFAULT_VARIANT?a=0:t&F.VARIANT_2?a=1:t&F.VARIANT_3&&(a=2);const r=this.getFormIndex(t);return{shiny:i,female:n,variant:a,formIndex:r}}getStarterSpeciesDefaultAbilityIndex(e,t){return t??=this.starterData[e.speciesId].abilityAttr,t&ht.ABILITY_1?0:!e.ability2||t&ht.ABILITY_2?1:2}getSpeciesDefaultNature(e,t){t??=this.dexData[e.speciesId];for(let i=0;i<25;i++)if(t.natureAttr&1<<i+1)return i;return 0}getSpeciesDefaultNatureAttr(e){return 1<<this.getSpeciesDefaultNature(e)}getDexAttrLuck(e){return e&F.SHINY?e&F.VARIANT_3?3:e&F.VARIANT_2?2:1:0}getNaturesForAttr(e=0){const t=[];for(let i=0;i<25;i++)e&1<<i+1&&t.push(i);return t}getSpeciesStarterValue(e){let i=$e[e];const n=h(r=>(r>1?r--:r/=2,r),"decrementValue");for(let r=0;r<this.starterData[e].valueReduction;r++)i=n(i);const a=new ct(i);return Cs(Ss.STARTER_COST,e,a),a.value}getFormIndex(e){if(!e||e<F.DEFAULT_FORM)return 0;let t=0;for(;!(e&this.getFormAttr(t));)t++;return t}getFormAttr(e){return BigInt(1)<<BigInt(7+e)}consolidateDexData(e){for(const t of Object.keys(e)){const i=e[t];i.hasOwnProperty("hatchedCount")||(i.hatchedCount=0),(!i.hasOwnProperty("natureAttr")||i.caughtAttr&&!i.natureAttr)&&(i.natureAttr=this.defaultDexData?.[t].natureAttr||1<<ns(25,1)),i.hasOwnProperty("ribbons")||(i.ribbons=new ae(0))}}migrateStarterAbilities(e,t){const i=Object.keys(this.starterData).map(r=>Number.parseInt(r)),n=t||e.starterData,a=e.dexData;for(const r of i){const o=a[r].caughtAttr;n[r].abilityAttr=(o&F.DEFAULT_VARIANT?ht.ABILITY_1:0)|(o&F.VARIANT_2?ht.ABILITY_2:0)|(o&F.VARIANT_3?ht.ABILITY_HIDDEN:0),o&&(o&F.DEFAULT_VARIANT||(a[r].caughtAttr^=F.DEFAULT_VARIANT),o&F.VARIANT_2&&(a[r].caughtAttr^=F.VARIANT_2),o&F.VARIANT_3&&(a[r].caughtAttr^=F.VARIANT_3))}}};h(Bs,"GameData");let Mn=Bs;const oS=["delay","completeDelay","loopDelay","duration","repeatDelay","hold","startDelay"];function lS(){const T=this,e=h(p=>p instanceof nf?p.value:T.gameSpeed===1?p:Math.ceil(p/=T.gameSpeed),"transformValue"),t=h((p,m=!1)=>{if(!(p instanceof Phaser.Tweens.Tween||p instanceof Phaser.Tweens.TweenChain)){if(m&&Array.isArray(p)){for(const d of p)t(d);return}for(const d of oS){const y=p[d];(typeof y=="number"||y instanceof nf)&&(p[d]=e(y))}if(p.tweens&&Array.isArray(p.tweens))for(const d of p.tweens)t(d)}},"mutateProperties"),i=this.time.addEvent;this.time.addEvent=function(p){return!(p instanceof Phaser.Time.TimerEvent)&&p.delay&&(p.delay=e(p.delay)),i.apply(this,[p])};const n=this.tweens.add;this.tweens.add=function(p){return t(p),n.apply(this,[p])};const a=this.tweens.chain;this.tweens.chain=function(p){return t(p),a.apply(this,[p])};const r=this.tweens.addCounter;this.tweens.addCounter=function(p){return t(p),r.apply(this,[p])};const o=this.tweens.create;this.tweens.create=function(p){return t(p,!0),o.apply(this,[p])};const l=this.tweens.addMultiple;this.tweens.addMultiple=function(p){return t(p,!0),l.apply(this,[p])};const c=Ds.fadeOut;Ds.fadeOut=((p,m,d,y)=>c(s,m,e(d),y));const u=Ds.fadeIn;Ds.fadeIn=((p,m,d,y,g)=>u(s,m,e(d),y,g))}h(lS,"initGameSpeed");const qi=118,hS=0,Nf=-116,$d=class $d extends Phaser.GameObjects.Container{abilityBars;abilityBarText;player;screenRight;shown;constructor(){super(s,qi,Nf),this.abilityBars=[],this.player=!0,this.shown=!1}setup(){for(const e of["ability_bar_right","ability_bar_left"]){const t=s.add.image(0,0,e);t.setOrigin(0,0),t.setVisible(!1),this.add(t),this.abilityBars.push(t)}this.abilityBarText=P(15,3,"",O.MESSAGE,{fontSize:"72px"}),this.abilityBarText.setOrigin(0,0),this.abilityBarText.setWordWrapWidth(600,!0),this.add(this.abilityBarText),this.bringToTop(this.abilityBarText),this.setVisible(!1),this.setX(-qi)}setVisible(e){return this.abilityBars[+this.player].setVisible(e),this.shown=e,this}async startTween(e,t){return this.setVisible(!0),t&&this.abilityBarText.setText(t),new Promise(i=>{s.tweens.add({...e,onComplete:h(()=>{e.onComplete&&e.onComplete(),i()},"onComplete")})})}async showAbility(e,t,i=!1,n=!0){const a=`${f.t("fightUiHandler:abilityFlyInText",{pokemonName:e,passive:i?f.t("fightUiHandler:passive"):"",abilityName:t})}`;this.screenRight=s.scaledCanvas.width,n!==this.player&&(this.setX(n?-qi:this.screenRight),this.player=n),s.fieldUI.bringToTop(this);let r=Nf;return this.player?r+=s.currentBattle.double?14:0:r-=s.currentBattle.double?28:14,this.setY(r),this.startTween({targets:this,x:this.player?hS:this.screenRight-qi,duration:500,ease:"Sine.easeOut",hold:1e3},a)}async hide(){return this.startTween({targets:this,x:this.player?-qi:this.screenRight,duration:200,ease:"Sine.easeIn",onComplete:h(()=>{this.setVisible(!1)},"onComplete")})}isVisible(){return this.shown}};h($d,"AbilityBar");let $l=$d;const Xd=class Xd extends Phaser.GameObjects.Container{timeOfDayIconFgs=new Array(2);timeOfDayIconMgs=new Array(2);timeOfDayIconBgs=new Array(2);timeOfDayIcons;timeOfDayIconPairs=new Map([["bg",this.timeOfDayIconBgs],["mg",this.timeOfDayIconMgs],["fg",this.timeOfDayIconFgs]]);currentTime=hs.ALL;previousTime=hs.ALL;onEncounterPhaseEvent=h(e=>this.onEncounterPhase(e),"onEncounterPhaseEvent");_parentVisible;get parentVisible(){return this._parentVisible}set parentVisible(e){e&&!this._parentVisible&&this.timeOfDayIcons?.forEach(t=>s.tweens.getTweensOf(t).forEach(i=>i.resume())),this._parentVisible=e}constructor(e=0,t=0){super(s,e,t),this.setVisible(s.showTimeOfDayWidget),s.showTimeOfDayWidget&&(this.timeOfDayIconPairs.forEach((i,n)=>{for(let a=0;a<i.length;a++)i[a]=s.add.sprite(0,0,"dawn_icon_"+n).setOrigin()}),this.timeOfDayIcons=[this.timeOfDayIconBgs,this.timeOfDayIconMgs,this.timeOfDayIconFgs].flat(),this.add(this.timeOfDayIcons),s.eventTarget.addEventListener(Si.ENCOUNTER_PHASE,this.onEncounterPhaseEvent))}getBackTween(){const e={targets:[this.timeOfDayIconMgs[0],this.timeOfDayIconMgs[1]],angle:"+=90",duration:ge(1500),ease:"Back.easeOut",paused:!this.parentVisible},t={targets:[this.timeOfDayIconBgs[1],this.timeOfDayIconMgs[1],this.timeOfDayIconFgs[1]],alpha:0,duration:ge(500),ease:"Linear",paused:!this.parentVisible};return[e,t]}getBounceTween(){const e={targets:[this.timeOfDayIconMgs[0],this.timeOfDayIconMgs[1]],angle:"+=90",duration:ge(2e3),ease:"Bounce.easeOut",paused:!this.parentVisible},t={targets:[this.timeOfDayIconBgs[1],this.timeOfDayIconMgs[1],this.timeOfDayIconFgs[1]],alpha:0,duration:ge(800),ease:"Linear",paused:!this.parentVisible};return[e,t]}resetIcons(){this.moveBelow(this.timeOfDayIconBgs[0],this.timeOfDayIconBgs[1]),this.moveBelow(this.timeOfDayIconMgs[0],this.timeOfDayIconBgs[1]),this.moveBelow(this.timeOfDayIconFgs[0],this.timeOfDayIconFgs[1]),this.timeOfDayIconPairs.forEach((e,t)=>{e[0].setTexture(hs[this.currentTime].toLowerCase()+"_icon_"+t),e[1].setTexture(hs[this.previousTime].toLowerCase()+"_icon_"+t)}),this.timeOfDayIconMgs[0].setRotation(-90*(3.14/180)),this.timeOfDayIcons.forEach(e=>e.setAlpha(1))}tweenTimeOfDayIcon(){s.tweens.killTweensOf(this.timeOfDayIcons),this.resetIcons(),(s.timeOfDayAnimation===vg.BACK?this.getBackTween():this.getBounceTween()).forEach(e=>s.tweens.add(e)),this.timeOfDayIconPairs.forEach(e=>{const t=e.shift();t&&e.push(t)})}onEncounterPhase(e){const t=s.arena.getTimeOfDay();this.currentTime!==t&&(this.currentTime=t,this.previousTime=this.currentTime-1,this.previousTime<hs.DAWN&&(this.previousTime=hs.NIGHT),this.tweenTimeOfDayIcon())}};h(Xd,"TimeOfDayWidget");let Xl=Xd;function wr(T){if(!T||T===Us.NONE)return T;const t=`arenaFlyout:${bt(T)}`,i=f.t(t);return!i||i===t?Ri(T):i}h(wr,"getFieldEffectText");const qd=class qd extends Phaser.GameObjects.Container{flyoutWidth=170;flyoutHeight=51;translationX;anchorX;anchorY;flyoutParent;flyoutContainer;flyoutWindow;flyoutWindowHeader;flyoutTextHeader;timeOfDayWidget;flyoutTextHeaderPlayer;flyoutTextHeaderEnemy;flyoutTextHeaderField;flyoutTextPlayer;flyoutTextEnemy;flyoutTextField;fieldEffectInfo=[];onNewArenaEvent=h(e=>this.onNewArena(e),"onNewArenaEvent");onTurnEndEvent=h(e=>this.onTurnEnd(e),"onTurnEndEvent");onFieldEffectChangedEvent=h(e=>this.onFieldEffectChanged(e),"onFieldEffectChangedEvent");constructor(){super(s,0,0),this.setName("arena-flyout"),this.translationX=this.flyoutWidth,this.anchorX=0,this.anchorY=-98,this.flyoutParent=s.add.container(this.anchorX-this.translationX,this.anchorY),this.flyoutParent.setAlpha(0),this.add(this.flyoutParent),this.flyoutContainer=s.add.container(0,0),this.flyoutParent.add(this.flyoutContainer),this.flyoutWindow=Ce(0,0,this.flyoutWidth,this.flyoutHeight,!1,!1,0,0,us.THIN),this.flyoutContainer.add(this.flyoutWindow),this.flyoutWindowHeader=Ce(this.flyoutWidth/2,0,this.flyoutWidth/2,14,!1,!1,0,0,us.XTHIN),this.flyoutWindowHeader.setOrigin(),this.flyoutContainer.add(this.flyoutWindowHeader),this.flyoutTextHeader=P(this.flyoutWidth/2,0,f.t("arenaFlyout:activeBattleEffects"),O.BATTLE_INFO),this.flyoutTextHeader.setFontSize(54),this.flyoutTextHeader.setAlign("center"),this.flyoutTextHeader.setOrigin(),this.flyoutContainer.add(this.flyoutTextHeader),this.timeOfDayWidget=new Xl(this.flyoutWidth/2+this.flyoutWindowHeader.displayWidth/2),this.flyoutContainer.add(this.timeOfDayWidget),this.flyoutTextHeaderPlayer=P(6,5,f.t("arenaFlyout:player"),O.SUMMARY_BLUE),this.flyoutTextHeaderPlayer.setFontSize(54),this.flyoutTextHeaderPlayer.setAlign("left"),this.flyoutTextHeaderPlayer.setOrigin(0,0),this.flyoutContainer.add(this.flyoutTextHeaderPlayer),this.flyoutTextHeaderField=P(this.flyoutWidth/2,5,f.t("arenaFlyout:field"),O.SUMMARY_GREEN),this.flyoutTextHeaderField.setFontSize(54),this.flyoutTextHeaderField.setAlign("center"),this.flyoutTextHeaderField.setOrigin(.5,0),this.flyoutContainer.add(this.flyoutTextHeaderField),this.flyoutTextHeaderEnemy=P(this.flyoutWidth-6,5,f.t("arenaFlyout:enemy"),O.SUMMARY_RED),this.flyoutTextHeaderEnemy.setFontSize(54),this.flyoutTextHeaderEnemy.setAlign("right"),this.flyoutTextHeaderEnemy.setOrigin(1,0),this.flyoutContainer.add(this.flyoutTextHeaderEnemy),this.flyoutTextPlayer=P(6,13,"",O.BATTLE_INFO),this.flyoutTextPlayer.setLineSpacing(-1),this.flyoutTextPlayer.setFontSize(48),this.flyoutTextPlayer.setAlign("left"),this.flyoutTextPlayer.setOrigin(0,0),this.flyoutContainer.add(this.flyoutTextPlayer),this.flyoutTextField=P(this.flyoutWidth/2,13,"",O.BATTLE_INFO),this.flyoutTextField.setLineSpacing(-1),this.flyoutTextField.setFontSize(48),this.flyoutTextField.setAlign("center"),this.flyoutTextField.setOrigin(.5,0),this.flyoutContainer.add(this.flyoutTextField),this.flyoutTextEnemy=P(this.flyoutWidth-6,13,"",O.BATTLE_INFO),this.flyoutTextEnemy.setLineSpacing(-1),this.flyoutTextEnemy.setFontSize(48),this.flyoutTextEnemy.setAlign("right"),this.flyoutTextEnemy.setOrigin(1,0),this.flyoutContainer.add(this.flyoutTextEnemy),this.name="Fight Flyout",this.flyoutParent.name="Fight Flyout Parent",s.eventTarget.addEventListener(Si.NEW_ARENA,this.onNewArenaEvent),s.eventTarget.addEventListener(Si.TURN_END,this.onTurnEndEvent)}onNewArena(e){this.fieldEffectInfo.length=0,s.arena.eventTarget.addEventListener(zs.WEATHER_CHANGED,this.onFieldEffectChangedEvent),s.arena.eventTarget.addEventListener(zs.TERRAIN_CHANGED,this.onFieldEffectChangedEvent),s.arena.eventTarget.addEventListener(zs.TAG_ADDED,this.onFieldEffectChangedEvent),s.arena.eventTarget.addEventListener(zs.TAG_REMOVED,this.onFieldEffectChangedEvent)}clearText(){this.flyoutTextPlayer.text="",this.flyoutTextField.text="",this.flyoutTextEnemy.text=""}updateFieldText(){this.clearText(),this.fieldEffectInfo.sort((e,t)=>e.duration-t.duration);for(const e of this.fieldEffectInfo){let t;switch(e.effectType){case 0:t=this.flyoutTextPlayer;break;case 1:case 2:case 3:t=this.flyoutTextField;break;case 4:t=this.flyoutTextEnemy;break}t.text+=e.name,e.maxDuration!==0&&(t.text+="  "+e.duration+"/"+e.maxDuration),t.text+=`
`}}onFieldEffectChanged(e){const t=e;if(!t)return;let i;switch(t.constructor){case Yr:{const n=t;if([Us.PENDING_HEAL].includes(n.arenaTagType))return;const r=s.arena.getTag(n.arenaTagType)instanceof Lh;let o;n.arenaTagSide===Tt.BOTH?o=3:n.arenaTagSide===Tt.PLAYER?o=0:o=4;const l=r?this.fieldEffectInfo.findIndex(u=>n.arenaTagType===u.tagType&&o===u.effectType):-1;let c=wr(Us[n.arenaTagType]);if(r){if(l!==-1){const u=n.arenaTagMaxLayers>1?` (${n.arenaTagLayers})`:"";this.fieldEffectInfo[l].name=`${c}${u}`;break}n.arenaTagMaxLayers>1&&(c=`${c} (${n.arenaTagLayers})`)}this.fieldEffectInfo.push({name:c,effectType:o,maxDuration:n.maxDuration,duration:n.duration,tagType:n.arenaTagType});break}case Vy:{const n=t;i=this.fieldEffectInfo.findIndex(a=>a.tagType===n.arenaTagType),i!==-1&&this.fieldEffectInfo.splice(i,1);break}case Ji:case Ig:{const n=t,a=wr(n instanceof Ji?hn[n.oldWeatherType]:Pi[n.oldTerrainType]),r={name:wr(n instanceof Ji?hn[n.newWeatherType]:Pi[n.newTerrainType]),effectType:n instanceof Ji?1:2,maxDuration:n.maxDuration,duration:n.duration};i=this.fieldEffectInfo.findIndex(o=>[r.name,a].includes(o.name)),i===-1?r.name!==void 0&&this.fieldEffectInfo.push(r):r.name?this.fieldEffectInfo[i]=r:this.fieldEffectInfo.splice(i,1);break}}this.updateFieldText()}onTurnEnd(e){if(!e)return;const i=[];this.fieldEffectInfo.forEach(n=>i.push(n));for(const n of i)n.maxDuration!==0&&(--n.duration,n.duration<=0&&this.fieldEffectInfo.splice(this.fieldEffectInfo.indexOf(n),1));this.updateFieldText()}toggleFlyout(e){s.tweens.add({targets:this.flyoutParent,x:e?this.anchorX:this.anchorX-this.translationX,duration:ge(125),ease:"Sine.easeInOut",alpha:e?1:0,onComplete:h(()=>this.timeOfDayWidget.parentVisible=e,"onComplete")})}destroy(e){s.eventTarget.removeEventListener(Si.NEW_ARENA,this.onNewArenaEvent),s.eventTarget.removeEventListener(Si.TURN_END,this.onTurnEndEvent),s.arena.eventTarget.removeEventListener(zs.WEATHER_CHANGED,this.onFieldEffectChangedEvent),s.arena.eventTarget.removeEventListener(zs.TERRAIN_CHANGED,this.onFieldEffectChangedEvent),s.arena.eventTarget.removeEventListener(zs.TAG_ADDED,this.onFieldEffectChangedEvent),s.arena.eventTarget.removeEventListener(zs.TAG_REMOVED,this.onFieldEffectChangedEvent),super.destroy(e)}};h(qd,"ArenaFlyout");let ql=qd;const Zd=class Zd extends Phaser.GameObjects.Container{bg;candyIcon;candyOverlayIcon;countText;speciesId;tween;autoHideTimer;shown;constructor(){super(s,s.scaledCanvas.width,-s.scaledCanvas.height+15)}setup(){this.bg=s.add.nineslice(0,0,"party_exp_bar",void 0,8,18,21,5,6,4),this.bg.setOrigin(0,0),this.add(this.bg),this.candyIcon=s.add.sprite(14,0,"items","candy"),this.candyIcon.setOrigin(.5,0),this.candyIcon.setScale(.5),this.add(this.candyIcon),this.candyOverlayIcon=s.add.sprite(14,0,"items","candy_overlay"),this.candyOverlayIcon.setOrigin(.5,0),this.candyOverlayIcon.setScale(.5),this.add(this.candyOverlayIcon),this.countText=P(22,4,"",O.BATTLE_INFO),this.countText.setOrigin(0,0),this.add(this.countText),this.setVisible(!1),this.shown=!1}showStarterSpeciesCandy(e,t){return new Promise(i=>{if(this.shown)return this.speciesId===e?i():this.hide().then(()=>this.showStarterSpeciesCandy(e,t)).then(()=>i());const n=vt[e];this.candyIcon.setTint(qt(Dt(n[0]))),this.candyOverlayIcon.setTint(qt(Dt(n[1]))),this.countText.setText(`${s.gameData.starterData[e].candyCount+t} (+${t.toString()})`),this.bg.width=this.countText.displayWidth+28,s.fieldUI.bringToTop(this),this.tween&&this.tween.stop(),s.playSound("se/shing"),this.tween=s.tweens.add({targets:this,x:s.scaledCanvas.width-(this.bg.width-5),duration:500,ease:"Sine.easeOut",onComplete:h(()=>{this.tween=null,this.resetAutoHideTimer(),i()},"onComplete")}),this.setVisible(!0),this.shown=!0})}hide(){return new Promise(e=>{if(!this.shown)return e();this.autoHideTimer&&clearInterval(this.autoHideTimer),this.tween&&this.tween.stop(),this.tween=s.tweens.add({targets:this,x:s.scaledCanvas.width,duration:500,ease:"Sine.easeIn",onComplete:h(()=>{this.tween=null,this.shown=!1,this.setVisible(!1),e()},"onComplete")})})}resetAutoHideTimer(){this.autoHideTimer&&clearInterval(this.autoHideTimer),this.autoHideTimer=setTimeout(()=>{this.hide(),this.autoHideTimer=null},2500)}};h(Zd,"CandyBar");let Zl=Zd;const Qd=class Qd extends Phaser.GameObjects.Container{sprite;transitionSprite;key;variant;shown;constructor(){super(s,s.scaledCanvas.width+32,-42)}setup(){[this.sprite,this.transitionSprite]=new Array(2).fill(null).map(()=>{const e=s.add.sprite(0,0,"","");return e.setOrigin(.5,1),this.add(e),e}),this.transitionSprite.setVisible(!1),this.setVisible(!1),this.shown=!1}showCharacter(e,t){return new Promise(i=>{if(e.startsWith("c_")||(e=`c_${e}`),this.shown){if(e===this.key&&t===this.variant)return i();if(e!==this.key)return this.hide().then(()=>this.showCharacter(e,t));this.setVariant(t).then(()=>i());return}this.sprite.setTexture(e,t),s.fieldUI.bringToTop(this),s.tweens.add({targets:this,x:s.scaledCanvas.width-102,duration:750,ease:"Cubic.easeOut",onComplete:h(()=>{i()},"onComplete")}),this.setVisible(s.textures.get(e).key!==Hy),this.shown=!0,this.key=e,this.variant=t})}setVariant(e){return new Promise(t=>{s.fieldUI.bringToTop(this),this.transitionSprite.setTexture(this.key,e),this.transitionSprite.setAlpha(0),this.transitionSprite.setVisible(!0),s.tweens.add({targets:this.transitionSprite,alpha:1,duration:250,ease:"Sine.easeIn",onComplete:h(()=>{this.sprite.setTexture(this.key,e),this.transitionSprite.setVisible(!1),t()},"onComplete")}),this.variant=e})}hide(){return new Promise(e=>{if(!this.shown)return e();s.tweens.add({targets:this,x:s.scaledCanvas.width+32,duration:750,ease:"Cubic.easeIn",onComplete:h(()=>{this.shown||this.setVisible(!1),e()},"onComplete")}),this.shown=!1})}};h(Qd,"CharSprite");let Ql=Qd;const Jd=class Jd extends Phaser.GameObjects.Container{bg;pokemonIcon;expText;tween;shown;constructor(){super(s,s.scaledCanvas.width,-s.scaledCanvas.height+15)}setup(){this.bg=s.add.nineslice(0,0,"party_exp_bar",void 0,8,18,21,5,6,4),this.bg.setOrigin(0,0),this.add(this.bg),this.expText=P(22,4,"",O.BATTLE_INFO),this.expText.setOrigin(0,0),this.add(this.expText),this.setVisible(!1),this.shown=!1}showPokemonExp(e,t,i,n){return new Promise(a=>{if(this.shown)return a();this.pokemonIcon=s.addPokemonIcon(e,-8,15,0,.5),this.pokemonIcon.setScale(.5),this.add(this.pokemonIcon),i?n>200?this.expText.setText(f.t("battleScene:levelUp")):this.expText.setText(f.t("battleScene:levelUpWithLevel",{level:n})):this.expText.setText(`+${t.toString()}`),this.bg.width=this.expText.displayWidth+28,s.fieldUI.bringToTop(this),this.tween&&this.tween.stop(),this.tween=s.tweens.add({targets:this,x:s.scaledCanvas.width-(this.bg.width-5),duration:500/Math.pow(2,s.expGainsSpeed),ease:"Sine.easeOut",onComplete:h(()=>{this.tween=null,a()},"onComplete")}),this.setVisible(!0),this.shown=!0})}hide(){return new Promise(e=>{if(!this.shown)return e();this.tween&&this.tween.stop(),this.tween=s.tweens.add({targets:this,x:s.scaledCanvas.width,duration:500,ease:"Sine.easeIn",onComplete:h(()=>{this.tween=null,this.shown=!1,this.setVisible(!1),this.pokemonIcon?.destroy(),e()},"onComplete")})})}};h(Jd,"PartyExpBar");let Jl=Jd;const ep=class ep extends Phaser.GameObjects.Container{player;bg;balls;shown;constructor(e){super(s,e?s.scaledCanvas.width:0,e?-72:-144),this.player=e}setup(){this.bg=s.add.nineslice(0,0,`pb_tray_overlay_${this.player?"player":"enemy"}`,void 0,104,4,48,8,0,0),this.bg.setOrigin(this.player?1:0,0),this.add(this.bg),this.balls=new Array(6).fill(null).map((e,t)=>s.add.sprite((this.player?-83:76)+s.scaledCanvas.width*(this.player?-1:1)+10*t*(this.player?1:-1),-8,"pb_tray_ball","empty"));for(const e of this.balls)e.setOrigin(0,0),this.add(e);this.setVisible(!1),this.shown=!1}showPbTray(e){return new Promise(t=>{if(this.shown)return t();s.fieldUI.bringToTop(this),this.x+=104*(this.player?1:-1),this.bg.width=104,this.bg.alpha=1,this.balls.forEach((i,n)=>{i.x+=(s.scaledCanvas.width+104)*(this.player?1:-1);let a="ball";n>=e.length?a="empty":e[n].hp?e[n].status&&(a="status"):a="faint",i.setFrame(a)}),s.playSound("se/pb_tray_enter"),s.tweens.add({targets:this,x:`${this.player?"-":"+"}=104`,duration:500,ease:"Sine.easeIn",onComplete:h(()=>{this.balls.forEach((i,n)=>{s.tweens.add({targets:i,x:`${this.player?"-":"+"}=104`,duration:n*100,ease:"Sine.easeIn",onComplete:h(()=>s.playSound(`se/${n<e.length?"pb_tray_ball":"pb_tray_empty"}`),"onComplete")})})},"onComplete")}),this.setVisible(!0),this.shown=!0,s.time.delayedCall(1100,()=>t())})}hide(){return new Promise(e=>{if(!this.shown)return e();this.balls.forEach((t,i)=>{s.tweens.add({targets:t,x:`${this.player?"-":"+"}=${s.scaledCanvas.width}`,duration:250,delay:i*100,ease:"Sine.easeIn"})}),s.tweens.add({targets:this.bg,width:144,alpha:0,duration:500,ease:"Sine.easeIn"}),s.time.delayedCall(850,()=>{this.setVisible(!1),e()}),this.shown=!1})}};h(ep,"PokeballTray");let Za=ep;const tp=class tp extends Phaser.GameObjects.Container{defaultWidth;defaultHeight;bg;icon;titleText;scoreText;descriptionText;queue=[];playerGender;shown;constructor(){super(s,s.scaledCanvas.width,0),this.playerGender=s.gameData.gender}setup(){this.defaultWidth=200,this.defaultHeight=40,this.bg=s.add.nineslice(0,0,"achv_bar",void 0,this.defaultWidth,this.defaultHeight,41,6,16,4).setOrigin(0),this.add(this.bg),this.icon=s.add.image(4,4,"items").setOrigin(0),this.add(this.icon),this.titleText=P(40,3,"",O.MESSAGE,{fontSize:"72px"}).setOrigin(0),this.add(this.titleText),this.scoreText=P(150,3,"",O.MESSAGE,{fontSize:"72px"}).setOrigin(1,0),this.add(this.scoreText),this.descriptionText=P(43,16,"",O.WINDOW_ALT,{fontSize:"72px"}),this.descriptionText.setOrigin(0).setWordWrapWidth(664).setLineSpacing(-5),this.add(this.descriptionText),this.setScale(.5),this.shown=!1}showAchv(e){if(this.shown){this.queue.push(e);return}const t=e.getTier();this.bg.setTexture(`achv_bar${t?`_${t+1}`:""}`),this.icon.setFrame(e.getIconImage()),this.titleText.setText(e.getName(this.playerGender)),this.scoreText.setVisible(e instanceof Cr),e instanceof Cr?this.descriptionText.setText(Og(e.localizationKey)):e instanceof Wy&&this.descriptionText.setText(e.description),e instanceof Cr&&this.scoreText.setText(`+${e.score}pt`),this.bg.width=Math.max(this.defaultWidth,this.icon.displayWidth+this.titleText.displayWidth+this.scoreText.displayWidth+16),this.scoreText.x=this.bg.width-2,this.descriptionText.width=this.bg.width-this.icon.displayWidth-16,this.descriptionText.setWordWrapWidth(this.descriptionText.width*6),this.bg.height=Math.max(this.defaultHeight,this.titleText.displayHeight+this.descriptionText.displayHeight+8),this.icon.y=this.bg.height/2-this.icon.height/2,s.playSound("se/achv"),s.tweens.add({targets:this,x:s.scaledCanvas.width-this.bg.width/2,duration:500,ease:"Sine.easeOut"}),s.time.delayedCall(1e4,()=>this.hide(this.playerGender)),this.setVisible(!0),this.shown=!0}hide(e){this.shown&&s.tweens.add({targets:this,x:s.scaledCanvas.width,duration:500,ease:"Sine.easeIn",onComplete:h(()=>{if(this.shown=!1,this.setVisible(!1),this.queue.length>0){const t=this.queue.shift();t&&this.showAchv(t)}},"onComplete")})}};h(tp,"AchvBar");let eh=tp;const As={ACHIEVEMENTS:0,VOUCHERS:1},cS={de:{TextSize:"80px"}},sp=class sp extends Vt{ROWS=4;COLS=18;mainContainer;iconsContainer;headerBg;headerText;headerActionText;headerActionButton;headerBgX;iconsBg;icons;titleBg;titleText;scoreContainer;scoreText;unlockText;achvsName;achvsTotal;vouchersName;vouchersTotal;currentTotal;scrollBar;scrollCursor;cursorObj;currentPage;constructor(e=null){super(e),this.achvsTotal=Object.keys(Fe).length,this.vouchersTotal=Object.keys(Yt).length,this.scrollCursor=0}setup(){const e=this.getUi(),t=s.scaledCanvas.width,i=s.scaledCanvas.height;this.mainContainer=s.add.container(1,-i+1),this.mainContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,t,i),Phaser.Geom.Rectangle.Contains),this.headerBg=Ce(0,0,t-2,24),this.headerText=P(0,0,"",O.HEADER_LABEL).setOrigin(0).setPositionRelative(this.headerBg,8,4),this.headerActionButton=new Phaser.GameObjects.Sprite(s,0,0,"keyboard","ACTION.png").setOrigin(0).setPositionRelative(this.headerBg,236,6),this.headerActionText=P(0,0,"",O.WINDOW,{fontSize:"60px"}).setOrigin(0).setPositionRelative(this.headerBg,264,8);const n=s.gameData.gender??De.MALE,a=De[n].toLowerCase();this.achvsName=f.t("achv:achievements.name",{context:a}),this.vouchersName=f.t("voucher:vouchers"),this.iconsBg=Ce(0,this.headerBg.height,t-2,i-this.headerBg.height-68).setOrigin(0);const r=6;this.scrollBar=new Ps(this.iconsBg.width-9,this.iconsBg.y+r,4,this.iconsBg.height-r*2,this.ROWS),this.iconsContainer=s.add.container(5,this.headerBg.height+8),this.icons=[];for(let g=0;g<this.ROWS*this.COLS;g++){const C=g%this.COLS*17,E=Math.floor(g/this.COLS)*19,I=s.add.sprite(C,E,"items","unknown").setOrigin(0).setScale(.5);this.icons.push(I),this.iconsContainer.add(I)}const o=Ce(0,this.headerBg.height+this.iconsBg.height,174,24);this.titleBg=o,this.titleText=P(0,0,"",O.WINDOW).setOrigin();const l=cS[f.language]?.TextSize??this.titleText.style.fontSize;this.titleText.setFontSize(l);const c=o.x+o.width/2,u=o.y+o.height/2;this.titleText.setPosition(c,u),this.scoreContainer=s.add.container(o.x+o.width,o.y);const p=Ce(0,0,46,24);this.scoreText=P(p.width/2,p.height/2,"",O.WINDOW).setOrigin(),this.scoreContainer.add([p,this.scoreText]);const m=Ce(this.scoreContainer.x+p.width,o.y,98,24);this.unlockText=P(0,0,"",O.WINDOW).setPositionRelative(m,m.width/2,m.height/2).setOrigin();const d=Ce(0,o.y+o.height,t-2,42),y=P(0,0,"",O.WINDOW,{maxLines:2}).setWordWrapWidth(1870).setOrigin(0).setPositionRelative(d,8,4);this.message=y,this.mainContainer.add([this.headerBg,this.headerActionButton,this.headerText,this.headerActionText,this.iconsBg,this.scrollBar,this.iconsContainer,o,this.titleText,this.scoreContainer,m,this.unlockText,d,y]),e.add(this.mainContainer),this.currentPage=As.ACHIEVEMENTS,this.mainContainer.setVisible(!1)}show(e){return super.show(e),this.headerBgX=this.headerBg.getTopRight().x,this.updateAchvIcons(),this.mainContainer.setVisible(!0),this.setCursor(0),this.setScrollCursor(0),this.scrollBar.setTotalRows(Math.ceil(this.currentTotal/this.COLS)),this.scrollBar.setScrollCursor(0),this.getUi().moveTo(this.mainContainer,this.getUi().length-1),this.getUi().hideTooltip(),!0}showAchv(e){const t=s.gameData.gender??De.MALE,i=De[t].toLowerCase();e.name=f.t(`achv:${e.localizationKey}.name`,{context:i}),e.description=Og(e.localizationKey);const n=s.gameData.achvUnlocks,a=n.hasOwnProperty(e.id),r=!a&&e.secret&&(!e.parentId||!n.hasOwnProperty(e.parentId));this.titleText.setText(a?e.name:"???"),this.showText(r?"":e.description),this.scoreText.setText(`${e.score}pt`),this.unlockText.setText(a?new Date(n[e.id]).toLocaleDateString():f.t("achv:locked.name"))}showVoucher(e){const t=s.gameData.voucherUnlocks,i=t.hasOwnProperty(e.id);this.titleText.setText(Gy(e.voucherType)),this.showText(e.description),this.unlockText.setText(i?new Date(t[e.id]).toLocaleDateString():f.t("voucher:locked"))}processActionInput(){return this.setScrollCursor(0),this.currentPage===As.ACHIEVEMENTS?(this.currentPage=As.VOUCHERS,this.updateVoucherIcons()):this.currentPage===As.VOUCHERS&&(this.currentPage=As.ACHIEVEMENTS,this.updateAchvIcons()),this.setCursor(0,!0),this.scrollBar.setTotalRows(Math.ceil(this.currentTotal/this.COLS)),this.scrollBar.setScrollCursor(0),this.mainContainer.update(),!0}processUpInput(){if(this.cursor>=this.COLS)return this.setCursor(this.cursor-this.COLS);if(this.scrollCursor)return this.setScrollCursor(this.scrollCursor-1);const e=this.setScrollCursor(Math.ceil(this.currentTotal/this.COLS)-this.ROWS);let t=this.cursor+(this.ROWS-1)*this.COLS;return t>this.currentTotal-this.scrollCursor*this.COLS-1&&(t-=this.COLS),e&&this.setCursor(t)}processDownInput(){const e=Math.floor(this.cursor/this.COLS),t=this.scrollCursor*this.COLS,i=t+1<this.currentTotal;return e>=this.ROWS-1?this.scrollCursor<Math.ceil(this.currentTotal/this.COLS)-this.ROWS&&i?this.setScrollCursor(this.scrollCursor+1):this.setScrollCursor(0)&&this.setCursor(this.cursor%this.COLS):i?this.setCursor(Math.min(this.cursor+this.COLS,this.currentTotal-t-1)):!1}processLeftInput(){const e=this.scrollCursor*this.COLS;return this.cursor%this.COLS===0?this.setCursor(Math.min(this.cursor+this.COLS-1,this.currentTotal-e-1)):this.setCursor(this.cursor-1)}processRightInput(){const e=this.scrollCursor*this.COLS;return(this.cursor+1)%this.COLS===0||this.cursor+e===this.currentTotal-1?this.setCursor(this.cursor-this.cursor%this.COLS):this.setCursor(this.cursor+1)}processInput(e){let t=!1;switch(e){case b.ACTION:t=this.processActionInput();break;case b.CANCEL:t=!0,s.ui.revertMode();break;case b.UP:t=this.processUpInput();break;case b.DOWN:t=this.processDownInput();break;case b.LEFT:t=this.processLeftInput();break;case b.RIGHT:t=this.processRightInput();break}return t&&this.getUi().playSelect(),t}setCursor(e,t){const i=super.setCursor(e);let n=i;if(this.cursorObj||(this.cursorObj=s.add.nineslice(0,0,"select_cursor_highlight",void 0,16,16,1,1,1,1).setOrigin(0),this.iconsContainer.add(this.cursorObj),n=!0),this.cursorObj.setPositionRelative(this.icons[this.cursor],0,0),!n&&!t)return i;switch(this.currentPage){case As.ACHIEVEMENTS:t&&(this.titleBg.width=174,this.titleText.x=this.titleBg.width/2,this.scoreContainer.setVisible(!0)),this.showAchv(Fe[Object.keys(Fe)[e+this.scrollCursor*this.COLS]]);break;case As.VOUCHERS:t&&(this.titleBg.width=220,this.titleText.x=this.titleBg.width/2,this.scoreContainer.setVisible(!1)),this.showVoucher(Yt[Object.keys(Yt)[e+this.scrollCursor*this.COLS]]);break}return i}setScrollCursor(e){if(e===this.scrollCursor)return!1;this.scrollCursor=e,this.scrollBar.setScrollCursor(this.scrollCursor);const t=Math.min(this.cursor,this.currentTotal-this.scrollCursor*this.COLS-1);switch(t!==this.cursor&&this.setCursor(t),this.currentPage){case As.ACHIEVEMENTS:this.updateAchvIcons(),this.showAchv(Fe[Object.keys(Fe)[this.cursor+this.scrollCursor*this.COLS]]);break;case As.VOUCHERS:this.updateVoucherIcons(),this.showVoucher(Yt[Object.keys(Yt)[this.cursor+this.scrollCursor*this.COLS]]);break}return!0}updateIcons(e,t,i,n,a,r){this.headerText.text=i,this.headerActionText.text=n;const o=this.headerBgX-this.headerActionText.displayWidth-8;this.headerActionText.setX(o),this.headerActionButton.setX(o-this.headerActionButton.displayWidth-4);const l=this.scrollCursor*this.COLS,c=this.ROWS*this.COLS,u=e.slice(l,c+l);u.forEach((p,m)=>{const d=this.icons[m],y=t.hasOwnProperty(p.id);let g=!y;if(r){const C=p,E=!y&&C.secret&&(!C.parentId||!t.hasOwnProperty(C.parentId));g&&=!E,d.setFrame(E?"unknown":C.iconImage)}else d.setFrame(oi(p.voucherType));d.setVisible(!0),g?d.setTintFill(0):d.clearTint()}),u.length<this.icons.length&&this.icons.slice(u.length).forEach(p=>p.setVisible(!1)),this.currentTotal=a}updateAchvIcons(){this.updateIcons(Object.values(Fe),s.gameData.achvUnlocks,this.achvsName,this.vouchersName,this.achvsTotal,!0)}updateVoucherIcons(){this.updateIcons(Object.values(Yt),s.gameData.voucherUnlocks,this.vouchersName,this.achvsName,this.vouchersTotal,!1)}clear(){super.clear(),this.currentPage=As.ACHIEVEMENTS,this.mainContainer.setVisible(!1),this.setScrollCursor(0),this.setCursor(0,!0),this.eraseCursor()}eraseCursor(){this.cursorObj&&this.cursorObj.destroy(),this.cursorObj=null}};h(sp,"AchvsUiHandler");let th=sp;const ip=class ip extends mn{modalContainer;constructor(e=x.OPTION_SELECT){super(e)}getWindowWidth(){return 64}show(e){if(e[0].modalContainer){const{modalContainer:t}=e[0],i=super.show(e);return this.modalContainer=t,this.setupOptions(),i}return!1}setupOptions(){super.setupOptions(),this.modalContainer&&(this.optionSelectContainer.setSize(this.optionSelectContainer.height,Math.max(this.optionSelectText.displayWidth+24,this.getWindowWidth())),this.optionSelectContainer.setPositionRelative(this.modalContainer,this.optionSelectBg.width,this.optionSelectBg.height+50))}processInput(e){return e!==b.CANCEL&&e!==b.ACTION?super.processInput(e):!1}};h(ip,"AutoCompleteUiHandler");let sh=ip;const np=class np extends fs{pokeballSelectContainer;pokeballSelectBg;countsText;cursorObj;scale=.1666666667;constructor(){super(x.BALL)}setup(){const e=this.getUi();this.scale=Vi(O.WINDOW).scale;let t="";for(let a=0;a<Object.keys(s.pokeballCounts).length;a++)t+=`${Yy(a)}
`;t+=f.t("commandUiHandler:ballCancel");const i=P(0,0,t,O.WINDOW,{align:"right",maxLines:6}),n=i.displayWidth;this.pokeballSelectContainer=s.add.container(s.scaledCanvas.width-51-Math.max(64,n),-49),this.pokeballSelectContainer.setVisible(!1),e.add(this.pokeballSelectContainer),this.pokeballSelectBg=Ce(0,0,50+Math.max(64,n),32+480*this.scale),this.pokeballSelectBg.setOrigin(0,1),this.pokeballSelectContainer.add(this.pokeballSelectBg),this.pokeballSelectContainer.add(i),i.setOrigin(0,0),i.setPositionRelative(this.pokeballSelectBg,42,9),i.setLineSpacing(this.scale*72),this.countsText=P(0,0,"",O.WINDOW,{maxLines:5}),this.countsText.setPositionRelative(this.pokeballSelectBg,18,9),this.countsText.setLineSpacing(this.scale*72),this.pokeballSelectContainer.add(this.countsText),this.setCursor(0)}show(e){return super.show(e),this.updateCounts(),this.pokeballSelectContainer.setVisible(!0),this.setCursor(this.cursor),!0}processInput(e){const t=this.getUi();let i=!1;const n=Object.keys(s.pokeballCounts).length;if(e===b.ACTION||e===b.CANCEL){const a=s.phaseManager.getCurrentPhase();i=!0,e===b.ACTION&&this.cursor<n?s.pokeballCounts[this.cursor]?a.handleCommand(Ie.BALL,this.cursor)&&(s.ui.setMode(x.COMMAND,a.getFieldIndex()),s.ui.setMode(x.MESSAGE),i=!0):t.playError():(t.setMode(x.COMMAND,a.getFieldIndex()),i=!0)}else switch(e){case b.UP:i=this.setCursor(this.cursor?this.cursor-1:n);break;case b.DOWN:i=this.setCursor(this.cursor<n?this.cursor+1:0);break}return i&&t.playSelect(),i}updateCounts(){this.countsText.setText(Object.values(s.pokeballCounts).map(e=>`${e}`).join(`
`))}setCursor(e){const t=super.setCursor(e);return this.cursorObj||(this.cursorObj=s.add.image(0,0,"cursor"),this.pokeballSelectContainer.add(this.cursorObj)),this.cursorObj.setScale(this.scale*6),this.cursorObj.setPositionRelative(this.pokeballSelectBg,12,15+(6+this.cursor*96)*this.scale),t}clear(){super.clear(),this.pokeballSelectContainer.setVisible(!1),this.eraseCursor()}eraseCursor(){this.cursorObj&&this.cursorObj.destroy(),this.cursorObj=null}};h(np,"BallUiHandler");let ih=np;const ap=class ap extends Vt{levelUpStatsContainer;levelUpStatsIncrContent;levelUpStatsValuesContent;nameBox;nameText;bg;commandWindow;movesWindowContainer;nameBoxContainer;wordWrapWidth=1780;constructor(){super(x.MESSAGE)}setup(){const e=this.getUi();this.textTimer=null,this.textCallbackTimer=null,this.bg=s.add.sprite(0,0,"bg",s.windowType),this.bg.setName("sprite-battle-msg-bg"),this.bg.setOrigin(0,1),e.add(this.bg),this.commandWindow=Ce(202,0,118,48),this.commandWindow.setName("window-command"),this.commandWindow.setOrigin(0,1),this.commandWindow.setVisible(!1),e.add(this.commandWindow),this.movesWindowContainer=s.add.container(0,0),this.movesWindowContainer.setName("moves-bg"),this.movesWindowContainer.setVisible(!1);const t=Ce(0,0,243,48);t.setName("moves-window"),t.setOrigin(0,1);const i=Ce(240,0,80,48,!1,!1,-1,132);i.setName("move-details-window"),i.setOrigin(0,1),this.movesWindowContainer.add([t,i]),e.add(this.movesWindowContainer);const n=s.add.container(12,-39);e.add(n);const a=P(0,0,"",O.MESSAGE,{maxLines:2,wordWrap:{width:this.wordWrapWidth}});n.add(a),this.message=a,this.nameBoxContainer=s.add.container(0,-16),this.nameBoxContainer.setVisible(!1),this.nameBox=s.add.nineslice(0,0,"namebox",s.windowType,72,16,8,8,5,5),this.nameBox.setOrigin(0,0),this.nameText=P(8,0,"Rival",O.MESSAGE,{maxLines:1}),this.nameBoxContainer.add(this.nameBox),this.nameBoxContainer.add(this.nameText),n.add(this.nameBoxContainer),this.initPromptSprite(n);const r=s.add.container(0,0);r.setVisible(!1),e.add(r),this.levelUpStatsContainer=r;const o=P(s.scaledCanvas.width-73,-94,"",O.WINDOW,{maxLines:6});let l="";for(const m of sn)l+=`${f.t(nn(m))}
`;o.text=l,o.x-=o.displayWidth;const c=Ce(s.scaledCanvas.width,-100,80+o.displayWidth,100);c.setOrigin(1,0),r.add(c),r.add(o);const u=P(s.scaledCanvas.width-50,-94,`+
+
+
+
+
+`,O.WINDOW,{maxLines:6});r.add(u),this.levelUpStatsIncrContent=u;const p=It(s.scaledCanvas.width-7,-94,"",O.WINDOW,{maxLines:6,lineSpacing:5});p.setOrigin(1,0),p.setAlign("right"),r.add(p),this.levelUpStatsValuesContent=p}show(e){return super.show(e),this.commandWindow.setVisible(!1),this.movesWindowContainer.setVisible(!1),this.message.setWordWrapWidth(this.wordWrapWidth),!0}processInput(e){const t=this.getUi();if(this.awaitingActionInput&&(e===b.CANCEL||e===b.ACTION)&&this.onActionInput){t.playSelect();const i=this.onActionInput;return this.onActionInput=null,i(),!0}return!1}clear(){super.clear()}showText(e,t,i,n,a,r){this.hideNameText(),super.showText(e,t,i,n,a,r)}showDialogue(e,t,i,n,a,r,o){t&&this.showNameText(t),super.showDialogue(e,t,i,n,a,r,o)}promptLevelUpStats(e,t,i){return new Promise(n=>{if(!s.showLevelUpStats)return n();const a=s.getPlayerParty()[e].stats;let r="";for(const o of sn)r+=`${i?a[o]:a[o]-t[o]}
`;this.levelUpStatsValuesContent.text=r,this.levelUpStatsIncrContent.setVisible(!i),this.levelUpStatsContainer.setVisible(!0),this.awaitingActionInput=!0,this.onActionInput=()=>{if(!i)return this.promptLevelUpStats(e,[],!0).then(()=>n());this.levelUpStatsContainer.setVisible(!1),n()}})}promptIvs(e,t){return new Promise(i=>{s.executeWithSeedOffset(()=>{let n="";for(const a of sn)n+=`${this.getIvDescriptor(t[a],a,e)}
`;this.levelUpStatsValuesContent.text=n,this.levelUpStatsIncrContent.setVisible(!1),this.levelUpStatsContainer.setVisible(!0),this.awaitingActionInput=!0,this.onActionInput=()=>{this.levelUpStatsContainer.setVisible(!1),i()}},e)})}getIvDescriptor(e,t,i){const n=s.getPokemonById(i).species.getRootSpeciesId(),a=s.gameData.dexData[n].ivs,r=h((o,l,c)=>{let u;return l?c===31?u=O.PERFECT_IV:u=O.SUMMARY_GREEN:u=O.WINDOW,`[color=${le(u,!1)}][shadow=${le(u,!0)}]${o}[/shadow][/color]`},"coloredText");return e>30?r(f.t("battleMessageUiHandler:ivBest"),e>a[t],e):e===30?r(f.t("battleMessageUiHandler:ivFantastic"),e>a[t],e):e>20?r(f.t("battleMessageUiHandler:ivVeryGood"),e>a[t],e):e>10?r(f.t("battleMessageUiHandler:ivPrettyGood"),e>a[t],e):e>0?r(f.t("battleMessageUiHandler:ivDecent"),e>a[t],e):r(f.t("battleMessageUiHandler:ivNoGood"),e>a[t],e)}showNameText(e){this.nameBoxContainer.setVisible(!0),this.nameText.setText(e),this.nameBox.width=this.nameText.displayWidth+16}hideNameText(){this.nameBoxContainer.setVisible(!1)}};h(ap,"BattleMessageUiHandler");let nh=ap;const rp=class rp extends fs{challengesContainer;valuesContainer;scrollCursor;optionsBg;descriptionText;challengeLabels;monoTypeValue;cursorObj;startBg;startCursor;startText;hasSelectedChallenge;optionsWidth;widestTextBox;leftArrowGap=90;arrowSpacing=3;constructor(e=null){super(e)}setup(){const e=this.getUi();this.widestTextBox=0,this.challengesContainer=s.add.container(1,-s.scaledCanvas.height+1),this.challengesContainer.setName("challenges"),this.challengesContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,s.scaledCanvas.width,s.scaledCanvas.height),Phaser.Geom.Rectangle.Contains);const t=s.add.rectangle(-1,-1,s.scaledCanvas.width,s.scaledCanvas.height,4342338,.8);t.setName("rect-challenge-overlay"),t.setOrigin(0,0),this.challengesContainer.add(t);const i=Ce(0,0,s.scaledCanvas.width,24);i.setName("window-header-bg"),i.setOrigin(0,0);const n=P(0,0,f.t("challenges:title"),O.HEADER_LABEL);n.setName("text-header"),n.setOrigin(0,0),n.setPositionRelative(i,8,4),this.optionsWidth=s.scaledCanvas.width*.6,this.optionsBg=Ce(0,i.height,this.optionsWidth,s.scaledCanvas.height-i.height-2),this.optionsBg.setName("window-options-bg"),this.optionsBg.setOrigin(0,0);const a=Ce(0,i.height,s.scaledCanvas.width-this.optionsWidth,s.scaledCanvas.height-i.height-26);a.setName("window-desc-bg"),a.setOrigin(0,0),a.setPositionRelative(this.optionsBg,this.optionsBg.width,0),this.descriptionText=new Ag(s,a.x+6,a.y+4,"",{fontFamily:"emerald",fontSize:84,color:af.ORANGE,padding:{bottom:6},wrap:{mode:"word",width:(a.width-12)*6}}),this.descriptionText.setName("text-desc"),s.add.existing(this.descriptionText),this.descriptionText.setScale(1/6),this.descriptionText.setShadow(4,5,rf.ORANGE),this.descriptionText.setOrigin(0,0),this.startBg=Ce(0,0,a.width,24),this.startBg.setName("window-start-bg"),this.startBg.setOrigin(0,0),this.startBg.setPositionRelative(a,0,a.height),this.startText=P(0,0,f.t("challenges:noneSelected"),O.SETTINGS_LABEL),this.startText.setName("text-start"),this.startText.setOrigin(0,0),this.startText.setPositionRelative(this.startBg,(this.startBg.width-this.startText.displayWidth)/2,4),this.startCursor=s.add.nineslice(0,0,"summary_moves_cursor",void 0,a.width-8,16,1,1,1,1),this.startCursor.setName("9s-start-cursor"),this.startCursor.setOrigin(0,0),this.startCursor.setPositionRelative(this.startBg,4,3),this.startCursor.setVisible(!1),this.valuesContainer=s.add.container(0,0),this.valuesContainer.setName("values"),this.challengeLabels=[];for(let r=0;r<9;r++){const o=P(8,28+r*16,"",O.SETTINGS_LABEL);o.setName(`text-challenge-label-${r}`),o.setOrigin(0,0),this.valuesContainer.add(o);const l=s.add.image(0,0,"cursor_reverse");l.setName(`challenge-left-arrow-${r}`),l.setOrigin(0,0),l.setVisible(!1),l.setScale(.75),this.valuesContainer.add(l);const c=s.add.image(0,0,"cursor");c.setName(`challenge-right-arrow-${r}`),c.setOrigin(0,0),c.setScale(.75),c.setVisible(!1),this.valuesContainer.add(c);const u=P(0,28+r*16,"",O.SETTINGS_LABEL);u.setName(`challenge-value-text-${r}`),u.setPositionRelative(o,100,0),this.valuesContainer.add(u),this.challengeLabels[r]={label:o,value:u,leftArrow:l,rightArrow:c}}this.monoTypeValue=s.add.sprite(8,98,Kt("types")),this.monoTypeValue.setName("challenge-value-monotype-sprite"),this.monoTypeValue.setScale(.86),this.monoTypeValue.setVisible(!1),this.valuesContainer.add(this.monoTypeValue),this.challengesContainer.add(i),this.challengesContainer.add(n),this.challengesContainer.add(this.optionsBg),this.challengesContainer.add(a),this.challengesContainer.add(this.descriptionText),this.challengesContainer.add(this.startBg),this.challengesContainer.add(this.startText),this.challengesContainer.add(this.startCursor),this.challengesContainer.add(this.valuesContainer),e.add(this.challengesContainer),this.setCursor(0),this.setScrollCursor(0),this.challengesContainer.setVisible(!1)}setDescription(e){this.descriptionText.setText(`[color=${af.ORANGE}][shadow=${rf.ORANGE}]${e}`)}initLabels(){this.setDescription(s.gameMode.challenges[0].getDescription()),this.widestTextBox=0;for(let e=0;e<9;e++)if(e<s.gameMode.challenges.length){this.challengeLabels[e].label.setVisible(!0),this.challengeLabels[e].value.setVisible(!0),this.challengeLabels[e].leftArrow.setVisible(!0),this.challengeLabels[e].rightArrow.setVisible(!0);const t=P(0,0,"",O.SETTINGS_LABEL);for(let i=0;i<=s.gameMode.challenges[e].maxValue;i++)s.gameMode.challenges[e].id!==Pt.SINGLE_TYPE&&(t.setText(s.gameMode.challenges[e].getValue(i)),t.displayWidth>this.widestTextBox&&(this.widestTextBox=t.displayWidth));t.destroy()}}updateText(){this.setDescription(this.getActiveChallenge().getDescription());let e=!1;for(let t=0;t<Math.min(9,s.gameMode.challenges.length);t++){const i=s.gameMode.challenges[this.scrollCursor+t],n=this.challengeLabels[t];n.label.setText(i.getName()),n.leftArrow.setPositionRelative(n.label,this.leftArrowGap,4.5),n.leftArrow.setVisible(i.value!==0),n.rightArrow.setPositionRelative(n.leftArrow,Math.max(this.monoTypeValue.width,this.widestTextBox)+n.leftArrow.displayWidth+2*this.arrowSpacing,0),n.rightArrow.setVisible(i.value!==i.maxValue),n.rightArrow.x+n.rightArrow.width+this.optionsBg.rightWidth+this.arrowSpacing>this.optionsWidth&&n.rightArrow.setX(this.optionsWidth-this.arrowSpacing-this.optionsBg.rightWidth);const a=Math.round((n.leftArrow.x+n.rightArrow.x+n.leftArrow.displayWidth)/2);i.id===Pt.SINGLE_TYPE?(this.monoTypeValue.setX(a),this.monoTypeValue.setY(n.label.y+8),this.monoTypeValue.setFrame(i.getValue()),this.monoTypeValue.setVisible(!0),n.value.setVisible(!1),e=!0):(n.value.setText(i.getValue()),n.value.setX(a),n.value.setOrigin(.5,0),n.value.setVisible(!0))}e||this.monoTypeValue.setVisible(!1),this.hasSelectedChallenge=s.gameMode.challenges.some(t=>t.value!==0),this.hasSelectedChallenge?(this.startText.setText(f.t("common:start")),this.startText.setAlpha(1),this.startText.setPositionRelative(this.startBg,(this.startBg.width-this.startText.displayWidth)/2,4)):(this.startText.setText(f.t("challenges:noneSelected")),this.startText.setAlpha(.5),this.startText.setPositionRelative(this.startBg,(this.startBg.width-this.startText.displayWidth)/2,4)),this.challengesContainer.update()}show(e){return super.show(e),this.startCursor.setVisible(!1),this.updateChallengeArrows(!1),this.challengesContainer.setVisible(!0),this.hasSelectedChallenge=s.gameMode.challenges.some(t=>t.value!==0),this.setCursor(0),this.initLabels(),this.updateText(),this.getUi().moveTo(this.challengesContainer,this.getUi().length-1),this.getUi().hideTooltip(),!0}updateChallengeArrows(e){for(let t=0;t<Math.min(9,s.gameMode.challenges.length);t++){const i=this.challengeLabels[t];e?(i.leftArrow.setTint(8421504),i.rightArrow.setTint(8421504)):(i.leftArrow.clearTint(),i.rightArrow.clearTint())}}processInput(e){const t=this.getUi(),i=9;let n=!1;if(e===b.CANCEL)this.startCursor.visible?(this.startCursor.setVisible(!1),this.cursorObj?.setVisible(!0),this.updateChallengeArrows(this.startCursor.visible)):(s.phaseManager.toTitleScreen(),s.phaseManager.getCurrentPhase().end()),n=!0;else if(e===b.SUBMIT||e===b.ACTION)this.hasSelectedChallenge?(this.startCursor.visible?(s.phaseManager.unshiftNew("SelectStarterPhase"),s.phaseManager.getCurrentPhase().end()):(this.startCursor.setVisible(!0),this.cursorObj?.setVisible(!1),this.updateChallengeArrows(this.startCursor.visible)),n=!0):n=!1;else if(this.cursorObj?.visible&&!this.startCursor.visible)switch(e){case b.UP:if(this.cursor===0)if(this.scrollCursor===0)if(s.gameMode.challenges.length>i){const a=this.setCursor(i-1),r=this.setScrollCursor(s.gameMode.challenges.length-i);n=a&&r}else n=this.setCursor(s.gameMode.challenges.length-1);else n=this.setScrollCursor(this.scrollCursor-1);else n=this.setCursor(this.cursor-1);n&&this.updateText();break;case b.DOWN:if(this.cursor===i-1)if(this.scrollCursor<s.gameMode.challenges.length-i)n=this.setScrollCursor(this.scrollCursor+1);else{const a=this.setCursor(0),r=this.setScrollCursor(0);n=a&&r}else s.gameMode.challenges.length<i&&this.cursor===s.gameMode.challenges.length-1?n=this.setCursor(0):n=this.setCursor(this.cursor+1);n&&this.updateText();break;case b.LEFT:n=this.getActiveChallenge().decreaseValue(),n&&this.updateText();break;case b.RIGHT:n=this.getActiveChallenge().increaseValue(),n&&this.updateText();break}return n&&t.playSelect(),n}setCursor(e){let t=super.setCursor(e);return this.cursorObj||(this.cursorObj=s.add.nineslice(0,0,"summary_moves_cursor",void 0,this.optionsWidth-8,16,1,1,1,1),this.cursorObj.setOrigin(0,0),this.valuesContainer.add(this.cursorObj)),t||=!this.cursorObj.visible,this.cursorObj.setVisible(!0),this.cursorObj.setPositionRelative(this.optionsBg,4,4+(this.cursor+this.scrollCursor)*16),t}setScrollCursor(e){return e===this.scrollCursor?!1:(this.scrollCursor=e,this.setCursor(this.cursor),!0)}getActiveChallenge(){return s.gameMode.challenges[this.cursor+this.scrollCursor]}clear(){super.clear(),this.challengesContainer.setVisible(!1),this.eraseCursor()}eraseCursor(){this.cursorObj&&this.cursorObj.destroy(),this.cursorObj=null}};h(rp,"GameChallengesUiHandler");let ah=rp;const op=class op extends fs{modalContainer;modalBg;titleText;buttonContainers;buttonBgs;buttonLabels;constructor(e=null){super(e),this.buttonContainers=[],this.buttonBgs=[],this.buttonLabels=[]}getButtonTopMargin(){return 0}setup(){const e=this.getUi();this.modalContainer=s.add.container(0,0),this.modalContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,s.scaledCanvas.width,s.scaledCanvas.height),Phaser.Geom.Rectangle.Contains),this.modalBg=Ce(0,0,0,0),this.modalContainer.add(this.modalBg),this.titleText=P(0,4,"",O.SETTINGS_LABEL),this.titleText.setOrigin(.5,0),this.modalContainer.add(this.titleText),e.add(this.modalContainer);const t=this.getButtonLabels();for(const i of t)this.addButton(i);this.modalContainer.setVisible(!1)}addButton(e){const t=this.getButtonTopMargin(),i=P(0,8,e,O.TOOLTIP_CONTENT);i.setOrigin(.5,.5);const n=Ce(0,0,i.getBounds().width+8,16,!1,!1,0,0,us.THIN);n.setOrigin(.5,0),n.setInteractive(new Phaser.Geom.Rectangle(0,0,n.width,n.height),Phaser.Geom.Rectangle.Contains);const a=s.add.container(0,t);this.buttonLabels.push(i),this.buttonBgs.push(n),this.buttonContainers.push(a),a.add(n),a.add(i),this.addInteractionHoverEffect(n),this.modalContainer.add(a)}show(e){if(e.length>0&&"buttonActions"in e[0]){if(super.show(e),e[0].hasOwnProperty("fadeOut")&&typeof e[0].fadeOut=="function"){const[i,n,a,r]=this.getMargin(),o=s.add.rectangle((this.getWidth()+r+n)/2,(this.getHeight()+i+a)/2,s.scaledCanvas.width,s.scaledCanvas.height,0);o.setOrigin(.5,.5),o.setName("rect-ui-overlay-modal"),o.setAlpha(0),this.modalContainer.add(o),this.modalContainer.moveTo(o,0),s.tweens.add({targets:o,alpha:1,duration:250,ease:"Sine.easeOut",onComplete:e[0].fadeOut})}const t=e[0];this.updateContainer(t),this.modalContainer.setVisible(!0),this.getUi().moveTo(this.modalContainer,this.getUi().length-1);for(let i=0;i<this.buttonBgs.length;i++)i<this.buttonBgs.length&&this.buttonBgs[i].on("pointerdown",n=>{s.tweens.getTweensOf(this.modalContainer).length===0&&t.buttonActions[i]()});return!0}return!1}updateContainer(e){const[t,i,n,a]=this.getMargin(e),r=this.getWidth(e),o=this.getHeight(e);this.modalContainer.setPosition((s.scaledCanvas.width-(r+(i-a)))/2,(-s.scaledCanvas.height-(o+(n-t)))/2),this.modalBg.setSize(r,o);const l=this.getModalTitle(e);if(this.titleText.setText(l),this.titleText.setX(r/2),this.titleText.setVisible(!!l),this.buttonContainers.length>0){const u=this.buttonBgs.reduce((m,d)=>m+d.width,0)+12*(this.buttonBgs.length-1);let p=(this.modalBg.width-u)/2;this.buttonContainers.forEach((m,d)=>{m.setPosition(p+this.buttonBgs[d].width/2,this.modalBg.height-(this.buttonBgs[d].height+8)),p+=this.buttonBgs[d].width+12})}}hideLastButtons(e=0){const t=this.buttonBgs.length-e,i=this.buttonBgs.slice(0,t).reduce((o,l)=>o+l.width,0),n=Math.max(2,Math.min(12,(this.modalBg.width-8-i)/t)),a=i+n*Math.max(t-1,0);let r=(this.modalBg.width-a)/2;this.buttonContainers.forEach((o,l)=>{const c=l<t;o.setActive(c).setVisible(c),c&&(o.setPosition(r+this.buttonBgs[l].width/2,this.modalBg.height-(this.buttonBgs[l].height+8)),r+=this.buttonBgs[l].width+n)})}processInput(e){return!1}clear(){super.clear(),this.modalContainer.setVisible(!1),this.buttonBgs.map(e=>e.off("pointerdown"))}addInteractionHoverEffect(e){e.on("pointerover",()=>{this.setMouseCursorStyle("pointer"),e.setTint(12303291)}),e.on("pointerout",()=>{this.setMouseCursorStyle("default"),e.clearTint()})}};h(op,"ModalUiHandler");let Ui=op;const lp=class lp extends Ui{editing=!1;inputContainers=[];inputs=[];errorMessage;submitAction;cancelAction;tween;formLabels=[];getHeight(e){return 20*this.getInputFieldConfigs().length+(this.getModalTitle()?26:0)+(e?.errorMessage?12:0)+this.getButtonTopMargin()+28}getReadableErrorMessage(e){return e?e.includes("connection refused")?"Could not connect to the server":e:""}setup(){super.setup();const e=this.getInputFieldConfigs(),t=!!this.getModalTitle();e.length>0&&this.updateFields(e,t);const i=(t?31:5)+20*(e.length-1)+16+this.getButtonTopMargin(),n={fontSize:"42px",wordWrap:{width:850}};this.errorMessage=P(10,i,"",O.TOOLTIP_CONTENT,n).setColor(le(O.SUMMARY_PINK)).setShadowColor(le(O.SUMMARY_PINK,!0)).setVisible(!1),this.modalContainer.add(this.errorMessage)}updateFields(e,t){this.inputContainers=new Array(e.length),this.inputs=new Array(e.length),this.formLabels=new Array(e.length);for(const[i,n]of e.entries()){const a=(t?31:5)+20*i,r=this.getWidth()<200?Rn(n.label,25):n.label,o=P(10,a,r,O.TOOLTIP_CONTENT);o.name="formLabel"+i,this.formLabels[i]=o,this.modalContainer.add(o);const l=o.width<320?80:80-(o.width-320)/5.5,c=s.add.container(70+(80-l),(t?28:2)+20*i).setVisible(!1),u=Ce(0,0,l,16,!1,!1,0,0,us.XTHIN),p=n?.isPassword,m=n?.isReadOnly,d=Ky(4,-2,l*5.5,116,O.TOOLTIP_CONTENT,{type:p?"password":"text",maxLength:p?64:20,readOnly:m}).setOrigin(0);c.add([u,d]),this.inputContainers[i]=c,this.modalContainer.add(c),this.inputs[i]=d}}show(e){if(super.show(e)){for(const n of this.inputContainers)n.setActive(!0).setVisible(!0);const i=e[0].buttonActions??[];return[this.submitAction,this.cancelAction]=i,setTimeout(()=>{this.inputs[0]?.setFocus()},50),this.buttonBgs[0].off("pointerdown").on("pointerdown",()=>{this.submitAction&&s.tweens.getTweensOf(this.modalContainer).length===0&&this.submitAction()}),this.buttonBgs[1]?.off("pointerdown").on("pointerdown",()=>{this.cancelAction&&s.tweens.getTweensOf(this.modalContainer).length===0&&this.cancelAction()}),this.modalContainer.setAlpha(0).y+=24,this.tween=s.tweens.add({targets:this.modalContainer,duration:ge(1e3),ease:"Sine.easeInOut",y:"-=24",alpha:1}),!0}return!1}processInput(e){return e===b.SUBMIT&&this.submitAction?(this.submitAction(),!0):!1}sanitizeInputs(){for(const e of this.inputs)e.text=e.text.trim()}updateContainer(e){super.updateContainer(e),this.errorMessage.setText(this.getReadableErrorMessage(e?.errorMessage||"")).setVisible(!!this.errorMessage.text)}hide(){this.modalContainer.setVisible(!1).setActive(!1);for(const e of this.inputContainers)e.setVisible(!1).setActive(!1)}unhide(){this.modalContainer.setActive(!0).setVisible(!0);for(const e of this.inputContainers)e.setActive(!0).setVisible(!0)}clear(){super.clear(),this.modalContainer.setVisible(!1);for(const e of this.inputContainers)e.setVisible(!1).setActive(!1);this.submitAction=void 0,this.tween?.remove().destroy(),this.tween=void 0}};h(lp,"FormModalUiHandler");let Ws=lp;const hp=class hp extends Ws{ERR_PASSWORD="invalid password";ERR_ACCOUNT_EXIST="account doesn't exist";ERR_PASSWORD_MISMATCH="password doesn't match";constructor(e=null){super(e)}setup(){super.setup()}getModalTitle(e){return f.t("menu:changePassword")}getWidth(e){return 160}getMargin(e){return[0,0,48,0]}getButtonLabels(e){return[f.t("settings:buttonSubmit"),f.t("menu:cancel")]}getReadableErrorMessage(e){const t=e?.indexOf(":");switch(t>0&&(e=e.slice(0,t)),e){case this.ERR_PASSWORD:return f.t("menu:invalidRegisterPassword");case this.ERR_ACCOUNT_EXIST:return f.t("menu:accountNonExistent");case this.ERR_PASSWORD_MISMATCH:return f.t("menu:passwordNotMatchingConfirmPassword")}return super.getReadableErrorMessage(e)}getInputFieldConfigs(){const e=[];return e.push({label:f.t("menu:password"),isPassword:!0}),e.push({label:f.t("menu:confirmPassword"),isPassword:!0}),e}show(e){if(super.show(e)){const t=e[0],i=this.submitAction;this.submitAction=()=>{if(s.tweens.getTweensOf(this.modalContainer).length===0){this.submitAction=i,this.sanitizeInputs(),s.ui.setMode(x.LOADING,{buttonActions:[]});const a=h(l=>{s.ui.setMode(x.CHANGE_PASSWORD_FORM,Object.assign(t,{errorMessage:l?.trim()})),s.ui.playError()},"onFail"),[r,o]=this.inputs;if(!r?.text)return a(this.getReadableErrorMessage("invalid password"));if(r.text!==o.text)return a(this.ERR_PASSWORD_MISMATCH);at.account.changePassword({password:r.text}).then(l=>{if(!l&&i){s.ui.playSelect(),i();for(const c of this.inputs)c.setText("")}else a(l)})}};const n=this.cancelAction;return this.cancelAction=()=>{s.ui.playSelect();for(const a of this.inputs)a.setText("");n?.()},!0}return!1}clear(){super.clear(),this.setMouseCursorStyle("default")}};h(hp,"ChangePasswordFormUiHandler");let rh=hp;const cp=class cp extends fs{commandsContainer;cursorObj;teraButton;fieldIndex=0;cursor2=0;constructor(){super(x.COMMAND)}setup(){const e=this.getUi(),t=[f.t("commandUiHandler:fight"),f.t("commandUiHandler:ball"),f.t("commandUiHandler:pokemon"),f.t("commandUiHandler:run")];this.commandsContainer=s.add.container(217,-38.7),this.commandsContainer.setName("commands"),this.commandsContainer.setVisible(!1),e.add(this.commandsContainer),this.teraButton=s.add.sprite(-32,15,"button_tera"),this.teraButton.setName("terastallize-button"),this.teraButton.setScale(1.3),this.teraButton.setFrame("fire"),this.teraButton.setPipeline(s.spritePipeline,{tone:[0,0,0,0],ignoreTimeTint:!0,teraColor:pi(Me.FIRE),isTerastallized:!1}),this.commandsContainer.add(this.teraButton);for(let i=0;i<t.length;i++){const n=P(i%2===0?0:55.8,i<2?0:16,t[i],O.WINDOW_BATTLE_COMMAND);n.setName(t[i]),this.commandsContainer.add(n)}}show(e){super.show(e),this.fieldIndex=e.length>0?e[0]:0,this.commandsContainer.setVisible(!0);let t;const i=s.phaseManager.getCurrentPhase();i.is("CommandPhase")?t=i:t=s.phaseManager.getStandbyPhase(),this.canTera()?(this.teraButton.setVisible(!0),this.teraButton.setFrame(Me[s.getField()[this.fieldIndex].getTeraType()].toLowerCase())):(this.teraButton.setVisible(!1),this.getCursor()===Ie.TERA&&this.setCursor(Ie.FIGHT)),this.toggleTeraButton();const n=this.getUi().getMessageHandler();return n.bg.setVisible(!0),n.commandWindow.setVisible(!0),n.movesWindowContainer.setVisible(!1),n.message.setWordWrapWidth(this.canTera()?910:1110),n.showText(f.t("commandUiHandler:actionMessage",{pokemonName:Re(t.getPokemon())}),0),this.getCursor()===Ie.POKEMON?this.setCursor(Ie.FIGHT):this.setCursor(this.getCursor()),!0}processInput(e){const t=this.getUi();let i=!1;const n=this.getCursor();if(e===b.CANCEL||e===b.ACTION)if(e===b.ACTION)switch(n){case Ie.FIGHT:t.setMode(x.FIGHT,s.phaseManager.getCurrentPhase().getFieldIndex()),i=!0;break;case Ie.BALL:t.setModeWithoutClear(x.BALL),i=!0;break;case Ie.POKEMON:t.setMode(x.PARTY,ts.SWITCH,s.phaseManager.getCurrentPhase().getPokemon().getFieldIndex(),null,Ln.FilterNonFainted),i=!0;break;case Ie.RUN:s.phaseManager.getCurrentPhase().handleCommand(Ie.RUN,0),i=!0;break;case Ie.TERA:t.setMode(x.FIGHT,s.phaseManager.getCurrentPhase().getFieldIndex(),Ie.TERA),i=!0;break}else s.phaseManager.getCurrentPhase().cancel();else switch(e){case b.UP:(n===Ie.POKEMON||n===Ie.RUN)&&(i=this.setCursor(n-2));break;case b.DOWN:(n===Ie.FIGHT||n===Ie.BALL)&&(i=this.setCursor(n+2));break;case b.LEFT:n===Ie.BALL||n===Ie.RUN?i=this.setCursor(n-1):(n===Ie.FIGHT||n===Ie.POKEMON)&&this.canTera()&&(i=this.setCursor(Ie.TERA),this.toggleTeraButton());break;case b.RIGHT:n===Ie.FIGHT||n===Ie.POKEMON?i=this.setCursor(n+1):n===Ie.TERA&&(i=this.setCursor(Ie.FIGHT),this.toggleTeraButton());break}return i&&t.playSelect(),i}canTera(){const e=s.getField()[this.fieldIndex],t=s.arena.playerTerasUsed,i=e.isPlayer()&&zy(e),n=+(s.currentBattle.preTurnCommands[0]?.command===Ie.TERA&&this.fieldIndex>0);return i&&t+n<jy}toggleTeraButton(){this.teraButton.setPipeline(s.spritePipeline,{tone:[0,0,0,0],ignoreTimeTint:!0,teraColor:pi(s.getField()[this.fieldIndex].getTeraType()),isTerastallized:this.getCursor()===Ie.TERA})}getCursor(){return this.fieldIndex?this.cursor2:this.cursor}setCursor(e){const t=this.getCursor()!==e;return t&&(this.fieldIndex?this.cursor2=e:this.cursor=e),this.cursorObj||(this.cursorObj=s.add.image(0,0,"cursor"),this.commandsContainer.add(this.cursorObj)),e===Ie.TERA?this.cursorObj.setVisible(!1):(this.cursorObj.setPosition(-5+(e%2===1?56:0),8+(e>=2?16:0)),this.cursorObj.setVisible(!0)),t}clear(){super.clear(),this.getUi().getMessageHandler().commandWindow.setVisible(!1),this.commandsContainer.setVisible(!1),this.getUi().getMessageHandler().clearText(),this.eraseCursor()}eraseCursor(){this.cursorObj&&this.cursorObj.destroy(),this.cursorObj=null}};h(cp,"CommandUiHandler");let oh=cp;const sr=class sr extends Vt{eggGachaContainer;eggGachaMessageBox;eggGachaOptionsContainer;eggGachaOptionSelectBg;gachaContainers;gachaKnobs;gachaHatches;gachaInfoContainers;eggGachaOverlay;eggGachaSummaryContainer;voucherCountLabels;gachaCursor;cursorObj;transitioning;transitionCancelled;summaryFinished;defaultText;eggDropTweenChain;scale=.1666666667;legendaryExpiration=P(0,0,"",O.WINDOW_ALT);playTimeTimer;constructor(){super(x.EGG_GACHA),this.gachaContainers=[],this.gachaKnobs=[],this.gachaHatches=[],this.gachaInfoContainers=[],this.voucherCountLabels=[],this.defaultText=f.t("egg:selectMachine")}setupGachaType(e,t){const i=e.toLowerCase(),n=s.add.container(180*t,18),a=s.add.sprite(0,0,`gacha_${i}`).setOrigin(0),r=s.add.sprite(115,80,`gacha_underlay_${i}`).setOrigin(0),o=s.add.sprite(0,0,"gacha_eggs").setOrigin(0),l=s.add.sprite(0,0,"gacha_glass").setOrigin(0),c=s.add.container(160,46),u=f.resolvedLanguage??"en";let p=O.WINDOW_ALT,m=4,d=0,y=-20,g=6;["de","es-ES","es-419","fr","ko","pt-BR","ja","ru","tr"].includes(u)&&(p=O.SMALLER_WINDOW_ALT,m=2,d=2);let C=m,E=d;["de","es-ES","es-419","tr"].includes(u)&&(y=-25,g=10,C=-6,E=0);const I=P(m,d,f.t("egg:legendaryUpGacha"),p).setOrigin(0);switch(c.add(I),t){case ri.LEGENDARY:{["de","es-ES"].includes(u)&&I.setAlign("center");let w=0;const L=s.add.sprite(y,g,"pokemon_icons_0");["pt-BR","tr"].includes(u)&&(w=2,L.setX(y-2)),I.setX(C-w).setY(E),L.setScale(.5).setOrigin(0,.5),c.add(L)}break;case ri.MOVE:["de","es-ES","fr","pt-BR","ru","tr"].includes(u)&&I.setAlign("center").setY(0),I.setText(f.t("egg:moveUpGacha")).setX(0).setOrigin(.5,0);break;case ri.SHINY:["de","fr","ko","ru","tr"].includes(u)&&I.setAlign("center").setY(0),I.setText(f.t("egg:shinyUpGacha")).setX(0).setOrigin(.5,0);break}const A=s.add.sprite(191,89,"gacha_knob"),_=s.add.sprite(115,73,"gacha_hatch");_.setOrigin(0).setAlpha(.9),l.setAlpha(.5),n.add([o,r,a,l,A,_,c]),_.on("animationupdate",(w,L)=>r.setFrame(L.textureFrame==="4.png"?"open_hatch":"default")),this.gachaContainers.push(n),this.gachaKnobs.push(A),this.gachaHatches.push(_),this.gachaInfoContainers.push(c),this.eggGachaContainer.add(n),t===ri.LEGENDARY&&(this.legendaryExpiration.setText(this.getLegendaryGachaTimeLeft()).setFontSize("64px").setPositionRelative(a,a.width/2-this.legendaryExpiration.displayWidth/2+.3,a.height/2+12.5),n.add(this.legendaryExpiration),this.updateLegendaryGacha())}setup(){this.gachaCursor=0,this.scale=Vi(O.WINDOW).scale;const e=this.getUi();this.eggGachaContainer=s.add.container(0,-s.scaledCanvas.height).setVisible(!1),e.add(this.eggGachaContainer);const t=s.add.nineslice(0,0,"default_bg",void 0,320,180,0,0,16,0).setOrigin(0);this.eggGachaContainer.add(t);const i=s.anims.generateFrameNames("gacha_hatch",{suffix:".png",start:1,end:4});s.anims.exists("open")||s.anims.create({key:"open",frames:i,frameRate:12}),s.anims.exists("close")||s.anims.create({key:"close",frames:i.reverse(),frameRate:12});for(const[y,g]of Object.entries(ri))this.setupGachaType(y,g);let n=0;switch(f.resolvedLanguage){case"ru":n=100;break;default:n=96}this.eggGachaOptionSelectBg=Ce(0,0,n,16+576*this.scale).setOrigin(1),this.eggGachaOptionsContainer=s.add.container(s.scaledCanvas.width,148).add(this.eggGachaOptionSelectBg),this.eggGachaContainer.add(this.eggGachaOptionsContainer);const a="x1",o=[{multiplier:a,description:`1 ${f.t("egg:pull")}`,icon:oi(kt.REGULAR)},{multiplier:"x10",description:`10 ${f.t("egg:pulls")}`,icon:oi(kt.REGULAR)},{multiplier:a,description:`5 ${f.t("egg:pulls")}`,icon:oi(kt.PLUS)},{multiplier:a,description:`10 ${f.t("egg:pulls")}`,icon:oi(kt.PREMIUM)},{multiplier:a,description:`25 ${f.t("egg:pulls")}`,icon:oi(kt.GOLDEN)}],l=f.resolvedLanguage??"en",c=o.map(y=>{const g=y.description.split(" ");return g[0].length<2&&(g[0]+=["zh","ko"].includes(l.substring(0,2))?" ":"  "),y.multiplier===a&&(g[0]+=" "),`     ${y.multiplier.padEnd(5)}${g.join(" ")}`}).join(`
`),u=P(0,0,`${c}
${f.t("menu:cancel")}`,O.WINDOW).setLineSpacing(28).setFontSize("80px").setPositionRelative(this.eggGachaOptionSelectBg,16,9);this.eggGachaOptionsContainer.add(u),o.forEach((y,g)=>{const C=s.add.sprite(0,0,"items",y.icon).setScale(3*this.scale).setPositionRelative(this.eggGachaOptionSelectBg,20,9+(48+g*96)*this.scale);this.eggGachaOptionsContainer.add(C)}),this.eggGachaContainer.add(this.eggGachaOptionsContainer);for(const y of ks(kt)){const g=s.add.container(s.scaledCanvas.width-56*y,0),C=Ce(0,0,56,22).setOrigin(1,0);g.add(C);const E=P(-48,3,"0",O.WINDOW).setOrigin(0);g.add(E),this.voucherCountLabels.push(E);const I=oi(y),A=s.add.sprite(-19,2,"items",I).setOrigin(0).setScale(.5);g.add(A),this.eggGachaContainer.add(g)}this.eggGachaOverlay=s.add.rectangle(0,0,t.displayWidth,t.displayHeight,0).setOrigin(0).setAlpha(0),this.eggGachaContainer.add(this.eggGachaOverlay),this.eggGachaSummaryContainer=s.add.container().setVisible(!1),this.eggGachaContainer.add(this.eggGachaSummaryContainer);const p=Ce(0,0,320,32).setOrigin(0),m=s.add.container(0,148).add(p);this.eggGachaMessageBox=p;const d=P(8,8,"",O.WINDOW,{maxLines:2}).setOrigin(0);m.add(d),this.message=d,this.initTutorialOverlay(this.eggGachaContainer),this.eggGachaContainer.add(m),this.initPromptSprite(m),this.setCursor(0)}show(e){return super.show(e),this.getUi().showText(this.defaultText,0),this.setGachaCursor(1),this.updateLegendaryGacha(),this.updateVoucherCounts(),this.getUi().bringToTop(this.eggGachaContainer),this.eggGachaContainer.setActive(!0).setVisible(!0),ii(ds.Egg_Gacha),this.legendaryExpiration.setText(this.getLegendaryGachaTimeLeft()),this.legendaryGachaTimer(),!0}getDelayValue(e){return this.transitioning&&this.transitionCancelled&&(e=Math.ceil(e/5)),ge(e)}firstDropAnims(){return s.playSound("se/gacha_dial"),[{targets:this.gachaKnobs[this.gachaCursor],duration:this.getDelayValue(350),angle:90,ease:"Cubic.easeInOut"},{targets:this.gachaKnobs[this.gachaCursor],duration:this.getDelayValue(350),angle:0,ease:"Sine.easeInOut"},{targets:{dummy:0},dummy:1,duration:this.getDelayValue(350),onStart:h(()=>{s.playSound("se/gacha_running",{loop:!0})},"onStart")},{delay:this.getDelayValue(1250),onStart:h(()=>{s.playSound("se/gacha_dispense")},"onStart"),targets:{dummy:0},dummy:1,duration:this.getDelayValue(750),onComplete:h(()=>{s.sound.stopByKey("se/gacha_running")},"onComplete")}]}async doPullAnim(e,t){let i;const n=this.gachaHatches[this.gachaCursor],a=t?1.25:1;t&&(n.anims.timeScale=a);const r=new Promise(l=>{i=l}),o=t?[]:this.firstDropAnims();return o.push({targets:e,duration:this.getDelayValue(350/a),y:95,ease:"Bounce.easeOut"},{onStart:h(()=>{s.playSound("se/pb_catch"),this.gachaHatches[this.gachaCursor].play("open")},"onStart"),targets:e,delay:this.getDelayValue(125/a),duration:this.getDelayValue(350/a),props:{scale:{value:.75,ease:"Sine.easeIn"},y:{value:110,ease:"Back.easeOut"}}},{onStart:h(()=>{this.gachaHatches[this.gachaCursor].play("close")},"onStart"),targets:e,y:200,duration:this.getDelayValue(350/a),ease:"Cubic.easeIn"}),this.eggDropTweenChain=s.tweens.chain({onComplete:h(()=>{this.eggDropTweenChain=void 0,n.anims.timeScale=1,i()},"onComplete"),tweens:o}),r}pullEggs(e){const t=[];for(let i=1;i<=e;i++){const n={pulled:!0,sourceType:this.gachaCursor};if(i===e){const r=this.getGuaranteedEggTierFromPullCount(e);r!==$i.COMMON&&!t.some(o=>o.tier>=r)&&(n.tier=r)}const a=new _i(n);t.push(a)}return $y(t)}async pull(e=0){ie.EGG_GACHA_PULL_COUNT_OVERRIDE&&(e=ie.EGG_GACHA_PULL_COUNT_OVERRIDE);const t=this.pullEggs(e);if(this.eggGachaOptionsContainer.setVisible(!1),this.setTransitioning(!0),!await(s.currentBattle?s.gameData.saveAll(!0,!0,!0):s.gameData.saveSystem()).then(a=>a?!0:(s.reset(!0),!1)))return;const n=this.gachaContainers[this.gachaCursor];for(let a=0;a<e&&!this.transitionCancelled;++a){const r=s.add.sprite(127,75,"egg",`egg_${t[a].getKey()}`).setScale(.5);n.addAt(r,2),await this.doPullAnim(r,a).finally(()=>n.remove(r,!0))}this.showSummary(t)}getGuaranteedEggTierFromPullCount(e){switch(e){case 10:return $i.RARE;case 25:return $i.EPIC;default:return $i.COMMON}}showSummary(e){const t=this.getDelayValue(750);this.summaryFinished=!1,this.transitionCancelled=!1,this.setTransitioning(!0),this.eggGachaSummaryContainer.setVisible(!0);const i=e.length<20?1:.5;s.tweens.add({targets:this.eggGachaOverlay,alpha:.5,ease:"Sine.easeOut",duration:t,onComplete:h(()=>{const a=Math.ceil(e.length/5),r=Math.min(e.length,5),o=this.eggGachaOverlay.displayHeight-this.eggGachaMessageBox.displayHeight;e.map((c,u)=>{const p=u%5,m=Math.floor(u/5),d=this.eggGachaOverlay.displayWidth/(r+2),y=o/(a+2),g=y/2*(m/Math.max(a-1,1))+y/4,C=s.add.container(d*(p+1)+d*.5,y*(m+1)+g);C.setScale(1e-4);const E=s.add.sprite(0,0,"egg",`egg_${c.getKey()}`);C.add(E);const I=P(0,14,c.getEggDescriptor(),O.PARTY,{align:"center"});return I.setOrigin(.5,0),I.setTint(Xy(c.isManaphyEgg()?$i.EPIC:c.tier)),C.add(I),this.eggGachaSummaryContainer.addAt(C,0),C}).forEach((c,u)=>{const p=this.transitionCancelled?0:this.getDelayValue(u*100);s.time.delayedCall(p,()=>s.tweens.add({targets:c,duration:this.getDelayValue(350),scale:i,ease:"Sine.easeOut",onComplete:h(()=>{u===e.length-1&&(this.setTransitioning(!1),this.summaryFinished=!0)},"onComplete")}))})},"onComplete")})}hideSummary(){this.setTransitioning(!0),s.tweens.add({targets:[this.eggGachaOverlay,this.eggGachaSummaryContainer],alpha:0,duration:this.getDelayValue(250),ease:"Cubic.easeIn",onComplete:h(()=>{this.eggGachaSummaryContainer.setVisible(!1).setAlpha(1).removeAll(!0),this.setTransitioning(!1),this.summaryFinished=!1,this.eggGachaOptionsContainer.setVisible(!0)},"onComplete")})}updateLegendaryGacha(){const e=this.gachaInfoContainers[ri.LEGENDARY],t=zt(qy(Date.now()));e.getAt(1).setTexture(t.getIconAtlasKey(),t.getIconId(!1))}consumeVouchers(e,t){s.gameData.voucherCounts[e]=Math.max(s.gameData.voucherCounts[e]-t,0),this.updateVoucherCounts()}updateVoucherCounts(){this.voucherCountLabels.forEach((e,t)=>{e.setText(s.gameData.voucherCounts[t].toString())})}showText(e,t,i,n,a,r){e||(e=this.defaultText),e?.indexOf(`
`)===-1?(this.eggGachaMessageBox.setSize(320,32),this.eggGachaMessageBox.setY(0),this.message.setY(8)):(this.eggGachaMessageBox.setSize(320,46),this.eggGachaMessageBox.setY(-14),this.message.setY(-6)),super.showText(e,t,i,n,a,r)}showError(e){this.showText(e,void 0,()=>this.showText(this.defaultText),ge(1500))}setTransitioning(e){this.transitioning!==e&&(this.transitioning=e,this.transitionCancelled=!1)}static cursorToVoucher(e){switch(e){case 0:return[kt.REGULAR,1,1];case 1:return[kt.REGULAR,10,10];case 2:return[kt.PLUS,1,5];case 3:return[kt.PREMIUM,1,10];case 4:return[kt.GOLDEN,1,25]}}handleVoucherSelectAction(e){if(e<0||e>5)return;const t=this.getUi(),i=sr.cursorToVoucher(e);if(!i)return t.revertMode(),!0;const[n,a,r]=i;let o;const l=ie.EGG_FREE_GACHA_PULLS_OVERRIDE;return!l&&s.gameData.eggs.length+r>99?o="egg:tooManyEggs":!l&&s.gameData.voucherCounts[n]<a&&(o="egg:notEnoughVouchers"),o?(this.showError(f.t(o)),!1):(l||this.consumeVouchers(n,a),this.pull(r),!0)}processTransitionInput(e){if(!this.transitionCancelled&&(e===b.ACTION||e===b.CANCEL))return this.transitionCancelled=!0,this.eggDropTweenChain?.setTimeScale(50),!0}processNormalInput(e){const t=this.getUi();let i;switch(e){case b.ACTION:return this.handleVoucherSelectAction(this.cursor);case b.CANCEL:t.revertMode(),i=!0;break;case b.UP:this.cursor&&(i=this.setCursor(this.cursor-1));break;case b.DOWN:this.cursor<5&&(i=this.setCursor(this.cursor+1));break;case b.LEFT:this.gachaCursor&&(i=this.setGachaCursor(this.gachaCursor-1));break;case b.RIGHT:this.gachaCursor<Object.keys(ri).length-1&&(i=this.setGachaCursor(this.gachaCursor+1));break}return i||void 0}processSummaryInput(e){if(this.summaryFinished&&(e===b.ACTION||e===b.CANCEL))return this.hideSummary(),!0}processInput(e){let t;return this.transitioning?t=this.processTransitionInput(e):this.eggGachaSummaryContainer.visible?t=this.processSummaryInput(e):t=this.processNormalInput(e),t===void 0?!1:(t?this.getUi().playSelect():this.getUi().playError(),!0)}setCursor(e){const t=super.setCursor(e);return this.cursorObj||(this.cursorObj=s.add.image(0,0,"cursor"),this.eggGachaOptionsContainer.add(this.cursorObj)),this.cursorObj.setScale(this.scale*6),this.cursorObj.setPositionRelative(this.eggGachaOptionSelectBg,10,9+(48+this.cursor*96)*this.scale),t}setGachaCursor(e){const i=this.gachaCursor!==e;return i&&(this.gachaCursor=e,this.setTransitioning(!0),s.tweens.add({targets:this.gachaContainers,duration:this.eggGachaContainer.visible?500:0,x:h((n,a,r,o)=>180*(o-e),"x"),ease:"Cubic.easeInOut",onComplete:h(()=>this.setTransitioning(!1),"onComplete")})),i}legendaryGachaTimer(){this.playTimeTimer&&(this.playTimeTimer.destroy(),this.playTimeTimer=null),this.playTimeTimer=s.time.addEvent({loop:!0,delay:ge(1e3),callback:h(()=>{this.legendaryExpiration.setText(this.getLegendaryGachaTimeLeft())},"callback")})}getLegendaryGachaTimeLeft(){const e=864e5-Date.now()%864e5,t=`${Math.floor(e/36e5)}`,i=`${Math.floor(e%36e5/6e4)}`,n=`${Math.floor(e%6e4/1e3)}`;return`${t.padStart(2,"0")}:${i.padStart(2,"0")}:${n.padStart(2,"0")}`}clear(){super.clear(),this.setGachaCursor(-1),this.eggGachaContainer.setVisible(!1),this.playTimeTimer&&(this.playTimeTimer.destroy(),this.playTimeTimer=null),this.eggGachaContainer.setActive(!1)}};h(sr,"EggGachaUiHandler");let lh=sr;const up=class up extends fs{eggHatchContainer;eventTarget=new EventTarget;constructor(){super(x.EGG_HATCH_SCENE)}setup(){this.eggHatchContainer=s.add.container(0,-s.scaledCanvas.height),s.fieldUI.add(this.eggHatchContainer);const e=s.anims.generateFrameNames("egg_lightrays",{start:0,end:3});s.anims.exists("egg_lightrays")||s.anims.create({key:"egg_lightrays",frames:e,frameRate:32})}show(e){return super.show(e),this.getUi().showText("",0),s.setModifiersVisible(!1),!0}processInput(e){if(e===b.ACTION||e===b.CANCEL){const t=s.phaseManager.getCurrentPhase();if(t.is("EggHatchPhase")&&t.trySkip())return!0}return s.ui.getMessageHandler().processInput(e)}setCursor(e){return!1}clear(){super.clear(),this.eggHatchContainer.removeAll(!0),this.getUi().hideTooltip()}};h(up,"EggHatchSceneUiHandler");let hh=up;const dp=class dp{ROWS;COLUMNS;handler;totalElements;cursor;scrollCursor;scrollBar;updateGridCallback;updateDetailsCallback;constructor(e,t,i){this.handler=e,this.ROWS=t,this.COLUMNS=i,this.scrollCursor=0,this.cursor=0,this.totalElements=t*i}withScrollBar(e){return this.scrollBar=e,this.scrollBar.setTotalRows(Math.ceil(this.totalElements/this.COLUMNS)),this}withUpdateGridCallBack(e){return this.updateGridCallback=e,this}withUpdateSingleElementCallback(e){return this.updateDetailsCallback=e,this}setTotalElements(e){this.totalElements=e,this.scrollBar&&this.scrollBar.setTotalRows(Math.ceil(this.totalElements/this.COLUMNS)),this.setScrollCursor(0)}getItemOffset(){return this.scrollCursor*this.COLUMNS}processInput(e){let t=!1;const i=Math.min(this.ROWS,Math.ceil(this.totalElements/this.COLUMNS)),n=Math.max(0,Math.ceil(this.totalElements/this.COLUMNS)-i),a=Math.floor(this.cursor/this.COLUMNS),r=this.cursor%this.COLUMNS,o=this.scrollCursor*this.COLUMNS,l=Math.min(this.totalElements-1,this.totalElements-n*this.COLUMNS-1);switch(e){case b.UP:if(a>0)t=this.setCursor(this.cursor-this.COLUMNS);else if(this.scrollCursor>0)t=this.setScrollCursor(this.scrollCursor-1);else{let c=this.cursor+(i-1)*this.COLUMNS;c>l&&(c-=this.COLUMNS),t=this.setScrollCursor(n,c)}break;case b.DOWN:a<i-1?t=this.setCursor(Math.min(this.cursor+this.COLUMNS,this.totalElements-o-1)):this.scrollCursor<n?t=this.setScrollCursor(this.scrollCursor+1):t=this.setScrollCursor(0,this.cursor%this.COLUMNS);break;case b.LEFT:r>0?t=this.setCursor(this.cursor-1):this.scrollCursor===n&&a===i-1?t=this.setCursor(l):t=this.setCursor(this.cursor+this.COLUMNS-1);break;case b.RIGHT:r<this.COLUMNS-1&&this.cursor+o<this.totalElements-1?t=this.setCursor(this.cursor+1):t=this.setCursor(this.cursor-r);break}return t}reset(){this.setScrollCursor(0),this.setCursor(0)}setCursor(e){return this.cursor=e,this.handler.setCursor(e)}setScrollCursor(e,t){const i=e!==this.scrollCursor;i&&(this.scrollCursor=e,this.scrollBar&&this.scrollBar.setScrollCursor(e),this.updateGridCallback&&this.updateGridCallback());let n=!1;const a=this.cursor+this.scrollCursor*this.COLUMNS;return t!==void 0?n=this.setCursor(t):a>=this.totalElements?n=this.setCursor(this.totalElements-this.scrollCursor*this.COLUMNS-1):i&&this.updateDetailsCallback&&this.updateDetailsCallback(a),i||n}};h(dp,"ScrollableGridHelper");let Qa=dp;const pp=class pp extends Vt{ROWS=9;COLUMNS=11;eggListContainer;eggListIconContainer;eggIcons;eggSprite;eggNameText;eggDateText;eggHatchWavesText;eggGachaInfoText;eggListMessageBoxContainer;cursorObj;scrollGridHandler;iconAnimHandler;constructor(){super(x.EGG_LIST)}setup(){const e=this.getUi();this.eggListContainer=s.add.container(0,-s.scaledCanvas.height).setVisible(!1),e.add(this.eggListContainer);const t=s.add.rectangle(0,0,s.scaledCanvas.width,s.scaledCanvas.height,26720).setOrigin(0),i=s.add.image(0,0,"egg_list_bg").setOrigin(0);this.iconAnimHandler=new lr,this.iconAnimHandler.setup(),this.eggNameText=P(8,68,"",O.SUMMARY).setOrigin(0),this.eggDateText=P(8,91,"",O.EGG_LIST),this.eggHatchWavesText=P(8,108,"",O.EGG_LIST).setWordWrapWidth(540),this.eggGachaInfoText=P(8,152,"",O.EGG_LIST).setWordWrapWidth(540),this.eggListIconContainer=s.add.container(113,5),this.cursorObj=s.add.image(0,0,"select_cursor").setOrigin(0),this.eggSprite=s.add.sprite(54,37,"egg");const n=new Ps(310,5,4,170,this.ROWS);this.scrollGridHandler=new Qa(this,this.ROWS,this.COLUMNS).withScrollBar(n).withUpdateGridCallBack(()=>this.updateEggIcons()).withUpdateSingleElementCallback(r=>this.setEggDetails(r)),this.eggListMessageBoxContainer=s.add.container(0,s.scaledCanvas.height).setVisible(!1);const a=Ce(1,-1,318,28).setOrigin(0,1);this.eggListMessageBoxContainer.add(a),this.message=P(8,-8,"",O.WINDOW,{maxLines:1}).setActive(!1).setVisible(!1),this.cursor=-1,this.eggListContainer.add([t,i,Ce(1,85,106,22),Ce(1,102,106,50,!0),Ce(1,147,106,32,!0),Ce(107,1,212,178),this.eggNameText,this.eggDateText,this.eggHatchWavesText,this.eggGachaInfoText,this.eggListIconContainer,this.cursorObj,this.eggSprite,n])}show(e){return super.show(e),this.initEggIcons(),this.getUi().bringToTop(this.eggListContainer),this.eggListContainer.setVisible(!0),this.scrollGridHandler.setTotalElements(s.gameData.eggs.length),this.updateEggIcons(),this.setCursor(0),!0}initEggIcons(){this.eggIcons=[];for(let e=0;e<Math.min(this.ROWS*this.COLUMNS,s.gameData.eggs.length);e++){const t=e%this.COLUMNS*18,i=Math.floor(e/this.COLUMNS)*18,n=s.add.sprite(t-2,i+2,"egg_icons").setScale(.5).setOrigin(0);this.eggListIconContainer.add(n),this.eggIcons.push(n)}}updateEggIcons(){const e=this.scrollGridHandler.getItemOffset(),t=Math.min(this.eggIcons.length,s.gameData.eggs.length-e);this.eggIcons.forEach((i,n)=>{if(n!==this.cursor&&this.iconAnimHandler.addOrUpdate(i,Ft.NONE),n<t){const a=s.gameData.eggs[n+e];i.setFrame(a.getKey()).setVisible(!0)}else i.setVisible(!1)})}setEggDetails(e){const t=s.gameData.eggs[e];this.eggSprite.setFrame(`egg_${t.getKey()}`),this.eggNameText.setText(`${f.t("egg:egg")} (${t.getEggDescriptor()})`),this.eggDateText.setText(new Date(t.timestamp).toLocaleString(void 0,{weekday:"short",year:"numeric",month:"2-digit",day:"numeric"})),this.eggHatchWavesText.setText(t.getEggHatchWavesMessage()),this.eggGachaInfoText.setText(t.getEggTypeDescriptor())}processInput(e){const t=this.getUi();let i=!1;return e===b.CANCEL?(t.revertMode(),i=!0):i=this.scrollGridHandler.processInput(e),i&&t.playSelect(),i}setCursor(e){let t=!1;const i=this.cursor;if(t=super.setCursor(e),t){const n=this.eggIcons[e];this.cursorObj.setPositionRelative(n,114,5),i>-1&&this.iconAnimHandler.addOrUpdate(this.eggIcons[i],Ft.NONE),this.iconAnimHandler.addOrUpdate(n,Ft.ACTIVE),this.setEggDetails(e+this.scrollGridHandler.getItemOffset())}return t}clear(){super.clear(),this.scrollGridHandler.reset(),this.cursor=-1,this.eggListContainer.setVisible(!1),this.iconAnimHandler.removeAll(),this.eggListIconContainer.removeAll(!0),this.eggIcons=[]}};h(pp,"EggListUiHandler");let ch=pp;const fp=class fp extends Phaser.GameObjects.Container{species;icon;shinyIcon;hiddenAbilityIcon;pokeballIcon;eggMoveIcon;constructor(e,t,i){super(s,e,t);const n=i.pokemon;this.species=n.species;const a=2,r=12,o=n.species,l=n.gender===Ut.FEMALE,c=n.formIndex,u=n.variant,p=n.shiny,m=s.add.sprite(-a,a,o.getIconAtlasKey(c,p,u));m.setScale(.5),m.setOrigin(0,0),m.setFrame(o.getIconId(l,c,p,u)),this.icon=m,this.checkIconId(l,c,p,u),this.add(this.icon),this.shinyIcon=s.add.image(r,a,"shiny_star_small"),this.shinyIcon.setOrigin(0,0),this.shinyIcon.setScale(.5),this.add(this.shinyIcon);const d=s.add.image(r,a*4,"ha_capsule");d.setOrigin(0,0),d.setScale(.5),this.hiddenAbilityIcon=d,this.add(this.hiddenAbilityIcon);const y=s.add.image(r,a*7,"icon_owned");y.setOrigin(0,0),y.setScale(.5),this.pokeballIcon=y,this.add(this.pokeballIcon);const g=s.add.image(0,a,"icon_egg_move");g.setOrigin(0,0),g.setScale(.5),this.eggMoveIcon=g,this.add(this.eggMoveIcon)}updateAndAnimate(e,t){const i=e.pokemon;this.species=i.species;const a=e.dexEntryBeforeUpdate.caughtAttr,r=BigInt(1<<(i.shiny?1:0)),o=BigInt(1<<i.variant+4),l=(r&a)===BigInt(0)||(o&a)===BigInt(0),c=(BigInt(1<<i.formIndex)*F.DEFAULT_FORM&a)===BigInt(0),u=i.gender===Ut.FEMALE,p=i.formIndex,m=i.variant,d=i.shiny;this.icon.setTexture(this.species.getIconAtlasKey(p,d,m)),this.icon.setFrame(this.species.getIconId(u,p,d,m)),this.checkIconId(u,p,d,m),this.shinyIcon.setVisible(i.shiny),this.shinyIcon.setTint(Et(i.variant)),this.eggMoveIcon.setVisible(e.eggMoveUnlocked),this.hiddenAbilityIcon.setVisible(i.abilityIndex===2),this.pokeballIcon.setVisible(!a||c),!a||l||c?t.addOrUpdate(this.icon,Ft.PASSIVE):t.addOrUpdate(this.icon,Ft.NONE)}checkIconId(e,t,i,n){this.icon.frame.name!==this.species.getIconId(e,t,i,n)&&(`${this.species.name}`,this.icon.setTexture(this.species.getIconAtlasKey(t,!1,n)),this.icon.setFrame(this.species.getIconId(e,t,!1,n)))}};h(fp,"HatchedPokemonContainer");let uh=fp;const gp=class gp extends Tn{currentPokemonSprite;pokemonNumberText;pokemonNameText;pokemonEggMovesContainer;pokemonEggMoveContainers;pokemonEggMoveBgs;pokemonEggMoveLabels;pokemonHatchedIcon;pokemonListContainer;pokemonCandyIcon;pokemonCandyOverlayIcon;pokemonCandyCountText;constructor(e,t=115,i=9){super(t,i),this.pokemonListContainer=e}setup(){super.setup(),super.changeToEggSummaryLayout(),this.currentPokemonSprite=s.add.sprite(54,80,"pkmn__sub"),this.currentPokemonSprite.setScale(.8),this.currentPokemonSprite.setPipeline(s.spritePipeline,{tone:[0,0,0,0],ignoreTimeTint:!0}),this.pokemonListContainer.add(this.currentPokemonSprite),this.pokemonNumberText=P(84,107,"0000",O.EGG_SUMMARY_DEX,{fontSize:78}),this.pokemonNumberText.setOrigin(0,0),this.pokemonListContainer.add(this.pokemonNumberText),this.pokemonNameText=P(7,109,"",O.EGG_SUMMARY_NAME,{fontSize:64}),this.pokemonNameText.setOrigin(0,0),this.pokemonListContainer.add(this.pokemonNameText),this.pokemonHatchedIcon=s.add.sprite(-5,90,"egg_icons"),this.pokemonHatchedIcon.setOrigin(0,.2),this.pokemonHatchedIcon.setScale(.8),this.pokemonListContainer.add(this.pokemonHatchedIcon),this.pokemonCandyIcon=s.add.sprite(4.5,40,"candy"),this.pokemonCandyIcon.setScale(.5),this.pokemonCandyIcon.setOrigin(0,0),this.pokemonListContainer.add(this.pokemonCandyIcon),this.pokemonCandyOverlayIcon=s.add.sprite(4.5,40,"candy_overlay"),this.pokemonCandyOverlayIcon.setScale(.5),this.pokemonCandyOverlayIcon.setOrigin(0,0),this.pokemonListContainer.add(this.pokemonCandyOverlayIcon),this.pokemonCandyCountText=P(14,40,"x0",O.SUMMARY,{fontSize:"56px"}),this.pokemonCandyCountText.setOrigin(0,0),this.pokemonListContainer.add(this.pokemonCandyCountText),this.pokemonEggMoveContainers=[],this.pokemonEggMoveBgs=[],this.pokemonEggMoveLabels=[],this.pokemonEggMovesContainer=s.add.container(0,200),this.pokemonEggMovesContainer.setVisible(!1),this.pokemonEggMovesContainer.setScale(.5);for(let e=0;e<4;e++){const t=s.add.container(0,0+6*e),i=s.add.nineslice(70,0,"type_bgs","unknown",92,14,2,2,2,2);i.setOrigin(1,0);const n=P(70-i.width/2,0,"???",O.MOVE_LABEL);n.setOrigin(.5,0),this.pokemonEggMoveBgs.push(i),this.pokemonEggMoveLabels.push(n),t.add(i),t.add(n),t.setScale(.44),this.pokemonEggMoveContainers.push(t),this.pokemonEggMovesContainer.add(t)}super.add(this.pokemonEggMoveContainers)}hideDisplayPokemon(){this.currentPokemonSprite.setVisible(!1)}displayPokemon(e){const t=e.species,i=e.gender===Ut.FEMALE,n=e.formIndex,a=e.shiny,r=e.variant;this.currentPokemonSprite.setVisible(!1),t.loadAssets(i,n,a,r,!0).then(()=>{is(t.speciesId,e.formIndex).cry(),this.currentPokemonSprite.play(t.getSpriteKey(i,n,a,r)),this.currentPokemonSprite.setPipelineData("shiny",a),this.currentPokemonSprite.setPipelineData("variant",r),this.currentPokemonSprite.setPipelineData("spriteKey",t.getSpriteKey(i,n,a,r)),this.currentPokemonSprite.setVisible(!0)})}showHatchInfo(e){this.pokemonEggMovesContainer.setVisible(!0);const t=e.pokemon,i=t.species;this.displayPokemon(t),super.show(t,!1,1,e.getDex(),e.getStarterEntry(),!0);const n=vt[i.speciesId];this.pokemonCandyIcon.setTint(qt(Dt(n[0]))),this.pokemonCandyIcon.setVisible(!0),this.pokemonCandyOverlayIcon.setTint(qt(Dt(n[1]))),this.pokemonCandyOverlayIcon.setVisible(!0),this.pokemonCandyCountText.setText(`${s.gameData.starterData[i.speciesId].candyCount}`),this.pokemonCandyCountText.setVisible(!0),this.pokemonNumberText.setText(Hs(i.speciesId,4)),this.pokemonNameText.setText(i.name);const a=i&&Ht.hasOwnProperty(i.speciesId);for(let r=0;r<4;r++){const o=a?We[Ht[i.speciesId][r]]:null,l=o&&s.gameData.starterData[i.speciesId].eggMoves&Math.pow(2,r);this.pokemonEggMoveBgs[r].setFrame(Me[o?o.type:Me.UNKNOWN].toString().toLowerCase()),this.pokemonEggMoveLabels[r].setText(o&&l?o.name:"???"),!(o&&e.starterDataEntryBeforeUpdate.eggMoves&Math.pow(2,r))&&l&&this.pokemonEggMoveLabels[r].setText("(+) "+o.name)}this.pokemonEggMovesContainer.setVisible(!0),i.speciesId===ye.MANAPHY||i.speciesId===ye.PHIONE?this.pokemonHatchedIcon.setFrame("manaphy"):this.pokemonHatchedIcon.setFrame(ci(i))}};h(gp,"PokemonHatchInfoContainer");let dh=gp;const Mr=112,kr=9,aa=9,qs=11,Zi=18,mp=class mp extends Vt{eggHatchContainer;summaryContainer;pokemonIconsContainer;pokemonContainers;infoContainer;iconAnimHandler;eggHatchBg;eggHatchData;scrollGridHandler;cursorObj;blockExit;eventTarget=new EventTarget;constructor(){super(x.EGG_HATCH_SUMMARY)}setup(){const e=this.getUi();this.summaryContainer=s.add.container(0,-s.scaledCanvas.height),this.summaryContainer.setVisible(!1),e.add(this.summaryContainer),this.eggHatchContainer=s.add.container(0,-s.scaledCanvas.height),this.eggHatchContainer.setVisible(!1),e.add(this.eggHatchContainer),this.iconAnimHandler=new lr,this.iconAnimHandler.setup(),this.eggHatchBg=s.add.image(0,0,"egg_summary_bg"),this.eggHatchBg.setOrigin(0,0),this.eggHatchContainer.add(this.eggHatchBg),this.cursorObj=s.add.image(0,0,"select_cursor"),this.cursorObj.setOrigin(0,0),this.summaryContainer.add(this.cursorObj),this.pokemonContainers=[],this.pokemonIconsContainer=s.add.container(Mr,kr),this.summaryContainer.add(this.pokemonIconsContainer),this.infoContainer=new dh(this.summaryContainer),this.infoContainer.setup(),this.infoContainer.changeToEggSummaryLayout(),this.infoContainer.setVisible(!0),this.summaryContainer.add(this.infoContainer);const t=new Ps(Mr+qs*Zi,kr+3,4,s.scaledCanvas.height-20,aa);this.summaryContainer.add(t),this.scrollGridHandler=new Qa(this,aa,qs).withScrollBar(t).withUpdateGridCallBack(()=>this.updatePokemonIcons()).withUpdateSingleElementCallback(i=>this.infoContainer.showHatchInfo(this.eggHatchData[i])),this.cursor=-1}clear(){super.clear(),this.scrollGridHandler.reset(),this.cursor=-1,this.summaryContainer.setVisible(!1),this.pokemonIconsContainer.removeAll(!0),this.pokemonContainers=[],this.eggHatchBg.setVisible(!1),this.getUi().hideTooltip();const e=s.getActiveKeys();Object.keys(s.anims.anims.entries).forEach(n=>{n.startsWith("pkmn__")&&!e.includes(n)&&s.anims.remove(n)}),Object.keys(s.cache.audio.entries.entries).forEach(n=>{n.startsWith("cry/")&&!e.includes(n)&&delete s.cache.audio.entries.entries[n]}),this.eggHatchData.length=0,this.iconAnimHandler.removeAll()}show(e){super.show(e),e.length>0&&(this.eggHatchData=e[0].sort(h(function(n,a){const r=n.pokemon.species,o=a.pokemon.species;return ci(r)<ci(o)?-1:ci(r)>ci(o)?1:r.speciesId<o.speciesId?-1:r.speciesId>o.speciesId?1:0},"sortHatchData"))),this.getUi().bringToTop(this.summaryContainer),this.summaryContainer.setVisible(!0),this.eggHatchContainer.setVisible(!0),this.eggHatchBg.setVisible(!0),this.infoContainer.hideDisplayPokemon(),this.scrollGridHandler.setTotalElements(this.eggHatchData.length),this.updatePokemonIcons(),this.setCursor(0),s.playSoundWithoutBgm("evolution_fanfare");const t=s.eggSkipPreference===2?2e3:1e3;return this.blockExit=!0,s.time.delayedCall(t,()=>this.blockExit=!1),!0}updatePokemonIcons(){const e=this.scrollGridHandler.getItemOffset(),t=Math.min(aa*qs,this.eggHatchData.length-e);for(let i=0;i<aa*qs;i++){const n=this.eggHatchData[i+e];let a=this.pokemonContainers[i];if(i<t){if(!a){const r=i%qs*Zi,o=Math.floor(i/qs)*Zi;a=new uh(r,o,n).setVisible(!1),this.pokemonContainers.push(a),this.pokemonIconsContainer.add(a)}a.setVisible(!0),a.updateAndAnimate(n,this.iconAnimHandler)}else a&&(a.setVisible(!1),this.iconAnimHandler.addOrUpdate(a.icon,Ft.NONE))}}processInput(e){const t=this.getUi();let i=!1,n=!1;if(e===b.CANCEL)if(this.blockExit)n=!0;else{const a=s.phaseManager.getCurrentPhase();a.is("EggSummaryPhase")&&a.end(),i=!0}else this.scrollGridHandler.processInput(e);return i?t.playSelect():n&&t.playError(),i||n}setCursor(e){let t=!1;const i=this.cursor;return t=super.setCursor(e),t&&(this.cursorObj.setPosition(Mr-1+Zi*(e%qs),kr+1+Zi*Math.floor(e/qs)),i>-1&&this.iconAnimHandler.addOrUpdate(this.pokemonContainers[i].icon,Ft.NONE),this.iconAnimHandler.addOrUpdate(this.pokemonContainers[e].icon,Ft.ACTIVE),this.infoContainer.showHatchInfo(this.eggHatchData[e+this.scrollGridHandler.getItemOffset()])),t}};h(mp,"EggSummaryUiHandler");let ph=mp;const Ei=class Ei extends fs{movesContainer;moveInfoContainer;typeIcon;ppLabel;ppText;powerLabel;powerText;accuracyLabel;accuracyText;cursorObj;moveCategoryIcon;moveInfoOverlay;fieldIndex=0;fromCommand=Ie.FIGHT;cursor2=0;constructor(){super(x.FIGHT)}setInfoVis(e){this.moveInfoContainer.iterate(t=>t.setVisible(e))}setup(){const e=this.getUi();this.movesContainer=s.add.container(18,-38.7).setName(Ei.MOVES_CONTAINER_NAME),e.add(this.movesContainer),this.moveInfoContainer=s.add.container(1,0).setName("move-info"),e.add(this.moveInfoContainer),this.typeIcon=s.add.sprite(s.scaledCanvas.width-57,-36,Kt("types"),"unknown").setVisible(!1),this.moveCategoryIcon=s.add.sprite(s.scaledCanvas.width-25,-36,"categories","physical").setVisible(!1),this.ppLabel=P(s.scaledCanvas.width-70,-26,"PP",O.MOVE_INFO_CONTENT).setOrigin(0,.5).setVisible(!1).setText(f.t("fightUiHandler:pp")),this.ppText=P(s.scaledCanvas.width-12,-26,"--/--",O.MOVE_INFO_CONTENT).setOrigin(1,.5).setVisible(!1),this.powerLabel=P(s.scaledCanvas.width-70,-18,"POWER",O.MOVE_INFO_CONTENT).setOrigin(0,.5).setVisible(!1).setText(f.t("fightUiHandler:power")),this.powerText=P(s.scaledCanvas.width-12,-18,"---",O.MOVE_INFO_CONTENT).setOrigin(1,.5).setVisible(!1),this.accuracyLabel=P(s.scaledCanvas.width-70,-10,"ACC",O.MOVE_INFO_CONTENT).setOrigin(0,.5).setVisible(!1).setText(f.t("fightUiHandler:accuracy")),this.accuracyText=P(s.scaledCanvas.width-12,-10,"---",O.MOVE_INFO_CONTENT).setOrigin(1,.5).setVisible(!1),this.moveInfoContainer.add([this.typeIcon,this.moveCategoryIcon,this.ppLabel,this.ppText,this.powerLabel,this.powerText,this.accuracyLabel,this.accuracyText]),this.moveInfoOverlay=new si({delayVisibility:!0,onSide:!0,right:!0,x:0,y:-si.getHeight(!0),width:s.scaledCanvas.width+4,hideEffectBox:!0,hideBg:!0}),e.add(this.moveInfoOverlay),s.addInfoToggle(this.moveInfoOverlay,this)}show(e){super.show(e),this.fieldIndex=e[0]??0,this.fromCommand=e[1]??Ie.FIGHT;const t=this.getUi().getMessageHandler();return t.bg.setVisible(!1),t.commandWindow.setVisible(!1),t.movesWindowContainer.setVisible(!0),s.phaseManager.getCurrentPhase().getPokemon().tempSummonData.turnCount<=1?this.setCursor(0):this.setCursor(this.fieldIndex?this.cursor2:this.cursor),this.displayMoves(),this.toggleInfo(!1),this.active=!0,!0}processInput(e){const t=this.getUi();let i=!1;const n=this.getCursor();switch(e){case b.ACTION:s.phaseManager.getCurrentPhase().handleCommand(this.fromCommand,n,Rt.NORMAL)?i=!0:t.playError();break;case b.CANCEL:{const{battleType:a,mysteryEncounter:r}=s.currentBattle;(a!==de.MYSTERY_ENCOUNTER||!r?.skipToFightInput)&&(t.setMode(x.COMMAND,this.fieldIndex),i=!0);break}case b.UP:n>=2&&(i=this.setCursor(n-2));break;case b.DOWN:n<2&&(i=this.setCursor(n+2));break;case b.LEFT:n%2===1&&(i=this.setCursor(n-1));break;case b.RIGHT:n%2===0&&(i=this.setCursor(n+1));break}return i&&t.playSelect(),i}toggleInfo(e){if(e){this.movesContainer.setVisible(!1).setAlpha(0),this.cursorObj?.setVisible(!1).setAlpha(0);return}s.tweens.add({targets:[this.movesContainer,this.cursorObj],duration:ge(125),ease:"Sine.easeInOut",alpha:1}),this.movesContainer.setVisible(!0),this.cursorObj?.setVisible(!0)}isActive(){return this.active}getCursor(){return this.fieldIndex?this.cursor2:this.cursor}static ppRatioToColor(e){return e>.25&&e<=.5?O.MOVE_PP_HALF_FULL:e>0&&e<=.25?O.MOVE_PP_NEAR_EMPTY:e===0?O.MOVE_PP_EMPTY:O.MOVE_PP_FULL}setMoveInfo(e){const t=s.phaseManager.getCurrentPhase().getPokemon(),i=t.getMoveset(),n=e<i.length;if(this.setInfoVis(n),!n)return;const a=i[e],r=t.getMoveType(a.getMove()),o=Kt("types");this.typeIcon.setTexture(o,Me[r].toLowerCase()).setScale(.8);const l=a.getMove().category;this.moveCategoryIcon.setTexture("categories",Oi[l].toLowerCase()).setScale(1);const c=a.getMove().power,u=a.getMove().accuracy,p=a.getMovePp(),m=p-a.ppUsed,d=Hs(m,2,"  "),y=Hs(p,2,"  ");this.ppText.setText(`${d}/${y}`),this.powerText.setText(`${c>=0?c:"---"}`),this.accuracyText.setText(`${u>=0?u:"---"}`);const g=Ei.ppRatioToColor(m/p);this.ppText.setColor(le(g,!1)).setShadowColor(le(g,!0)),this.moveInfoOverlay.show(a.getMove()),t.getOpponents().forEach(C=>{C.updateEffectiveness(this.getEffectivenessText(t,C,a))})}setCursor(e){const t=this.getUi();this.moveInfoOverlay.clear();const i=this.getCursor()!==e;if(i&&(this.fieldIndex?this.cursor2=e:this.cursor=e),this.setMoveInfo(e),!this.cursorObj){const n=this.fromCommand===Ie.TERA;this.cursorObj=s.add.image(0,0,n?"cursor_tera":"cursor"),this.cursorObj.setScale(n?.7:1),t.add(this.cursorObj)}return this.cursorObj.setPosition(13+(e%2===1?114:0),-31+(e>=2?15:0)),i}getEffectivenessText(e,t,i){const n=t.getMoveEffectiveness(e,i.getMove(),!t.waveData.abilityRevealed,void 0,void 0,!0);return i.getMove().category===Oi.STATUS?n===0?"0x":"1x":`${n}x`}displayMoves(){const e=s.phaseManager.getCurrentPhase().getPokemon(),t=e.getMoveset();for(let i=0;i<4;i++){const n=P(i%2===0?0:114,i<2?0:16,"-",O.WINDOW).setName("text-empty-move");if(i<t.length){const a=t[i];n.setText(a.getName()).setName(a.getName()).setColor(this.getMoveColor(e,a)??n.style.color)}this.movesContainer.add(n)}}getMoveColor(e,t){if(!s.typeHints)return;const i=e.getOpponents();return i.length<=0?void 0:i.map(a=>a.getMoveEffectiveness(e,t.getMove(),!a.waveData.abilityRevealed,void 0,void 0,!0)).sort((a,r)=>r-a).map(a=>{if(!(t.getMove().category===Oi.STATUS&&a!==0))return Zy(a??0)})[0]}clear(){super.clear();const e=this.getUi().getMessageHandler();this.clearMoves(),this.setInfoVis(!1),this.moveInfoOverlay.clear(),e.bg.setVisible(!0),this.eraseCursor(),this.active=!1}clearMoves(){this.movesContainer.removeAll(!0),s.phaseManager.getCurrentPhase().getPokemon().getOpponents().forEach(t=>{t.updateEffectiveness()})}eraseCursor(){this.cursorObj&&this.cursorObj.destroy(),this.cursorObj=null}};h(Ei,"FightUiHandler"),Gi(Ei,"MOVES_CONTAINER_NAME","moves");let fh=Ei;const yp=class yp extends fs{optionSelectContainer;actionsContainer;titleBg;actionBg;optionSelectBg;unlockText;timerText;swapText;actionLabel;cancelLabel;listening=!1;buttonPressed=null;newButtonIcon;targetButtonIcon;cancelFn;timeLeftAutoClose=5;countdownTimer;target;constructor(e=null){super(e)}setup(){const e=this.getUi();this.optionSelectContainer=s.add.container(0,0),this.actionsContainer=s.add.container(0,0),this.optionSelectContainer.setVisible(!1),this.actionsContainer.setVisible(!1),e.add(this.optionSelectContainer),e.add(this.actionsContainer),this.titleBg=Ce(s.scaledCanvas.width-this.getWindowWidth(),-s.scaledCanvas.height+28+21,this.getWindowWidth(),24),this.titleBg.setOrigin(.5),this.optionSelectContainer.add(this.titleBg),this.actionBg=Ce(s.scaledCanvas.width-this.getWindowWidth(),-s.scaledCanvas.height+this.getWindowHeight()+28+21+21,this.getWindowWidth(),24),this.actionBg.setOrigin(.5),this.actionsContainer.add(this.actionBg),this.unlockText=P(0,0,f.t("settings:pressButton"),O.WINDOW),this.unlockText.setOrigin(0,0),this.unlockText.setPositionRelative(this.titleBg,36,4),this.optionSelectContainer.add(this.unlockText),this.timerText=P(0,0,"(5)",O.WINDOW),this.timerText.setOrigin(0,0),this.timerText.setPositionRelative(this.unlockText,this.unlockText.width/6+5,0),this.optionSelectContainer.add(this.timerText),this.optionSelectBg=Ce(s.scaledCanvas.width-this.getWindowWidth(),-s.scaledCanvas.height+this.getWindowHeight()+28,this.getWindowWidth(),this.getWindowHeight()),this.optionSelectBg.setOrigin(.5),this.optionSelectContainer.add(this.optionSelectBg),this.cancelLabel=P(0,0,f.t("settings:back"),O.SETTINGS_LABEL),this.cancelLabel.setOrigin(0,.5),this.cancelLabel.setPositionRelative(this.actionBg,10,this.actionBg.height/2),this.actionsContainer.add(this.cancelLabel)}manageAutoCloseTimer(){clearTimeout(this.countdownTimer),this.countdownTimer=setTimeout(()=>{this.timeLeftAutoClose-=1,this.timerText.setText(`(${this.timeLeftAutoClose})`),this.timeLeftAutoClose>=0?this.manageAutoCloseTimer():this.cancelFn?.()},1e3)}show(e){return super.show(e),this.buttonPressed=null,this.timeLeftAutoClose=5,this.cancelFn=e[0].cancelHandler,this.target=e[0].target,this.getUi().bringToTop(this.optionSelectContainer),this.getUi().bringToTop(this.actionsContainer),this.optionSelectContainer.setVisible(!0),setTimeout(()=>{this.listening=!0,this.manageAutoCloseTimer()},100),!0}getWindowWidth(){return 160}getWindowHeight(){return 64}processInput(e){if(this.buttonPressed===null)return!1;const t=this.getUi();let i=!1;switch(e){case b.LEFT:case b.RIGHT:{i=this.setCursor(this.cursor?0:1);break}case b.ACTION:this.cursor===0?this.cancelFn?.():(i=this.swapAction(),as.getInstance().updateIcons(),this.cancelFn?.(i));break}return i?t.playSelect():t.playError(),i}setCursor(e){return this.cursor=e,e===1?(this.actionLabel.setColor(le(O.SETTINGS_SELECTED)),this.actionLabel.setShadowColor(le(O.SETTINGS_SELECTED,!0)),this.cancelLabel.setColor(le(O.WINDOW)),this.cancelLabel.setShadowColor(le(O.WINDOW,!0)),!0):(this.actionLabel.setColor(le(O.WINDOW)),this.actionLabel.setShadowColor(le(O.WINDOW,!0)),this.cancelLabel.setColor(le(O.SETTINGS_SELECTED)),this.cancelLabel.setShadowColor(le(O.SETTINGS_SELECTED,!0)),!0)}clear(){super.clear(),clearTimeout(this.countdownTimer),this.timerText.setText("(5)"),this.timeLeftAutoClose=5,this.listening=!1,this.target=null,this.cancelFn=null,this.optionSelectContainer.setVisible(!1),this.actionsContainer.setVisible(!1),this.newButtonIcon.setVisible(!1),this.buttonPressed=null}onInputDown(e,t,i){clearTimeout(this.countdownTimer),this.timerText.setText(""),this.newButtonIcon.setTexture(i),this.newButtonIcon.setFrame(e),t&&(this.targetButtonIcon.setTexture(i),this.targetButtonIcon.setFrame(t),this.targetButtonIcon.setVisible(!0),this.swapText.setVisible(!0)),this.newButtonIcon.setVisible(!0),this.setCursor(0),this.actionsContainer.setVisible(!0)}};h(yp,"AbstractBindingUiHandler");let Ja=yp;const Tp=class Tp extends Ja{constructor(e=null){super(e),s.input.gamepad?.on("down",this.gamepadButtonDown,this)}setup(){super.setup(),this.newButtonIcon=s.add.sprite(0,0,"xbox"),this.newButtonIcon.setPositionRelative(this.optionSelectBg,78,16),this.newButtonIcon.setOrigin(.5),this.newButtonIcon.setVisible(!1),this.swapText=P(0,0,f.t("settings:willSwapWith"),O.WINDOW),this.swapText.setOrigin(.5),this.swapText.setPositionRelative(this.optionSelectBg,this.optionSelectBg.width/2-2,this.optionSelectBg.height/2-2),this.swapText.setVisible(!1),this.targetButtonIcon=s.add.sprite(0,0,"xbox"),this.targetButtonIcon.setPositionRelative(this.optionSelectBg,78,48),this.targetButtonIcon.setOrigin(.5),this.targetButtonIcon.setVisible(!1),this.actionLabel=P(0,0,f.t("settings:confirmSwap"),O.SETTINGS_LABEL),this.actionLabel.setOrigin(0,.5),this.actionLabel.setPositionRelative(this.actionBg,this.actionBg.width-75,this.actionBg.height/2),this.actionsContainer.add(this.actionLabel),this.optionSelectContainer.add(this.newButtonIcon),this.optionSelectContainer.add(this.swapText),this.optionSelectContainer.add(this.targetButtonIcon)}getSelectedDevice(){return s.inputController?.selectedDevice[Le.GAMEPAD]}gamepadButtonDown(e,t,i){const n=[12,13,14,15];if(!this.listening||e.id.toLowerCase()!==this.getSelectedDevice()||n.includes(t.index)||this.buttonPressed!==null)return;const a=s.inputController.getActiveConfig(Le.GAMEPAD),r=a.padType,o=Bi(a,t.index),l=a.icons[o];if(!l)return;this.buttonPressed=t.index;const c=Ea(a,this.target);this.onInputDown(l,c,r)}swapAction(){const e=s.inputController.getActiveConfig(Le.GAMEPAD);return s.inputController.assignBinding(e,this.target,this.buttonPressed)?(s.gameData.saveMappingConfigs(this.getSelectedDevice(),e),!0):!1}clear(){super.clear(),this.targetButtonIcon.setVisible(!1),this.swapText.setVisible(!1)}};h(Tp,"GamepadBindingUiHandler");let gh=Tp;const Cp=class Cp extends Ja{constructor(e=null){super(e),s.input.keyboard?.on("keydown",this.onKeyDown,this)}setup(){super.setup(),this.newButtonIcon=s.add.sprite(0,0,"keyboard"),this.newButtonIcon.setPositionRelative(this.optionSelectBg,78,32),this.newButtonIcon.setOrigin(.5),this.newButtonIcon.setVisible(!1),this.actionLabel=P(0,0,f.t("settings:assignButton"),O.SETTINGS_LABEL),this.actionLabel.setOrigin(0,.5),this.actionLabel.setPositionRelative(this.actionBg,this.actionBg.width-80,this.actionBg.height/2),this.actionsContainer.add(this.actionLabel),this.optionSelectContainer.add(this.newButtonIcon)}getSelectedDevice(){return s.inputController?.selectedDevice[Le.KEYBOARD]}onKeyDown(e){const t=[Phaser.Input.Keyboard.KeyCodes.UP,Phaser.Input.Keyboard.KeyCodes.DOWN,Phaser.Input.Keyboard.KeyCodes.LEFT,Phaser.Input.Keyboard.KeyCodes.RIGHT,Phaser.Input.Keyboard.KeyCodes.HOME,Phaser.Input.Keyboard.KeyCodes.ENTER,Phaser.Input.Keyboard.KeyCodes.ESC,Phaser.Input.Keyboard.KeyCodes.DELETE],i=e.keyCode;if(!this.listening||this.buttonPressed!==null||t.includes(i))return;const n=s.inputController.getActiveConfig(Le.KEYBOARD),a=Bi(n,i),r=n.icons[a];r&&(this.buttonPressed=i,this.onInputDown(r,null,"keyboard"))}swapAction(){const e=s.inputController.getActiveConfig(Le.KEYBOARD);return s.inputController.assignBinding(e,this.target,this.buttonPressed)?(s.gameData.saveMappingConfigs(this.getSelectedDevice(),e),!0):!1}};h(Cp,"KeyboardBindingUiHandler");let mh=Cp;const Sp=class Sp extends Ui{constructor(e=null){super(e)}getModalTitle(){return""}getWidth(){return 80}getHeight(){return 32}getMargin(){return[0,0,48,0]}getButtonLabels(){return[]}setup(){super.setup();const e=P(this.getWidth()/2,this.getHeight()/2,f.t("menu:loading"),O.WINDOW);e.setOrigin(.5,.5),this.modalContainer.add(e)}};h(Sp,"LoadingModalUiHandler");let yh=Sp;var Nr={exports:{}};var Pf;function uS(){return Pf||(Pf=1,(function(T,e){(function(t){T.exports=t()})(function(){return h(function t(i,n,a){function r(c,u){if(!n[c]){if(!i[c]){var p=typeof Yn=="function"&&Yn;if(!u&&p)return p(c,!0);if(o)return o(c,!0);var m=new Error("Cannot find module '"+c+"'");throw m.code="MODULE_NOT_FOUND",m}var d=n[c]={exports:{}};i[c][0].call(d.exports,function(y){var g=i[c][1][y];return r(g||y)},d,d.exports,t,i,n,a)}return n[c].exports}h(r,"u");for(var o=typeof Yn=="function"&&Yn,l=0;l<a.length;l++)r(a[l]);return r},"s")({1:[function(t,i,n){var a=t("./utils"),r=t("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(l){for(var c,u,p,m,d,y,g,C=[],E=0,I=l.length,A=I,_=a.getTypeOf(l)!=="string";E<l.length;)A=I-E,p=_?(c=l[E++],u=E<I?l[E++]:0,E<I?l[E++]:0):(c=l.charCodeAt(E++),u=E<I?l.charCodeAt(E++):0,E<I?l.charCodeAt(E++):0),m=c>>2,d=(3&c)<<4|u>>4,y=1<A?(15&u)<<2|p>>6:64,g=2<A?63&p:64,C.push(o.charAt(m)+o.charAt(d)+o.charAt(y)+o.charAt(g));return C.join("")},n.decode=function(l){var c,u,p,m,d,y,g=0,C=0,E="data:";if(l.substr(0,E.length)===E)throw new Error("Invalid base64 input, it looks like a data url.");var I,A=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===o.charAt(64)&&A--,l.charAt(l.length-2)===o.charAt(64)&&A--,A%1!=0)throw new Error("Invalid base64 input, bad content length.");for(I=r.uint8array?new Uint8Array(0|A):new Array(0|A);g<l.length;)c=o.indexOf(l.charAt(g++))<<2|(m=o.indexOf(l.charAt(g++)))>>4,u=(15&m)<<4|(d=o.indexOf(l.charAt(g++)))>>2,p=(3&d)<<6|(y=o.indexOf(l.charAt(g++))),I[C++]=c,d!==64&&(I[C++]=u),y!==64&&(I[C++]=p);return I}},{"./support":30,"./utils":32}],2:[function(t,i,n){var a=t("./external"),r=t("./stream/DataWorker"),o=t("./stream/Crc32Probe"),l=t("./stream/DataLengthProbe");function c(u,p,m,d,y){this.compressedSize=u,this.uncompressedSize=p,this.crc32=m,this.compression=d,this.compressedContent=y}h(c,"o"),c.prototype={getContentWorker:h(function(){var u=new r(a.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),p=this;return u.on("end",function(){if(this.streamInfo.data_length!==p.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},"getContentWorker"),getCompressedWorker:h(function(){return new r(a.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)},"getCompressedWorker")},c.createWorkerFrom=function(u,p,m){return u.pipe(new o).pipe(new l("uncompressedSize")).pipe(p.compressWorker(m)).pipe(new l("compressedSize")).withStreamInfo("compression",p)},i.exports=c},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,i,n){var a=t("./stream/GenericWorker");n.STORE={magic:"\0\0",compressWorker:h(function(){return new a("STORE compression")},"compressWorker"),uncompressWorker:h(function(){return new a("STORE decompression")},"uncompressWorker")},n.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,i,n){var a=t("./utils"),r=(function(){for(var o,l=[],c=0;c<256;c++){o=c;for(var u=0;u<8;u++)o=1&o?3988292384^o>>>1:o>>>1;l[c]=o}return l})();i.exports=function(o,l){return o!==void 0&&o.length?a.getTypeOf(o)!=="string"?(function(c,u,p,m){var d=r,y=m+p;c^=-1;for(var g=m;g<y;g++)c=c>>>8^d[255&(c^u[g])];return-1^c})(0|l,o,o.length,0):(function(c,u,p,m){var d=r,y=m+p;c^=-1;for(var g=m;g<y;g++)c=c>>>8^d[255&(c^u.charCodeAt(g))];return-1^c})(0|l,o,o.length,0):0}},{"./utils":32}],5:[function(t,i,n){n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!0,n.date=null,n.compression=null,n.compressionOptions=null,n.comment=null,n.unixPermissions=null,n.dosPermissions=null},{}],6:[function(t,i,n){var a=null;a=typeof Promise<"u"?Promise:t("lie"),i.exports={Promise:a}},{lie:37}],7:[function(t,i,n){var a=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",r=t("pako"),o=t("./utils"),l=t("./stream/GenericWorker"),c=a?"uint8array":"array";function u(p,m){l.call(this,"FlateWorker/"+p),this._pako=null,this._pakoAction=p,this._pakoOptions=m,this.meta={}}h(u,"h"),n.magic="\b\0",o.inherits(u,l),u.prototype.processChunk=function(p){this.meta=p.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(c,p.data),!1)},u.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new r[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var p=this;this._pako.onData=function(m){p.push({data:m,meta:p.meta})}},n.compressWorker=function(p){return new u("Deflate",p)},n.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,i,n){function a(d,y){var g,C="";for(g=0;g<y;g++)C+=String.fromCharCode(255&d),d>>>=8;return C}h(a,"A");function r(d,y,g,C,E,I){var A,_,w=d.file,L=d.compression,V=I!==c.utf8encode,H=o.transformTo("string",I(w.name)),W=o.transformTo("string",c.utf8encode(w.name)),ee=w.comment,me=o.transformTo("string",I(ee)),N=o.transformTo("string",c.utf8encode(ee)),j=W.length!==w.name.length,v=N.length!==ee.length,z="",ne="",X="",J=w.dir,R=w.date,Te={crc32:0,compressedSize:0,uncompressedSize:0};y&&!g||(Te.crc32=d.crc32,Te.compressedSize=d.compressedSize,Te.uncompressedSize=d.uncompressedSize);var Y=0;y&&(Y|=8),V||!j&&!v||(Y|=2048);var U=0,Ee=0;J&&(U|=16),E==="UNIX"?(Ee=798,U|=(function(he,be){var _e=he;return he||(_e=be?16893:33204),(65535&_e)<<16})(w.unixPermissions,J)):(Ee=20,U|=(function(he){return 63&(he||0)})(w.dosPermissions)),A=R.getUTCHours(),A<<=6,A|=R.getUTCMinutes(),A<<=5,A|=R.getUTCSeconds()/2,_=R.getUTCFullYear()-1980,_<<=4,_|=R.getUTCMonth()+1,_<<=5,_|=R.getUTCDate(),j&&(ne=a(1,1)+a(u(H),4)+W,z+="up"+a(ne.length,2)+ne),v&&(X=a(1,1)+a(u(me),4)+N,z+="uc"+a(X.length,2)+X);var ue="";return ue+=`
\0`,ue+=a(Y,2),ue+=L.magic,ue+=a(A,2),ue+=a(_,2),ue+=a(Te.crc32,4),ue+=a(Te.compressedSize,4),ue+=a(Te.uncompressedSize,4),ue+=a(H.length,2),ue+=a(z.length,2),{fileRecord:p.LOCAL_FILE_HEADER+ue+H+z,dirRecord:p.CENTRAL_FILE_HEADER+a(Ee,2)+ue+a(me.length,2)+"\0\0\0\0"+a(U,4)+a(C,4)+H+z+me}}h(r,"n");var o=t("../utils"),l=t("../stream/GenericWorker"),c=t("../utf8"),u=t("../crc32"),p=t("../signature");function m(d,y,g,C){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=y,this.zipPlatform=g,this.encodeFileName=C,this.streamFiles=d,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}h(m,"s"),o.inherits(m,l),m.prototype.push=function(d){var y=d.meta.percent||0,g=this.entriesCount,C=this._sources.length;this.accumulate?this.contentBuffer.push(d):(this.bytesWritten+=d.data.length,l.prototype.push.call(this,{data:d.data,meta:{currentFile:this.currentFile,percent:g?(y+100*(g-C-1))/g:100}}))},m.prototype.openedSource=function(d){this.currentSourceOffset=this.bytesWritten,this.currentFile=d.file.name;var y=this.streamFiles&&!d.file.dir;if(y){var g=r(d,y,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:g.fileRecord,meta:{percent:0}})}else this.accumulate=!0},m.prototype.closedSource=function(d){this.accumulate=!1;var y=this.streamFiles&&!d.file.dir,g=r(d,y,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(g.dirRecord),y)this.push({data:(function(C){return p.DATA_DESCRIPTOR+a(C.crc32,4)+a(C.compressedSize,4)+a(C.uncompressedSize,4)})(d),meta:{percent:100}});else for(this.push({data:g.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},m.prototype.flush=function(){for(var d=this.bytesWritten,y=0;y<this.dirRecords.length;y++)this.push({data:this.dirRecords[y],meta:{percent:100}});var g=this.bytesWritten-d,C=(function(E,I,A,_,w){var L=o.transformTo("string",w(_));return p.CENTRAL_DIRECTORY_END+"\0\0\0\0"+a(E,2)+a(E,2)+a(I,4)+a(A,4)+a(L.length,2)+L})(this.dirRecords.length,g,d,this.zipComment,this.encodeFileName);this.push({data:C,meta:{percent:100}})},m.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},m.prototype.registerPrevious=function(d){this._sources.push(d);var y=this;return d.on("data",function(g){y.processChunk(g)}),d.on("end",function(){y.closedSource(y.previous.streamInfo),y._sources.length?y.prepareNextSource():y.end()}),d.on("error",function(g){y.error(g)}),this},m.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},m.prototype.error=function(d){var y=this._sources;if(!l.prototype.error.call(this,d))return!1;for(var g=0;g<y.length;g++)try{y[g].error(d)}catch{}return!0},m.prototype.lock=function(){l.prototype.lock.call(this);for(var d=this._sources,y=0;y<d.length;y++)d[y].lock()},i.exports=m},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,i,n){var a=t("../compressions"),r=t("./ZipFileWorker");n.generateWorker=function(o,l,c){var u=new r(l.streamFiles,c,l.platform,l.encodeFileName),p=0;try{o.forEach(function(m,d){p++;var y=(function(I,A){var _=I||A,w=a[_];if(!w)throw new Error(_+" is not a valid compression method !");return w})(d.options.compression,l.compression),g=d.options.compressionOptions||l.compressionOptions||{},C=d.dir,E=d.date;d._compressWorker(y,g).withStreamInfo("file",{name:m,dir:C,date:E,comment:d.comment||"",unixPermissions:d.unixPermissions,dosPermissions:d.dosPermissions}).pipe(u)}),u.entriesCount=p}catch(m){u.error(m)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,i,n){function a(){if(!(this instanceof a))return new a;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var r=new a;for(var o in this)typeof this[o]!="function"&&(r[o]=this[o]);return r}}h(a,"n"),(a.prototype=t("./object")).loadAsync=t("./load"),a.support=t("./support"),a.defaults=t("./defaults"),a.version="3.10.1",a.loadAsync=function(r,o){return new a().loadAsync(r,o)},a.external=t("./external"),i.exports=a},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,i,n){var a=t("./utils"),r=t("./external"),o=t("./utf8"),l=t("./zipEntries"),c=t("./stream/Crc32Probe"),u=t("./nodejsUtils");function p(m){return new r.Promise(function(d,y){var g=m.decompressed.getContentWorker().pipe(new c);g.on("error",function(C){y(C)}).on("end",function(){g.streamInfo.crc32!==m.decompressed.crc32?y(new Error("Corrupted zip : CRC32 mismatch")):d()}).resume()})}h(p,"f"),i.exports=function(m,d){var y=this;return d=a.extend(d||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),u.isNode&&u.isStream(m)?r.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):a.prepareContent("the loaded zip file",m,!0,d.optimizedBinaryString,d.base64).then(function(g){var C=new l(d);return C.load(g),C}).then(function(g){var C=[r.Promise.resolve(g)],E=g.files;if(d.checkCRC32)for(var I=0;I<E.length;I++)C.push(p(E[I]));return r.Promise.all(C)}).then(function(g){for(var C=g.shift(),E=C.files,I=0;I<E.length;I++){var A=E[I],_=A.fileNameStr,w=a.resolve(A.fileNameStr);y.file(w,A.decompressed,{binary:!0,optimizedBinaryString:!0,date:A.date,dir:A.dir,comment:A.fileCommentStr.length?A.fileCommentStr:null,unixPermissions:A.unixPermissions,dosPermissions:A.dosPermissions,createFolders:d.createFolders}),A.dir||(y.file(w).unsafeOriginalName=_)}return C.zipComment.length&&(y.comment=C.zipComment),y})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,i,n){var a=t("../utils"),r=t("../stream/GenericWorker");function o(l,c){r.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(c)}h(o,"s"),a.inherits(o,r),o.prototype._bindStream=function(l){var c=this;(this._stream=l).pause(),l.on("data",function(u){c.push({data:u,meta:{percent:0}})}).on("error",function(u){c.isPaused?this.generatedError=u:c.error(u)}).on("end",function(){c.isPaused?c._upstreamEnded=!0:c.end()})},o.prototype.pause=function(){return!!r.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},i.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,i,n){var a=t("readable-stream").Readable;function r(o,l,c){a.call(this,l),this._helper=o;var u=this;o.on("data",function(p,m){u.push(p)||u._helper.pause(),c&&c(m)}).on("error",function(p){u.emit("error",p)}).on("end",function(){u.push(null)})}h(r,"n"),t("../utils").inherits(r,a),r.prototype._read=function(){this._helper.resume()},i.exports=r},{"../utils":32,"readable-stream":16}],14:[function(t,i,n){i.exports={isNode:typeof Buffer<"u",newBufferFrom:h(function(a,r){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(a,r);if(typeof a=="number")throw new Error('The "data" argument must not be a number');return new Buffer(a,r)},"newBufferFrom"),allocBuffer:h(function(a){if(Buffer.alloc)return Buffer.alloc(a);var r=new Buffer(a);return r.fill(0),r},"allocBuffer"),isBuffer:h(function(a){return Buffer.isBuffer(a)},"isBuffer"),isStream:h(function(a){return a&&typeof a.on=="function"&&typeof a.pause=="function"&&typeof a.resume=="function"},"isStream")}},{}],15:[function(t,i,n){function a(w,L,V){var H,W=o.getTypeOf(L),ee=o.extend(V||{},u);ee.date=ee.date||new Date,ee.compression!==null&&(ee.compression=ee.compression.toUpperCase()),typeof ee.unixPermissions=="string"&&(ee.unixPermissions=parseInt(ee.unixPermissions,8)),ee.unixPermissions&&16384&ee.unixPermissions&&(ee.dir=!0),ee.dosPermissions&&16&ee.dosPermissions&&(ee.dir=!0),ee.dir&&(w=E(w)),ee.createFolders&&(H=C(w))&&I.call(this,H,!0);var me=W==="string"&&ee.binary===!1&&ee.base64===!1;V&&V.binary!==void 0||(ee.binary=!me),(L instanceof p&&L.uncompressedSize===0||ee.dir||!L||L.length===0)&&(ee.base64=!1,ee.binary=!0,L="",ee.compression="STORE",W="string");var N=null;N=L instanceof p||L instanceof l?L:y.isNode&&y.isStream(L)?new g(w,L):o.prepareContent(w,L,ee.binary,ee.optimizedBinaryString,ee.base64);var j=new m(w,N,ee);this.files[w]=j}h(a,"s");var r=t("./utf8"),o=t("./utils"),l=t("./stream/GenericWorker"),c=t("./stream/StreamHelper"),u=t("./defaults"),p=t("./compressedObject"),m=t("./zipObject"),d=t("./generate"),y=t("./nodejsUtils"),g=t("./nodejs/NodejsStreamInputAdapter"),C=h(function(w){w.slice(-1)==="/"&&(w=w.substring(0,w.length-1));var L=w.lastIndexOf("/");return 0<L?w.substring(0,L):""},"_"),E=h(function(w){return w.slice(-1)!=="/"&&(w+="/"),w},"g"),I=h(function(w,L){return L=L!==void 0?L:u.createFolders,w=E(w),this.files[w]||a.call(this,w,null,{dir:!0,createFolders:L}),this.files[w]},"b");function A(w){return Object.prototype.toString.call(w)==="[object RegExp]"}h(A,"h");var _={load:h(function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},"load"),forEach:h(function(w){var L,V,H;for(L in this.files)H=this.files[L],(V=L.slice(this.root.length,L.length))&&L.slice(0,this.root.length)===this.root&&w(V,H)},"forEach"),filter:h(function(w){var L=[];return this.forEach(function(V,H){w(V,H)&&L.push(H)}),L},"filter"),file:h(function(w,L,V){if(arguments.length!==1)return w=this.root+w,a.call(this,w,L,V),this;if(A(w)){var H=w;return this.filter(function(ee,me){return!me.dir&&H.test(ee)})}var W=this.files[this.root+w];return W&&!W.dir?W:null},"file"),folder:h(function(w){if(!w)return this;if(A(w))return this.filter(function(W,ee){return ee.dir&&w.test(W)});var L=this.root+w,V=I.call(this,L),H=this.clone();return H.root=V.name,H},"folder"),remove:h(function(w){w=this.root+w;var L=this.files[w];if(L||(w.slice(-1)!=="/"&&(w+="/"),L=this.files[w]),L&&!L.dir)delete this.files[w];else for(var V=this.filter(function(W,ee){return ee.name.slice(0,w.length)===w}),H=0;H<V.length;H++)delete this.files[V[H].name];return this},"remove"),generate:h(function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},"generate"),generateInternalStream:h(function(w){var L,V={};try{if((V=o.extend(w||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode})).type=V.type.toLowerCase(),V.compression=V.compression.toUpperCase(),V.type==="binarystring"&&(V.type="string"),!V.type)throw new Error("No output type specified.");o.checkSupport(V.type),V.platform!=="darwin"&&V.platform!=="freebsd"&&V.platform!=="linux"&&V.platform!=="sunos"||(V.platform="UNIX"),V.platform==="win32"&&(V.platform="DOS");var H=V.comment||this.comment||"";L=d.generateWorker(this,V,H)}catch(W){(L=new l("error")).error(W)}return new c(L,V.type||"string",V.mimeType)},"generateInternalStream"),generateAsync:h(function(w,L){return this.generateInternalStream(w).accumulate(L)},"generateAsync"),generateNodeStream:h(function(w,L){return(w=w||{}).type||(w.type="nodebuffer"),this.generateInternalStream(w).toNodejsStream(L)},"generateNodeStream")};i.exports=_},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,i,n){i.exports=t("stream")},{stream:void 0}],17:[function(t,i,n){var a=t("./DataReader");function r(o){a.call(this,o);for(var l=0;l<this.data.length;l++)o[l]=255&o[l]}h(r,"i"),t("../utils").inherits(r,a),r.prototype.byteAt=function(o){return this.data[this.zero+o]},r.prototype.lastIndexOfSignature=function(o){for(var l=o.charCodeAt(0),c=o.charCodeAt(1),u=o.charCodeAt(2),p=o.charCodeAt(3),m=this.length-4;0<=m;--m)if(this.data[m]===l&&this.data[m+1]===c&&this.data[m+2]===u&&this.data[m+3]===p)return m-this.zero;return-1},r.prototype.readAndCheckSignature=function(o){var l=o.charCodeAt(0),c=o.charCodeAt(1),u=o.charCodeAt(2),p=o.charCodeAt(3),m=this.readData(4);return l===m[0]&&c===m[1]&&u===m[2]&&p===m[3]},r.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},i.exports=r},{"../utils":32,"./DataReader":18}],18:[function(t,i,n){var a=t("../utils");function r(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}h(r,"i"),r.prototype={checkOffset:h(function(o){this.checkIndex(this.index+o)},"checkOffset"),checkIndex:h(function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},"checkIndex"),setIndex:h(function(o){this.checkIndex(o),this.index=o},"setIndex"),skip:h(function(o){this.setIndex(this.index+o)},"skip"),byteAt:h(function(){},"byteAt"),readInt:h(function(o){var l,c=0;for(this.checkOffset(o),l=this.index+o-1;l>=this.index;l--)c=(c<<8)+this.byteAt(l);return this.index+=o,c},"readInt"),readString:h(function(o){return a.transformTo("string",this.readData(o))},"readString"),readData:h(function(){},"readData"),lastIndexOfSignature:h(function(){},"lastIndexOfSignature"),readAndCheckSignature:h(function(){},"readAndCheckSignature"),readDate:h(function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))},"readDate")},i.exports=r},{"../utils":32}],19:[function(t,i,n){var a=t("./Uint8ArrayReader");function r(o){a.call(this,o)}h(r,"i"),t("../utils").inherits(r,a),r.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},i.exports=r},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,i,n){var a=t("./DataReader");function r(o){a.call(this,o)}h(r,"i"),t("../utils").inherits(r,a),r.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},r.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},r.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},r.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},i.exports=r},{"../utils":32,"./DataReader":18}],21:[function(t,i,n){var a=t("./ArrayReader");function r(o){a.call(this,o)}h(r,"i"),t("../utils").inherits(r,a),r.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},i.exports=r},{"../utils":32,"./ArrayReader":17}],22:[function(t,i,n){var a=t("../utils"),r=t("../support"),o=t("./ArrayReader"),l=t("./StringReader"),c=t("./NodeBufferReader"),u=t("./Uint8ArrayReader");i.exports=function(p){var m=a.getTypeOf(p);return a.checkSupport(m),m!=="string"||r.uint8array?m==="nodebuffer"?new c(p):r.uint8array?new u(a.transformTo("uint8array",p)):new o(a.transformTo("array",p)):new l(p)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,i,n){n.LOCAL_FILE_HEADER="PK",n.CENTRAL_FILE_HEADER="PK",n.CENTRAL_DIRECTORY_END="PK",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",n.ZIP64_CENTRAL_DIRECTORY_END="PK",n.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,i,n){var a=t("./GenericWorker"),r=t("../utils");function o(l){a.call(this,"ConvertWorker to "+l),this.destType=l}h(o,"s"),r.inherits(o,a),o.prototype.processChunk=function(l){this.push({data:r.transformTo(this.destType,l.data),meta:l.meta})},i.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(t,i,n){var a=t("./GenericWorker"),r=t("../crc32");function o(){a.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}h(o,"s"),t("../utils").inherits(o,a),o.prototype.processChunk=function(l){this.streamInfo.crc32=r(l.data,this.streamInfo.crc32||0),this.push(l)},i.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,i,n){var a=t("../utils"),r=t("./GenericWorker");function o(l){r.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}h(o,"s"),a.inherits(o,r),o.prototype.processChunk=function(l){if(l){var c=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=c+l.data.length}r.prototype.processChunk.call(this,l)},i.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(t,i,n){var a=t("../utils"),r=t("./GenericWorker");function o(l){r.call(this,"DataWorker");var c=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(u){c.dataIsReady=!0,c.data=u,c.max=u&&u.length||0,c.type=a.getTypeOf(u),c.isPaused||c._tickAndRepeat()},function(u){c.error(u)})}h(o,"s"),a.inherits(o,r),o.prototype.cleanUp=function(){r.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,a.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(a.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,c=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,c);break;case"uint8array":l=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":l=this.data.slice(this.index,c)}return this.index=c,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},i.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(t,i,n){function a(r){this.name=r||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}h(a,"n"),a.prototype={push:h(function(r){this.emit("data",r)},"push"),end:h(function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(r){this.emit("error",r)}return!0},"end"),error:h(function(r){return!this.isFinished&&(this.isPaused?this.generatedError=r:(this.isFinished=!0,this.emit("error",r),this.previous&&this.previous.error(r),this.cleanUp()),!0)},"error"),on:h(function(r,o){return this._listeners[r].push(o),this},"on"),cleanUp:h(function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},"cleanUp"),emit:h(function(r,o){if(this._listeners[r])for(var l=0;l<this._listeners[r].length;l++)this._listeners[r][l].call(this,o)},"emit"),pipe:h(function(r){return r.registerPrevious(this)},"pipe"),registerPrevious:h(function(r){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=r.streamInfo,this.mergeStreamInfo(),this.previous=r;var o=this;return r.on("data",function(l){o.processChunk(l)}),r.on("end",function(){o.end()}),r.on("error",function(l){o.error(l)}),this},"registerPrevious"),pause:h(function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},"pause"),resume:h(function(){if(!this.isPaused||this.isFinished)return!1;var r=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),r=!0),this.previous&&this.previous.resume(),!r},"resume"),flush:h(function(){},"flush"),processChunk:h(function(r){this.push(r)},"processChunk"),withStreamInfo:h(function(r,o){return this.extraStreamInfo[r]=o,this.mergeStreamInfo(),this},"withStreamInfo"),mergeStreamInfo:h(function(){for(var r in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,r)&&(this.streamInfo[r]=this.extraStreamInfo[r])},"mergeStreamInfo"),lock:h(function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},"lock"),toString:h(function(){var r="Worker "+this.name;return this.previous?this.previous+" -> "+r:r},"toString")},i.exports=a},{}],29:[function(t,i,n){var a=t("../utils"),r=t("./ConvertWorker"),o=t("./GenericWorker"),l=t("../base64"),c=t("../support"),u=t("../external"),p=null;if(c.nodestream)try{p=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function m(y,g){return new u.Promise(function(C,E){var I=[],A=y._internalType,_=y._outputType,w=y._mimeType;y.on("data",function(L,V){I.push(L),g&&g(V)}).on("error",function(L){I=[],E(L)}).on("end",function(){try{var L=(function(V,H,W){switch(V){case"blob":return a.newBlob(a.transformTo("arraybuffer",H),W);case"base64":return l.encode(H);default:return a.transformTo(V,H)}})(_,(function(V,H){var W,ee=0,me=null,N=0;for(W=0;W<H.length;W++)N+=H[W].length;switch(V){case"string":return H.join("");case"array":return Array.prototype.concat.apply([],H);case"uint8array":for(me=new Uint8Array(N),W=0;W<H.length;W++)me.set(H[W],ee),ee+=H[W].length;return me;case"nodebuffer":return Buffer.concat(H);default:throw new Error("concat : unsupported type '"+V+"'")}})(A,I),w);C(L)}catch(V){E(V)}I=[]}).resume()})}h(m,"l");function d(y,g,C){var E=g;switch(g){case"blob":case"arraybuffer":E="uint8array";break;case"base64":E="string"}try{this._internalType=E,this._outputType=g,this._mimeType=C,a.checkSupport(E),this._worker=y.pipe(new r(E)),y.lock()}catch(I){this._worker=new o("error"),this._worker.error(I)}}h(d,"f"),d.prototype={accumulate:h(function(y){return m(this,y)},"accumulate"),on:h(function(y,g){var C=this;return y==="data"?this._worker.on(y,function(E){g.call(C,E.data,E.meta)}):this._worker.on(y,function(){a.delay(g,arguments,C)}),this},"on"),resume:h(function(){return a.delay(this._worker.resume,[],this._worker),this},"resume"),pause:h(function(){return this._worker.pause(),this},"pause"),toNodejsStream:h(function(y){if(a.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new p(this,{objectMode:this._outputType!=="nodebuffer"},y)},"toNodejsStream")},i.exports=d},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,i,n){if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",n.nodebuffer=typeof Buffer<"u",n.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")n.blob=!1;else{var a=new ArrayBuffer(0);try{n.blob=new Blob([a],{type:"application/zip"}).size===0}catch{try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);r.append(a),n.blob=r.getBlob("application/zip").size===0}catch{n.blob=!1}}}try{n.nodestream=!!t("readable-stream").Readable}catch{n.nodestream=!1}},{"readable-stream":16}],31:[function(t,i,n){for(var a=t("./utils"),r=t("./support"),o=t("./nodejsUtils"),l=t("./stream/GenericWorker"),c=new Array(256),u=0;u<256;u++)c[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;c[254]=c[254]=1;function p(){l.call(this,"utf-8 decode"),this.leftOver=null}h(p,"a");function m(){l.call(this,"utf-8 encode")}h(m,"l"),n.utf8encode=function(d){return r.nodebuffer?o.newBufferFrom(d,"utf-8"):(function(y){var g,C,E,I,A,_=y.length,w=0;for(I=0;I<_;I++)(64512&(C=y.charCodeAt(I)))==55296&&I+1<_&&(64512&(E=y.charCodeAt(I+1)))==56320&&(C=65536+(C-55296<<10)+(E-56320),I++),w+=C<128?1:C<2048?2:C<65536?3:4;for(g=r.uint8array?new Uint8Array(w):new Array(w),I=A=0;A<w;I++)(64512&(C=y.charCodeAt(I)))==55296&&I+1<_&&(64512&(E=y.charCodeAt(I+1)))==56320&&(C=65536+(C-55296<<10)+(E-56320),I++),C<128?g[A++]=C:(C<2048?g[A++]=192|C>>>6:(C<65536?g[A++]=224|C>>>12:(g[A++]=240|C>>>18,g[A++]=128|C>>>12&63),g[A++]=128|C>>>6&63),g[A++]=128|63&C);return g})(d)},n.utf8decode=function(d){return r.nodebuffer?a.transformTo("nodebuffer",d).toString("utf-8"):(function(y){var g,C,E,I,A=y.length,_=new Array(2*A);for(g=C=0;g<A;)if((E=y[g++])<128)_[C++]=E;else if(4<(I=c[E]))_[C++]=65533,g+=I-1;else{for(E&=I===2?31:I===3?15:7;1<I&&g<A;)E=E<<6|63&y[g++],I--;1<I?_[C++]=65533:E<65536?_[C++]=E:(E-=65536,_[C++]=55296|E>>10&1023,_[C++]=56320|1023&E)}return _.length!==C&&(_.subarray?_=_.subarray(0,C):_.length=C),a.applyFromCharCode(_)})(d=a.transformTo(r.uint8array?"uint8array":"array",d))},a.inherits(p,l),p.prototype.processChunk=function(d){var y=a.transformTo(r.uint8array?"uint8array":"array",d.data);if(this.leftOver&&this.leftOver.length){if(r.uint8array){var g=y;(y=new Uint8Array(g.length+this.leftOver.length)).set(this.leftOver,0),y.set(g,this.leftOver.length)}else y=this.leftOver.concat(y);this.leftOver=null}var C=(function(I,A){var _;for((A=A||I.length)>I.length&&(A=I.length),_=A-1;0<=_&&(192&I[_])==128;)_--;return _<0||_===0?A:_+c[I[_]]>A?_:A})(y),E=y;C!==y.length&&(r.uint8array?(E=y.subarray(0,C),this.leftOver=y.subarray(C,y.length)):(E=y.slice(0,C),this.leftOver=y.slice(C,y.length))),this.push({data:n.utf8decode(E),meta:d.meta})},p.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:n.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},n.Utf8DecodeWorker=p,a.inherits(m,l),m.prototype.processChunk=function(d){this.push({data:n.utf8encode(d.data),meta:d.meta})},n.Utf8EncodeWorker=m},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,i,n){var a=t("./support"),r=t("./base64"),o=t("./nodejsUtils"),l=t("./external");function c(g){return g}h(c,"n");function u(g,C){for(var E=0;E<g.length;++E)C[E]=255&g.charCodeAt(E);return C}h(u,"l"),t("setimmediate"),n.newBlob=function(g,C){n.checkSupport("blob");try{return new Blob([g],{type:C})}catch{try{var E=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return E.append(g),E.getBlob(C)}catch{throw new Error("Bug : can't construct the Blob.")}}};var p={stringifyByChunk:h(function(g,C,E){var I=[],A=0,_=g.length;if(_<=E)return String.fromCharCode.apply(null,g);for(;A<_;)C==="array"||C==="nodebuffer"?I.push(String.fromCharCode.apply(null,g.slice(A,Math.min(A+E,_)))):I.push(String.fromCharCode.apply(null,g.subarray(A,Math.min(A+E,_)))),A+=E;return I.join("")},"stringifyByChunk"),stringifyByChar:h(function(g){for(var C="",E=0;E<g.length;E++)C+=String.fromCharCode(g[E]);return C},"stringifyByChar"),applyCanBeUsed:{uint8array:(function(){try{return a.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return a.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}})()}};function m(g){var C=65536,E=n.getTypeOf(g),I=!0;if(E==="uint8array"?I=p.applyCanBeUsed.uint8array:E==="nodebuffer"&&(I=p.applyCanBeUsed.nodebuffer),I)for(;1<C;)try{return p.stringifyByChunk(g,E,C)}catch{C=Math.floor(C/2)}return p.stringifyByChar(g)}h(m,"s");function d(g,C){for(var E=0;E<g.length;E++)C[E]=g[E];return C}h(d,"f"),n.applyFromCharCode=m;var y={};y.string={string:c,array:h(function(g){return u(g,new Array(g.length))},"array"),arraybuffer:h(function(g){return y.string.uint8array(g).buffer},"arraybuffer"),uint8array:h(function(g){return u(g,new Uint8Array(g.length))},"uint8array"),nodebuffer:h(function(g){return u(g,o.allocBuffer(g.length))},"nodebuffer")},y.array={string:m,array:c,arraybuffer:h(function(g){return new Uint8Array(g).buffer},"arraybuffer"),uint8array:h(function(g){return new Uint8Array(g)},"uint8array"),nodebuffer:h(function(g){return o.newBufferFrom(g)},"nodebuffer")},y.arraybuffer={string:h(function(g){return m(new Uint8Array(g))},"string"),array:h(function(g){return d(new Uint8Array(g),new Array(g.byteLength))},"array"),arraybuffer:c,uint8array:h(function(g){return new Uint8Array(g)},"uint8array"),nodebuffer:h(function(g){return o.newBufferFrom(new Uint8Array(g))},"nodebuffer")},y.uint8array={string:m,array:h(function(g){return d(g,new Array(g.length))},"array"),arraybuffer:h(function(g){return g.buffer},"arraybuffer"),uint8array:c,nodebuffer:h(function(g){return o.newBufferFrom(g)},"nodebuffer")},y.nodebuffer={string:m,array:h(function(g){return d(g,new Array(g.length))},"array"),arraybuffer:h(function(g){return y.nodebuffer.uint8array(g).buffer},"arraybuffer"),uint8array:h(function(g){return d(g,new Uint8Array(g.length))},"uint8array"),nodebuffer:c},n.transformTo=function(g,C){if(C=C||"",!g)return C;n.checkSupport(g);var E=n.getTypeOf(C);return y[E][g](C)},n.resolve=function(g){for(var C=g.split("/"),E=[],I=0;I<C.length;I++){var A=C[I];A==="."||A===""&&I!==0&&I!==C.length-1||(A===".."?E.pop():E.push(A))}return E.join("/")},n.getTypeOf=function(g){return typeof g=="string"?"string":Object.prototype.toString.call(g)==="[object Array]"?"array":a.nodebuffer&&o.isBuffer(g)?"nodebuffer":a.uint8array&&g instanceof Uint8Array?"uint8array":a.arraybuffer&&g instanceof ArrayBuffer?"arraybuffer":void 0},n.checkSupport=function(g){if(!a[g.toLowerCase()])throw new Error(g+" is not supported by this platform")},n.MAX_VALUE_16BITS=65535,n.MAX_VALUE_32BITS=-1,n.pretty=function(g){var C,E,I="";for(E=0;E<(g||"").length;E++)I+="\\x"+((C=g.charCodeAt(E))<16?"0":"")+C.toString(16).toUpperCase();return I},n.delay=function(g,C,E){setImmediate(function(){g.apply(E||null,C||[])})},n.inherits=function(g,C){function E(){}h(E,"r"),E.prototype=C.prototype,g.prototype=new E},n.extend=function(){var g,C,E={};for(g=0;g<arguments.length;g++)for(C in arguments[g])Object.prototype.hasOwnProperty.call(arguments[g],C)&&E[C]===void 0&&(E[C]=arguments[g][C]);return E},n.prepareContent=function(g,C,E,I,A){return l.Promise.resolve(C).then(function(_){return a.blob&&(_ instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(_))!==-1)&&typeof FileReader<"u"?new l.Promise(function(w,L){var V=new FileReader;V.onload=function(H){w(H.target.result)},V.onerror=function(H){L(H.target.error)},V.readAsArrayBuffer(_)}):_}).then(function(_){var w=n.getTypeOf(_);return w?(w==="arraybuffer"?_=n.transformTo("uint8array",_):w==="string"&&(A?_=r.decode(_):E&&I!==!0&&(_=(function(L){return u(L,a.uint8array?new Uint8Array(L.length):new Array(L.length))})(_))),_):l.Promise.reject(new Error("Can't read the data of '"+g+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,i,n){var a=t("./reader/readerFor"),r=t("./utils"),o=t("./signature"),l=t("./zipEntry"),c=t("./support");function u(p){this.files=[],this.loadOptions=p}h(u,"h"),u.prototype={checkSignature:h(function(p){if(!this.reader.readAndCheckSignature(p)){this.reader.index-=4;var m=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+r.pretty(m)+", expected "+r.pretty(p)+")")}},"checkSignature"),isSignature:h(function(p,m){var d=this.reader.index;this.reader.setIndex(p);var y=this.reader.readString(4)===m;return this.reader.setIndex(d),y},"isSignature"),readBlockEndOfCentral:h(function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var p=this.reader.readData(this.zipCommentLength),m=c.uint8array?"uint8array":"array",d=r.transformTo(m,p);this.zipComment=this.loadOptions.decodeFileName(d)},"readBlockEndOfCentral"),readBlockZip64EndOfCentral:h(function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var p,m,d,y=this.zip64EndOfCentralSize-44;0<y;)p=this.reader.readInt(2),m=this.reader.readInt(4),d=this.reader.readData(m),this.zip64ExtensibleData[p]={id:p,length:m,value:d}},"readBlockZip64EndOfCentral"),readBlockZip64EndOfCentralLocator:h(function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},"readBlockZip64EndOfCentralLocator"),readLocalFiles:h(function(){var p,m;for(p=0;p<this.files.length;p++)m=this.files[p],this.reader.setIndex(m.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),m.readLocalPart(this.reader),m.handleUTF8(),m.processAttributes()},"readLocalFiles"),readCentralDir:h(function(){var p;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(p=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(p);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},"readCentralDir"),readEndOfCentral:h(function(){var p=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(p<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(p);var m=p;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===r.MAX_VALUE_16BITS||this.diskWithCentralDirStart===r.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===r.MAX_VALUE_16BITS||this.centralDirRecords===r.MAX_VALUE_16BITS||this.centralDirSize===r.MAX_VALUE_32BITS||this.centralDirOffset===r.MAX_VALUE_32BITS){if(this.zip64=!0,(p=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(p),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var d=this.centralDirOffset+this.centralDirSize;this.zip64&&(d+=20,d+=12+this.zip64EndOfCentralSize);var y=m-d;if(0<y)this.isSignature(m,o.CENTRAL_FILE_HEADER)||(this.reader.zero=y);else if(y<0)throw new Error("Corrupted zip: missing "+Math.abs(y)+" bytes.")},"readEndOfCentral"),prepareReader:h(function(p){this.reader=a(p)},"prepareReader"),load:h(function(p){this.prepareReader(p),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()},"load")},i.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,i,n){var a=t("./reader/readerFor"),r=t("./utils"),o=t("./compressedObject"),l=t("./crc32"),c=t("./utf8"),u=t("./compressions"),p=t("./support");function m(d,y){this.options=d,this.loadOptions=y}h(m,"l"),m.prototype={isEncrypted:h(function(){return(1&this.bitFlag)==1},"isEncrypted"),useUTF8:h(function(){return(2048&this.bitFlag)==2048},"useUTF8"),readLocalPart:h(function(d){var y,g;if(d.skip(22),this.fileNameLength=d.readInt(2),g=d.readInt(2),this.fileName=d.readData(this.fileNameLength),d.skip(g),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((y=(function(C){for(var E in u)if(Object.prototype.hasOwnProperty.call(u,E)&&u[E].magic===C)return u[E];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+r.pretty(this.compressionMethod)+" unknown (inner file : "+r.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,y,d.readData(this.compressedSize))},"readLocalPart"),readCentralPart:h(function(d){this.versionMadeBy=d.readInt(2),d.skip(2),this.bitFlag=d.readInt(2),this.compressionMethod=d.readString(2),this.date=d.readDate(),this.crc32=d.readInt(4),this.compressedSize=d.readInt(4),this.uncompressedSize=d.readInt(4);var y=d.readInt(2);if(this.extraFieldsLength=d.readInt(2),this.fileCommentLength=d.readInt(2),this.diskNumberStart=d.readInt(2),this.internalFileAttributes=d.readInt(2),this.externalFileAttributes=d.readInt(4),this.localHeaderOffset=d.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");d.skip(y),this.readExtraFields(d),this.parseZIP64ExtraField(d),this.fileComment=d.readData(this.fileCommentLength)},"readCentralPart"),processAttributes:h(function(){this.unixPermissions=null,this.dosPermissions=null;var d=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),d==0&&(this.dosPermissions=63&this.externalFileAttributes),d==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},"processAttributes"),parseZIP64ExtraField:h(function(){if(this.extraFields[1]){var d=a(this.extraFields[1].value);this.uncompressedSize===r.MAX_VALUE_32BITS&&(this.uncompressedSize=d.readInt(8)),this.compressedSize===r.MAX_VALUE_32BITS&&(this.compressedSize=d.readInt(8)),this.localHeaderOffset===r.MAX_VALUE_32BITS&&(this.localHeaderOffset=d.readInt(8)),this.diskNumberStart===r.MAX_VALUE_32BITS&&(this.diskNumberStart=d.readInt(4))}},"parseZIP64ExtraField"),readExtraFields:h(function(d){var y,g,C,E=d.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});d.index+4<E;)y=d.readInt(2),g=d.readInt(2),C=d.readData(g),this.extraFields[y]={id:y,length:g,value:C};d.setIndex(E)},"readExtraFields"),handleUTF8:h(function(){var d=p.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=c.utf8decode(this.fileName),this.fileCommentStr=c.utf8decode(this.fileComment);else{var y=this.findExtraFieldUnicodePath();if(y!==null)this.fileNameStr=y;else{var g=r.transformTo(d,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(g)}var C=this.findExtraFieldUnicodeComment();if(C!==null)this.fileCommentStr=C;else{var E=r.transformTo(d,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(E)}}},"handleUTF8"),findExtraFieldUnicodePath:h(function(){var d=this.extraFields[28789];if(d){var y=a(d.value);return y.readInt(1)!==1||l(this.fileName)!==y.readInt(4)?null:c.utf8decode(y.readData(d.length-5))}return null},"findExtraFieldUnicodePath"),findExtraFieldUnicodeComment:h(function(){var d=this.extraFields[25461];if(d){var y=a(d.value);return y.readInt(1)!==1||l(this.fileComment)!==y.readInt(4)?null:c.utf8decode(y.readData(d.length-5))}return null},"findExtraFieldUnicodeComment")},i.exports=m},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,i,n){function a(y,g,C){this.name=y,this.dir=C.dir,this.date=C.date,this.comment=C.comment,this.unixPermissions=C.unixPermissions,this.dosPermissions=C.dosPermissions,this._data=g,this._dataBinary=C.binary,this.options={compression:C.compression,compressionOptions:C.compressionOptions}}h(a,"n");var r=t("./stream/StreamHelper"),o=t("./stream/DataWorker"),l=t("./utf8"),c=t("./compressedObject"),u=t("./stream/GenericWorker");a.prototype={internalStream:h(function(y){var g=null,C="string";try{if(!y)throw new Error("No output type specified.");var E=(C=y.toLowerCase())==="string"||C==="text";C!=="binarystring"&&C!=="text"||(C="string"),g=this._decompressWorker();var I=!this._dataBinary;I&&!E&&(g=g.pipe(new l.Utf8EncodeWorker)),!I&&E&&(g=g.pipe(new l.Utf8DecodeWorker))}catch(A){(g=new u("error")).error(A)}return new r(g,C,"")},"internalStream"),async:h(function(y,g){return this.internalStream(y).accumulate(g)},"async"),nodeStream:h(function(y,g){return this.internalStream(y||"nodebuffer").toNodejsStream(g)},"nodeStream"),_compressWorker:h(function(y,g){if(this._data instanceof c&&this._data.compression.magic===y.magic)return this._data.getCompressedWorker();var C=this._decompressWorker();return this._dataBinary||(C=C.pipe(new l.Utf8EncodeWorker)),c.createWorkerFrom(C,y,g)},"_compressWorker"),_decompressWorker:h(function(){return this._data instanceof c?this._data.getContentWorker():this._data instanceof u?this._data:new o(this._data)},"_decompressWorker")};for(var p=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],m=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},d=0;d<p.length;d++)a.prototype[p[d]]=m;i.exports=a},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,i,n){(function(a){var r,o,l=a.MutationObserver||a.WebKitMutationObserver;if(l){var c=0,u=new l(y),p=a.document.createTextNode("");u.observe(p,{characterData:!0}),r=h(function(){p.data=c=++c%2},"r")}else if(a.setImmediate||a.MessageChannel===void 0)r="document"in a&&"onreadystatechange"in a.document.createElement("script")?function(){var g=a.document.createElement("script");g.onreadystatechange=function(){y(),g.onreadystatechange=null,g.parentNode.removeChild(g),g=null},a.document.documentElement.appendChild(g)}:function(){setTimeout(y,0)};else{var m=new a.MessageChannel;m.port1.onmessage=y,r=h(function(){m.port2.postMessage(0)},"r")}var d=[];function y(){var g,C;o=!0;for(var E=d.length;E;){for(C=d,d=[],g=-1;++g<E;)C[g]();E=d.length}o=!1}h(y,"u"),i.exports=function(g){d.push(g)!==1||o||r()}}).call(this,typeof $n<"u"?$n:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(t,i,n){var a=t("immediate");function r(){}h(r,"u");var o={},l=["REJECTED"],c=["FULFILLED"],u=["PENDING"];function p(E){if(typeof E!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,E!==r&&g(this,E)}h(p,"o");function m(E,I,A){this.promise=E,typeof I=="function"&&(this.onFulfilled=I,this.callFulfilled=this.otherCallFulfilled),typeof A=="function"&&(this.onRejected=A,this.callRejected=this.otherCallRejected)}h(m,"h");function d(E,I,A){a(function(){var _;try{_=I(A)}catch(w){return o.reject(E,w)}_===E?o.reject(E,new TypeError("Cannot resolve promise with itself")):o.resolve(E,_)})}h(d,"f");function y(E){var I=E&&E.then;if(E&&(typeof E=="object"||typeof E=="function")&&typeof I=="function")return function(){I.apply(E,arguments)}}h(y,"c");function g(E,I){var A=!1;function _(V){A||(A=!0,o.reject(E,V))}h(_,"n");function w(V){A||(A=!0,o.resolve(E,V))}h(w,"i");var L=C(function(){I(w,_)});L.status==="error"&&_(L.value)}h(g,"d");function C(E,I){var A={};try{A.value=E(I),A.status="success"}catch(_){A.status="error",A.value=_}return A}h(C,"p"),(i.exports=p).prototype.finally=function(E){if(typeof E!="function")return this;var I=this.constructor;return this.then(function(A){return I.resolve(E()).then(function(){return A})},function(A){return I.resolve(E()).then(function(){throw A})})},p.prototype.catch=function(E){return this.then(null,E)},p.prototype.then=function(E,I){if(typeof E!="function"&&this.state===c||typeof I!="function"&&this.state===l)return this;var A=new this.constructor(r);return this.state!==u?d(A,this.state===c?E:I,this.outcome):this.queue.push(new m(A,E,I)),A},m.prototype.callFulfilled=function(E){o.resolve(this.promise,E)},m.prototype.otherCallFulfilled=function(E){d(this.promise,this.onFulfilled,E)},m.prototype.callRejected=function(E){o.reject(this.promise,E)},m.prototype.otherCallRejected=function(E){d(this.promise,this.onRejected,E)},o.resolve=function(E,I){var A=C(y,I);if(A.status==="error")return o.reject(E,A.value);var _=A.value;if(_)g(E,_);else{E.state=c,E.outcome=I;for(var w=-1,L=E.queue.length;++w<L;)E.queue[w].callFulfilled(I)}return E},o.reject=function(E,I){E.state=l,E.outcome=I;for(var A=-1,_=E.queue.length;++A<_;)E.queue[A].callRejected(I);return E},p.resolve=function(E){return E instanceof this?E:o.resolve(new this(r),E)},p.reject=function(E){var I=new this(r);return o.reject(I,E)},p.all=function(E){var I=this;if(Object.prototype.toString.call(E)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=E.length,_=!1;if(!A)return this.resolve([]);for(var w=new Array(A),L=0,V=-1,H=new this(r);++V<A;)W(E[V],V);return H;function W(ee,me){I.resolve(ee).then(function(N){w[me]=N,++L!==A||_||(_=!0,o.resolve(H,w))},function(N){_||(_=!0,o.reject(H,N))})}},p.race=function(E){var I=this;if(Object.prototype.toString.call(E)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=E.length,_=!1;if(!A)return this.resolve([]);for(var w=-1,L=new this(r);++w<A;)V=E[w],I.resolve(V).then(function(H){_||(_=!0,o.resolve(L,H))},function(H){_||(_=!0,o.reject(L,H))});var V;return L}},{immediate:36}],38:[function(t,i,n){var a={};(0,t("./lib/utils/common").assign)(a,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),i.exports=a},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,i,n){var a=t("./zlib/deflate"),r=t("./utils/common"),o=t("./utils/strings"),l=t("./zlib/messages"),c=t("./zlib/zstream"),u=Object.prototype.toString,p=0,m=-1,d=0,y=8;function g(E){if(!(this instanceof g))return new g(E);this.options=r.assign({level:m,method:y,chunkSize:16384,windowBits:15,memLevel:8,strategy:d,to:""},E||{});var I=this.options;I.raw&&0<I.windowBits?I.windowBits=-I.windowBits:I.gzip&&0<I.windowBits&&I.windowBits<16&&(I.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var A=a.deflateInit2(this.strm,I.level,I.method,I.windowBits,I.memLevel,I.strategy);if(A!==p)throw new Error(l[A]);if(I.header&&a.deflateSetHeader(this.strm,I.header),I.dictionary){var _;if(_=typeof I.dictionary=="string"?o.string2buf(I.dictionary):u.call(I.dictionary)==="[object ArrayBuffer]"?new Uint8Array(I.dictionary):I.dictionary,(A=a.deflateSetDictionary(this.strm,_))!==p)throw new Error(l[A]);this._dict_set=!0}}h(g,"p");function C(E,I){var A=new g(I);if(A.push(E,!0),A.err)throw A.msg||l[A.err];return A.result}h(C,"n"),g.prototype.push=function(E,I){var A,_,w=this.strm,L=this.options.chunkSize;if(this.ended)return!1;_=I===~~I?I:I===!0?4:0,typeof E=="string"?w.input=o.string2buf(E):u.call(E)==="[object ArrayBuffer]"?w.input=new Uint8Array(E):w.input=E,w.next_in=0,w.avail_in=w.input.length;do{if(w.avail_out===0&&(w.output=new r.Buf8(L),w.next_out=0,w.avail_out=L),(A=a.deflate(w,_))!==1&&A!==p)return this.onEnd(A),!(this.ended=!0);w.avail_out!==0&&(w.avail_in!==0||_!==4&&_!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(r.shrinkBuf(w.output,w.next_out))):this.onData(r.shrinkBuf(w.output,w.next_out)))}while((0<w.avail_in||w.avail_out===0)&&A!==1);return _===4?(A=a.deflateEnd(this.strm),this.onEnd(A),this.ended=!0,A===p):_!==2||(this.onEnd(p),!(w.avail_out=0))},g.prototype.onData=function(E){this.chunks.push(E)},g.prototype.onEnd=function(E){E===p&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=E,this.msg=this.strm.msg},n.Deflate=g,n.deflate=C,n.deflateRaw=function(E,I){return(I=I||{}).raw=!0,C(E,I)},n.gzip=function(E,I){return(I=I||{}).gzip=!0,C(E,I)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,i,n){var a=t("./zlib/inflate"),r=t("./utils/common"),o=t("./utils/strings"),l=t("./zlib/constants"),c=t("./zlib/messages"),u=t("./zlib/zstream"),p=t("./zlib/gzheader"),m=Object.prototype.toString;function d(g){if(!(this instanceof d))return new d(g);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},g||{});var C=this.options;C.raw&&0<=C.windowBits&&C.windowBits<16&&(C.windowBits=-C.windowBits,C.windowBits===0&&(C.windowBits=-15)),!(0<=C.windowBits&&C.windowBits<16)||g&&g.windowBits||(C.windowBits+=32),15<C.windowBits&&C.windowBits<48&&(15&C.windowBits)==0&&(C.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var E=a.inflateInit2(this.strm,C.windowBits);if(E!==l.Z_OK)throw new Error(c[E]);this.header=new p,a.inflateGetHeader(this.strm,this.header)}h(d,"a");function y(g,C){var E=new d(C);if(E.push(g,!0),E.err)throw E.msg||c[E.err];return E.result}h(y,"o"),d.prototype.push=function(g,C){var E,I,A,_,w,L,V=this.strm,H=this.options.chunkSize,W=this.options.dictionary,ee=!1;if(this.ended)return!1;I=C===~~C?C:C===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof g=="string"?V.input=o.binstring2buf(g):m.call(g)==="[object ArrayBuffer]"?V.input=new Uint8Array(g):V.input=g,V.next_in=0,V.avail_in=V.input.length;do{if(V.avail_out===0&&(V.output=new r.Buf8(H),V.next_out=0,V.avail_out=H),(E=a.inflate(V,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&W&&(L=typeof W=="string"?o.string2buf(W):m.call(W)==="[object ArrayBuffer]"?new Uint8Array(W):W,E=a.inflateSetDictionary(this.strm,L)),E===l.Z_BUF_ERROR&&ee===!0&&(E=l.Z_OK,ee=!1),E!==l.Z_STREAM_END&&E!==l.Z_OK)return this.onEnd(E),!(this.ended=!0);V.next_out&&(V.avail_out!==0&&E!==l.Z_STREAM_END&&(V.avail_in!==0||I!==l.Z_FINISH&&I!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(A=o.utf8border(V.output,V.next_out),_=V.next_out-A,w=o.buf2string(V.output,A),V.next_out=_,V.avail_out=H-_,_&&r.arraySet(V.output,V.output,A,_,0),this.onData(w)):this.onData(r.shrinkBuf(V.output,V.next_out)))),V.avail_in===0&&V.avail_out===0&&(ee=!0)}while((0<V.avail_in||V.avail_out===0)&&E!==l.Z_STREAM_END);return E===l.Z_STREAM_END&&(I=l.Z_FINISH),I===l.Z_FINISH?(E=a.inflateEnd(this.strm),this.onEnd(E),this.ended=!0,E===l.Z_OK):I!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(V.avail_out=0))},d.prototype.onData=function(g){this.chunks.push(g)},d.prototype.onEnd=function(g){g===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},n.Inflate=d,n.inflate=y,n.inflateRaw=function(g,C){return(C=C||{}).raw=!0,y(g,C)},n.ungzip=y},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,i,n){var a=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";n.assign=function(l){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var u=c.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var p in u)u.hasOwnProperty(p)&&(l[p]=u[p])}}return l},n.shrinkBuf=function(l,c){return l.length===c?l:l.subarray?l.subarray(0,c):(l.length=c,l)};var r={arraySet:h(function(l,c,u,p,m){if(c.subarray&&l.subarray)l.set(c.subarray(u,u+p),m);else for(var d=0;d<p;d++)l[m+d]=c[u+d]},"arraySet"),flattenChunks:h(function(l){var c,u,p,m,d,y;for(c=p=0,u=l.length;c<u;c++)p+=l[c].length;for(y=new Uint8Array(p),c=m=0,u=l.length;c<u;c++)d=l[c],y.set(d,m),m+=d.length;return y},"flattenChunks")},o={arraySet:h(function(l,c,u,p,m){for(var d=0;d<p;d++)l[m+d]=c[u+d]},"arraySet"),flattenChunks:h(function(l){return[].concat.apply([],l)},"flattenChunks")};n.setTyped=function(l){l?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,r)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,o))},n.setTyped(a)},{}],42:[function(t,i,n){var a=t("./common"),r=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var l=new a.Buf8(256),c=0;c<256;c++)l[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;function u(p,m){if(m<65537&&(p.subarray&&o||!p.subarray&&r))return String.fromCharCode.apply(null,a.shrinkBuf(p,m));for(var d="",y=0;y<m;y++)d+=String.fromCharCode(p[y]);return d}h(u,"l"),l[254]=l[254]=1,n.string2buf=function(p){var m,d,y,g,C,E=p.length,I=0;for(g=0;g<E;g++)(64512&(d=p.charCodeAt(g)))==55296&&g+1<E&&(64512&(y=p.charCodeAt(g+1)))==56320&&(d=65536+(d-55296<<10)+(y-56320),g++),I+=d<128?1:d<2048?2:d<65536?3:4;for(m=new a.Buf8(I),g=C=0;C<I;g++)(64512&(d=p.charCodeAt(g)))==55296&&g+1<E&&(64512&(y=p.charCodeAt(g+1)))==56320&&(d=65536+(d-55296<<10)+(y-56320),g++),d<128?m[C++]=d:(d<2048?m[C++]=192|d>>>6:(d<65536?m[C++]=224|d>>>12:(m[C++]=240|d>>>18,m[C++]=128|d>>>12&63),m[C++]=128|d>>>6&63),m[C++]=128|63&d);return m},n.buf2binstring=function(p){return u(p,p.length)},n.binstring2buf=function(p){for(var m=new a.Buf8(p.length),d=0,y=m.length;d<y;d++)m[d]=p.charCodeAt(d);return m},n.buf2string=function(p,m){var d,y,g,C,E=m||p.length,I=new Array(2*E);for(d=y=0;d<E;)if((g=p[d++])<128)I[y++]=g;else if(4<(C=l[g]))I[y++]=65533,d+=C-1;else{for(g&=C===2?31:C===3?15:7;1<C&&d<E;)g=g<<6|63&p[d++],C--;1<C?I[y++]=65533:g<65536?I[y++]=g:(g-=65536,I[y++]=55296|g>>10&1023,I[y++]=56320|1023&g)}return u(I,y)},n.utf8border=function(p,m){var d;for((m=m||p.length)>p.length&&(m=p.length),d=m-1;0<=d&&(192&p[d])==128;)d--;return d<0||d===0?m:d+l[p[d]]>m?d:m}},{"./common":41}],43:[function(t,i,n){i.exports=function(a,r,o,l){for(var c=65535&a|0,u=a>>>16&65535|0,p=0;o!==0;){for(o-=p=2e3<o?2e3:o;u=u+(c=c+r[l++]|0)|0,--p;);c%=65521,u%=65521}return c|u<<16|0}},{}],44:[function(t,i,n){i.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,i,n){var a=(function(){for(var r,o=[],l=0;l<256;l++){r=l;for(var c=0;c<8;c++)r=1&r?3988292384^r>>>1:r>>>1;o[l]=r}return o})();i.exports=function(r,o,l,c){var u=a,p=c+l;r^=-1;for(var m=c;m<p;m++)r=r>>>8^u[255&(r^o[m])];return-1^r}},{}],46:[function(t,i,n){var a,r=t("../utils/common"),o=t("./trees"),l=t("./adler32"),c=t("./crc32"),u=t("./messages"),p=0,m=4,d=0,y=-2,g=-1,C=4,E=2,I=8,A=9,_=286,w=30,L=19,V=2*_+1,H=15,W=3,ee=258,me=ee+W+1,N=42,j=113,v=1,z=2,ne=3,X=4;function J(S,Z){return S.msg=u[Z],Z}h(J,"R");function R(S){return(S<<1)-(4<S?9:0)}h(R,"T");function Te(S){for(var Z=S.length;0<=--Z;)S[Z]=0}h(Te,"D");function Y(S){var Z=S.state,$=Z.pending;$>S.avail_out&&($=S.avail_out),$!==0&&(r.arraySet(S.output,Z.pending_buf,Z.pending_out,$,S.next_out),S.next_out+=$,Z.pending_out+=$,S.total_out+=$,S.avail_out-=$,Z.pending-=$,Z.pending===0&&(Z.pending_out=0))}h(Y,"F");function U(S,Z){o._tr_flush_block(S,0<=S.block_start?S.block_start:-1,S.strstart-S.block_start,Z),S.block_start=S.strstart,Y(S.strm)}h(U,"N");function Ee(S,Z){S.pending_buf[S.pending++]=Z}h(Ee,"U");function ue(S,Z){S.pending_buf[S.pending++]=Z>>>8&255,S.pending_buf[S.pending++]=255&Z}h(ue,"P");function he(S,Z){var $,k,M=S.max_chain_length,D=S.strstart,te=S.prev_length,se=S.nice_match,K=S.strstart>S.w_size-me?S.strstart-(S.w_size-me):0,ce=S.window,Se=S.w_mask,pe=S.prev,xe=S.strstart+ee,Qe=ce[D+te-1],Ue=ce[D+te];S.prev_length>=S.good_match&&(M>>=2),se>S.lookahead&&(se=S.lookahead);do if(ce[($=Z)+te]===Ue&&ce[$+te-1]===Qe&&ce[$]===ce[D]&&ce[++$]===ce[D+1]){D+=2,$++;do;while(ce[++D]===ce[++$]&&ce[++D]===ce[++$]&&ce[++D]===ce[++$]&&ce[++D]===ce[++$]&&ce[++D]===ce[++$]&&ce[++D]===ce[++$]&&ce[++D]===ce[++$]&&ce[++D]===ce[++$]&&D<xe);if(k=ee-(xe-D),D=xe-ee,te<k){if(S.match_start=Z,se<=(te=k))break;Qe=ce[D+te-1],Ue=ce[D+te]}}while((Z=pe[Z&Se])>K&&--M!=0);return te<=S.lookahead?te:S.lookahead}h(he,"L");function be(S){var Z,$,k,M,D,te,se,K,ce,Se,pe=S.w_size;do{if(M=S.window_size-S.lookahead-S.strstart,S.strstart>=pe+(pe-me)){for(r.arraySet(S.window,S.window,pe,pe,0),S.match_start-=pe,S.strstart-=pe,S.block_start-=pe,Z=$=S.hash_size;k=S.head[--Z],S.head[Z]=pe<=k?k-pe:0,--$;);for(Z=$=pe;k=S.prev[--Z],S.prev[Z]=pe<=k?k-pe:0,--$;);M+=pe}if(S.strm.avail_in===0)break;if(te=S.strm,se=S.window,K=S.strstart+S.lookahead,ce=M,Se=void 0,Se=te.avail_in,ce<Se&&(Se=ce),$=Se===0?0:(te.avail_in-=Se,r.arraySet(se,te.input,te.next_in,Se,K),te.state.wrap===1?te.adler=l(te.adler,se,Se,K):te.state.wrap===2&&(te.adler=c(te.adler,se,Se,K)),te.next_in+=Se,te.total_in+=Se,Se),S.lookahead+=$,S.lookahead+S.insert>=W)for(D=S.strstart-S.insert,S.ins_h=S.window[D],S.ins_h=(S.ins_h<<S.hash_shift^S.window[D+1])&S.hash_mask;S.insert&&(S.ins_h=(S.ins_h<<S.hash_shift^S.window[D+W-1])&S.hash_mask,S.prev[D&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=D,D++,S.insert--,!(S.lookahead+S.insert<W)););}while(S.lookahead<me&&S.strm.avail_in!==0)}h(be,"j");function _e(S,Z){for(var $,k;;){if(S.lookahead<me){if(be(S),S.lookahead<me&&Z===p)return v;if(S.lookahead===0)break}if($=0,S.lookahead>=W&&(S.ins_h=(S.ins_h<<S.hash_shift^S.window[S.strstart+W-1])&S.hash_mask,$=S.prev[S.strstart&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=S.strstart),$!==0&&S.strstart-$<=S.w_size-me&&(S.match_length=he(S,$)),S.match_length>=W)if(k=o._tr_tally(S,S.strstart-S.match_start,S.match_length-W),S.lookahead-=S.match_length,S.match_length<=S.max_lazy_match&&S.lookahead>=W){for(S.match_length--;S.strstart++,S.ins_h=(S.ins_h<<S.hash_shift^S.window[S.strstart+W-1])&S.hash_mask,$=S.prev[S.strstart&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=S.strstart,--S.match_length!=0;);S.strstart++}else S.strstart+=S.match_length,S.match_length=0,S.ins_h=S.window[S.strstart],S.ins_h=(S.ins_h<<S.hash_shift^S.window[S.strstart+1])&S.hash_mask;else k=o._tr_tally(S,0,S.window[S.strstart]),S.lookahead--,S.strstart++;if(k&&(U(S,!1),S.strm.avail_out===0))return v}return S.insert=S.strstart<W-1?S.strstart:W-1,Z===m?(U(S,!0),S.strm.avail_out===0?ne:X):S.last_lit&&(U(S,!1),S.strm.avail_out===0)?v:z}h(_e,"Z");function we(S,Z){for(var $,k,M;;){if(S.lookahead<me){if(be(S),S.lookahead<me&&Z===p)return v;if(S.lookahead===0)break}if($=0,S.lookahead>=W&&(S.ins_h=(S.ins_h<<S.hash_shift^S.window[S.strstart+W-1])&S.hash_mask,$=S.prev[S.strstart&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=S.strstart),S.prev_length=S.match_length,S.prev_match=S.match_start,S.match_length=W-1,$!==0&&S.prev_length<S.max_lazy_match&&S.strstart-$<=S.w_size-me&&(S.match_length=he(S,$),S.match_length<=5&&(S.strategy===1||S.match_length===W&&4096<S.strstart-S.match_start)&&(S.match_length=W-1)),S.prev_length>=W&&S.match_length<=S.prev_length){for(M=S.strstart+S.lookahead-W,k=o._tr_tally(S,S.strstart-1-S.prev_match,S.prev_length-W),S.lookahead-=S.prev_length-1,S.prev_length-=2;++S.strstart<=M&&(S.ins_h=(S.ins_h<<S.hash_shift^S.window[S.strstart+W-1])&S.hash_mask,$=S.prev[S.strstart&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=S.strstart),--S.prev_length!=0;);if(S.match_available=0,S.match_length=W-1,S.strstart++,k&&(U(S,!1),S.strm.avail_out===0))return v}else if(S.match_available){if((k=o._tr_tally(S,0,S.window[S.strstart-1]))&&U(S,!1),S.strstart++,S.lookahead--,S.strm.avail_out===0)return v}else S.match_available=1,S.strstart++,S.lookahead--}return S.match_available&&(k=o._tr_tally(S,0,S.window[S.strstart-1]),S.match_available=0),S.insert=S.strstart<W-1?S.strstart:W-1,Z===m?(U(S,!0),S.strm.avail_out===0?ne:X):S.last_lit&&(U(S,!1),S.strm.avail_out===0)?v:z}h(we,"W");function Ne(S,Z,$,k,M){this.good_length=S,this.max_lazy=Z,this.nice_length=$,this.max_chain=k,this.func=M}h(Ne,"M");function ot(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=I,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(2*V),this.dyn_dtree=new r.Buf16(2*(2*w+1)),this.bl_tree=new r.Buf16(2*(2*L+1)),Te(this.dyn_ltree),Te(this.dyn_dtree),Te(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(H+1),this.heap=new r.Buf16(2*_+1),Te(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(2*_+1),Te(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}h(ot,"H");function je(S){var Z;return S&&S.state?(S.total_in=S.total_out=0,S.data_type=E,(Z=S.state).pending=0,Z.pending_out=0,Z.wrap<0&&(Z.wrap=-Z.wrap),Z.status=Z.wrap?N:j,S.adler=Z.wrap===2?0:1,Z.last_flush=p,o._tr_init(Z),d):J(S,y)}h(je,"G");function Ct(S){var Z=je(S);return Z===d&&(function($){$.window_size=2*$.w_size,Te($.head),$.max_lazy_match=a[$.level].max_lazy,$.good_match=a[$.level].good_length,$.nice_match=a[$.level].nice_length,$.max_chain_length=a[$.level].max_chain,$.strstart=0,$.block_start=0,$.lookahead=0,$.insert=0,$.match_length=$.prev_length=W-1,$.match_available=0,$.ins_h=0})(S.state),Z}h(Ct,"K");function Ae(S,Z,$,k,M,D){if(!S)return y;var te=1;if(Z===g&&(Z=6),k<0?(te=0,k=-k):15<k&&(te=2,k-=16),M<1||A<M||$!==I||k<8||15<k||Z<0||9<Z||D<0||C<D)return J(S,y);k===8&&(k=9);var se=new ot;return(S.state=se).strm=S,se.wrap=te,se.gzhead=null,se.w_bits=k,se.w_size=1<<se.w_bits,se.w_mask=se.w_size-1,se.hash_bits=M+7,se.hash_size=1<<se.hash_bits,se.hash_mask=se.hash_size-1,se.hash_shift=~~((se.hash_bits+W-1)/W),se.window=new r.Buf8(2*se.w_size),se.head=new r.Buf16(se.hash_size),se.prev=new r.Buf16(se.w_size),se.lit_bufsize=1<<M+6,se.pending_buf_size=4*se.lit_bufsize,se.pending_buf=new r.Buf8(se.pending_buf_size),se.d_buf=1*se.lit_bufsize,se.l_buf=3*se.lit_bufsize,se.level=Z,se.strategy=D,se.method=$,Ct(S)}h(Ae,"Y"),a=[new Ne(0,0,0,0,function(S,Z){var $=65535;for($>S.pending_buf_size-5&&($=S.pending_buf_size-5);;){if(S.lookahead<=1){if(be(S),S.lookahead===0&&Z===p)return v;if(S.lookahead===0)break}S.strstart+=S.lookahead,S.lookahead=0;var k=S.block_start+$;if((S.strstart===0||S.strstart>=k)&&(S.lookahead=S.strstart-k,S.strstart=k,U(S,!1),S.strm.avail_out===0)||S.strstart-S.block_start>=S.w_size-me&&(U(S,!1),S.strm.avail_out===0))return v}return S.insert=0,Z===m?(U(S,!0),S.strm.avail_out===0?ne:X):(S.strstart>S.block_start&&(U(S,!1),S.strm.avail_out),v)}),new Ne(4,4,8,4,_e),new Ne(4,5,16,8,_e),new Ne(4,6,32,32,_e),new Ne(4,4,16,16,we),new Ne(8,16,32,32,we),new Ne(8,16,128,128,we),new Ne(8,32,128,256,we),new Ne(32,128,258,1024,we),new Ne(32,258,258,4096,we)],n.deflateInit=function(S,Z){return Ae(S,Z,I,15,8,0)},n.deflateInit2=Ae,n.deflateReset=Ct,n.deflateResetKeep=je,n.deflateSetHeader=function(S,Z){return S&&S.state?S.state.wrap!==2?y:(S.state.gzhead=Z,d):y},n.deflate=function(S,Z){var $,k,M,D;if(!S||!S.state||5<Z||Z<0)return S?J(S,y):y;if(k=S.state,!S.output||!S.input&&S.avail_in!==0||k.status===666&&Z!==m)return J(S,S.avail_out===0?-5:y);if(k.strm=S,$=k.last_flush,k.last_flush=Z,k.status===N)if(k.wrap===2)S.adler=0,Ee(k,31),Ee(k,139),Ee(k,8),k.gzhead?(Ee(k,(k.gzhead.text?1:0)+(k.gzhead.hcrc?2:0)+(k.gzhead.extra?4:0)+(k.gzhead.name?8:0)+(k.gzhead.comment?16:0)),Ee(k,255&k.gzhead.time),Ee(k,k.gzhead.time>>8&255),Ee(k,k.gzhead.time>>16&255),Ee(k,k.gzhead.time>>24&255),Ee(k,k.level===9?2:2<=k.strategy||k.level<2?4:0),Ee(k,255&k.gzhead.os),k.gzhead.extra&&k.gzhead.extra.length&&(Ee(k,255&k.gzhead.extra.length),Ee(k,k.gzhead.extra.length>>8&255)),k.gzhead.hcrc&&(S.adler=c(S.adler,k.pending_buf,k.pending,0)),k.gzindex=0,k.status=69):(Ee(k,0),Ee(k,0),Ee(k,0),Ee(k,0),Ee(k,0),Ee(k,k.level===9?2:2<=k.strategy||k.level<2?4:0),Ee(k,3),k.status=j);else{var te=I+(k.w_bits-8<<4)<<8;te|=(2<=k.strategy||k.level<2?0:k.level<6?1:k.level===6?2:3)<<6,k.strstart!==0&&(te|=32),te+=31-te%31,k.status=j,ue(k,te),k.strstart!==0&&(ue(k,S.adler>>>16),ue(k,65535&S.adler)),S.adler=1}if(k.status===69)if(k.gzhead.extra){for(M=k.pending;k.gzindex<(65535&k.gzhead.extra.length)&&(k.pending!==k.pending_buf_size||(k.gzhead.hcrc&&k.pending>M&&(S.adler=c(S.adler,k.pending_buf,k.pending-M,M)),Y(S),M=k.pending,k.pending!==k.pending_buf_size));)Ee(k,255&k.gzhead.extra[k.gzindex]),k.gzindex++;k.gzhead.hcrc&&k.pending>M&&(S.adler=c(S.adler,k.pending_buf,k.pending-M,M)),k.gzindex===k.gzhead.extra.length&&(k.gzindex=0,k.status=73)}else k.status=73;if(k.status===73)if(k.gzhead.name){M=k.pending;do{if(k.pending===k.pending_buf_size&&(k.gzhead.hcrc&&k.pending>M&&(S.adler=c(S.adler,k.pending_buf,k.pending-M,M)),Y(S),M=k.pending,k.pending===k.pending_buf_size)){D=1;break}D=k.gzindex<k.gzhead.name.length?255&k.gzhead.name.charCodeAt(k.gzindex++):0,Ee(k,D)}while(D!==0);k.gzhead.hcrc&&k.pending>M&&(S.adler=c(S.adler,k.pending_buf,k.pending-M,M)),D===0&&(k.gzindex=0,k.status=91)}else k.status=91;if(k.status===91)if(k.gzhead.comment){M=k.pending;do{if(k.pending===k.pending_buf_size&&(k.gzhead.hcrc&&k.pending>M&&(S.adler=c(S.adler,k.pending_buf,k.pending-M,M)),Y(S),M=k.pending,k.pending===k.pending_buf_size)){D=1;break}D=k.gzindex<k.gzhead.comment.length?255&k.gzhead.comment.charCodeAt(k.gzindex++):0,Ee(k,D)}while(D!==0);k.gzhead.hcrc&&k.pending>M&&(S.adler=c(S.adler,k.pending_buf,k.pending-M,M)),D===0&&(k.status=103)}else k.status=103;if(k.status===103&&(k.gzhead.hcrc?(k.pending+2>k.pending_buf_size&&Y(S),k.pending+2<=k.pending_buf_size&&(Ee(k,255&S.adler),Ee(k,S.adler>>8&255),S.adler=0,k.status=j)):k.status=j),k.pending!==0){if(Y(S),S.avail_out===0)return k.last_flush=-1,d}else if(S.avail_in===0&&R(Z)<=R($)&&Z!==m)return J(S,-5);if(k.status===666&&S.avail_in!==0)return J(S,-5);if(S.avail_in!==0||k.lookahead!==0||Z!==p&&k.status!==666){var se=k.strategy===2?(function(K,ce){for(var Se;;){if(K.lookahead===0&&(be(K),K.lookahead===0)){if(ce===p)return v;break}if(K.match_length=0,Se=o._tr_tally(K,0,K.window[K.strstart]),K.lookahead--,K.strstart++,Se&&(U(K,!1),K.strm.avail_out===0))return v}return K.insert=0,ce===m?(U(K,!0),K.strm.avail_out===0?ne:X):K.last_lit&&(U(K,!1),K.strm.avail_out===0)?v:z})(k,Z):k.strategy===3?(function(K,ce){for(var Se,pe,xe,Qe,Ue=K.window;;){if(K.lookahead<=ee){if(be(K),K.lookahead<=ee&&ce===p)return v;if(K.lookahead===0)break}if(K.match_length=0,K.lookahead>=W&&0<K.strstart&&(pe=Ue[xe=K.strstart-1])===Ue[++xe]&&pe===Ue[++xe]&&pe===Ue[++xe]){Qe=K.strstart+ee;do;while(pe===Ue[++xe]&&pe===Ue[++xe]&&pe===Ue[++xe]&&pe===Ue[++xe]&&pe===Ue[++xe]&&pe===Ue[++xe]&&pe===Ue[++xe]&&pe===Ue[++xe]&&xe<Qe);K.match_length=ee-(Qe-xe),K.match_length>K.lookahead&&(K.match_length=K.lookahead)}if(K.match_length>=W?(Se=o._tr_tally(K,1,K.match_length-W),K.lookahead-=K.match_length,K.strstart+=K.match_length,K.match_length=0):(Se=o._tr_tally(K,0,K.window[K.strstart]),K.lookahead--,K.strstart++),Se&&(U(K,!1),K.strm.avail_out===0))return v}return K.insert=0,ce===m?(U(K,!0),K.strm.avail_out===0?ne:X):K.last_lit&&(U(K,!1),K.strm.avail_out===0)?v:z})(k,Z):a[k.level].func(k,Z);if(se!==ne&&se!==X||(k.status=666),se===v||se===ne)return S.avail_out===0&&(k.last_flush=-1),d;if(se===z&&(Z===1?o._tr_align(k):Z!==5&&(o._tr_stored_block(k,0,0,!1),Z===3&&(Te(k.head),k.lookahead===0&&(k.strstart=0,k.block_start=0,k.insert=0))),Y(S),S.avail_out===0))return k.last_flush=-1,d}return Z!==m?d:k.wrap<=0?1:(k.wrap===2?(Ee(k,255&S.adler),Ee(k,S.adler>>8&255),Ee(k,S.adler>>16&255),Ee(k,S.adler>>24&255),Ee(k,255&S.total_in),Ee(k,S.total_in>>8&255),Ee(k,S.total_in>>16&255),Ee(k,S.total_in>>24&255)):(ue(k,S.adler>>>16),ue(k,65535&S.adler)),Y(S),0<k.wrap&&(k.wrap=-k.wrap),k.pending!==0?d:1)},n.deflateEnd=function(S){var Z;return S&&S.state?(Z=S.state.status)!==N&&Z!==69&&Z!==73&&Z!==91&&Z!==103&&Z!==j&&Z!==666?J(S,y):(S.state=null,Z===j?J(S,-3):d):y},n.deflateSetDictionary=function(S,Z){var $,k,M,D,te,se,K,ce,Se=Z.length;if(!S||!S.state||(D=($=S.state).wrap)===2||D===1&&$.status!==N||$.lookahead)return y;for(D===1&&(S.adler=l(S.adler,Z,Se,0)),$.wrap=0,Se>=$.w_size&&(D===0&&(Te($.head),$.strstart=0,$.block_start=0,$.insert=0),ce=new r.Buf8($.w_size),r.arraySet(ce,Z,Se-$.w_size,$.w_size,0),Z=ce,Se=$.w_size),te=S.avail_in,se=S.next_in,K=S.input,S.avail_in=Se,S.next_in=0,S.input=Z,be($);$.lookahead>=W;){for(k=$.strstart,M=$.lookahead-(W-1);$.ins_h=($.ins_h<<$.hash_shift^$.window[k+W-1])&$.hash_mask,$.prev[k&$.w_mask]=$.head[$.ins_h],$.head[$.ins_h]=k,k++,--M;);$.strstart=k,$.lookahead=W-1,be($)}return $.strstart+=$.lookahead,$.block_start=$.strstart,$.insert=$.lookahead,$.lookahead=0,$.match_length=$.prev_length=W-1,$.match_available=0,S.next_in=se,S.input=K,S.avail_in=te,$.wrap=D,d},n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,i,n){i.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,i,n){i.exports=function(a,r){var o,l,c,u,p,m,d,y,g,C,E,I,A,_,w,L,V,H,W,ee,me,N,j,v,z;o=a.state,l=a.next_in,v=a.input,c=l+(a.avail_in-5),u=a.next_out,z=a.output,p=u-(r-a.avail_out),m=u+(a.avail_out-257),d=o.dmax,y=o.wsize,g=o.whave,C=o.wnext,E=o.window,I=o.hold,A=o.bits,_=o.lencode,w=o.distcode,L=(1<<o.lenbits)-1,V=(1<<o.distbits)-1;e:do{A<15&&(I+=v[l++]<<A,A+=8,I+=v[l++]<<A,A+=8),H=_[I&L];t:for(;;){if(I>>>=W=H>>>24,A-=W,(W=H>>>16&255)===0)z[u++]=65535&H;else{if(!(16&W)){if((64&W)==0){H=_[(65535&H)+(I&(1<<W)-1)];continue t}if(32&W){o.mode=12;break e}a.msg="invalid literal/length code",o.mode=30;break e}ee=65535&H,(W&=15)&&(A<W&&(I+=v[l++]<<A,A+=8),ee+=I&(1<<W)-1,I>>>=W,A-=W),A<15&&(I+=v[l++]<<A,A+=8,I+=v[l++]<<A,A+=8),H=w[I&V];s:for(;;){if(I>>>=W=H>>>24,A-=W,!(16&(W=H>>>16&255))){if((64&W)==0){H=w[(65535&H)+(I&(1<<W)-1)];continue s}a.msg="invalid distance code",o.mode=30;break e}if(me=65535&H,A<(W&=15)&&(I+=v[l++]<<A,(A+=8)<W&&(I+=v[l++]<<A,A+=8)),d<(me+=I&(1<<W)-1)){a.msg="invalid distance too far back",o.mode=30;break e}if(I>>>=W,A-=W,(W=u-p)<me){if(g<(W=me-W)&&o.sane){a.msg="invalid distance too far back",o.mode=30;break e}if(j=E,(N=0)===C){if(N+=y-W,W<ee){for(ee-=W;z[u++]=E[N++],--W;);N=u-me,j=z}}else if(C<W){if(N+=y+C-W,(W-=C)<ee){for(ee-=W;z[u++]=E[N++],--W;);if(N=0,C<ee){for(ee-=W=C;z[u++]=E[N++],--W;);N=u-me,j=z}}}else if(N+=C-W,W<ee){for(ee-=W;z[u++]=E[N++],--W;);N=u-me,j=z}for(;2<ee;)z[u++]=j[N++],z[u++]=j[N++],z[u++]=j[N++],ee-=3;ee&&(z[u++]=j[N++],1<ee&&(z[u++]=j[N++]))}else{for(N=u-me;z[u++]=z[N++],z[u++]=z[N++],z[u++]=z[N++],2<(ee-=3););ee&&(z[u++]=z[N++],1<ee&&(z[u++]=z[N++]))}break}}break}}while(l<c&&u<m);l-=ee=A>>3,I&=(1<<(A-=ee<<3))-1,a.next_in=l,a.next_out=u,a.avail_in=l<c?c-l+5:5-(l-c),a.avail_out=u<m?m-u+257:257-(u-m),o.hold=I,o.bits=A}},{}],49:[function(t,i,n){var a=t("../utils/common"),r=t("./adler32"),o=t("./crc32"),l=t("./inffast"),c=t("./inftrees"),u=1,p=2,m=0,d=-2,y=1,g=852,C=592;function E(N){return(N>>>24&255)+(N>>>8&65280)+((65280&N)<<8)+((255&N)<<24)}h(E,"L");function I(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new a.Buf16(320),this.work=new a.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}h(I,"s");function A(N){var j;return N&&N.state?(j=N.state,N.total_in=N.total_out=j.total=0,N.msg="",j.wrap&&(N.adler=1&j.wrap),j.mode=y,j.last=0,j.havedict=0,j.dmax=32768,j.head=null,j.hold=0,j.bits=0,j.lencode=j.lendyn=new a.Buf32(g),j.distcode=j.distdyn=new a.Buf32(C),j.sane=1,j.back=-1,m):d}h(A,"a");function _(N){var j;return N&&N.state?((j=N.state).wsize=0,j.whave=0,j.wnext=0,A(N)):d}h(_,"o");function w(N,j){var v,z;return N&&N.state?(z=N.state,j<0?(v=0,j=-j):(v=1+(j>>4),j<48&&(j&=15)),j&&(j<8||15<j)?d:(z.window!==null&&z.wbits!==j&&(z.window=null),z.wrap=v,z.wbits=j,_(N))):d}h(w,"h");function L(N,j){var v,z;return N?(z=new I,(N.state=z).window=null,(v=w(N,j))!==m&&(N.state=null),v):d}h(L,"u");var V,H,W=!0;function ee(N){if(W){var j;for(V=new a.Buf32(512),H=new a.Buf32(32),j=0;j<144;)N.lens[j++]=8;for(;j<256;)N.lens[j++]=9;for(;j<280;)N.lens[j++]=7;for(;j<288;)N.lens[j++]=8;for(c(u,N.lens,0,288,V,0,N.work,{bits:9}),j=0;j<32;)N.lens[j++]=5;c(p,N.lens,0,32,H,0,N.work,{bits:5}),W=!1}N.lencode=V,N.lenbits=9,N.distcode=H,N.distbits=5}h(ee,"j");function me(N,j,v,z){var ne,X=N.state;return X.window===null&&(X.wsize=1<<X.wbits,X.wnext=0,X.whave=0,X.window=new a.Buf8(X.wsize)),z>=X.wsize?(a.arraySet(X.window,j,v-X.wsize,X.wsize,0),X.wnext=0,X.whave=X.wsize):(z<(ne=X.wsize-X.wnext)&&(ne=z),a.arraySet(X.window,j,v-z,ne,X.wnext),(z-=ne)?(a.arraySet(X.window,j,v-z,z,0),X.wnext=z,X.whave=X.wsize):(X.wnext+=ne,X.wnext===X.wsize&&(X.wnext=0),X.whave<X.wsize&&(X.whave+=ne))),0}h(me,"Z"),n.inflateReset=_,n.inflateReset2=w,n.inflateResetKeep=A,n.inflateInit=function(N){return L(N,15)},n.inflateInit2=L,n.inflate=function(N,j){var v,z,ne,X,J,R,Te,Y,U,Ee,ue,he,be,_e,we,Ne,ot,je,Ct,Ae,S,Z,$,k,M=0,D=new a.Buf8(4),te=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!N||!N.state||!N.output||!N.input&&N.avail_in!==0)return d;(v=N.state).mode===12&&(v.mode=13),J=N.next_out,ne=N.output,Te=N.avail_out,X=N.next_in,z=N.input,R=N.avail_in,Y=v.hold,U=v.bits,Ee=R,ue=Te,Z=m;e:for(;;)switch(v.mode){case y:if(v.wrap===0){v.mode=13;break}for(;U<16;){if(R===0)break e;R--,Y+=z[X++]<<U,U+=8}if(2&v.wrap&&Y===35615){D[v.check=0]=255&Y,D[1]=Y>>>8&255,v.check=o(v.check,D,2,0),U=Y=0,v.mode=2;break}if(v.flags=0,v.head&&(v.head.done=!1),!(1&v.wrap)||(((255&Y)<<8)+(Y>>8))%31){N.msg="incorrect header check",v.mode=30;break}if((15&Y)!=8){N.msg="unknown compression method",v.mode=30;break}if(U-=4,S=8+(15&(Y>>>=4)),v.wbits===0)v.wbits=S;else if(S>v.wbits){N.msg="invalid window size",v.mode=30;break}v.dmax=1<<S,N.adler=v.check=1,v.mode=512&Y?10:12,U=Y=0;break;case 2:for(;U<16;){if(R===0)break e;R--,Y+=z[X++]<<U,U+=8}if(v.flags=Y,(255&v.flags)!=8){N.msg="unknown compression method",v.mode=30;break}if(57344&v.flags){N.msg="unknown header flags set",v.mode=30;break}v.head&&(v.head.text=Y>>8&1),512&v.flags&&(D[0]=255&Y,D[1]=Y>>>8&255,v.check=o(v.check,D,2,0)),U=Y=0,v.mode=3;case 3:for(;U<32;){if(R===0)break e;R--,Y+=z[X++]<<U,U+=8}v.head&&(v.head.time=Y),512&v.flags&&(D[0]=255&Y,D[1]=Y>>>8&255,D[2]=Y>>>16&255,D[3]=Y>>>24&255,v.check=o(v.check,D,4,0)),U=Y=0,v.mode=4;case 4:for(;U<16;){if(R===0)break e;R--,Y+=z[X++]<<U,U+=8}v.head&&(v.head.xflags=255&Y,v.head.os=Y>>8),512&v.flags&&(D[0]=255&Y,D[1]=Y>>>8&255,v.check=o(v.check,D,2,0)),U=Y=0,v.mode=5;case 5:if(1024&v.flags){for(;U<16;){if(R===0)break e;R--,Y+=z[X++]<<U,U+=8}v.length=Y,v.head&&(v.head.extra_len=Y),512&v.flags&&(D[0]=255&Y,D[1]=Y>>>8&255,v.check=o(v.check,D,2,0)),U=Y=0}else v.head&&(v.head.extra=null);v.mode=6;case 6:if(1024&v.flags&&(R<(he=v.length)&&(he=R),he&&(v.head&&(S=v.head.extra_len-v.length,v.head.extra||(v.head.extra=new Array(v.head.extra_len)),a.arraySet(v.head.extra,z,X,he,S)),512&v.flags&&(v.check=o(v.check,z,he,X)),R-=he,X+=he,v.length-=he),v.length))break e;v.length=0,v.mode=7;case 7:if(2048&v.flags){if(R===0)break e;for(he=0;S=z[X+he++],v.head&&S&&v.length<65536&&(v.head.name+=String.fromCharCode(S)),S&&he<R;);if(512&v.flags&&(v.check=o(v.check,z,he,X)),R-=he,X+=he,S)break e}else v.head&&(v.head.name=null);v.length=0,v.mode=8;case 8:if(4096&v.flags){if(R===0)break e;for(he=0;S=z[X+he++],v.head&&S&&v.length<65536&&(v.head.comment+=String.fromCharCode(S)),S&&he<R;);if(512&v.flags&&(v.check=o(v.check,z,he,X)),R-=he,X+=he,S)break e}else v.head&&(v.head.comment=null);v.mode=9;case 9:if(512&v.flags){for(;U<16;){if(R===0)break e;R--,Y+=z[X++]<<U,U+=8}if(Y!==(65535&v.check)){N.msg="header crc mismatch",v.mode=30;break}U=Y=0}v.head&&(v.head.hcrc=v.flags>>9&1,v.head.done=!0),N.adler=v.check=0,v.mode=12;break;case 10:for(;U<32;){if(R===0)break e;R--,Y+=z[X++]<<U,U+=8}N.adler=v.check=E(Y),U=Y=0,v.mode=11;case 11:if(v.havedict===0)return N.next_out=J,N.avail_out=Te,N.next_in=X,N.avail_in=R,v.hold=Y,v.bits=U,2;N.adler=v.check=1,v.mode=12;case 12:if(j===5||j===6)break e;case 13:if(v.last){Y>>>=7&U,U-=7&U,v.mode=27;break}for(;U<3;){if(R===0)break e;R--,Y+=z[X++]<<U,U+=8}switch(v.last=1&Y,U-=1,3&(Y>>>=1)){case 0:v.mode=14;break;case 1:if(ee(v),v.mode=20,j!==6)break;Y>>>=2,U-=2;break e;case 2:v.mode=17;break;case 3:N.msg="invalid block type",v.mode=30}Y>>>=2,U-=2;break;case 14:for(Y>>>=7&U,U-=7&U;U<32;){if(R===0)break e;R--,Y+=z[X++]<<U,U+=8}if((65535&Y)!=(Y>>>16^65535)){N.msg="invalid stored block lengths",v.mode=30;break}if(v.length=65535&Y,U=Y=0,v.mode=15,j===6)break e;case 15:v.mode=16;case 16:if(he=v.length){if(R<he&&(he=R),Te<he&&(he=Te),he===0)break e;a.arraySet(ne,z,X,he,J),R-=he,X+=he,Te-=he,J+=he,v.length-=he;break}v.mode=12;break;case 17:for(;U<14;){if(R===0)break e;R--,Y+=z[X++]<<U,U+=8}if(v.nlen=257+(31&Y),Y>>>=5,U-=5,v.ndist=1+(31&Y),Y>>>=5,U-=5,v.ncode=4+(15&Y),Y>>>=4,U-=4,286<v.nlen||30<v.ndist){N.msg="too many length or distance symbols",v.mode=30;break}v.have=0,v.mode=18;case 18:for(;v.have<v.ncode;){for(;U<3;){if(R===0)break e;R--,Y+=z[X++]<<U,U+=8}v.lens[te[v.have++]]=7&Y,Y>>>=3,U-=3}for(;v.have<19;)v.lens[te[v.have++]]=0;if(v.lencode=v.lendyn,v.lenbits=7,$={bits:v.lenbits},Z=c(0,v.lens,0,19,v.lencode,0,v.work,$),v.lenbits=$.bits,Z){N.msg="invalid code lengths set",v.mode=30;break}v.have=0,v.mode=19;case 19:for(;v.have<v.nlen+v.ndist;){for(;Ne=(M=v.lencode[Y&(1<<v.lenbits)-1])>>>16&255,ot=65535&M,!((we=M>>>24)<=U);){if(R===0)break e;R--,Y+=z[X++]<<U,U+=8}if(ot<16)Y>>>=we,U-=we,v.lens[v.have++]=ot;else{if(ot===16){for(k=we+2;U<k;){if(R===0)break e;R--,Y+=z[X++]<<U,U+=8}if(Y>>>=we,U-=we,v.have===0){N.msg="invalid bit length repeat",v.mode=30;break}S=v.lens[v.have-1],he=3+(3&Y),Y>>>=2,U-=2}else if(ot===17){for(k=we+3;U<k;){if(R===0)break e;R--,Y+=z[X++]<<U,U+=8}U-=we,S=0,he=3+(7&(Y>>>=we)),Y>>>=3,U-=3}else{for(k=we+7;U<k;){if(R===0)break e;R--,Y+=z[X++]<<U,U+=8}U-=we,S=0,he=11+(127&(Y>>>=we)),Y>>>=7,U-=7}if(v.have+he>v.nlen+v.ndist){N.msg="invalid bit length repeat",v.mode=30;break}for(;he--;)v.lens[v.have++]=S}}if(v.mode===30)break;if(v.lens[256]===0){N.msg="invalid code -- missing end-of-block",v.mode=30;break}if(v.lenbits=9,$={bits:v.lenbits},Z=c(u,v.lens,0,v.nlen,v.lencode,0,v.work,$),v.lenbits=$.bits,Z){N.msg="invalid literal/lengths set",v.mode=30;break}if(v.distbits=6,v.distcode=v.distdyn,$={bits:v.distbits},Z=c(p,v.lens,v.nlen,v.ndist,v.distcode,0,v.work,$),v.distbits=$.bits,Z){N.msg="invalid distances set",v.mode=30;break}if(v.mode=20,j===6)break e;case 20:v.mode=21;case 21:if(6<=R&&258<=Te){N.next_out=J,N.avail_out=Te,N.next_in=X,N.avail_in=R,v.hold=Y,v.bits=U,l(N,ue),J=N.next_out,ne=N.output,Te=N.avail_out,X=N.next_in,z=N.input,R=N.avail_in,Y=v.hold,U=v.bits,v.mode===12&&(v.back=-1);break}for(v.back=0;Ne=(M=v.lencode[Y&(1<<v.lenbits)-1])>>>16&255,ot=65535&M,!((we=M>>>24)<=U);){if(R===0)break e;R--,Y+=z[X++]<<U,U+=8}if(Ne&&(240&Ne)==0){for(je=we,Ct=Ne,Ae=ot;Ne=(M=v.lencode[Ae+((Y&(1<<je+Ct)-1)>>je)])>>>16&255,ot=65535&M,!(je+(we=M>>>24)<=U);){if(R===0)break e;R--,Y+=z[X++]<<U,U+=8}Y>>>=je,U-=je,v.back+=je}if(Y>>>=we,U-=we,v.back+=we,v.length=ot,Ne===0){v.mode=26;break}if(32&Ne){v.back=-1,v.mode=12;break}if(64&Ne){N.msg="invalid literal/length code",v.mode=30;break}v.extra=15&Ne,v.mode=22;case 22:if(v.extra){for(k=v.extra;U<k;){if(R===0)break e;R--,Y+=z[X++]<<U,U+=8}v.length+=Y&(1<<v.extra)-1,Y>>>=v.extra,U-=v.extra,v.back+=v.extra}v.was=v.length,v.mode=23;case 23:for(;Ne=(M=v.distcode[Y&(1<<v.distbits)-1])>>>16&255,ot=65535&M,!((we=M>>>24)<=U);){if(R===0)break e;R--,Y+=z[X++]<<U,U+=8}if((240&Ne)==0){for(je=we,Ct=Ne,Ae=ot;Ne=(M=v.distcode[Ae+((Y&(1<<je+Ct)-1)>>je)])>>>16&255,ot=65535&M,!(je+(we=M>>>24)<=U);){if(R===0)break e;R--,Y+=z[X++]<<U,U+=8}Y>>>=je,U-=je,v.back+=je}if(Y>>>=we,U-=we,v.back+=we,64&Ne){N.msg="invalid distance code",v.mode=30;break}v.offset=ot,v.extra=15&Ne,v.mode=24;case 24:if(v.extra){for(k=v.extra;U<k;){if(R===0)break e;R--,Y+=z[X++]<<U,U+=8}v.offset+=Y&(1<<v.extra)-1,Y>>>=v.extra,U-=v.extra,v.back+=v.extra}if(v.offset>v.dmax){N.msg="invalid distance too far back",v.mode=30;break}v.mode=25;case 25:if(Te===0)break e;if(he=ue-Te,v.offset>he){if((he=v.offset-he)>v.whave&&v.sane){N.msg="invalid distance too far back",v.mode=30;break}be=he>v.wnext?(he-=v.wnext,v.wsize-he):v.wnext-he,he>v.length&&(he=v.length),_e=v.window}else _e=ne,be=J-v.offset,he=v.length;for(Te<he&&(he=Te),Te-=he,v.length-=he;ne[J++]=_e[be++],--he;);v.length===0&&(v.mode=21);break;case 26:if(Te===0)break e;ne[J++]=v.length,Te--,v.mode=21;break;case 27:if(v.wrap){for(;U<32;){if(R===0)break e;R--,Y|=z[X++]<<U,U+=8}if(ue-=Te,N.total_out+=ue,v.total+=ue,ue&&(N.adler=v.check=v.flags?o(v.check,ne,ue,J-ue):r(v.check,ne,ue,J-ue)),ue=Te,(v.flags?Y:E(Y))!==v.check){N.msg="incorrect data check",v.mode=30;break}U=Y=0}v.mode=28;case 28:if(v.wrap&&v.flags){for(;U<32;){if(R===0)break e;R--,Y+=z[X++]<<U,U+=8}if(Y!==(4294967295&v.total)){N.msg="incorrect length check",v.mode=30;break}U=Y=0}v.mode=29;case 29:Z=1;break e;case 30:Z=-3;break e;case 31:return-4;case 32:default:return d}return N.next_out=J,N.avail_out=Te,N.next_in=X,N.avail_in=R,v.hold=Y,v.bits=U,(v.wsize||ue!==N.avail_out&&v.mode<30&&(v.mode<27||j!==4))&&me(N,N.output,N.next_out,ue-N.avail_out)?(v.mode=31,-4):(Ee-=N.avail_in,ue-=N.avail_out,N.total_in+=Ee,N.total_out+=ue,v.total+=ue,v.wrap&&ue&&(N.adler=v.check=v.flags?o(v.check,ne,ue,N.next_out-ue):r(v.check,ne,ue,N.next_out-ue)),N.data_type=v.bits+(v.last?64:0)+(v.mode===12?128:0)+(v.mode===20||v.mode===15?256:0),(Ee==0&&ue===0||j===4)&&Z===m&&(Z=-5),Z)},n.inflateEnd=function(N){if(!N||!N.state)return d;var j=N.state;return j.window&&(j.window=null),N.state=null,m},n.inflateGetHeader=function(N,j){var v;return N&&N.state?(2&(v=N.state).wrap)==0?d:((v.head=j).done=!1,m):d},n.inflateSetDictionary=function(N,j){var v,z=j.length;return N&&N.state?(v=N.state).wrap!==0&&v.mode!==11?d:v.mode===11&&r(1,j,z,0)!==v.check?-3:me(N,j,z,z)?(v.mode=31,-4):(v.havedict=1,m):d},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,i,n){var a=t("../utils/common"),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];i.exports=function(u,p,m,d,y,g,C,E){var I,A,_,w,L,V,H,W,ee,me=E.bits,N=0,j=0,v=0,z=0,ne=0,X=0,J=0,R=0,Te=0,Y=0,U=null,Ee=0,ue=new a.Buf16(16),he=new a.Buf16(16),be=null,_e=0;for(N=0;N<=15;N++)ue[N]=0;for(j=0;j<d;j++)ue[p[m+j]]++;for(ne=me,z=15;1<=z&&ue[z]===0;z--);if(z<ne&&(ne=z),z===0)return y[g++]=20971520,y[g++]=20971520,E.bits=1,0;for(v=1;v<z&&ue[v]===0;v++);for(ne<v&&(ne=v),N=R=1;N<=15;N++)if(R<<=1,(R-=ue[N])<0)return-1;if(0<R&&(u===0||z!==1))return-1;for(he[1]=0,N=1;N<15;N++)he[N+1]=he[N]+ue[N];for(j=0;j<d;j++)p[m+j]!==0&&(C[he[p[m+j]]++]=j);if(V=u===0?(U=be=C,19):u===1?(U=r,Ee-=257,be=o,_e-=257,256):(U=l,be=c,-1),N=v,L=g,J=j=Y=0,_=-1,w=(Te=1<<(X=ne))-1,u===1&&852<Te||u===2&&592<Te)return 1;for(;;){for(H=N-J,ee=C[j]<V?(W=0,C[j]):C[j]>V?(W=be[_e+C[j]],U[Ee+C[j]]):(W=96,0),I=1<<N-J,v=A=1<<X;y[L+(Y>>J)+(A-=I)]=H<<24|W<<16|ee|0,A!==0;);for(I=1<<N-1;Y&I;)I>>=1;if(I!==0?(Y&=I-1,Y+=I):Y=0,j++,--ue[N]==0){if(N===z)break;N=p[m+C[j]]}if(ne<N&&(Y&w)!==_){for(J===0&&(J=ne),L+=v,R=1<<(X=N-J);X+J<z&&!((R-=ue[X+J])<=0);)X++,R<<=1;if(Te+=1<<X,u===1&&852<Te||u===2&&592<Te)return 1;y[_=Y&w]=ne<<24|X<<16|L-g|0}}return Y!==0&&(y[L+Y]=N-J<<24|64<<16|0),E.bits=ne,0}},{"../utils/common":41}],51:[function(t,i,n){i.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,i,n){var a=t("../utils/common"),r=0,o=1;function l(M){for(var D=M.length;0<=--D;)M[D]=0}h(l,"n");var c=0,u=29,p=256,m=p+1+u,d=30,y=19,g=2*m+1,C=15,E=16,I=7,A=256,_=16,w=17,L=18,V=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],H=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],W=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],ee=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],me=new Array(2*(m+2));l(me);var N=new Array(2*d);l(N);var j=new Array(512);l(j);var v=new Array(256);l(v);var z=new Array(u);l(z);var ne,X,J,R=new Array(d);function Te(M,D,te,se,K){this.static_tree=M,this.extra_bits=D,this.extra_base=te,this.elems=se,this.max_length=K,this.has_stree=M&&M.length}h(Te,"D");function Y(M,D){this.dyn_tree=M,this.max_code=0,this.stat_desc=D}h(Y,"F");function U(M){return M<256?j[M]:j[256+(M>>>7)]}h(U,"N");function Ee(M,D){M.pending_buf[M.pending++]=255&D,M.pending_buf[M.pending++]=D>>>8&255}h(Ee,"U");function ue(M,D,te){M.bi_valid>E-te?(M.bi_buf|=D<<M.bi_valid&65535,Ee(M,M.bi_buf),M.bi_buf=D>>E-M.bi_valid,M.bi_valid+=te-E):(M.bi_buf|=D<<M.bi_valid&65535,M.bi_valid+=te)}h(ue,"P");function he(M,D,te){ue(M,te[2*D],te[2*D+1])}h(he,"L");function be(M,D){for(var te=0;te|=1&M,M>>>=1,te<<=1,0<--D;);return te>>>1}h(be,"j");function _e(M,D,te){var se,K,ce=new Array(C+1),Se=0;for(se=1;se<=C;se++)ce[se]=Se=Se+te[se-1]<<1;for(K=0;K<=D;K++){var pe=M[2*K+1];pe!==0&&(M[2*K]=be(ce[pe]++,pe))}}h(_e,"Z");function we(M){var D;for(D=0;D<m;D++)M.dyn_ltree[2*D]=0;for(D=0;D<d;D++)M.dyn_dtree[2*D]=0;for(D=0;D<y;D++)M.bl_tree[2*D]=0;M.dyn_ltree[2*A]=1,M.opt_len=M.static_len=0,M.last_lit=M.matches=0}h(we,"W");function Ne(M){8<M.bi_valid?Ee(M,M.bi_buf):0<M.bi_valid&&(M.pending_buf[M.pending++]=M.bi_buf),M.bi_buf=0,M.bi_valid=0}h(Ne,"M");function ot(M,D,te,se){var K=2*D,ce=2*te;return M[K]<M[ce]||M[K]===M[ce]&&se[D]<=se[te]}h(ot,"H");function je(M,D,te){for(var se=M.heap[te],K=te<<1;K<=M.heap_len&&(K<M.heap_len&&ot(D,M.heap[K+1],M.heap[K],M.depth)&&K++,!ot(D,se,M.heap[K],M.depth));)M.heap[te]=M.heap[K],te=K,K<<=1;M.heap[te]=se}h(je,"G");function Ct(M,D,te){var se,K,ce,Se,pe=0;if(M.last_lit!==0)for(;se=M.pending_buf[M.d_buf+2*pe]<<8|M.pending_buf[M.d_buf+2*pe+1],K=M.pending_buf[M.l_buf+pe],pe++,se===0?he(M,K,D):(he(M,(ce=v[K])+p+1,D),(Se=V[ce])!==0&&ue(M,K-=z[ce],Se),he(M,ce=U(--se),te),(Se=H[ce])!==0&&ue(M,se-=R[ce],Se)),pe<M.last_lit;);he(M,A,D)}h(Ct,"K");function Ae(M,D){var te,se,K,ce=D.dyn_tree,Se=D.stat_desc.static_tree,pe=D.stat_desc.has_stree,xe=D.stat_desc.elems,Qe=-1;for(M.heap_len=0,M.heap_max=g,te=0;te<xe;te++)ce[2*te]!==0?(M.heap[++M.heap_len]=Qe=te,M.depth[te]=0):ce[2*te+1]=0;for(;M.heap_len<2;)ce[2*(K=M.heap[++M.heap_len]=Qe<2?++Qe:0)]=1,M.depth[K]=0,M.opt_len--,pe&&(M.static_len-=Se[2*K+1]);for(D.max_code=Qe,te=M.heap_len>>1;1<=te;te--)je(M,ce,te);for(K=xe;te=M.heap[1],M.heap[1]=M.heap[M.heap_len--],je(M,ce,1),se=M.heap[1],M.heap[--M.heap_max]=te,M.heap[--M.heap_max]=se,ce[2*K]=ce[2*te]+ce[2*se],M.depth[K]=(M.depth[te]>=M.depth[se]?M.depth[te]:M.depth[se])+1,ce[2*te+1]=ce[2*se+1]=K,M.heap[1]=K++,je(M,ce,1),2<=M.heap_len;);M.heap[--M.heap_max]=M.heap[1],(function(Ue,jt){var ni,rs,Gs,ut,Ys,gi,gs=jt.dyn_tree,Wi=jt.max_code,hr=jt.stat_desc.static_tree,Un=jt.stat_desc.has_stree,cr=jt.stat_desc.extra_bits,Vn=jt.stat_desc.extra_base,q=jt.stat_desc.max_length,bs=0;for(ut=0;ut<=C;ut++)Ue.bl_count[ut]=0;for(gs[2*Ue.heap[Ue.heap_max]+1]=0,ni=Ue.heap_max+1;ni<g;ni++)q<(ut=gs[2*gs[2*(rs=Ue.heap[ni])+1]+1]+1)&&(ut=q,bs++),gs[2*rs+1]=ut,Wi<rs||(Ue.bl_count[ut]++,Ys=0,Vn<=rs&&(Ys=cr[rs-Vn]),gi=gs[2*rs],Ue.opt_len+=gi*(ut+Ys),Un&&(Ue.static_len+=gi*(hr[2*rs+1]+Ys)));if(bs!==0){do{for(ut=q-1;Ue.bl_count[ut]===0;)ut--;Ue.bl_count[ut]--,Ue.bl_count[ut+1]+=2,Ue.bl_count[q]--,bs-=2}while(0<bs);for(ut=q;ut!==0;ut--)for(rs=Ue.bl_count[ut];rs!==0;)Wi<(Gs=Ue.heap[--ni])||(gs[2*Gs+1]!==ut&&(Ue.opt_len+=(ut-gs[2*Gs+1])*gs[2*Gs],gs[2*Gs+1]=ut),rs--)}})(M,D),_e(ce,Qe,M.bl_count)}h(Ae,"Y");function S(M,D,te){var se,K,ce=-1,Se=D[1],pe=0,xe=7,Qe=4;for(Se===0&&(xe=138,Qe=3),D[2*(te+1)+1]=65535,se=0;se<=te;se++)K=Se,Se=D[2*(se+1)+1],++pe<xe&&K===Se||(pe<Qe?M.bl_tree[2*K]+=pe:K!==0?(K!==ce&&M.bl_tree[2*K]++,M.bl_tree[2*_]++):pe<=10?M.bl_tree[2*w]++:M.bl_tree[2*L]++,ce=K,Qe=(pe=0)===Se?(xe=138,3):K===Se?(xe=6,3):(xe=7,4))}h(S,"X");function Z(M,D,te){var se,K,ce=-1,Se=D[1],pe=0,xe=7,Qe=4;for(Se===0&&(xe=138,Qe=3),se=0;se<=te;se++)if(K=Se,Se=D[2*(se+1)+1],!(++pe<xe&&K===Se)){if(pe<Qe)for(;he(M,K,M.bl_tree),--pe!=0;);else K!==0?(K!==ce&&(he(M,K,M.bl_tree),pe--),he(M,_,M.bl_tree),ue(M,pe-3,2)):pe<=10?(he(M,w,M.bl_tree),ue(M,pe-3,3)):(he(M,L,M.bl_tree),ue(M,pe-11,7));ce=K,Qe=(pe=0)===Se?(xe=138,3):K===Se?(xe=6,3):(xe=7,4)}}h(Z,"V"),l(R);var $=!1;function k(M,D,te,se){ue(M,(c<<1)+(se?1:0),3),(function(K,ce,Se,pe){Ne(K),Ee(K,Se),Ee(K,~Se),a.arraySet(K.pending_buf,K.window,ce,Se,K.pending),K.pending+=Se})(M,D,te)}h(k,"J"),n._tr_init=function(M){$||((function(){var D,te,se,K,ce,Se=new Array(C+1);for(K=se=0;K<u-1;K++)for(z[K]=se,D=0;D<1<<V[K];D++)v[se++]=K;for(v[se-1]=K,K=ce=0;K<16;K++)for(R[K]=ce,D=0;D<1<<H[K];D++)j[ce++]=K;for(ce>>=7;K<d;K++)for(R[K]=ce<<7,D=0;D<1<<H[K]-7;D++)j[256+ce++]=K;for(te=0;te<=C;te++)Se[te]=0;for(D=0;D<=143;)me[2*D+1]=8,D++,Se[8]++;for(;D<=255;)me[2*D+1]=9,D++,Se[9]++;for(;D<=279;)me[2*D+1]=7,D++,Se[7]++;for(;D<=287;)me[2*D+1]=8,D++,Se[8]++;for(_e(me,m+1,Se),D=0;D<d;D++)N[2*D+1]=5,N[2*D]=be(D,5);ne=new Te(me,V,p+1,m,C),X=new Te(N,H,0,d,C),J=new Te(new Array(0),W,0,y,I)})(),$=!0),M.l_desc=new Y(M.dyn_ltree,ne),M.d_desc=new Y(M.dyn_dtree,X),M.bl_desc=new Y(M.bl_tree,J),M.bi_buf=0,M.bi_valid=0,we(M)},n._tr_stored_block=k,n._tr_flush_block=function(M,D,te,se){var K,ce,Se=0;0<M.level?(M.strm.data_type===2&&(M.strm.data_type=(function(pe){var xe,Qe=4093624447;for(xe=0;xe<=31;xe++,Qe>>>=1)if(1&Qe&&pe.dyn_ltree[2*xe]!==0)return r;if(pe.dyn_ltree[18]!==0||pe.dyn_ltree[20]!==0||pe.dyn_ltree[26]!==0)return o;for(xe=32;xe<p;xe++)if(pe.dyn_ltree[2*xe]!==0)return o;return r})(M)),Ae(M,M.l_desc),Ae(M,M.d_desc),Se=(function(pe){var xe;for(S(pe,pe.dyn_ltree,pe.l_desc.max_code),S(pe,pe.dyn_dtree,pe.d_desc.max_code),Ae(pe,pe.bl_desc),xe=y-1;3<=xe&&pe.bl_tree[2*ee[xe]+1]===0;xe--);return pe.opt_len+=3*(xe+1)+5+5+4,xe})(M),K=M.opt_len+3+7>>>3,(ce=M.static_len+3+7>>>3)<=K&&(K=ce)):K=ce=te+5,te+4<=K&&D!==-1?k(M,D,te,se):M.strategy===4||ce===K?(ue(M,2+(se?1:0),3),Ct(M,me,N)):(ue(M,4+(se?1:0),3),(function(pe,xe,Qe,Ue){var jt;for(ue(pe,xe-257,5),ue(pe,Qe-1,5),ue(pe,Ue-4,4),jt=0;jt<Ue;jt++)ue(pe,pe.bl_tree[2*ee[jt]+1],3);Z(pe,pe.dyn_ltree,xe-1),Z(pe,pe.dyn_dtree,Qe-1)})(M,M.l_desc.max_code+1,M.d_desc.max_code+1,Se+1),Ct(M,M.dyn_ltree,M.dyn_dtree)),we(M),se&&Ne(M)},n._tr_tally=function(M,D,te){return M.pending_buf[M.d_buf+2*M.last_lit]=D>>>8&255,M.pending_buf[M.d_buf+2*M.last_lit+1]=255&D,M.pending_buf[M.l_buf+M.last_lit]=255&te,M.last_lit++,D===0?M.dyn_ltree[2*te]++:(M.matches++,D--,M.dyn_ltree[2*(v[te]+p+1)]++,M.dyn_dtree[2*U(D)]++),M.last_lit===M.lit_bufsize-1},n._tr_align=function(M){ue(M,2,3),he(M,A,me),(function(D){D.bi_valid===16?(Ee(D,D.bi_buf),D.bi_buf=0,D.bi_valid=0):8<=D.bi_valid&&(D.pending_buf[D.pending++]=255&D.bi_buf,D.bi_buf>>=8,D.bi_valid-=8)})(M)}},{"../utils/common":41}],53:[function(t,i,n){i.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,i,n){(function(a){(function(r,o){if(!r.setImmediate){var l,c,u,p,m=1,d={},y=!1,g=r.document,C=Object.getPrototypeOf&&Object.getPrototypeOf(r);C=C&&C.setTimeout?C:r,l={}.toString.call(r.process)==="[object process]"?function(_){process.nextTick(function(){I(_)})}:(function(){if(r.postMessage&&!r.importScripts){var _=!0,w=r.onmessage;return r.onmessage=function(){_=!1},r.postMessage("","*"),r.onmessage=w,_}})()?(p="setImmediate$"+Math.random()+"$",r.addEventListener?r.addEventListener("message",A,!1):r.attachEvent("onmessage",A),function(_){r.postMessage(p+_,"*")}):r.MessageChannel?((u=new MessageChannel).port1.onmessage=function(_){I(_.data)},function(_){u.port2.postMessage(_)}):g&&"onreadystatechange"in g.createElement("script")?(c=g.documentElement,function(_){var w=g.createElement("script");w.onreadystatechange=function(){I(_),w.onreadystatechange=null,c.removeChild(w),w=null},c.appendChild(w)}):function(_){setTimeout(I,0,_)},C.setImmediate=function(_){typeof _!="function"&&(_=new Function(""+_));for(var w=new Array(arguments.length-1),L=0;L<w.length;L++)w[L]=arguments[L+1];var V={callback:_,args:w};return d[m]=V,l(m),m++},C.clearImmediate=E}function E(_){delete d[_]}h(E,"f");function I(_){if(y)setTimeout(I,0,_);else{var w=d[_];if(w){y=!0;try{(function(L){var V=L.callback,H=L.args;switch(H.length){case 0:V();break;case 1:V(H[0]);break;case 2:V(H[0],H[1]);break;case 3:V(H[0],H[1],H[2]);break;default:V.apply(o,H)}})(w)}finally{E(_),y=!1}}}}h(I,"c");function A(_){_.source===r&&typeof _.data=="string"&&_.data.indexOf(p)===0&&I(+_.data.slice(p.length))}h(A,"d")})(typeof self>"u"?a===void 0?this:a:self)}).call(this,typeof $n<"u"?$n:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Nr)),Nr.exports}h(uS,"requireJszip_min");var dS=uS();const pS=jT(dS),fS=7,Pr="No save files found",Rf="Too many save files found",Ep=class Ep extends Ws{usernameInfoImage;saveDownloadImage;changeLanguageImage;infoContainer;lastFocusedInput=null;getReadableErrorMessage(e){if(!e)return"";const t=e.indexOf(":");switch(t>0&&(e=e.slice(0,t)),e){case Pr:return"P01: "+f.t("menu:noSaves");case Rf:return"P02: "+f.t("menu:tooManySaves")}return super.getReadableErrorMessage(e)}setup(){super.setup(),this.buildInfoContainer()}clear(){super.clear(),this.infoContainer.setVisible(!1).setActive(!1),this.setMouseCursorStyle("default")}destroy(){super.destroy(),this.infoContainer.destroy()}buildInfoContainer(){this.usernameInfoImage=this.buildInteractableImage("settings_icon","username-info-icon",{x:0,scale:.5}),this.saveDownloadImage=this.buildInteractableImage("saving_icon","save-download-icon",{x:20,scale:.75}),this.changeLanguageImage=this.buildInteractableImage("language_icon","change-language-icon",{x:40,scale:.5}),this.infoContainer=s.add.container(0,0).add([this.usernameInfoImage,this.saveDownloadImage,this.changeLanguageImage]).setVisible(!1).disableInteractive(),this.getUi().add(this.infoContainer)}showInfoContainer(e){this.infoContainer.setPosition(5,-76).setVisible(!0),this.getUi().moveTo(this.infoContainer,this.getUi().length-1),this.usernameInfoImage.setPositionRelative(this.infoContainer,0,0).on("pointerdown",()=>this.showUsernames(e)),this.saveDownloadImage.setPositionRelative(this.infoContainer,20,0).on("pointerdown",()=>this.downloadSaves(e)),this.changeLanguageImage.setPositionRelative(this.infoContainer,40,0).on("pointerdown",()=>{this.setInteractive(!1),s.ui.setOverlayMode(x.OPTION_SELECT,{options:Qy,maxOptions:7,delay:1e3})}),this.infoContainer.setAlpha(0),s.tweens.add({targets:this.infoContainer,duration:ge(1e3),ease:"Sine.easeInOut",y:"-=24",alpha:1})}showUsernames(e){if(s.tweens.getTweensOf(this.infoContainer).length>0)return;const t=Object.keys(localStorage),i="data_",n=t.filter(o=>o.includes(i));if(n.length===0){this.onFail(Pr,e);return}if(n.length>fS){this.onFail(Rf,e);return}const a=[],r=h(()=>(s.ui.revertMode(),this.infoContainer.disableInteractive(),this.setInteractive(!0),!0),"handler");for(const o of n)a.push({label:o.replace(i,""),handler:r});s.ui.setOverlayMode(x.OPTION_SELECT,{options:a,delay:1e3}),this.setInteractive(!1),this.infoContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,s.game.canvas.width,s.game.canvas.height),Phaser.Geom.Rectangle.Contains)}async downloadSaves(e){const t=Object.keys(localStorage),i="data_",n="sessionData",a=t.filter(p=>p.includes(i)),r=t.filter(p=>p.includes(n));if(a.length<=0&&r.length<=0){this.onFail(Pr,e);return}const o=new pS;for(const p of a)o.file(p+".prsv",localStorage.getItem(p));for(const p of r)o.file(p+".prsv",localStorage.getItem(p));const l=await o.generateAsync({type:"blob"}),c=URL.createObjectURL(l),u=document.createElement("a");u.href=c,u.download="pokerogue_saves.zip",u.click(),URL.revokeObjectURL(c)}onFail(e,t){const i=s.ui;i.setMode(x.LOADING,{buttonActions:[]}),i.setModeForceTransition(x.LOGIN_OR_REGISTER,Object.assign(t,{errorMessage:e?.trim()})),i.playError()}buildInteractableImage(e,t,i={}){const{scale:n=.07,x:a=0,y:r=0,origin:o={x:0,y:0}}=i,l=s.add.image(a,r,e).setName(t).setOrigin(o.x,o.y).setScale(n).setInteractive();return this.addInteractionHoverEffect(l),l}setInteractive(e){const t=[...this.buttonBgs,this.usernameInfoImage,this.saveDownloadImage,this.changeLanguageImage];for(const i of t)e?i.setInteractive():(i.disableInteractive(),i instanceof Phaser.GameObjects.Image&&i.clearTint());this.setInteractiveInputs(e),this.setMouseCursorStyle("default")}setInteractiveInputs(e){e?setTimeout(()=>{this.lastFocusedInput?.setFocus(),this.lastFocusedInput=null},50):this.lastFocusedInput=this.inputs.find(t=>t.isFocused)??null;for(const t of this.inputs)t.node.disabled=!e}};h(Ep,"LoginRegisterInfoContainerUiHandler");let kn=Ep;const bp=class bp extends kn{discordImage;googleImage;externalPartyContainer;externalPartyBg;externalPartyTitle;setup(){super.setup(),this.buildExternalPartyContainer()}clear(){super.clear(),this.externalPartyContainer.setVisible(!1).setActive(!1),[this.discordImage,this.googleImage].forEach(e=>{e.off("pointerdown")})}destroy(){super.destroy(),this.externalPartyContainer.destroy()}buildExternalPartyContainer(){const{height:e,width:t}=s.scaledCanvas;this.externalPartyContainer=s.add.container(0,0).setInteractive(new Phaser.Geom.Rectangle(0,0,t/2,e/2),Phaser.Geom.Rectangle.Contains),this.externalPartyTitle=P(0,4,"",O.SETTINGS_LABEL).setOrigin(.5,0),this.externalPartyBg=Ce(0,0,0,0),this.discordImage=this.buildInteractableImage("discord","discord-icon"),this.googleImage=this.buildInteractableImage("google","google-icon"),this.externalPartyContainer.add([this.externalPartyBg,this.externalPartyTitle,this.discordImage,this.googleImage]).setVisible(!1),this.getUi().add(this.externalPartyContainer)}setInteractive(e){super.setInteractive(e);const t=this.externalPartyContainer.list.filter(i=>i instanceof Phaser.GameObjects.Image);for(const i of t)e?i.setInteractive():i.disableInteractive()}processExternalProvider(){this.externalPartyTitle.setText(f.t("menu:orUse")).setX(22+this.externalPartyTitle.text.length).setVisible(!0),this.externalPartyContainer.setPositionRelative(this.modalContainer,175,0).setVisible(!0);const t=this.externalPartyTitle.text.length+50;this.externalPartyBg.setSize(t,this.modalBg.height),this.getUi().moveTo(this.externalPartyContainer,this.getUi().length-1);const i=this.externalPartyBg.width/3.1,n=h(a=>encodeURIComponent(`https://api.pokerogue.net/auth/${a}/callback`),"getRedirectUri");this.discordImage.setPosition(i,this.externalPartyBg.height-40).on("pointerdown",()=>{const o=`https://discord.com/api/oauth2/authorize?client_id=1248062921129459756&redirect_uri=${n("discord")}&response_type=code&scope=identify&prompt=none`;window.open(o,"_self")}),this.googleImage.setPosition(i,this.externalPartyBg.height-60).on("pointerdown",()=>{const o=`https://accounts.google.com/o/oauth2/auth?client_id=955345393540-2k6lfftf0fdnb0krqmpthjnqavfvvf73.apps.googleusercontent.com&redirect_uri=${n("google")}&response_type=code&scope=openid`;window.open(o,"_self")}),this.externalPartyContainer.setAlpha(0),s.tweens.add({targets:this.externalPartyContainer,duration:ge(1e3),ease:"Sine.easeInOut",y:"-=24",alpha:1})}};h(bp,"OAuthProvidersUiHandler");let Th=bp;const gS="invalid username",mS="invalid password",yS="account doesn't exist",TS="password doesn't match",Ip=class Ip extends Th{constructor(e=null){super(e)}getModalTitle(){return f.t("menu:login")}getWidth(){return 160}getMargin(){return[0,20,48,0]}getButtonLabels(){return[f.t("menu:login"),f.t("menu:goBack")]}getReadableErrorMessage(e){if(!e)return"";switch(e){case gS:return f.t("menu:invalidLoginUsername");case mS:return f.t("menu:invalidLoginPassword");case yS:return f.t("menu:accountNonExistent");case TS:return f.t("menu:unmatchingPassword")}return super.getReadableErrorMessage(e)}getInputFieldConfigs(){const e=[];return e.push({label:f.t("menu:username")},{label:f.t("menu:password"),isPassword:!0}),e}show(e){if(!super.show(e))return!1;const t=e[0];this.processExternalProvider(),this.showInfoContainer(t);const i=this.submitAction;return this.submitAction=()=>{if(s.tweens.getTweensOf(this.modalContainer).length>0)return;this.submitAction=i,this.sanitizeInputs(),s.ui.setMode(x.LOADING,{buttonActions:[]});const n=h(o=>{s.ui.setMode(x.LOGIN_FORM,Object.assign(t,{errorMessage:o?.trim()})),s.ui.playError()},"onFail");if(!this.inputs[0].text)return n(f.t("menu:emptyUsername"));const[a,r]=this.inputs;at.account.login({username:a.text,password:r.text}).then(o=>{!o&&i?i():n(o)})},!0}};h(Ip,"LoginFormUiHandler");let Ch=Ip;const vp=class vp extends kn{logo;getModalTitle(){return""}getWidth(){return this.buttonLabels.reduce((t,i)=>t+i.width,0)/6+50}getHeight(){return 32}getMargin(){return[0,0,30,0]}getButtonLabels(){return[f.t("menu:login"),f.t("menu:register")]}getInputFieldConfigs(){return[]}setup(){super.setup(),this.logo=s.add.image(-((150-this.getWidth())/2),-52,"logo").setOrigin(0),this.modalContainer.add(this.logo)}show(e){this.logo.setVisible(!0).setActive(!0);const t=e[0];return this.showInfoContainer(t),super.show(e)}clear(){super.clear(),this.logo.setVisible(!1).setActive(!1)}destroy(){super.destroy(),this.logo.destroy()}};h(vp,"LoginOrRegisterUiHandler");let Sh=vp;const pt=Object.freeze({LINK:0,SEARCH:1,ADMIN:2});function CS(T){switch(T){case pt.LINK:return"Link";case pt.SEARCH:return"Search";default:return""}}h(CS,"getAdminModeName");const Bf=-150,SS=0,Lf=0,Op=class Op extends Phaser.GameObjects.Container{defaultWidth;defaultHeight;bg;musicText;shown;constructor(){super(s,Bf,Lf)}setup(){this.defaultWidth=230,this.defaultHeight=100,this.bg=s.add.nineslice(-5,-5,"bgm_bar",void 0,this.defaultWidth,this.defaultHeight,0,0,10,10),this.bg.setOrigin(0,0),this.add(this.bg),this.musicText=P(5,5,"",O.BGM_BAR),this.musicText.setOrigin(0,0),this.musicText.setWordWrapWidth(650,!0),this.add(this.musicText),this.setVisible(!1),this.shown=!1}setBgmToBgmBar(e){this.musicText.setText(`${f.t("bgmName:music")}${this.getRealBgmName(e)}`),this.musicText.width=this.bg.width-20,this.musicText.setWordWrapWidth(this.defaultWidth*4),this.bg.width=Math.min(this.defaultWidth,this.musicText.displayWidth+23),this.bg.height=Math.min(this.defaultHeight,this.musicText.displayHeight+20),s.fieldUI.bringToTop(this),this.y=Lf}toggleBgmBar(e){if(this.musicText.text===""){this.setVisible(!1);return}if(!s.showBgmBar){this.setVisible(!1);return}s.tweens.add({targets:this,x:e?SS:Bf,duration:500,ease:"Sine.easeInOut",onComplete:h(()=>{this.setVisible(!0)},"onComplete")})}getRealBgmName(e){return f.t([`bgmName:${bt(e)}`,"bgmName:missingEntries"],{name:Ri(e)})}};h(Op,"BgmBar");let Eh=Op;var tn=(T=>(T[T.GAME_SETTINGS=0]="GAME_SETTINGS",T[T.ACHIEVEMENTS=1]="ACHIEVEMENTS",T[T.STATS=2]="STATS",T[T.EGG_LIST=3]="EGG_LIST",T[T.EGG_GACHA=4]="EGG_GACHA",T[T.POKEDEX=5]="POKEDEX",T[T.MANAGE_DATA=6]="MANAGE_DATA",T[T.COMMUNITY=7]="COMMUNITY",T[T.SAVE_AND_QUIT=8]="SAVE_AND_QUIT",T[T.LOG_OUT=9]="LOG_OUT",T))(tn||{});let Df="https://wiki.pokerogue.net/start";const ES="https://discord.gg/pokerogue",bS="https://github.com/pagefaultgames/pokerogue",IS="https://www.reddit.com/r/pokerogue",vS="https://github.com/sponsors/pagefaultgames",Ap=class Ap extends Vt{textPadding=8;defaultMessageBoxWidth=220;defaultWordWrapWidth=1224;menuContainer;menuMessageBoxContainer;menuOverlay;menuBg;optionSelectText;cursorObj;excludedMenus;menuOptions;manageDataConfig;communityConfig;menuMessageBox;dialogueMessageBox;scale=.1666666667;bgmBar;constructor(e=null){super(e),this.excludedMenus=()=>[{condition:[x.COMMAND,x.TITLE].includes(e??x.TITLE),options:[4,3]},{condition:pn,options:[9]}],this.menuOptions=ks(tn).filter(t=>!this.excludedMenus().some(i=>i.condition&&i.options.includes(t)))}setup(){const e=this.getUi(),t=f.resolvedLanguage?.substring(0,2);["de","fr","ko","zh"].includes(t)&&(Df=`https://wiki.pokerogue.net/${t}:start`),this.bgmBar=new Eh,this.bgmBar.setup(),e.bgmBar=this.bgmBar,this.menuContainer=s.add.container(1,-s.scaledCanvas.height+1),this.menuContainer.setName("menu"),this.menuContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,s.scaledCanvas.width,s.scaledCanvas.height),Phaser.Geom.Rectangle.Contains),this.menuOverlay=new Phaser.GameObjects.Rectangle(s,-1,-1,s.scaledCanvas.width,s.scaledCanvas.height,16777215,.3),this.menuOverlay.setName("menu-overlay"),this.menuOverlay.setOrigin(0,0),this.menuContainer.add(this.menuOverlay),this.menuContainer.add(this.bgmBar),this.menuContainer.setVisible(!1)}render(){const e=this.getUi();this.excludedMenus=()=>[{condition:s.phaseManager.getCurrentPhase().is("SelectModifierPhase"),options:[4]},{condition:pn,options:[9]}],this.menuOptions=ks(tn).filter(r=>!this.excludedMenus().some(o=>o.condition&&o.options.includes(r))),this.optionSelectText=P(0,0,this.menuOptions.map(r=>`${f.t(`menuUiHandler:${bt(tn[r])}`)}`).join(`
`),O.WINDOW,{maxLines:this.menuOptions.length}),this.optionSelectText.setLineSpacing(12),this.scale=Vi(O.WINDOW).scale,this.menuBg=Ce(s.scaledCanvas.width-(this.optionSelectText.displayWidth+25),0,this.optionSelectText.displayWidth+19+24*this.scale,s.scaledCanvas.height-2),this.menuBg.setOrigin(0,0),this.optionSelectText.setPositionRelative(this.menuBg,10+24*this.scale,6),this.menuContainer.add(this.menuBg),this.menuContainer.add(this.optionSelectText),e.add(this.menuContainer),this.menuMessageBoxContainer=s.add.container(0,130),this.menuMessageBoxContainer.setName("menu-message-box"),this.menuMessageBoxContainer.setVisible(!1),this.menuMessageBox=Ce(0,0,this.defaultMessageBoxWidth,48),this.menuMessageBox.setOrigin(0,0),this.menuMessageBoxContainer.add(this.menuMessageBox),this.dialogueMessageBox=Ce(-this.textPadding,0,s.scaledCanvas.width+this.textPadding*2,49,!1,!1,0,0,us.THIN),this.dialogueMessageBox.setOrigin(0,0),this.menuMessageBoxContainer.add(this.dialogueMessageBox);const t=P(this.textPadding,this.textPadding,"",O.WINDOW,{maxLines:2});t.setName("menu-message"),t.setOrigin(0,0),this.menuMessageBoxContainer.add(t),this.initTutorialOverlay(this.menuContainer),this.initPromptSprite(this.menuMessageBoxContainer),this.message=t,this.setDialogTestMode(!1),this.menuContainer.add(this.menuMessageBoxContainer);const i=[],n=h((r,o,l)=>{e.revertMode(),e.showText(r,null,()=>{const c={options:new Array(5).fill(null).map((u,p)=>p).filter(o).map(u=>({label:f.t("menuUiHandler:slot",{slotNumber:u+1}),handler:h(()=>(l(u),e.revertMode(),e.showText("",0),!0),"handler")})).concat([{label:f.t("menuUiHandler:cancel"),handler:h(()=>(e.revertMode(),e.showText("",0),!0),"handler")}]),xOffset:98};e.setOverlayMode(x.MENU_OPTION_SELECT,c)})},"confirmSlot");i.push({label:f.t("menuUiHandler:exportSession"),handler:h(()=>{const r=[];return Promise.all(new Array(5).fill(null).map((o,l)=>{const c=l;return s.gameData.getSession(c).then(u=>{u&&r.push(c)})})).then(()=>{n(f.t("menuUiHandler:exportSlotSelect"),o=>r.indexOf(o)>-1,o=>s.gameData.tryExportData(tt.SESSION,o))}),!0},"handler"),keepOpen:!0}),i.push({label:f.t("menuUiHandler:importRunHistory"),handler:h(()=>(e.revertMode(),s.gameData.importData(tt.RUN_HISTORY),!0),"handler"),keepOpen:!0}),i.push({label:f.t("menuUiHandler:exportRunHistory"),handler:h(()=>(s.gameData.tryExportData(tt.RUN_HISTORY),!0),"handler"),keepOpen:!0}),i.push({label:f.t("menuUiHandler:exportData"),handler:h(()=>(s.gameData.tryExportData(tt.SYSTEM),!0),"handler"),keepOpen:!0},{label:f.t("menu:changePassword"),handler:h(()=>(e.setOverlayMode(x.CHANGE_PASSWORD_FORM,{buttonActions:[()=>e.revertMode(),()=>e.revertMode()]}),!0),"handler"),keepOpen:!0},{label:f.t("menuUiHandler:consentPreferences"),handler:h(()=>{const r=document.querySelector(".termly-display-preferences"),o=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});return r.dispatchEvent(o),r.focus(),!0},"handler"),keepOpen:!0}),i.push({label:f.t("menuUiHandler:cancel"),handler:h(()=>(s.ui.revertMode(),!0),"handler"),keepOpen:!0}),this.manageDataConfig={xOffset:98,options:i,maxOptions:7};const a=[{label:"Wiki",handler:h(()=>(window.open(Df,"_blank")?.focus(),!0),"handler"),keepOpen:!0},{label:"Discord",handler:h(()=>(window.open(ES,"_blank")?.focus(),!0),"handler"),keepOpen:!0},{label:"GitHub",handler:h(()=>(window.open(bS,"_blank")?.focus(),!0),"handler"),keepOpen:!0},{label:"Reddit",handler:h(()=>(window.open(IS,"_blank")?.focus(),!0),"handler"),keepOpen:!0},{label:f.t("menuUiHandler:donate"),handler:h(()=>(window.open(vS,"_blank")?.focus(),!0),"handler"),keepOpen:!0}];Be?.hasAdminRole&&a.push({label:"Admin",handler:h(()=>{const r=[pt.ADMIN],o=[];return Object.values(pt).filter(l=>!Number.isNaN(Number(l))&&!r.includes(l)).forEach(l=>{o.push({label:CS(l),handler:h(()=>(e.playSelect(),e.setOverlayMode(x.ADMIN,{buttonActions:[()=>{e.revertMode(),e.revertMode()},()=>{e.revertMode(),e.revertMode()}]},l),!0),"handler")})}),o.push({label:"Cancel",handler:h(()=>(e.revertMode(),!0),"handler")}),s.ui.setOverlayMode(x.OPTION_SELECT,{options:o,delay:0}),!0},"handler"),keepOpen:!0}),a.push({label:f.t("menuUiHandler:cancel"),handler:h(()=>(s.ui.revertMode(),!0),"handler")}),this.communityConfig={xOffset:98,options:a},this.setCursor(0)}show(e){return this.render(),super.show(e),this.menuOptions=ks(tn).filter(t=>!this.excludedMenus().some(i=>i.condition&&i.options.includes(t))),this.menuContainer.setVisible(!0),this.setCursor(0),this.getUi().moveTo(this.menuContainer,this.getUi().length-1),this.getUi().hideTooltip(),s.playSound("ui/menu_open"),this.menuContainer.bringToTop(this.tutorialOverlay),this.menuContainer.bringToTop(this.menuMessageBoxContainer),ii(ds.Menu),this.bgmBar.toggleBgmBar(!0),!0}processInput(e){const t=this.getUi();let i=!1,n=!1;if(e===b.ACTION){let a=this.cursor;const r=this.excludedMenus().find(o=>o.condition);if(r!==void 0&&r.options!==void 0&&r.options.length>0){const o=r.options.sort();for(const l of o)if(a>=l)a++;else break}switch(this.showText("",0),a){case 0:t.setOverlayMode(x.SETTINGS),i=!0;break;case 1:t.setOverlayMode(x.ACHIEVEMENTS),i=!0;break;case 2:t.setOverlayMode(x.GAME_STATS),i=!0;break;case 3:s.gameData.eggs.length>0?(t.revertMode(),t.setOverlayMode(x.EGG_LIST),i=!0):(t.showText(f.t("menuUiHandler:noEggs"),null,()=>t.showText(""),ge(1500)),n=!0);break;case 4:t.revertMode(),t.setOverlayMode(x.EGG_GACHA),i=!0;break;case 5:t.revertMode(),t.setOverlayMode(x.POKEDEX),i=!0;break;case 6:this.manageDataConfig.options.some(o=>o.label===f.t("menuUiHandler:linkDiscord")||o.label===f.t("menuUiHandler:unlinkDiscord"))||this.manageDataConfig.options.splice(this.manageDataConfig.options.length-1,0,{label:Be?.discordId===""?f.t("menuUiHandler:linkDiscord"):f.t("menuUiHandler:unlinkDiscord"),handler:h(()=>{if(Be?.discordId===""){const o=Fr(vi),u=`https://discord.com/api/oauth2/authorize?client_id=1248062921129459756&redirect_uri=${encodeURIComponent("https://api.pokerogue.net/auth/discord/callback")}&response_type=code&scope=identify&state=${o}&prompt=none`;return window.open(u,"_self"),!0}return at.unlinkDiscord().then(o=>{Ts().then(()=>s.reset(!0,!0))}),!0},"handler")},{label:Be?.googleId===""?f.t("menuUiHandler:linkGoogle"):f.t("menuUiHandler:unlinkGoogle"),handler:h(()=>{if(Be?.googleId===""){const o=Fr(vi),u=`https://accounts.google.com/o/oauth2/auth?client_id=955345393540-2k6lfftf0fdnb0krqmpthjnqavfvvf73.apps.googleusercontent.com&response_type=code&redirect_uri=${encodeURIComponent("https://api.pokerogue.net/auth/google/callback")}&scope=openid&state=${o}`;return window.open(u,"_self"),!0}return at.unlinkGoogle().then(o=>{Ts().then(()=>s.reset(!0,!0))}),!0},"handler")}),t.setOverlayMode(x.MENU_OPTION_SELECT,this.manageDataConfig),i=!0;break;case 7:t.setOverlayMode(x.MENU_OPTION_SELECT,this.communityConfig),i=!0;break;case 8:if(s.currentBattle){i=!0;const o=h(()=>{t.setMode(x.LOADING,{buttonActions:[],fadeOut:h(()=>s.gameData.saveAll(!0,!0,!0,!0).then(()=>{s.reset(!0)}),"fadeOut")})},"doSaveQuit");s.currentBattle.turn>1?t.showText(f.t("menuUiHandler:losingProgressionWarning"),null,()=>{if(!this.active){this.showText("",0);return}t.setOverlayMode(x.CONFIRM,o,()=>{t.revertMode(),this.showText("",0)},!1,-98)}):o()}else n=!0;break;case 9:{i=!0;const o=h(()=>{t.setMode(x.LOADING,{buttonActions:[],fadeOut:h(()=>at.account.logout().then(()=>{Ts().then(()=>s.reset(!0,!0))}),"fadeOut")})},"doLogout");s.currentBattle?t.showText(f.t("menuUiHandler:losingProgressionWarning"),null,()=>{if(!this.active){this.showText("",0);return}t.setOverlayMode(x.CONFIRM,o,()=>{t.revertMode(),this.showText("",0)},!1,-98)}):o();break}}}else if(e===b.CANCEL)i=!0,t.revertMode().then(a=>{a||t.setMode(x.MESSAGE)});else switch(e){case b.UP:this.cursor?i=this.setCursor(this.cursor-1):i=this.setCursor(this.menuOptions.length-1);break;case b.DOWN:this.cursor+1<this.menuOptions.length?i=this.setCursor(this.cursor+1):i=this.setCursor(0);break}return i?t.playSelect():n&&t.playError(),i||n}setDialogTestMode(e){this.menuMessageBox.setVisible(!e),this.dialogueMessageBox.setVisible(e),this.message.setWordWrapWidth(e?s.ui.getMessageHandler().wordWrapWidth:this.defaultWordWrapWidth),this.message.setX(e?this.textPadding+1:this.textPadding),this.message.setY(e?this.textPadding+.4:this.textPadding)}showText(e,t,i,n,a,r){this.menuMessageBoxContainer.setVisible(!!e),super.showText(e,t,i,n,a,r)}setCursor(e){const t=super.setCursor(e);return this.cursorObj||(this.cursorObj=s.add.image(0,0,"cursor"),this.cursorObj.setOrigin(0,0),this.menuContainer.add(this.cursorObj)),this.cursorObj.setScale(this.scale*6),this.cursorObj.setPositionRelative(this.menuBg,7,6+(18+this.cursor*96)*this.scale),t}clear(){super.clear(),this.menuContainer.setVisible(!1),this.bgmBar.toggleBgmBar(!1),this.eraseCursor()}eraseCursor(){this.cursorObj&&this.cursorObj.destroy(),this.cursorObj=null}};h(Ap,"MenuUiHandler");let bh=Ap;const xp=class xp extends fs{cursorContainer;cursorObj;optionsContainer;optionScrollTweens=new Array(4).fill(null);tooltipWindow;tooltipContainer;tooltipScrollTween;descriptionWindow;descriptionContainer;descriptionScrollTween;rarityBall;dexProgressWindow;dexProgressContainer;showDexProgress=!1;overrideSettings;encounterOptions=[];optionsMeetsReqs;viewPartyIndex=0;viewPartyXPosition=0;blockInput=!0;constructor(){super(x.MYSTERY_ENCOUNTER)}setup(){const e=this.getUi();this.cursorContainer=s.add.container(18,-38.7),this.cursorContainer.setVisible(!1),e.add(this.cursorContainer),this.optionsContainer=s.add.container(12,-38.7),this.optionsContainer.setVisible(!1),e.add(this.optionsContainer),this.dexProgressContainer=s.add.container(214,-43),this.dexProgressContainer.setVisible(!1),e.add(this.dexProgressContainer),this.descriptionContainer=s.add.container(0,-152),this.descriptionContainer.setVisible(!1),e.add(this.descriptionContainer),this.tooltipContainer=s.add.container(210,-48),this.tooltipContainer.setVisible(!1),e.add(this.tooltipContainer),this.setCursor(this.getCursor()),this.descriptionWindow=Ce(0,0,150,105,!1,!1,0,0,us.THIN),this.descriptionContainer.add(this.descriptionWindow),this.tooltipWindow=Ce(0,0,110,48,!1,!1,0,0,us.THIN),this.tooltipContainer.add(this.tooltipWindow),this.dexProgressWindow=Ce(0,0,24,28,!1,!1,0,0,us.THIN),this.dexProgressContainer.add(this.dexProgressWindow),this.rarityBall=s.add.sprite(141,9,"pb"),this.rarityBall.setScale(.75),this.descriptionContainer.add(this.rarityBall);const t=s.add.sprite(12,10,"encounter_radar");t.setScale(.8),this.dexProgressContainer.add(t),this.dexProgressContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,24,28),Phaser.Geom.Rectangle.Contains)}show(e){super.show(e),this.overrideSettings=e[0]??{};const t=this.overrideSettings?.hideDescription==null?!0:!this.overrideSettings.hideDescription,i=this.overrideSettings?.slideInDescription==null?!0:this.overrideSettings.slideInDescription,n=this.overrideSettings?.startingCursorIndex??0;this.cursorContainer.setVisible(!0),this.descriptionContainer.setVisible(t),this.optionsContainer.setVisible(!0),this.dexProgressContainer.setVisible(!0),this.displayEncounterOptions(i);const a=this.getCursor();return a===(this.optionsContainer?.length||0)-1?this.setCursor(a):this.setCursor(n),this.blockInput&&setTimeout(()=>{this.unblockInput()},1e3),this.displayOptionTooltip(),!0}processInput(e){const t=this.getUi();let i=!1;const n=this.getCursor();if(e===b.CANCEL||e===b.ACTION){if(e===b.ACTION){const a=this.encounterOptions[n];if(n===this.viewPartyIndex){i=!0;const r={...this.overrideSettings,slideInDescription:!1};s.ui.setMode(x.PARTY,ts.CHECK,-1,()=>{s.ui.setMode(x.MYSTERY_ENCOUNTER,r),setTimeout(()=>{this.setCursor(this.viewPartyIndex),this.unblockInput()},300)})}else this.blockInput||!this.optionsMeetsReqs[n]&&(a.optionMode===Is.DISABLED_OR_DEFAULT||a.optionMode===Is.DISABLED_OR_SPECIAL)?i=!1:s.phaseManager.getCurrentPhase().handleOptionSelect(a,n)?i=!0:t.playError()}}else{switch(this.optionsContainer.getAll()?.length){default:case 3:i=this.handleTwoOptionMoveInput(e);break;case 4:i=this.handleThreeOptionMoveInput(e);break;case 5:i=this.handleFourOptionMoveInput(e);break}this.displayOptionTooltip()}return i&&t.playSelect(),i}handleTwoOptionMoveInput(e){let t=!1;const i=this.getCursor();switch(e){case b.UP:i<this.viewPartyIndex&&(t=this.setCursor(this.viewPartyIndex));break;case b.DOWN:i===this.viewPartyIndex&&(t=this.setCursor(1));break;case b.LEFT:i>0&&(t=this.setCursor(i-1));break;case b.RIGHT:i<this.viewPartyIndex&&(t=this.setCursor(i+1));break}return t}handleThreeOptionMoveInput(e){let t=!1;const i=this.getCursor();switch(e){case b.UP:i===2?t=this.setCursor(i-2):t=this.setCursor(this.viewPartyIndex);break;case b.DOWN:i===this.viewPartyIndex?t=this.setCursor(1):t=this.setCursor(2);break;case b.LEFT:i===this.viewPartyIndex?t=this.setCursor(1):i===1&&(t=this.setCursor(i-1));break;case b.RIGHT:i===1?t=this.setCursor(this.viewPartyIndex):i<1&&(t=this.setCursor(i+1));break}return t}handleFourOptionMoveInput(e){let t=!1;const i=this.getCursor();switch(e){case b.UP:i>=2&&i!==this.viewPartyIndex?t=this.setCursor(i-2):t=this.setCursor(this.viewPartyIndex);break;case b.DOWN:i<=1?t=this.setCursor(i+2):i===this.viewPartyIndex&&(t=this.setCursor(1));break;case b.LEFT:i===this.viewPartyIndex?t=this.setCursor(1):i%2===1&&(t=this.setCursor(i-1));break;case b.RIGHT:i===1?t=this.setCursor(this.viewPartyIndex):i%2===0&&i!==this.viewPartyIndex&&(t=this.setCursor(i+1));break}return t}unblockInput(){if(this.blockInput){this.blockInput=!1;for(let e=0;e<this.optionsContainer.length-1;e++){const t=this.encounterOptions[e].optionMode;!this.optionsMeetsReqs[e]&&(t===Is.DISABLED_OR_DEFAULT||t===Is.DISABLED_OR_SPECIAL)||this.optionsContainer.getAt(e).setAlpha(1)}}}getCursor(){return this.cursor?this.cursor:0}setCursor(e){const i=this.getCursor()!==e;return i&&(this.cursor=e),this.viewPartyIndex=this.optionsContainer.getAll()?.length-1,this.cursorObj||(this.cursorObj=s.add.image(0,0,"cursor"),this.cursorContainer.add(this.cursorObj)),e===this.viewPartyIndex?this.cursorObj.setPosition(this.viewPartyXPosition,-17):this.optionsContainer.getAll()?.length===3?this.cursorObj.setPosition(-10.5+(e%2===1?100:0),15):this.optionsContainer.getAll()?.length===4?this.cursorObj.setPosition(-10.5+(e%2===1?100:0),7+(e>1?16:0)):this.optionsContainer.getAll()?.length===5&&this.cursorObj.setPosition(-10.5+(e%2===1?100:0),7+(e>1?16:0)),i}displayEncounterOptions(e=!0){this.getUi().clearText();const t=s.currentBattle.mysteryEncounter;this.encounterOptions=this.overrideSettings?.overrideOptions??t.options,this.optionsMeetsReqs=[];const i=ss(t.dialogue.encounterOptionsDialogue?.title,O.TOOLTIP_TITLE),n=ss(t.dialogue.encounterOptionsDialogue?.description,O.TOOLTIP_CONTENT),a=ss(t.dialogue.encounterOptionsDialogue?.query,O.TOOLTIP_CONTENT);this.optionsContainer.removeAll(!0);for(let g=0;g<this.encounterOptions.length;g++){const C=this.encounterOptions[g];let E;switch(this.encounterOptions.length){default:case 2:E=It(g%2===0?0:100,8,"-",O.WINDOW,{fontSize:"80px",lineSpacing:-8});break;case 3:E=It(g%2===0?0:100,g<2?0:16,"-",O.WINDOW,{fontSize:"80px",lineSpacing:-8});break;case 4:E=It(g%2===0?0:100,g<2?0:16,"-",O.WINDOW,{fontSize:"80px",lineSpacing:-8});break}this.optionsMeetsReqs.push(C.meetsRequirements());const I=C.dialogue,A=!this.optionsMeetsReqs[g]&&I.disabledButtonLabel?I.disabledButtonLabel:I.buttonLabel;let _;C.hasRequirements()&&this.optionsMeetsReqs[g]&&(C.optionMode===Is.DEFAULT_OR_SPECIAL||C.optionMode===Is.DISABLED_OR_SPECIAL)?_=ss(A,O.ME_OPTION_SPECIAL):_=ss(A,I.style?I.style:O.ME_OPTION_DEFAULT),_&&E.setText(_),!this.optionsMeetsReqs[g]&&(C.optionMode===Is.DISABLED_OR_DEFAULT||C.optionMode===Is.DISABLED_OR_SPECIAL)&&E.setAlpha(.5),this.blockInput&&E.setAlpha(.5);const w=90,L=s.make.graphics({});L.setScale(6),L.fillStyle(16777215),L.beginPath(),L.fillRect(E.x+11,E.y+140,w,18);const V=L.createGeometryMask();E.setMask(V);const H=E.displayWidth,W=this.optionScrollTweens[g];W&&(W.remove(),this.optionScrollTweens[g]=null),H>w&&(this.optionScrollTweens[g]=s.tweens.add({targets:E,delay:ge(2e3),loop:-1,hold:ge(2e3),duration:ge((H-w)/15*2e3),x:`-=${H-w}`})),this.optionsContainer.add(E)}const r=It(s.scaledCanvas.width,-24,Sr(f.t("mysteryEncounterMessages:viewPartyButton"),O.PARTY),O.PARTY);this.optionsContainer.add(r),r.x-=r.displayWidth+16,this.viewPartyXPosition=r.x-10;const o=It(0,0,i??"",O.TOOLTIP_TITLE,{wordWrap:{width:750},align:"center",lineSpacing:-8});this.descriptionContainer.add(o),o.setPosition(72-o.displayWidth/2,5.5);const l=t.encounterTier===St.COMMON?0:t.encounterTier===St.GREAT?1:t.encounterTier===St.ULTRA?2:t.encounterTier===St.ROGUE?3:4,c=wi(l);this.rarityBall.setTexture("pb",c);const u=It(6,25,n??"",O.TOOLTIP_CONTENT,{wordWrap:{width:830}}),p=s.make.graphics({});p.setScale(6),p.fillStyle(16777215),p.beginPath(),p.fillRect(6,53,206,57);const m=p.createGeometryMask();u.setMask(m);const d=Math.floor(u.displayHeight/9.2);this.descriptionScrollTween&&(this.descriptionScrollTween.remove(),this.descriptionScrollTween=void 0),d>6&&(this.descriptionScrollTween=s.tweens.add({targets:u,delay:ge(2e3),loop:-1,hold:ge(2e3),duration:ge((d-6)*2e3),y:`-=${10*(d-6)}`})),this.descriptionContainer.add(u);const y=It(0,0,a??"",O.TOOLTIP_CONTENT,{wordWrap:{width:830}});this.descriptionContainer.add(y),y.setPosition(75-y.displayWidth/2,90),e&&(this.descriptionContainer.x-=150,s.tweens.add({targets:this.descriptionContainer,x:"+=150",ease:"Sine.easeInOut",duration:1e3}))}displayOptionTooltip(){const e=this.getCursor();if(this.tooltipContainer.length>1&&this.tooltipContainer.removeBetween(1,this.tooltipContainer.length,!0),this.tooltipContainer.setVisible(!0),e==null||e>this.optionsContainer.length-2){this.showHideDexProgress(!1);return}let t;const i=this.encounterOptions[e],n=i.dialogue;if(!this.optionsMeetsReqs[e]&&(i.optionMode===Is.DISABLED_OR_DEFAULT||i.optionMode===Is.DISABLED_OR_SPECIAL)&&n.disabledButtonTooltip?t=ss(n.disabledButtonTooltip,O.TOOLTIP_CONTENT):t=ss(n.buttonTooltip,O.TOOLTIP_CONTENT),t){const a=[...t.match(new RegExp(/\[color=[^[]*\]\[shadow=[^[]*\]/i))][0];t=t.replace(/(\(\+\)[^([]*)/gi,r=>"[/color][/shadow]"+Sr(r,O.SUMMARY_GREEN)+"[/color][/shadow]"+a),t=t.replace(/(\(-\)[^([]*)/gi,r=>"[/color][/shadow]"+Sr(r,O.SUMMARY_BLUE)+"[/color][/shadow]"+a)}if(t){const a=It(6,7,t,O.TOOLTIP_CONTENT,{wordWrap:{width:600},fontSize:"72px",padding:{top:8},lineSpacing:1.25});this.tooltipContainer.add(a);const r=s.make.graphics({});r.setScale(6),r.fillStyle(16777215),r.beginPath(),r.fillRect(this.tooltipContainer.x,this.tooltipContainer.y+188.5,150,32);const o=r.createGeometryMask();a.setMask(o);const l=Math.floor(a.displayHeight/10.2);this.tooltipScrollTween&&(this.tooltipScrollTween.remove(),this.tooltipScrollTween=void 0),l>3&&(this.tooltipScrollTween=s.tweens.add({targets:a,delay:ge(1200),loop:-1,hold:ge(1200),duration:ge((l-3)*1200),y:`-=${11.2*(l-3)}`}))}i.hasDexProgress&&!this.showDexProgress?this.showHideDexProgress(!0):i.hasDexProgress||this.showHideDexProgress(!1)}clear(){super.clear(),this.overrideSettings=void 0,this.optionsContainer.setVisible(!1),this.optionsContainer.removeAll(!0),this.dexProgressContainer.setVisible(!1),this.descriptionContainer.setVisible(!1),this.tooltipContainer.setVisible(!1),this.descriptionContainer.removeBetween(2,this.descriptionContainer.length,!0),this.getUi().getMessageHandler().clearText(),this.eraseCursor()}eraseCursor(){this.cursorObj&&this.cursorObj.destroy(),this.cursorObj=void 0}showHideDexProgress(e){e&&!this.showDexProgress?(this.showDexProgress=!0,s.tweens.killTweensOf(this.dexProgressContainer),s.tweens.add({targets:this.dexProgressContainer,y:-63,ease:"Sine.easeInOut",duration:750,onComplete:h(()=>{this.dexProgressContainer.on("pointerover",()=>{s.ui.showTooltip("",f.t("mysteryEncounterMessages:affectsPokedex"),!0)}),this.dexProgressContainer.on("pointerout",()=>{s.ui.hideTooltip()})},"onComplete")})):!e&&this.showDexProgress&&(this.showDexProgress=!1,s.tweens.killTweensOf(this.dexProgressContainer),s.tweens.add({targets:this.dexProgressContainer,y:-43,ease:"Sine.easeInOut",duration:750,onComplete:h(()=>{this.dexProgressContainer.off("pointerover"),this.dexProgressContainer.off("pointerout")},"onComplete")}))}};h(xp,"MysteryEncounterUiHandler");let Ih=xp;const _p=class _p extends mn{constructor(e=x.OPTION_SELECT){super(e)}getWindowWidth(){return 64}};h(_p,"OptionSelectUiHandler");let Nn=_p;const wp=class wp extends Ws{keys;reducedKeys;parallelKeys;nameKeys;moveKeys;abilityKeys;row;setup(){super.setup(),this.nameKeys=it.map(e=>e.name).filter((e,t,i)=>i.indexOf(e)===t),this.moveKeys=We.map(e=>e.name),this.abilityKeys=_t.map(e=>e.name)}getModalTitle(e){return f.t("pokedexUiHandler:scanChooseOption")}getWidth(e){return 300}getMargin(e){return[0,0,48,0]}getButtonLabels(e){return[f.t("pokedexUiHandler:scanSelect"),f.t("pokedexUiHandler:scanCancel")]}getReadableErrorMessage(e){const t=e?.indexOf(":");return t>0&&(e=e.slice(0,t)),super.getReadableErrorMessage(e)}getInputFieldConfigs(){switch(this.row){case mt.NAME:return[{label:f.t("pokedexUiHandler:scanLabelName")}];case mt.MOVE_1:case mt.MOVE_2:return[{label:f.t("pokedexUiHandler:scanLabelMove")}];case mt.ABILITY_1:return[{label:f.t("pokedexUiHandler:scanLabelAbility")}];case mt.ABILITY_2:return[{label:f.t("pokedexUiHandler:scanLabelPassive")}];default:return[{label:""}]}}reduceKeys(){switch(this.row){case mt.NAME:{this.reducedKeys=this.nameKeys;break}case mt.MOVE_1:case mt.MOVE_2:{this.reducedKeys=this.moveKeys;break}case mt.ABILITY_1:case mt.ABILITY_2:{this.reducedKeys=this.abilityKeys;break}default:this.reducedKeys=this.keys}}show(e){this.row=e[2];const t=this.getUi(),i=!!this.getModalTitle();this.updateFields(this.getInputFieldConfigs(),i),this.updateContainer(e[0]);const n=this.inputs[0];if(n.setMaxLength(255),this.reduceKeys(),n.on("keydown",(a,r)=>{["escape","space"].some(o=>o===r.key.toLowerCase()||o===r.code.toLowerCase())&&t.getMode()===x.AUTO_COMPLETE&&(a.on("blur",()=>a.node.focus(),{once:!0}),t.revertMode())}),n.on("textchange",(a,r)=>{t.getMode()===x.AUTO_COMPLETE&&t.revertMode();let o=[];const l=this.reducedKeys.filter(c=>c.toLowerCase().includes(a.text.toLowerCase()));if(a.text!==""&&l.length>0&&(o=l.slice(0).map(c=>({label:c,handler:h(()=>((r.data!=null||r.inputType?.toLowerCase()==="deletecontentbackward")&&a.setText(c),t.revertMode(),!0),"handler")}))),o.length>0){const c={options:o,maxOptions:5,modalContainer:this.modalContainer};t.setOverlayMode(x.AUTO_COMPLETE,c)}}),super.show(e)){const a=e[0],r=this.formLabels[0],o=r.width<420?200:200-(r.width-420)/5.75;return this.inputs[0].resize(o*5.75,116),this.inputContainers[0].list[0].width=o,e[1]&&typeof e[1].getNameToRender=="function"?this.inputs[0].text=e[1].getNameToRender():this.inputs[0].text=e[1],this.submitAction=()=>{if(t.getMode()===x.POKEDEX_SCAN){this.sanitizeInputs();const l=this.reducedKeys.includes(this.inputs[0].text)?this.inputs[0].text:"",c=btoa(unescape(encodeURIComponent(l)));return a.buttonActions[0](c),!0}return!1},!0}return!1}clear(){super.clear(),this.formLabels.forEach(e=>{e.destroy()})}};h(wp,"PokedexScanUiHandler");let vh=wp;const Mp=class Mp extends kn{getModalTitle(){return f.t("menu:register")}getWidth(){return 160}getMargin(){return[0,20,48,0]}getButtonTopMargin(){return 12}getButtonLabels(){return[f.t("menu:register"),f.t("menu:goBack")]}getReadableErrorMessage(e){const t=e?.indexOf(":");switch(t>0&&(e=e.slice(0,t)),e){case"invalid username":return f.t("menu:invalidRegisterUsername");case"invalid password":return f.t("menu:invalidRegisterPassword");case"failed to add account record":return f.t("menu:usernameAlreadyUsed")}return super.getReadableErrorMessage(e)}getInputFieldConfigs(){const e=[];return e.push({label:f.t("menu:username")}),e.push({label:f.t("menu:password"),isPassword:!0}),e.push({label:f.t("menu:confirmPassword"),isPassword:!0}),e}setup(){super.setup();const e=P(10,87,f.t("menu:registrationAgeWarning"),O.TOOLTIP_CONTENT,{fontSize:"42px",wordWrap:{width:850}});this.modalContainer.add(e)}show(e){if(!super.show(e))return!1;const t=e[0];this.showInfoContainer(t);const i=this.submitAction;return this.submitAction=()=>{if(s.tweens.getTweensOf(this.modalContainer).length===0){this.submitAction=i,this.sanitizeInputs(),s.ui.setMode(x.LOADING,{buttonActions:[]});const n=h(o=>{s.ui.setMode(x.REGISTRATION_FORM,Object.assign(t,{errorMessage:o?.trim()})),s.ui.playError()},"onFail");if(!this.inputs[0].text)return n(f.t("menu:emptyUsername"));if(!this.inputs[1].text)return n(this.getReadableErrorMessage("invalid password"));if(this.inputs[1].text!==this.inputs[2].text)return n(f.t("menu:passwordNotMatchingConfirmPassword"));const[a,r]=this.inputs;at.account.register({username:a.text,password:r.text}).then(o=>{if(o)n(o);else{const l=a.text,c=r.text;at.account.login({username:l,password:c}).then(u=>{if(u){const p=h(()=>{at.account.login({username:l,password:c}).then(m=>{m?s.phaseManager.getCurrentPhase().goToLogin():i?.()})},"retryLogin");s.time.delayedCall(ge(2e3),p)}else i?.()})}})}},!0}};h(Mp,"RegistrationFormUiHandler");let Oh=Mp;const kp=class kp extends Ws{getModalTitle(e){return f.t("menu:renamePokemon")}getWidth(e){return 160}getMargin(e){return[0,0,48,0]}getButtonLabels(e){return[f.t("menu:rename"),f.t("menu:cancel")]}getReadableErrorMessage(e){const t=e?.indexOf(":");return t>0&&(e=e.slice(0,t)),super.getReadableErrorMessage(e)}getInputFieldConfigs(){return[{label:f.t("menu:nickname")}]}show(e){if(super.show(e)){const t=e[0];return e[1]&&typeof e[1].getNameToRender=="function"?this.inputs[0].text=e[1].getNameToRender(!1):this.inputs[0].text=e[1],this.submitAction=()=>{this.sanitizeInputs();const i=btoa(unescape(encodeURIComponent(this.inputs[0].text)));return t.buttonActions[0](i),!0},!0}return!1}};h(kp,"RenameFormUiHandler");let Ah=kp;const Np=class Np extends Phaser.GameObjects.Container{icon;animActive;shown;constructor(){super(s,s.scaledCanvas.width-4,s.scaledCanvas.height-4)}setup(){this.icon=s.add.sprite(0,0,"saving_icon"),this.icon.setOrigin(1,1),this.add(this.icon),this.animActive=!1,this.shown=!1,this.setAlpha(0),this.setVisible(!1)}show(){this.shown=!0,!this.animActive&&(this.animActive=!0,s.tweens.add({targets:this,alpha:1,duration:ge(250),ease:"Sine.easeInOut",onComplete:h(()=>{s.time.delayedCall(ge(500),()=>{this.animActive=!1,this.shown||this.hide()})},"onComplete")}),this.setVisible(!0),this.shown=!0)}hide(){this.shown=!1,!this.animActive&&(this.animActive=!0,s.tweens.add({targets:this,alpha:0,duration:ge(250),ease:"Sine.easeInOut",onComplete:h(()=>{this.animActive=!1,this.setVisible(!1),this.shown&&this.show()},"onComplete")}),this.shown=!1)}};h(Np,"SavingIconContainer");let xh=Np;const Pp=class Pp extends Ui{constructor(e=null){super(e)}getModalTitle(){return""}getWidth(){return 160}getHeight(){return 32}getMargin(){return[0,0,48,0]}getButtonLabels(){return[]}setup(){super.setup();const e=P(this.getWidth()/2,this.getHeight()/2,`Your session is out of date.
Your data will be reloaded`,O.WINDOW,{fontSize:"48px",align:"center"});e.setOrigin(.5,.5),this.modalContainer.add(e)}show(e){const t={buttonActions:[]};return super.show([t])}};h(Pp,"SessionReloadModalUiHandler");let _h=Pp;const Rp=class Rp extends fs{fieldIndex;move;targetSelectCallback;cursor0;cursor1;isMultipleTargets=!1;targets;targetsHighlighted;targetFlashTween;enemyModifiers;targetBattleInfoMoveTween=[];constructor(){super(x.TARGET_SELECT),this.cursor=-1}setup(){}show(e){if(e.length<3)return!1;super.show(e),this.fieldIndex=e[0],this.move=e[1],this.targetSelectCallback=e[2];const t=s.getPlayerField()[this.fieldIndex],i=Dh(t,this.move);return this.targets=i.targets,this.isMultipleTargets=i.multiple??!1,this.targets.length===0?!1:(this.enemyModifiers=s.getModifierBar(!0),this.fieldIndex===nt.PLAYER?this.resetCursor(this.cursor0,t):this.fieldIndex===nt.PLAYER_2&&this.resetCursor(this.cursor1,t),!0)}resetCursor(e,t){e!=null&&([nt.PLAYER,nt.PLAYER_2].includes(e)||t.tempSummonData.waveTurnCount===1)&&(e=-1),this.setCursor(this.targets.includes(e)?e:this.targets[0])}processInput(e){const t=this.getUi();let i=!1;if(e===b.ACTION||e===b.CANCEL){const n=this.isMultipleTargets?this.targets:[this.cursor];this.targetSelectCallback(e===b.ACTION?n:[]),i=!0,this.fieldIndex===nt.PLAYER?(this.cursor0==null||this.cursor0!==this.cursor)&&(this.cursor0=this.cursor):this.fieldIndex===nt.PLAYER_2&&(this.cursor1==null||this.cursor1!==this.cursor)&&(this.cursor1=this.cursor)}else if(this.isMultipleTargets)i=!1;else switch(e){case b.UP:this.cursor<nt.ENEMY&&this.targets.findIndex(n=>n>=nt.ENEMY)>-1&&(i=this.setCursor(this.targets.find(n=>n>=nt.ENEMY)));break;case b.DOWN:this.cursor>=nt.ENEMY&&this.targets.findIndex(n=>n<nt.ENEMY)>-1&&(i=this.setCursor(this.targets.find(n=>n<nt.ENEMY)));break;case b.LEFT:this.cursor%2&&this.targets.findIndex(n=>n===this.cursor-1)>-1&&(i=this.setCursor(this.cursor-1));break;case b.RIGHT:!(this.cursor%2)&&this.targets.findIndex(n=>n===this.cursor+1)>-1&&(i=this.setCursor(this.cursor+1));break}return i&&t.playSelect(),i}setCursor(e){const t=s.getField()[e],i=this.targets.map(r=>s.getField()[r]);this.targetsHighlighted=this.isMultipleTargets?i:[t];const n=super.setCursor(e);if(this.targetFlashTween){this.targetFlashTween.stop();for(const r of i)r.setAlpha(r.getTag(Ns)?.5:1),this.highlightItems(r.id,1)}if(this.targetFlashTween=s.tweens.add({targets:this.targetsHighlighted,key:{start:1,to:.25},loop:-1,loopDelay:150,duration:ge(450),ease:"Sine.easeInOut",yoyo:!0,onUpdate:h(r=>{for(const o of this.targetsHighlighted)o.setAlpha(r.getValue()??1),this.highlightItems(o.id,r.getValue()??1)},"onUpdate")}),this.targetBattleInfoMoveTween.length>0){this.targetBattleInfoMoveTween.filter(r=>r!==void 0).forEach(r=>r.stop());for(const r of i)r.getBattleInfo().resetY()}return this.targetsHighlighted.map(r=>r.getBattleInfo()).map(r=>{this.targetBattleInfoMoveTween.push(s.tweens.add({targets:[r],y:{start:r.getBaseY(),to:r.getBaseY()+1},loop:-1,duration:ge(250),ease:"Linear",yoyo:!0}))}),n}eraseCursor(){this.targetFlashTween&&(this.targetFlashTween.stop(),this.targetFlashTween=null);for(const e of this.targetsHighlighted)e.setAlpha(e.getTag(Ns)?.5:1),this.highlightItems(e.id,1);this.targetBattleInfoMoveTween.length>0&&(this.targetBattleInfoMoveTween.filter(e=>e!==void 0).forEach(e=>e.stop()),this.targetBattleInfoMoveTween=[]);for(const e of this.targetsHighlighted)e.getBattleInfo().resetY()}highlightItems(e,t){const i=this.enemyModifiers.getAll("name",e.toString());for(const n of i)n.setAlpha(t)}clear(){super.clear(),this.eraseCursor()}};h(Rp,"TargetSelectUiHandler");let wh=Rp;const Bp=class Bp extends Ws{keys;setup(){super.setup();const e=h((n,a,r)=>Object.keys(n??{}).map((o,l)=>{const c=Object.values(n)[l];if(typeof c=="object"&&c!=null)return e(c,a??o,a?r?[...r,o]:[o]:void 0).filter(u=>u.length>0);if(typeof c=="string"||c==null)return r?`${a}:${r.join(".")}.${o}`:`${a}:${o}`}).filter(o=>o),"flattenKeys"),i=e(f.getDataByLanguage(String(f.resolvedLanguage))).filter(n=>n.length>0).flat(Number.POSITIVE_INFINITY).map(String);this.keys=i}getModalTitle(e){return"Test Dialogue"}getWidth(e){return 300}getMargin(e){return[0,0,48,0]}getButtonLabels(e){return["Check","Cancel"]}getReadableErrorMessage(e){const t=e?.indexOf(":");return t>0&&(e=e.slice(0,t)),super.getReadableErrorMessage(e)}getInputFieldConfigs(){return[{label:"Dialogue"}]}show(e){const t=this.getUi(),i=!!this.getModalTitle();this.updateFields(this.getInputFieldConfigs(),i),this.updateContainer(e[0]);const n=this.inputs[0];if(n.setMaxLength(255),n.on("keydown",(a,r)=>{["escape","space"].some(o=>o===r.key.toLowerCase()||o===r.code.toLowerCase())&&t.getMode()===x.AUTO_COMPLETE&&(a.on("blur",()=>a.node.focus(),{once:!0}),t.revertMode())}),n.on("textchange",(a,r)=>{t.getMode()===x.AUTO_COMPLETE&&t.revertMode();let o=[];const l=a.text.split(" "),c=this.keys.filter(u=>u.toLowerCase().includes(l.at(-1).toLowerCase()));if(a.text!==""&&c.length>0&&(o=c.slice(0).map(u=>({label:u,handler:h(()=>{if(r.data!=null||r.inputType?.toLowerCase()==="deletecontentbackward"){const p=a.text.split(" ");p[p.length-1]=u,a.setText(p.join(" "))}return t.revertMode(),!0},"handler")}))),o.length>0){const u={options:o,maxOptions:5,modalContainer:this.modalContainer};t.setOverlayMode(x.AUTO_COMPLETE,u)}}),super.show(e)){const a=e[0];return this.inputs[0].resize(1150,116),this.inputContainers[0].list[0].width=200,e[1]&&typeof e[1].getNameToRender=="function"?this.inputs[0].text=e[1].getNameToRender():this.inputs[0].text=e[1],this.submitAction=()=>{if(t.getMode()===x.TEST_DIALOGUE){this.sanitizeInputs();const r=btoa(unescape(encodeURIComponent(this.inputs[0].text)));return a.buttonActions[0](r),!0}return!1},!0}return!1}};h(Bp,"TestDialogueUiHandler");let Mh=Bp;const OS=15,AS=10,Ff=15,xS=[...new Array(OS).fill("battlesWon"),...new Array(AS).fill("underratedPokemon"),"joinTheDiscord","infiniteLevels","everythingIsStackable","optionalSaveScumming","biomes","openSource","playWithSpeed","liveBugTesting","heavyInfluence","pokemonRiskAndPokemonRain","nowWithMoreSalt","infiniteFusionAtHome","brokenEggMoves","magnificent","doPeopleReadThis","thatsCrazy","gottaCatchEmAll","questionableBalancing","coolShaders","aiFree","suddenDifficultySpikes","basedOnAnUnfinishedFlashGame","moreAddictiveThanIntended","mostlyConsistentSeeds","achievementPointsDontDoAnything","nothingBeatsAJellyFilledDonut","dontTalkAboutThePokemonIncident","alsoTryPokengine","alsoTryEmeraldRogue","alsoTryRadicalRed","eeveeExpo","checkOutYnoproject","breedersInSpace","alsoTryPokemonUnbound","tryTheJohtoDragonChallenge","basicReadingAbilityRecommended","shoutoutsToTheArtists","gamblingNotEncouraged","dontForgetToTakeABreak","wEvent","ifItsNotAccurateItsAccurate","everyLossIsProgressMade","liveWoChienReaction","itsAFeatureNotABug","theEggsAreNotForEating","tooManyWaterBiomes","butNothingHappened","thePowerOfScienceIsAmazing","freeToPlay","theresATimeAndPlaceForEverything","nowWithShinierShinies","smilesGoForMiles","certainlyNotDragonFree","haveANiceDay","redacted","hi","transRights","shinyOddsHigherThanYouThink","noFalseTrades","notForProfit","timeForYourDailyRun","moreEggsThanADaycare","disclaimerHarshSunDoesNotGiveVitaminD","whoNeedsAMap","luxrayIsNotADarkType","selfDestructiveEncounters","mostOptionsAreViable","pokerogueMorse","smiley","beAwareOfPassives","asSeenOnTheWorldWideWeb","vaultinVeluzas","tooManyStarters","checkTheWiki","winWithYourFavorites","alsoTryPokerogueWait","theWayISeeItKyogreIsSurrounded","tryOutHoneyGather","notForTheFaintOfHeart","p","flipYourDeviceToEvolveInkay","inArceusWeTrust","whyDidTheTorchicCrossTheRoad","goodLuck","fuseWisely","compensation","prepareForTroubleAndMakeItDouble","anEggForYourTroubles","regirock","hereForAGoodTime","getGoodOrDont","checkTheSubreddit","betterNerfGreninja","inCaseOfUpdateClearYourCache","insertTextHere","endingEndlessNotFound","iLikeMyEggsVouchered","you","noAddedSugar","notSponsored","notRated","justOneMoreWaveMom","saltCured","onlyOnPokerogueNet","pixelPerfection","openSource","probablyGood","itsAMonsterHouse","dontForgetYourPassword","tripleTripleTripleAxel","questionExclamation","clownEncounters","fullOfBerries","limitsAreMeantToBeBrokenSometimes","keepItCasual","serversProbablyWorking","mew","makeItRainAndYourProblemsGoAway","customMusicTracks","youAreValid","number591IsLookingOff","timeForYourDeliDelivery","goodFirstImpression","iPreferRarerCandies","pocketRoguelite","porygonDidNothingWrong","critMattered","pickupNotRequired","stayHydrated","alsoTryCobblemon","alsoTryPokeDoku","mySleepStyleIsDoesnt","makeYourOwnWorldChampDifference","yoChampInTheMaking","notLiableForDecisionAnxiety","theAirIsTastyHere","continue","startANewRunToday","neverGiveUp","theresAlwaysNextTime","oneTwoThreeAndPoof","yourPokemonOnlyGoToLevelOneHundred","theBattlesWillBeLegendary","levelCurveBetterThanJohto","alsoTryShowering","wellStillBeHere","weHopeToSeeYouAgain","aHealthyTeamCanMeanGreaterRewards","aWildPokemonAppeared","isThisThingOn","needsMoreTesting","whoChecksStatChanges","whenTwoTrainersEyesMeet","notOfficiallyOnSteam","fiftyFifty","metaNotIncluded","bornToBeAWinner","onARollout","itsAlwaysNightDeepInTheAbyss","folksThisIsInsane"],_S=[{name:"New Year's",start:"01-01",end:"01-15",messages:["newYears.happyNewYear","newYears.andAHappyNewYear"]},{name:"Valentines",start:"02-07",end:"02-21",messages:["valentines.happyValentines","valentines.fullOfLove","valentines.applinForYou","valentines.thePowerOfLoveIsThreeThirtyBst","valentines.haveAHeartScale","valentines.i<3You"]},{name:"April Fools",start:"04-01",end:"04-03",messages:["aprilFools.battlesOne","aprilFools.aprilFools","aprilFools.removedPokemon","aprilFools.helloKyleAmber","aprilFools.gotcha","aprilFools.alsoTryPokerogueTwo","aprilFools.nowWithSameScumCountermeasures","aprilFools.neverGonnaGiveYouGoodRolls","aprilFools.youBumblingBuffoon","aprilFools.doubleShinyOddsForTrainersOnly","aprilFools.nowWithZMoves","aprilFools.newLightType","aprilFools.removedMegas","aprilFools.nerfedYourFavorites","aprilFools.grrr","aprilFools.enabledEternatusPassiveGoodLuck","aprilFools.theDarkestDaySoundsLikeAFutureProblem","aprilFools.tmShopWhen","aprilFools.whoIsFinn","aprilFools.watchOutForShadowPokemon","aprilFools.nowWithDarkTypeLuxray","aprilFools.onlyOnPokerogueNetAgain","aprilFools.noFreeVouchers","aprilFools.altffourAchievementPoints","aprilFools.rokePogue","aprilFools.readMe","aprilFools.winningNotIncluded","aprilFools.timeForYourSoloUnownRun","aprilFools.nowARealTimeStrategyGame","aprilFools.nowWithQuickTimeEncounters","aprilFools.timeYourInputsForHigherCatchrate","aprilFools.certifiedButtonSimulator","aprilFools.iHopeYouGetSuckerPunched"]},{name:"Halloween",start:"10-15",end:"10-31",messages:["halloween.happyHalloween","halloween.boo","halloween.pumpkabooAbout","halloween.mayContainSpiders","halloween.spookyScarySkeledirge","halloween.gourgeistUsedTrickOrTreat","halloween.letsSnuggleForever"]},{name:"Winter Holiday",start:"12-01",end:"12-31",messages:["winterHoliday.happyHolidays","winterHoliday.unaffilicatedWithDelibirdServices","winterHoliday.delibirdSeason","winterHoliday.diamondsFromTheSky","winterHoliday.holidayStylePikachuNotIncluded","winterHoliday.delibirdDirectlyToYourHouse","winterHoliday.haveAnIceDay","winterHoliday.spinTheClaydol","winterHoliday.beGoodForGoodnessSake","winterHoliday.moomooMilkAndLavaCookies","winterHoliday.iNeedAYacheBerry","winterHoliday.getJolly","winterHoliday.tisTheSeasonToBeSpeSpa","winterHoliday.deckTheHalls","winterHoliday.saveScummingGetsYouOnTheNaughtyList","winterHoliday.badTrainersGetRolycoly"]}];function wS(){const T=[...xS];for(const{name:e,start:t,end:i,messages:n}of _S){const a=new Date,r=new Date(`${t}-${a.getFullYear()}`),o=new Date(`${i}-${a.getFullYear()}`);if(a>=r&&a<=o){`${n.length}${e}${Ff}`;for(const l of n){const c=new Array(Ff).fill(l);T.push(...c)}}}return T.map(e=>`splashMessages:${e}`)}h(wS,"getSplashMessages");const on=class on extends Nn{titleContainer;usernameLabel;playerCountLabel;splashMessage;splashMessageText;eventDisplay;appVersionText;titleStatsTimer;getUsername(){const e=f.t(s.gameData.gender===De.FEMALE?"trainerNames:playerF":"trainerNames:playerM"),t=s.hideUsername?e:Be?.username??f.t("common:guest");return f.t("menu:loggedInAs",{username:t})}updateUsername(){this.usernameLabel.setText(this.getUsername())}constructor(e=x.TITLE){super(e)}setup(){super.setup();const e=this.getUi(),t=s.scaledCanvas.height,i=s.scaledCanvas.width;this.titleContainer=s.add.container(0,-t).setName("title").setAlpha(0),e.add(this.titleContainer);const n=s.add.image(i/2,8,this.getLogo()).setOrigin(.5,0);cs.isEventActive()&&(this.eventDisplay=new Jy(0,0,cs.activeEvent()),this.eventDisplay.setup(),this.titleContainer.add(this.eventDisplay));const a=i-2;this.usernameLabel=P(a,0,this.getUsername(),O.MESSAGE,{fontSize:"54px"}).setOrigin(1,0),this.playerCountLabel=P(a,0,`? ${f.t("menu:playersOnline")}`,O.MESSAGE,{fontSize:"54px"}).setOrigin(1,0);const r=n.x,o=n.y+n.displayHeight;this.splashMessageText=P(r+64,o-8,"",O.MONEY,{fontSize:"54px"}).setOrigin().setAngle(-20),s.tweens.add({targets:this.splashMessageText,duration:ge(350),scale:"*=1.25",loop:-1,yoyo:!0}),this.appVersionText=P(r-60,o+4,"",O.MONEY,{fontSize:"54px"}).setOrigin(),this.titleContainer.add([n,this.usernameLabel,this.playerCountLabel,this.splashMessageText,this.appVersionText])}updateTitleStats(){at.getGameTitleStats().then(e=>{if(e==null)return;this.playerCountLabel.setText(`${e.playerCount} ${f.t("menu:playersOnline")}`);const t=this.splashMessage;t==="splashMessages:battlesWon"&&this.splashMessageText.setText(f.t(t,{count:e.battleCount}))}).catch(e=>{console.error(`Failed to fetch title stats:
`,e)})}randomPokemon(){const e=ns(1025,1),t=zt(e),i=this.splashMessage;(this.splashMessage==="splashMessages:underratedPokemon"||this.splashMessage==="splashMessages:dontTalkAboutThePokemonIncident"||this.splashMessage==="splashMessages:aWildPokemonAppeared"||this.splashMessage==="splashMessages:aprilFools.removedPokemon")&&this.splashMessageText.setText(f.t(i,{pokemonName:t.name}))}genderSplash(){const e=this.splashMessage;if(this.splashMessage==="splashMessages:aprilFools.helloKyleAmber"){const t=this.splashMessageText,i=s.gameData.gender===De.MALE?"trainerNames:playerM":"trainerNames:playerF";t.setText(f.t(e,{name:f.t(i)}))}}show(e){if(!super.show(e))return!1;const i=s.scaledCanvas.height,n=this.getWindowHeight();this.updateUsername();const a=i-23-n,r=i-13-n;this.usernameLabel.width<this.playerCountLabel.width?(this.usernameLabel.setY(a),this.playerCountLabel.setY(r)):(this.usernameLabel.setY(r),this.playerCountLabel.setY(a)),this.splashMessage=eT(wS()),this.splashMessageText.setText(f.t(this.splashMessage,{count:on.BATTLES_WON_FALLBACK})),this.appVersionText.setText("v"+xg+"");const l=this.getUi();cs.isEventActive()&&(this.eventDisplay.setWidth(s.scaledCanvas.width-this.optionSelectBg.width-this.optionSelectBg.x),this.eventDisplay.show());const c=new Date;return(c.getMonth()===11||c.getMonth()===0&&c.getDate()<=15)&&this.getSnow(),this.randomPokemon(),this.genderSplash(),this.updateTitleStats(),this.titleStatsTimer=setInterval(()=>{this.updateTitleStats()},6e4),s.tweens.add({targets:[this.titleContainer,l.getMessageHandler().bg],duration:ge(325),alpha:h(u=>u===this.titleContainer?1:0,"alpha"),ease:"Sine.easeInOut"}),!0}clear(){super.clear();const e=this.getUi();this.eventDisplay?.clear(),this.titleStatsTimer&&clearInterval(this.titleStatsTimer),this.titleStatsTimer=null,s.tweens.add({targets:[this.titleContainer,e.getMessageHandler().bg],duration:ge(325),alpha:h(t=>t===this.titleContainer?0:1,"alpha"),ease:"Sine.easeInOut"})}getLogo(){return cs.isAprilFoolsActive()===!!ns(tT)?"logo_fake":"logo"}snow;getSnow(){const e=s.scaledCanvas.width,t=s.scaledCanvas.height;this.snow?.destroy(),this.snow=s.add.tileSprite(e,t,e,t,"snow"),this.snow.setOrigin(1,1),s.tweens.add({targets:this.snow,tilePositionX:{from:0,to:-512},tilePositionY:{from:0,to:-512},duration:1e5,repeat:-1,yoyo:!1,ease:"Linear",onUpdate:h(()=>{this.snow&&(this.snow.tilePositionX-=.5,this.snow.tilePositionY-=.5)},"onUpdate")}),this.titleContainer.addAt(this.snow,0)}};h(on,"TitleUiHandler"),Gi(on,"BATTLES_WON_FALLBACK",-1);let kh=on;const Lp=class Lp extends Ui{reconnectDuration;reconnectCallback;minTime=1e3*5;maxTime=1e3*60*5;randVarianceTime=1e3*10;constructor(e=null){super(e),this.reconnectDuration=this.minTime}getModalTitle(){return""}getWidth(){return 160}getHeight(){return 64}getMargin(){return[0,0,48,0]}getButtonLabels(){return[]}setup(){super.setup();const e=P(this.getWidth()/2,this.getHeight()/2,f.t("menu:errorServerDown"),O.WINDOW,{fontSize:"48px",align:"center"});e.setOrigin(.5,.5),this.modalContainer.add(e)}tryReconnect(){Ts().then(e=>{e[0]||[200,400].includes(e[1])?(this.reconnectDuration=this.minTime,s.playSound("se/pb_bounce_1"),this.reconnectCallback()):e[1]===401?(Ur(vi),s.reset(!0,!0)):(this.reconnectDuration=Math.min(this.reconnectDuration*2,this.maxTime),setTimeout(()=>this.tryReconnect(),this.reconnectDuration+Math.random()*this.randVarianceTime))})}show(e){if(e.length>0&&e[0]instanceof Function){const t={buttonActions:[]};return this.reconnectCallback=e[0],this.reconnectDuration=this.minTime,setTimeout(()=>this.tryReconnect(),this.reconnectDuration),super.show([t])}return!1}};h(Lp,"UnavailableModalUiHandler");let Nh=Lp;const _s=class _s extends Ws{adminMode;adminResult;config;tempGameData=null;buttonGap=10;static ERR_REQUIRED_FIELD(e){return e==="username"?`${Ri(e)} is required`:`${Ri(e)} Id is required`}static SUCCESS_SERVICE_MODE(e,t){return`Username and ${e} successfully ${t.toLowerCase()}ed`}constructor(e=null){super(e)}getModalTitle(){return"Admin panel"}getWidth(){return this.adminMode===pt.ADMIN?180:160}getMargin(){return[0,0,0,0]}getButtonLabels(){switch(this.adminMode){case pt.LINK:return["Link Account","Cancel","",""];case pt.SEARCH:return["Find account","Cancel","",""];case pt.ADMIN:return["Back to search","Cancel","Stats","Pokedex"];default:return["Activate ADMIN","Cancel","Stats","Pokedex"]}}getInputFieldConfigs(){switch(this.adminMode){case pt.LINK:return[{label:"Username"},{label:"Discord ID"}];case pt.SEARCH:return[{label:"Username"}];case pt.ADMIN:return[{label:"Username",isReadOnly:!0},{label:"Discord ID",isReadOnly:(this.adminResult?.discordId??"")!==""},{label:"Google ID",isReadOnly:(this.adminResult?.googleId??"")!==""},{label:"Last played",isReadOnly:!0},{label:"Registered",isReadOnly:!0}];default:return[]}}processInput(e){return e===b.SUBMIT&&this.submitAction?(this.submitAction(),!0):!1}show(e){this.config=e[0],this.adminMode=e[1],this.adminResult=e[2]??{username:"",discordId:"",googleId:"",lastLoggedIn:"",registered:""};const t=e[3],i=this.getInputFieldConfigs(),n=!!this.getModalTitle();this.updateFields(i,n),this.updateContainer(this.config);const a=this.getButtonLabels();for(let l=0;l<a.length;l++)this.buttonLabels[l].setText(a[l]);const r=t?O.SUMMARY_PINK:O.SUMMARY_GREEN;if(this.errorMessage.setPosition(10,(n?31:5)+20*(i.length-1)+16+this.getButtonTopMargin()).setColor(le(r)).setShadowColor(le(r,!0)),!super.show(e))return!1;this.hideLastButtons(this.adminMode===pt.ADMIN?0:2),this.populateFields(this.adminMode,this.adminResult);const o=this.submitAction;return this.submitAction=()=>{this.submitAction=o;const l=this.convertInputsToAdmin(),c=this.areFieldsValid(this.adminMode);if(c.error)return s.ui.setMode(x.LOADING,{buttonActions:[]}),this.showMessage(c.errorMessage??"",l,!0);switch(s.ui.setMode(x.LOADING,{buttonActions:[]}),this.adminMode){case pt.LINK:this.adminLinkUnlink(l,"discord","Link").then(u=>u.error?this.showMessage(u.errorType,l,!0):this.showMessage(_s.SUCCESS_SERVICE_MODE("discord","link"),l,!1));break;case pt.SEARCH:this.adminSearch(l).then(u=>{if(u.error)return this.showMessage(u.errorType,l,!0);this.updateAdminPanelInfo(u.adminSearchResult??l)});break;case pt.ADMIN:this.updateAdminPanelInfo(l,pt.SEARCH);break}},!0}showMessage(e,t,i){s.ui.setMode(x.ADMIN,Object.assign(this.config,{errorMessage:e?.trim()}),this.adminMode,t,i),i?s.ui.playError():s.ui.playSelect()}populateAdminFields(e){for(const[t,i]of Object.keys(e).entries())if(i!=="systemData"&&(this.inputs[t].setText(e[i]),i==="discordId"||i==="googleId")){const n=this.inputContainers[t].list.find(r=>r.type==="NineSlice"),a=s.add.image(this.inputContainers[t].x+n.width+this.buttonGap,this.inputContainers[t].y+Math.floor(n.height/2),e[i]===""?"link_icon":"unlink_icon");a.setName(`adminBtn_${i}`).setOrigin().setInteractive().on("pointerdown",()=>{const r=i.toLowerCase().replace("id",""),o=e[i]===""?"Link":"Unlink",l=this.areFieldsValid(this.adminMode,r);if(l.error)return s.ui.setMode(x.LOADING,{buttonActions:[]}),this.showMessage(l.errorMessage??"",e,!0);this.adminLinkUnlink(this.convertInputsToAdmin(),r,o).then(c=>{if(c.error)return s.ui.setMode(x.LOADING,{buttonActions:[]}),this.showMessage(c.errorType,e,!0);s.ui.setMode(x.LOADING,{buttonActions:[]}),this.adminSearch(e).then(u=>u.error?this.showMessage(u.errorType,e,!0):this.showMessage(_s.SUCCESS_SERVICE_MODE(r,o),u.adminSearchResult??e,!1))})}),this.addInteractionHoverEffect(a),this.modalContainer.add(a)}}populateFields(e,t){switch(e){case pt.LINK:this.inputs[0].setText(t.username),this.inputs[1].setText(t.discordId);break;case pt.SEARCH:this.inputs[0].setText(t.username);break;case pt.ADMIN:this.populateAdminFields(t);break}}areFieldsValid(e,t){switch(e){case pt.LINK:if(!this.inputs[0].text)return{error:!0,errorMessage:_s.ERR_REQUIRED_FIELD("username")};if(!this.inputs[1].text)return{error:!0,errorMessage:_s.ERR_REQUIRED_FIELD("discord")};break;case pt.SEARCH:if(!this.inputs[0].text&&!pn)return{error:!0,errorMessage:_s.ERR_REQUIRED_FIELD("username")};break;case pt.ADMIN:if(!this.inputs[1].text&&t==="discord")return{error:!0,errorMessage:_s.ERR_REQUIRED_FIELD(t)};if(!this.inputs[2].text&&t==="google")return{error:!0,errorMessage:_s.ERR_REQUIRED_FIELD(t)};break}return{error:!1}}convertInputsToAdmin(){const e=this.inputs;return{username:e[0]?.node?e[0].text:"",discordId:e[1]?.node?e[1]?.text:"",googleId:e[2]?.node?e[2]?.text:"",lastLoggedIn:e[3]?.node?e[3]?.text:"",registered:e[4]?.node?e[4]?.text:""}}async adminSearch(e){this.tempGameData=null;try{const[t,i]=await at.admin.searchAccount({username:e.username});if(i||!t)return{adminSearchResult:e,error:!0,errorType:i};if(t.systemData){const n=JSON.stringify(t.systemData);try{this.tempGameData=Mn.fromRawSystem(n)}catch{console.warn("Could not parse system data for admin panel, stats/pokedex will be unavailable!")}}return{adminSearchResult:t,error:!1}}catch(t){return console.error(t),{error:!0,errorType:t}}}async adminLinkUnlink(e,t,i){try{const n=await at.admin.linkUnlinkRequest(i,t,e);if(n!=null)return{error:!0,errorType:n}}catch(n){return console.error(n),{error:!0,errorType:n}}return{adminSearchResult:e,error:!1}}updateAdminPanelInfo(e,t){t=t??pt.ADMIN,s.ui.setMode(x.ADMIN,{buttonActions:[()=>{s.ui.revertMode(),s.ui.revertMode()},()=>{s.ui.revertMode(),s.ui.revertMode()},()=>{if(this.tempGameData==null){s.ui.playError();return}this.hide(),s.ui.setOverlayMode(x.GAME_STATS,e.username,this.tempGameData,this.unhide.bind(this))},()=>{if(this.tempGameData==null){s.ui.playError();return}this.hide(),s.ui.setOverlayMode(x.POKEDEX,this.tempGameData,this.unhide.bind(this))}]},t,e)}clear(){super.clear();const e=["formLabel","adminBtn"],t=[],i=this.modalContainer.list;for(let n=i.length-1;n>=0;n--)(e.some(a=>i[n].name.includes(a))||i[n].type==="Container"&&i[n].list.find(a=>a.type==="rexInputText"))&&t.push(i[n]);for(;t.length>0;)this.modalContainer.remove(t.pop(),!0)}};h(_s,"AdminUiHandler");let Ph=_s;const Dp=class Dp extends Ws{getModalTitle(e){return f.t("menu:renameRun")}getWidth(e){return 160}getMargin(e){return[0,0,48,0]}getButtonLabels(e){return[f.t("menu:rename"),f.t("menu:cancel")]}getReadableErrorMessage(e){const t=e?.indexOf(":");return t>0&&(e=e.slice(0,t)),super.getReadableErrorMessage(e)}getInputFieldConfigs(){return[{label:f.t("menu:runName")}]}show(e){if(!super.show(e))return!1;this.inputs?.length>0&&this.inputs.forEach(i=>{i.text=""});const t=e[0];return this.submitAction=()=>{this.sanitizeInputs();const i=btoa(encodeURIComponent(this.inputs[0].text));return t.buttonActions[0](i),!0},!0}};h(Dp,"RenameRunFormUiHandler");let Rh=Dp;const Uf=[x.SAVE_SLOT,x.PARTY,x.SUMMARY,x.STARTER_SELECT,x.EVOLUTION_SCENE,x.EGG_HATCH_SCENE,x.EGG_LIST,x.EGG_GACHA,x.POKEDEX,x.POKEDEX_PAGE,x.CHALLENGE_SELECT,x.RUN_HISTORY],ra=[x.TITLE,x.CONFIRM,x.OPTION_SELECT,x.MENU,x.MENU_OPTION_SELECT,x.GAMEPAD_BINDING,x.KEYBOARD_BINDING,x.SETTINGS,x.SETTINGS_AUDIO,x.SETTINGS_DISPLAY,x.SETTINGS_GAMEPAD,x.SETTINGS_KEYBOARD,x.ACHIEVEMENTS,x.GAME_STATS,x.POKEDEX_SCAN,x.LOGIN_FORM,x.REGISTRATION_FORM,x.LOADING,x.SESSION_RELOAD,x.UNAVAILABLE,x.RENAME_POKEMON,x.RENAME_RUN,x.TEST_DIALOGUE,x.AUTO_COMPLETE,x.ADMIN,x.MYSTERY_ENCOUNTER,x.RUN_INFO,x.CHANGE_PASSWORD_FORM],Fp=class Fp extends Phaser.GameObjects.Container{mode;modeChain;handlers;overlay;achvBar;bgmBar;savingIcon;tooltipContainer;tooltipBg;tooltipTitle;tooltipContent;overlayActive;constructor(){super(s,0,s.scaledCanvas.height),this.mode=x.MESSAGE,this.modeChain=[],this.handlers=[new nh,new kh,new oh,new fh,new ih,new wh,new dl,new fl,new Ln,new sT,new wn,new wa,new hh,new ph,new Oa,new Nn,new bh,new Nn(x.MENU_OPTION_SELECT),new $a,new Ya,new Ga,new za,new gh,new ja,new mh,new th,new iT,new ch,new lh,new An,new vh(x.TEST_DIALOGUE),new On,new Sh,new Ch,new Oh,new yh,new _h,new Nh,new ah,new Ah,new Rh,new zl,new Ra,new Mh(x.TEST_DIALOGUE),new sh,new Ph,new Ih,new rh]}setup(){this.setName(`ui-${x[this.mode]}`);for(const e of this.handlers)e.setup();this.overlay=s.add.rectangle(0,0,s.scaledCanvas.width,s.scaledCanvas.height,0),this.overlay.setName("rect-ui-overlay"),this.overlay.setOrigin(0,0),s.uiContainer.add(this.overlay),this.overlay.setVisible(!1),this.setupTooltip(),this.achvBar=new eh,this.achvBar.setup(),s.uiContainer.add(this.achvBar),this.savingIcon=new xh,this.savingIcon.setup(),s.uiContainer.add(this.savingIcon)}setupTooltip(){this.tooltipContainer=s.add.container(0,0),this.tooltipContainer.setName("tooltip"),this.tooltipContainer.setVisible(!1),this.tooltipBg=Ce(0,0,128,31),this.tooltipBg.setName("window-tooltip-bg"),this.tooltipBg.setOrigin(0,0),this.tooltipTitle=P(64,4,"",O.TOOLTIP_TITLE),this.tooltipTitle.setName("text-tooltip-title"),this.tooltipTitle.setOrigin(.5,0),this.tooltipContent=P(6,16,"",O.TOOLTIP_CONTENT),this.tooltipContent.setName("text-tooltip-content"),this.tooltipContent.setWordWrapWidth(850),this.tooltipContainer.add(this.tooltipBg),this.tooltipContainer.add(this.tooltipTitle),this.tooltipContainer.add(this.tooltipContent),s.uiContainer.add(this.tooltipContainer)}getHandler(){return this.handlers[this.mode]}getMessageHandler(){return this.handlers[x.MESSAGE]}processInfoButton(e){return this.overlayActive?!1:[x.CONFIRM,x.COMMAND,x.FIGHT,x.MESSAGE,x.TARGET_SELECT].includes(this.mode)?(s?.processInfoButton(e),!0):(s?.processInfoButton(!1),!0)}processInput(e){if(this.overlayActive)return!1;const t=this.getHandler();return t instanceof Ni&&t.tutorialActive?t.processTutorialInput(e):t.processInput(e)}showTextPromise(e,t=0,i=!0,n){return new Promise(a=>{this.showText(e??"",null,()=>a(),t,i,n)})}showText(e,t,i,n,a,r){const o=[],l=["#POKEMON1","#POKEMON2"];for(let c=0;c<s.getPlayerField().length;c++)o.push(s.getPlayerField()[c].getNameToRender()),e=e.split(o[c]).join(l[c]);if(a&&e.indexOf("$")>-1){const c=e.split(/\$/g).map(p=>p.trim());let u=h(()=>i&&i(),"showMessageAndCallback");for(let p=c.length-1;p>=0;p--){const m=u;c[p]=c[p].split(l[0]).join(o[0]),c[p]=c[p].split(l[1]).join(o[1]),u=h(()=>this.showText(c[p],null,m,null,!0),"showMessageAndCallback")}u()}else{const c=this.getHandler();for(let u=0;u<s.getPlayerField().length;u++)e=e.split(l[u]).join(o[u]);c instanceof Vt?c.showText(e,t,i,n,a,r):this.getMessageHandler().showText(e,t,i,n,a,r)}}showDialogue(e,t,i=0,n,a,r){let o=!1,l=e;const c=s.gameData.gender??De.UNSET,u=De[c].toLowerCase();if(f.exists(e)){const m=e;if(o=!0,l=f.t(m,{context:u}),this.shouldSkipDialogue(m)){n();return}}let p=h(()=>{o&&s.gameData.saveSeenDialogue(e),n()},"showMessageAndCallback");if(l.indexOf("$")>-1){const m=l.split(/\$/g).map(d=>d.trim());for(let d=m.length-1;d>=0;d--){const y=p;p=h(()=>this.showDialogue(m[d],t,null,y),"showMessageAndCallback")}p()}else{const m=this.getHandler();m instanceof Vt?m.showDialogue(l,t,i,p,a,!0,r):this.getMessageHandler().showDialogue(l,t,i,p,a,!0,r)}}shouldSkipDialogue(e){return!!(f.exists(e)&&s.skipSeenDialogues&&s.gameData.getSeenDialogues()[e]===!0)}getTooltip(){return{visible:this.tooltipContainer.visible,title:this.tooltipTitle.text,content:this.tooltipContent.text}}showTooltip(e,t,i){this.tooltipContainer.setVisible(!0),this.editTooltip(e,t),i?s.uiContainer.moveAbove(this.tooltipContainer,this):s.uiContainer.moveBelow(this.tooltipContainer,this)}editTooltip(e,t){this.tooltipTitle.setText(e||"");const i=this.tooltipContent.runWordWrap(t);this.tooltipContent.setText(i),this.tooltipContent.y=e?16:4,this.tooltipBg.width=Math.min(Math.max(this.tooltipTitle.displayWidth,this.tooltipContent.displayWidth)+12,838),this.tooltipBg.height=(e?31:19)+10.5*(i.split(`
`).length-1),this.tooltipTitle.x=this.tooltipBg.width/2}hideTooltip(){this.tooltipContainer.setVisible(!1),this.tooltipTitle.clearTint()}update(){if(this.tooltipContainer.visible){const e=s.inputMethod==="touch",t=s.game.input.activePointer.x,i=s.game.input.activePointer.y,n=this.tooltipBg.width,a=this.tooltipBg.height,r=2;let o=e?r:t/6+r,l=e?r:i/6+r;e?t<=s.game.canvas.width/2&&i<=s.game.canvas.height/2&&(o=s.scaledCanvas.width-n-r):(o+n+r>s.scaledCanvas.width&&(o=Math.max(r,t/6-n-r)),l+a+r>s.scaledCanvas.height&&(l=Math.max(r,i/6-a-r))),this.tooltipContainer.setPosition(o,l)}}clearText(){const e=this.getHandler();e instanceof Vt?e.clearText():this.getMessageHandler().clearText()}setCursor(e){const t=this.getHandler().setCursor(e);return t&&this.playSelect(),t}playSelect(){s.playSound("ui/select")}playError(){s.playSound("ui/error")}fadeOut(e){return new Promise(t=>{if(this.overlayActive)return t();this.overlayActive=!0,this.overlay.setAlpha(0),this.overlay.setVisible(!0),s.tweens.add({targets:this.overlay,alpha:1,duration:e,ease:"Sine.easeOut",onComplete:h(()=>t(),"onComplete")})})}fadeIn(e){return new Promise(t=>{if(!this.overlayActive)return t();s.tweens.add({targets:this.overlay,alpha:0,duration:e,ease:"Sine.easeIn",onComplete:h(()=>{this.overlay.setVisible(!1),t()},"onComplete")}),this.overlayActive=!1})}setModeInternal(e,t,i,n,a){return new Promise(r=>{if(this.mode===e&&!i){r();return}const o=h(()=>{if(this.mode!==e){t&&this.getHandler().clear(),n&&this.mode&&!t&&(this.modeChain.push(this.mode),s.updateGameInfo()),this.mode=e;const l=document?.getElementById("touchControls");l&&(l.dataset.uiMode=x[e]),this.getHandler().show(a)}r()},"doSetMode");!n&&(Uf.indexOf(this.mode)>-1||Uf.indexOf(e)>-1)&&ra.indexOf(this.mode)===-1&&ra.indexOf(e)===-1||n&&ra.indexOf(e)===-1?this.fadeOut(250).then(()=>{s.time.delayedCall(100,()=>{o(),this.fadeIn(250)})}):o()})}getMode(){return this.mode}setMode(e,...t){return this.setModeInternal(e,!0,!1,!1,t)}setModeForceTransition(e,...t){return this.setModeInternal(e,!0,!0,!1,t)}setModeWithoutClear(e,...t){return this.setModeInternal(e,!1,!1,!1,t)}setOverlayMode(e,...t){return this.setModeInternal(e,!1,!1,!0,t)}resetModeChain(){this.modeChain=[],s.updateGameInfo()}revertMode(){return new Promise(e=>{if(this?.modeChain?.length===0)return e(!1);const t=this.mode,i=h(()=>{this.getHandler().clear(),this.mode=this.modeChain.pop(),s.updateGameInfo();const n=document.getElementById("touchControls");n&&(n.dataset.uiMode=x[this.mode]),e(!0)},"doRevertMode");ra.indexOf(t)===-1?this.fadeOut(250).then(()=>{s.time.delayedCall(100,()=>{i(),this.fadeIn(250)})}):i()})}revertModes(){return new Promise(e=>{if(this?.modeChain?.length===0)return e();this.revertMode().then(t=>Hh(t,this.revertModes).then(()=>e()))})}getModeChain(){return this.modeChain}getGamepadType(){return s.inputMethod==="gamepad"?s.inputController.getConfig(s.inputController.selectedDevice[Le.GAMEPAD]).padType:s.inputMethod}freeUIData(){this.handlers.forEach(e=>e.destroy()),this.handlers=[],as.getInstance().clearNavigationMenus()}};h(Fp,"UI");let Bh=Fp;const Up=class Up extends nT{rexUI;inputController;uiInputs;sessionPlayTime=null;lastSavePlayTime=null;masterVolume=.5;bgmVolume=1;fieldVolume=1;seVolume=1;uiVolume=1;gameSpeed=1;damageNumbersMode=0;reroll=!1;shopCursorTarget=la.REWARDS;commandCursorMemory=!1;dexForDevs=!1;showMissingRibbons=!1;showMovesetFlyout=!0;showArenaFlyout=!0;showTimeOfDayWidget=!0;timeOfDayAnimation=vg.NONE;showLevelUpStats=!0;enableTutorials=!1;enableMoveInfo=!0;enableRetries=!1;hideIvs=!1;candyUpgradeNotification=0;candyUpgradeDisplay=0;moneyFormat=aT.NORMAL;uiTheme=Gh.DEFAULT;windowType=0;experimentalSprites=!1;musicPreference=rT.ALLGENS;moveAnimations=!0;expGainsSpeed=dg.DEFAULT;skipSeenDialogues=!1;eggSkipPreference=0;expParty=di.DEFAULT;hpBarSpeed=0;fusionPaletteSwaps=!0;enableTouchControls=!1;enableVibration=!1;showBgmBar=!0;hideUsername=!1;battleStyle=Kh.SWITCH;typeHints=!1;disableMenu=!1;gameData;sessionSlotId;phaseManager;field;fieldUI;charSprite;pbTray;pbTrayEnemy;abilityBar;partyExpBar;candyBar;arenaBg;arenaBgTransition;arenaPlayer;arenaPlayerTransition;arenaEnemy;arenaNextEnemy;arena;gameMode;score;lockModifierTiers;trainer;lastEnemyTrainer;currentBattle;pokeballCounts;money;pokemonInfoContainer;party;mysteryEncounterSaveData=new Fi;lastMysteryEncounter;biomeWaveText;moneyText;scoreText;luckLabelText;luckText;modifierBar;enemyModifierBar;arenaFlyout;fieldOverlay;shopOverlay;shopOverlayShown=!1;shopOverlayOpacity=.8;modifiers;enemyModifiers;uiContainer;ui;seed;waveSeed;waveCycleOffset;offsetGym;damageNumberHandler;spriteSparkleHandler;fieldSpritePipeline;spritePipeline;bgm;bgmResumeTimer;bgmCache=new Set;playTimeTimer;rngCounter=0;rngSeedOverride="";rngOffset=0;inputMethod;infoToggles=[];eventTarget=new EventTarget;constructor(){super("battle"),this.phaseManager=new Bl,this.updateGameInfo(),$T(this)}loadPokemonAtlas(e,t,i){i===void 0&&(i=this.experimentalSprites);const n=t.includes("variant/")||/_[0-3]$/.test(t);i&&(i=oT(e)),n&&(t=t.replace("variant/","")),this.load.atlas(e,`images/pokemon/${n?"variant/":""}${i?"exp/":""}${t}.png`,`images/pokemon/${n?"variant/":""}${i?"exp/":""}${t}.json`)}async preload(){const e=[st.TACKLE,st.TAIL_WHIP,st.FOCUS_ENERGY,st.STRUGGLE];await Promise.all([this.initVariantData(),lT().then(()=>hT(!0)),Promise.all(e.map(t=>Uh(t))).then(()=>Vh(e,!0)),this.initStarterColors()]).catch(t=>{throw new Error(`Unexpected error during BattleScene preLoad!
Reason: ${t}`)})}create(){this.scene.remove(cT.KEY),lS.apply(this),this.inputController=new $r,this.uiInputs=new Gl(this.inputController),this.gameData=new Mn,uT(),this.load.setBaseURL(),this.spritePipeline=new Ll(this.game),this.renderer.pipelines.add("Sprite",this.spritePipeline),this.fieldSpritePipeline=new Fa(this.game),this.renderer.pipelines.add("FieldSprite",this.fieldSpritePipeline),this.launchBattle()}update(){this.ui?.update()}launchBattle(){this.arenaBg=this.add.sprite(0,0,"plains_bg"),this.arenaBg.setName("sprite-arena-bg"),this.arenaBgTransition=this.add.sprite(0,0,"plains_bg"),this.arenaBgTransition.setName("sprite-arena-bg-transition");for(const c of[this.arenaBgTransition,this.arenaBg])c.setPipeline(this.fieldSpritePipeline),c.setScale(6),c.setOrigin(0),c.setSize(320,240);const e=this.add.container(0,0);e.setName("field"),e.setScale(6),this.field=e;const t=this.add.container(0,this.game.canvas.height);t.setName("field-ui"),t.setDepth(1),t.setScale(6),this.fieldUI=t;const i=this.make.rexTransitionImagePack({x:0,y:0,scale:6,key:"loading_bg",origin:{x:0,y:0}},!0);i.transit({mode:"blinds",ease:"Cubic.easeInOut",duration:1250}),i.once("complete",()=>{i.destroy()}),this.add.existing(i);const n=this.add.container(0,0);n.setName("ui"),n.setDepth(2),n.setScale(6),this.uiContainer=n;const a=this.scaledCanvas.width,r=this.scaledCanvas.height-48;this.fieldOverlay=this.add.rectangle(0,r*-1-48,a,r,4342338),this.fieldOverlay.setName("rect-field-overlay"),this.fieldOverlay.setOrigin(0,0),this.fieldOverlay.setAlpha(0),this.fieldUI.add(this.fieldOverlay),this.shopOverlay=this.add.rectangle(0,r*-1-48,a,r,460551),this.shopOverlay.setName("rect-shop-overlay"),this.shopOverlay.setOrigin(0,0),this.shopOverlay.setAlpha(0),this.fieldUI.add(this.shopOverlay),this.modifiers=[],this.enemyModifiers=[],this.modifierBar=new of,this.modifierBar.setName("modifier-bar"),this.add.existing(this.modifierBar),n.add(this.modifierBar),this.enemyModifierBar=new of(!0),this.enemyModifierBar.setName("enemy-modifier-bar"),this.add.existing(this.enemyModifierBar),n.add(this.enemyModifierBar),this.charSprite=new Ql,this.charSprite.setName("sprite-char"),this.charSprite.setup(),this.fieldUI.add(this.charSprite),this.pbTray=new Za(!0),this.pbTray.setName("pb-tray"),this.pbTray.setup(),this.pbTrayEnemy=new Za(!1),this.pbTrayEnemy.setName("enemy-pb-tray"),this.pbTrayEnemy.setup(),this.fieldUI.add(this.pbTray),this.fieldUI.add(this.pbTrayEnemy),this.abilityBar=new $l,this.abilityBar.setName("ability-bar"),this.abilityBar.setup(),this.fieldUI.add(this.abilityBar),this.partyExpBar=new Jl,this.partyExpBar.setName("party-exp-bar"),this.partyExpBar.setup(),this.fieldUI.add(this.partyExpBar),this.candyBar=new Zl,this.candyBar.setName("candy-bar"),this.candyBar.setup(),this.fieldUI.add(this.candyBar),this.biomeWaveText=P(this.scaledCanvas.width-2,0,Er.toString(),O.BATTLE_INFO),this.biomeWaveText.setName("text-biome-wave"),this.biomeWaveText.setOrigin(1,.5),this.fieldUI.add(this.biomeWaveText),this.moneyText=P(this.scaledCanvas.width-2,0,"",O.MONEY),this.moneyText.setName("text-money"),this.moneyText.setOrigin(1,.5),this.fieldUI.add(this.moneyText),this.scoreText=P(this.scaledCanvas.width-2,0,"",O.PARTY,{fontSize:"54px"}),this.scoreText.setName("text-score"),this.scoreText.setOrigin(1,.5),this.fieldUI.add(this.scoreText),this.luckText=P(this.scaledCanvas.width-2,0,"",O.PARTY,{fontSize:"54px"}),this.luckText.setName("text-luck"),this.luckText.setOrigin(1,.5),this.luckText.setVisible(!1),this.fieldUI.add(this.luckText),this.luckLabelText=P(this.scaledCanvas.width-2,0,f.t("common:luckIndicator"),O.PARTY,{fontSize:"54px"}),this.luckLabelText.setName("text-luck-label"),this.luckLabelText.setOrigin(1,.5),this.luckLabelText.setVisible(!1),this.fieldUI.add(this.luckLabelText),this.arenaFlyout=new ql,this.fieldUI.add(this.arenaFlyout),this.fieldUI.moveBelow(this.arenaFlyout,this.fieldOverlay),this.updateUIPositions(),this.damageNumberHandler=new Yl,this.spriteSparkleHandler=new Kl,this.spriteSparkleHandler.setup(),this.pokemonInfoContainer=new Tn(this.scaledCanvas.width+52,-this.scaledCanvas.height+66),this.pokemonInfoContainer.setup(),this.fieldUI.add(this.pokemonInfoContainer),this.party=[],this.arenaPlayer=new Kn(!0),this.arenaPlayer.setName("arena-player"),this.arenaPlayerTransition=new Kn(!0),this.arenaPlayerTransition.setName("arena-player-transition"),this.arenaEnemy=new Kn(!1),this.arenaEnemy.setName("arena-enemy"),this.arenaNextEnemy=new Kn(!1),this.arenaNextEnemy.setName("arena-next-enemy"),this.arenaBgTransition.setVisible(!1),this.arenaPlayerTransition.setVisible(!1),this.arenaNextEnemy.setVisible(!1);for(const c of[this.arenaPlayer,this.arenaPlayerTransition,this.arenaEnemy,this.arenaNextEnemy])c instanceof Jt.GameObjects.Sprite&&c.setOrigin(0,0),e.add(c);const o=this.addFieldSprite(0,0,`trainer_${this.gameData.gender===De.FEMALE?"f":"m"}_back`);o.setOrigin(.5,1),o.setName("sprite-trainer"),e.add(o),this.trainer=o,this.anims.create({key:"prompt",frames:this.anims.generateFrameNumbers("prompt",{start:1,end:4}),frameRate:6,repeat:-1,showOnStart:!0}),this.anims.create({key:"tera_sparkle",frames:this.anims.generateFrameNumbers("tera_sparkle",{start:0,end:12}),frameRate:18,repeat:0,showOnStart:!0,hideOnComplete:!0}),this.reset(!1,!1,!0);const l=new Bh;this.uiContainer.add(l),this.ui=l,l.setup(),this.phaseManager.toTitleScreen(!0),this.phaseManager.shiftPhase()}initSession(){this.sessionPlayTime===null&&(this.sessionPlayTime=0),this.lastSavePlayTime===null&&(this.lastSavePlayTime=0),this.playTimeTimer&&this.playTimeTimer.destroy(),this.playTimeTimer=this.time.addEvent({delay:ge(1e3),repeat:-1,callback:h(()=>{this.gameData&&this.gameData.gameStats.playTime++,this.sessionPlayTime!==null&&this.sessionPlayTime++,this.lastSavePlayTime!==null&&this.lastSavePlayTime++},"callback")}),this.updateBiomeWaveText(),this.updateMoneyText(),this.updateScoreText()}async initExpSprites(){if(lf.size>0)return;const t=await(await this.cachedFetch("./exp-sprites.json")).json();if(!Array.isArray(t))throw new Error("EXP Sprites were not array when fetched!");for(const i of t)lf.add(i)}async initVariantData(){GT();const e=await this.cachedFetch("./images/pokemon/variant/_masterlist.json").then(i=>i.json());for(const i of Object.keys(e))pf[i]=e[i];if(!this.experimentalSprites)return;const t=await this.cachedFetch("./images/pokemon/variant/_exp_masterlist.json").then(i=>i.json());dT(pf,t)}cachedFetch(e,t){const{manifest:i}=this.game,n=i?.[`/${e.replace("./","")}`];return n&&(e+=`?t=${n}`),fetch(e,t)}async initStarterColors(){if(Object.keys(vt).length>0)return;const e=await this.cachedFetch("./starter-colors.json").then(t=>t.json());for(const t of Object.keys(e))vt[t]=e[t]}getPlayerParty(){return this.party}getPokemonAllowedInBattle(){return this.getPlayerParty().filter(e=>e.isAllowedInBattle())}getPlayerPokemon(e=!0){return this.getPlayerField().find(t=>t.isActive()&&(e||t.switchOutStatus===!1))}getPlayerField(e=!1){const t=this.getPlayerParty();return t.slice(0,Math.min(t.length,this.currentBattle?.double?2:1)).filter(i=>!e||i.isActive())}getEnemyParty(){return this.currentBattle?.enemyParty??[]}getEnemyPokemon(e=!0){return this.getEnemyField().find(t=>t.isActive()&&(e||t.switchOutStatus===!1))}getEnemyField(e=!1){const t=this.getEnemyParty();return t.slice(0,Math.min(t.length,this.currentBattle?.double?2:1)).filter(i=>!e||i.isActive())}getField(e=!1){const t=new Array(4).fill(null),i=this.getPlayerField(),n=this.getEnemyField();return t.splice(0,i.length,...i),t.splice(2,n.length,...n),e?t.filter(a=>a?.isActive()):t}redirectPokemonMoves(e,t){this.phaseManager.redirectMoves(e,t)}getModifierBar(e=!1){return e?this.enemyModifierBar:this.modifierBar}addInfoToggle(...e){this.infoToggles.push(...e)}getInfoToggles(e=!1){return e?this.infoToggles.filter(t=>t?.isActive()):this.infoToggles}getPokemonById(e){return e==null?void 0:this.getPlayerParty().concat(this.getEnemyParty()).find(i=>i.id===e)}addPlayerPokemon(e,t,i,n,a,r,o,l,c,u,p){const m=new pT(e,t,i,n,a,r,o,l,c,u);if(p&&p(m),ie.IVS_OVERRIDE!==null)if(Array.isArray(ie.IVS_OVERRIDE)){if(ie.IVS_OVERRIDE.length!==6)throw new Error("The Player IVs override must be an array of length 6 or a number!");if(ie.IVS_OVERRIDE.some(d=>!zn(d,0,31)))throw new Error("All IVs in the player IV override must be between 0 and 31!");m.ivs=ie.IVS_OVERRIDE}else{if(!zn(ie.IVS_OVERRIDE,0,31))throw new Error("The Player IV override must be a value between 0 and 31!");m.ivs=new Array(6).fill(ie.IVS_OVERRIDE)}return ie.NATURE_OVERRIDE!==null&&(m.nature=ie.NATURE_OVERRIDE),m.init(),m}addEnemyPokemon(e,t,i,n=!1,a=!1,r,o){ie.ENEMY_LEVEL_OVERRIDE>0&&(t=ie.ENEMY_LEVEL_OVERRIDE),ie.ENEMY_SPECIES_OVERRIDE&&(e=zt(ie.ENEMY_SPECIES_OVERRIDE),n=this.getEncounterBossSegments(this.currentBattle.waveIndex,t,e)>1);const l=new fT(e,t,i,n,a,r);if(ie.ENEMY_FUSION_OVERRIDE&&l.generateFusionSpecies(),n&&!r){const c=gT(Ke(4294967296));for(let u=0;u<l.ivs.length;u++)l.ivs[u]=Math.round(Jt.Math.Linear(Math.min(l.ivs[u],c[u]),Math.max(l.ivs[u],c[u]),.75))}if(o&&o(l),ie.ENEMY_IVS_OVERRIDE!==null)if(Array.isArray(ie.ENEMY_IVS_OVERRIDE)){if(ie.ENEMY_IVS_OVERRIDE.length!==6)throw new Error("The Enemy IVs override must be an array of length 6 or a number!");if(ie.ENEMY_IVS_OVERRIDE.some(c=>!zn(c,0,31)))throw new Error("All IVs in the enemy IV override must be between 0 and 31!");l.ivs=ie.ENEMY_IVS_OVERRIDE}else{if(!zn(ie.ENEMY_IVS_OVERRIDE,0,31))throw new Error("The Enemy IV override must be a value between 0 and 31!");l.ivs=new Array(6).fill(ie.ENEMY_IVS_OVERRIDE)}return ie.ENEMY_NATURE_OVERRIDE!==null&&(l.nature=ie.ENEMY_NATURE_OVERRIDE),l.init(),l}removePokemonFromPlayerParty(e,t=!0){if(!e)return;const i=this.party.indexOf(e);this.party.splice(i,1),t&&(this.field.remove(e,!0),e.destroy()),this.updateModifiers(!0)}addPokemonIcon(e,t,i,n=.5,a=.5,r=!0,o=!1){const l=this.add.container(t,i);l.setName(`${e.name}-icon`);const c=this.add.sprite(0,0,e.getIconAtlasKey(r,o));if(c.setName(`sprite-${e.name}-icon`),c.setFrame(e.getIconId(r,o)),c.frame.name!==e.getIconId(r,o)){`${e.name}`;const u=e.shiny;e.shiny=!1,c.setTexture(e.getIconAtlasKey(r,o)),c.setFrame(e.getIconId(!0,o)),e.shiny=u}if(c.setOrigin(.5,0),l.add(c),e.isFusion(o)){const u=this.add.sprite(0,0,e.getFusionIconAtlasKey(r,o));u.setName("sprite-fusion-icon"),u.setOrigin(.5,0),u.setFrame(e.getFusionIconId(r,o));const p=c.width,m=c.height,d=c.frame,y=(c.frame.cutHeight<=u.frame.cutHeight?Math.ceil:Math.floor)((c.frame.cutHeight+u.frame.cutHeight)/4),g=`${c.frame.name}f${u.frame.name}`;c.frame.texture.has(g)||c.frame.texture.add(g,c.frame.sourceIndex,c.frame.cutX,c.frame.cutY,c.frame.cutWidth,y),c.setFrame(g),u.y=c.frame.cutHeight;const C=u.frame,E=u.frame.cutY+c.frame.cutHeight,I=u.frame.cutHeight-c.frame.cutHeight,A=`${u.frame.name}f${c.frame.name}`;u.frame.texture.has(A)||u.frame.texture.add(A,u.frame.sourceIndex,u.frame.cutX,E,u.frame.cutWidth,I),u.setFrame(A);const _=(d.y+C.y)/2;c.frame.y=u.frame.y=_,l.add(u),n!==.5&&(l.x-=p*(n-.5)),a!==0&&(l.y-=m*a)}else n!==.5&&(l.x-=c.width*(n-.5)),a!==0&&(l.y-=c.height*a);return l}setSeed(e){this.seed=e,this.rngCounter=0,this.waveCycleOffset=this.getGeneratedWaveCycleOffset(),this.offsetGym=this.gameMode.isClassic&&this.getGeneratedOffsetGym()}randBattleSeedInt(e,t=0){return this.currentBattle?.randSeedInt(e,t)}reset(e=!1,t=!1,i=!1){t&&(this.gameData=new Mn),this.gameMode=Sa(fe.CLASSIC),this.disableMenu=!1,this.score=0,this.money=0,this.lockModifierTiers=!1,this.pokeballCounts=Object.fromEntries(ks(bi).filter(n=>n<=bi.MASTER_BALL).map(n=>[n,0])),this.pokeballCounts[bi.POKEBALL]+=5,ie.POKEBALL_OVERRIDE.active&&(this.pokeballCounts=ie.POKEBALL_OVERRIDE.pokeballs),this.modifiers=[],this.enemyModifiers=[],this.modifierBar.removeAll(!0),this.enemyModifierBar.removeAll(!0);for(const n of this.getPlayerParty())n.destroy();this.party=[];for(const n of this.getEnemyParty())n.destroy();if(this.currentBattle?.mysteryEncounter?.introVisuals&&this.field.remove(this.currentBattle.mysteryEncounter?.introVisuals,!0),this.currentBattle=null,this.setSeed(ie.SEED_OVERRIDE||mT(24)),this.seed,this.resetSeed(),this.biomeWaveText.setText(Er.toString()),this.biomeWaveText.setVisible(!1),this.updateMoneyText(),this.moneyText.setVisible(!1),this.updateScoreText(),this.scoreText.setVisible(!1),[this.luckLabelText,this.luckText].forEach(n=>{n.setVisible(!1)}),this.newArena(ie.STARTING_BIOME_OVERRIDE||Je.TOWN),this.field.setVisible(!0),this.arenaBgTransition.setPosition(0,0),this.arenaPlayer.setPosition(300,0),this.arenaPlayerTransition.setPosition(0,0),this.arenaEnemy.setPosition(-280,0),this.arenaNextEnemy.setPosition(-280,0),this.arenaNextEnemy.setVisible(!1),this.arena.init(),this.trainer.setTexture(`trainer_${this.gameData.gender===De.FEMALE?"f":"m"}_back`),this.trainer.setPosition(406,186),this.trainer.setVisible(!0),this.mysteryEncounterSaveData=new Fi,this.updateGameInfo(),i){const n=[...it,...We,...ks(ei).map(a=>yT(a)).flatMap(a=>Object.values(a).flat().map(r=>r.modifierType).filter(r=>"localize"in r&&typeof r.localize=="function"))];for(const a of n)a.localize()}e&&(this.initVariantData(),this.fadeOutBgm(250,!1),this.tweens.add({targets:[this.uiContainer],alpha:0,duration:250,ease:"Sine.easeInOut",onComplete:h(()=>{this.ui.freeUIData(),this.uiContainer.remove(this.ui,!0),this.uiContainer.destroy(),this.children.removeAll(!0),this.game.domContainer.innerHTML="",this.launchBattle()},"onComplete")}))}getDoubleBattleChance(e,t){const i=new ct(e%10===0?32:8);this.applyModifiers(TT,!0,i);for(const n of t)ve("DoubleBattleChanceAbAttr",{pokemon:n,chance:i});return Math.max(i.value,1)}isNewBiome(e=this.currentBattle){const t=!(e.waveIndex%10),i=this.gameMode.hasShortBiomes||this.gameMode.isDaily,n=this.gameMode.hasShortBiomes&&e.waveIndex%5===0,a=e.waveIndex%50===49;return t||n||i&&a}newBattle(e,t,i,n,a){const r=ie.STARTING_WAVE_OVERRIDE||Er,o=e||(this.currentBattle?.waveIndex||r-1)+1;let l,c,u,p=null;this.resetSeed(o);const m=this.getPlayerField();if(this.gameMode.isFixedBattle(o)&&i===void 0)p=this.gameMode.getFixedBattle(o),l=p.double,c=p.battleType,this.executeWithSeedOffset(()=>u=p?.getTrainer(),(p.seedOffsetWaveIndex||o)<<8),u&&this.field.add(u);else{if(!this.gameMode.hasTrainers||ie.BATTLE_TYPE_OVERRIDE===de.WILD||ie.DISABLE_STANDARD_TRAINERS_OVERRIDE&&i==null?c=de.WILD:c=ie.BATTLE_TYPE_OVERRIDE??t??(this.gameMode.isWaveTrainer(o,this.arena)?de.TRAINER:de.WILD),c===de.TRAINER){const g=ie.RANDOM_TRAINER_OVERRIDE?.trainerType??this.arena.randomTrainerType(o),C=Ii[g].hasDouble;let E=!1;Ii[g].doubleOnly?E=!0:C&&(E=!Ke(this.getDoubleBattleChance(o,m)),Ii[g].trainerTypeDouble&&![B.TATE,B.LIZA].includes(g)&&(E=!1));const A=(ie.RANDOM_TRAINER_OVERRIDE?.trainerVariant===Xe.DOUBLE&&(!C||o<=1)?Xe.DEFAULT:ie.RANDOM_TRAINER_OVERRIDE?.trainerVariant)??(E?Xe.DOUBLE:Ke(2)?Xe.FEMALE:Xe.DEFAULT);u=i!==void 0?i.toTrainer():new ls(g,A),this.field.add(u)}!ie.BATTLE_TYPE_OVERRIDE&&(this.isWaveMysteryEncounter(c,o)||c===de.MYSTERY_ENCOUNTER)&&(c=de.MYSTERY_ENCOUNTER,this.mysteryEncounterSaveData.encounterSpawnChance=ig)}if(n===void 0&&o>1?c===de.WILD&&!this.gameMode.isWaveFinal(o)?l=!Ke(this.getDoubleBattleChance(o,m)):c===de.TRAINER&&(l=u?.variant===Xe.DOUBLE):p||(l=!!n),this.gameMode.isEndlessBoss(o)&&(l=!1),ie.BATTLE_STYLE_OVERRIDE!=null){let g=null;switch(ie.BATTLE_STYLE_OVERRIDE){case"double":g="double";break;case"single":g="single";break;case"even-doubles":g=o%2?"single":"double";break;case"odd-doubles":g=o%2?"double":"single";break}g==="double"&&(l=!0),c!==de.TRAINER&&g==="single"&&(l=!1)}const d=this.currentBattle,y=this.getMaxExpLevel();if(this.lastEnemyTrainer=d?.trainer??null,this.lastMysteryEncounter=d?.mysteryEncounter,c===de.MYSTERY_ENCOUNTER&&(l=!1),d?.double&&!l){this.phaseManager.tryRemovePhase("SwitchPhase");for(const g of this.getPlayerField())g.lapseTag(ke.COMMANDED)}if(this.executeWithSeedOffset(()=>{this.currentBattle=new CT(this.gameMode,o,c,u,l)},o<<3,this.waveSeed),this.currentBattle.incrementTurn(),c===de.MYSTERY_ENCOUNTER&&(this.currentBattle.mysteryEncounterType=a),!e&&d){const g=this.isNewBiome(d),C=g||[de.TRAINER,de.MYSTERY_ENCOUNTER].includes(this.currentBattle.battleType)||this.currentBattle.battleSpec===Xt.FINAL_BOSS;for(const E of this.getEnemyParty())E.destroy();if(this.trySpreadPokerus(),!g&&o%10===5&&this.arena.updatePoolsForTimeOfDay(),C){this.arena.resetArenaEffects();for(const E of m)E.lapseTag(ke.COMMANDED);m.forEach((E,I)=>{E.isOnField()&&this.phaseManager.pushNew("ReturnPhase",I)});for(const E of this.getPlayerParty())E.resetBattleAndWaveData(),E.resetTera(),ve("PostBattleInitAbAttr",{pokemon:E}),E.hasSpecies(ye.TERAPAGOS)&&(this.arena.playerTerasUsed=0);this.trainer.visible||this.phaseManager.pushNew("ShowTrainerPhase")}for(const E of this.getPlayerParty())this.triggerPokemonFormChange(E,ST);!this.gameMode.hasRandomBiomes&&!g?this.phaseManager.pushNew("NextEncounterPhase"):(this.phaseManager.pushNew("NewBiomeEncounterPhase"),this.getMaxExpLevel()>y&&this.phaseManager.pushNew("LevelCapPhase"))}return this.currentBattle}newArena(e,t=0){return this.arena=new Qf(e,t),this.eventTarget.dispatchEvent(new ET),this.arenaBg.pipelineData={terrainColorRatio:this.arena.getBgTerrainColorRatioForBiome()},this.arena}updateFieldScale(){return new Promise(e=>{const t=Math.floor(Math.pow(1/this.getField(!0).map(i=>i.getSpriteScale()).reduce((i,n)=>i=Math.max(n,i),0),.7)*40)/40;this.setFieldScale(t).then(()=>e())})}setFieldScale(e,t=!1){return new Promise(i=>{if(e*=6,this.field.scale===e)return i();const n=this.arenaBg.width*6,a=792,r=this.arenaBg.width*e,o=132*e;this.tweens.add({targets:this.field,scale:e,x:(n-r)/2,y:a-o,duration:t?0:ge(Math.abs(this.field.scale-e)*200),ease:"Sine.easeInOut",onComplete:h(()=>i(),"onComplete")})})}getSpeciesFormIndex(e,t,i,n){if(e.forms?.length===0)return 0;const a=this.phaseManager.getCurrentPhase().is("EggLapsePhase")||this.phaseManager.getCurrentPhase().is("EggHatchPhase");if(!a&&this.currentBattle?.battleType===de.TRAINER&&this.currentBattle.trainer!=null&&this.currentBattle.trainer.config.hasSpecialtyType()){if(e.speciesId===ye.WORMADAM)switch(this.currentBattle.trainer.config.specialtyType){case Me.GROUND:return 1;case Me.STEEL:return 2;case Me.GRASS:return 0}if(e.speciesId===ye.ROTOM)switch(this.currentBattle.trainer.config.specialtyType){case Me.FLYING:return 4;case Me.GHOST:return 0;case Me.FIRE:return 1;case Me.GRASS:return 5;case Me.WATER:return 2;case Me.ICE:return 3}if(e.speciesId===ye.ORICORIO)switch(this.currentBattle.trainer.config.specialtyType){case Me.GHOST:return 3;case Me.FIRE:return 0;case Me.ELECTRIC:return 1;case Me.PSYCHIC:return 2}if(e.speciesId===ye.PALDEA_TAUROS)switch(this.currentBattle.trainer.config.specialtyType){case Me.FIRE:return 1;case Me.WATER:return 2}if(e.speciesId===ye.SILVALLY||e.speciesId===ye.ARCEUS)return this.currentBattle.trainer.config.specialtyType}switch(e.speciesId){case ye.UNOWN:case ye.SHELLOS:case ye.GASTRODON:case ye.ROTOM:case ye.BASCULIN:case ye.DEERLING:case ye.SAWSBUCK:case ye.SCATTERBUG:case ye.SPEWPA:case ye.VIVILLON:case ye.FLABEBE:case ye.FLOETTE:case ye.FLORGES:case ye.FURFROU:case ye.PUMPKABOO:case ye.GOURGEIST:case ye.ORICORIO:case ye.MAGEARNA:case ye.ZARUDE:case ye.SQUAWKABILLY:case ye.TATSUGIRI:case ye.PALDEA_TAUROS:return Ke(e.forms.length);case ye.SINISTEA:case ye.POLTEAGEIST:case ye.MAUSHOLD:case ye.DUDUNSPARCE:case ye.POLTCHAGEIST:case ye.SINISTCHA:return Ke(16)?0:1;case ye.PIKACHU:return this.currentBattle?.battleType===de.TRAINER&&this.currentBattle?.waveIndex<30?0:Ke(8);case ye.EEVEE:return this.currentBattle?.battleType===de.TRAINER&&this.currentBattle?.waveIndex<30&&!a?0:Ke(2);case ye.FROAKIE:case ye.FROGADIER:case ye.GRENINJA:return this.currentBattle?.battleType===de.TRAINER&&!a?0:Ke(2);case ye.URSHIFU:return Ke(2);case ye.ZYGARDE:return Ke(4);case ye.MINIOR:return Ke(7);case ye.ALCREMIE:return Ke(9);case ye.MEOWSTIC:case ye.INDEEDEE:case ye.BASCULEGION:case ye.OINKOLOGNE:return t===Ut.FEMALE?1:0;case ye.TOXTRICITY:{const r=[Mt.LONELY,Mt.BOLD,Mt.RELAXED,Mt.TIMID,Mt.SERIOUS,Mt.MODEST,Mt.MILD,Mt.QUIET,Mt.BASHFUL,Mt.CALM,Mt.GENTLE,Mt.CAREFUL];return i!==void 0&&r.indexOf(i)>-1?1:0}case ye.GIMMIGHOUL:return this.gameMode.hasMysteryEncounters&&!a?1:Ke(e.forms.length)}if(n){switch(e.speciesId){case ye.BURMY:case ye.WORMADAM:case ye.LYCANROC:return Ke(e.forms.length)}return 0}return this.arena.getSpeciesFormIndex(e)}getGeneratedOffsetGym(){let e=!1;return this.executeWithSeedOffset(()=>{e=!Ke(2)},0,this.seed.toString()),e}getGeneratedWaveCycleOffset(){let e=0;return this.executeWithSeedOffset(()=>{e=Ke(8)*5},0,this.seed.toString()),e}getEncounterBossSegments(e,t,i,n=!1){if(ie.ENEMY_HEALTH_SEGMENTS_OVERRIDE>1)return ie.ENEMY_HEALTH_SEGMENTS_OVERRIDE;if(ie.ENEMY_HEALTH_SEGMENTS_OVERRIDE===1)return 0;if(this.gameMode.isDaily&&this.gameMode.isWaveFinal(e))return 5;let a;if(n||i&&(i.subLegendary||i.legendary||i.mythical)?a=!0:this.executeWithSeedOffset(()=>{a=e%10===0||this.gameMode.hasRandomBosses&&Ke(100)<Math.min(Math.max(Math.ceil((e-250)/50),0)*2,30)},e<<2),!a)return 0;let r=2;return t>=100&&r++,i&&i.baseTotal>=670&&r++,r+=Math.floor(e/250),r}trySpreadPokerus(){const e=this.getPlayerParty(),t=[],i=h((n,a)=>{const r=e[n+a];!r.pokerus&&!Ke(10)&&(r.pokerus=!0,t.push(n+a))},"spread");e.forEach((n,a)=>{!n.pokerus||t.indexOf(a)>-1||this.executeWithSeedOffset(()=>{a&&i(a,-1),a<e.length-1&&i(a,1)},this.currentBattle.waveIndex+(a<<8))})}resetSeed(e){const t=e??this.currentBattle?.waveIndex??0;this.waveSeed=hf(this.seed,t),Jt.Math.RND.sow([this.waveSeed]),this.waveSeed,this.rngCounter=0}executeWithSeedOffset(e,t,i){if(!e)return;const n=this.rngCounter,a=this.rngOffset,r=this.rngSeedOverride,o=Jt.Math.RND.state();Jt.Math.RND.sow([hf(i||this.seed,t)]),this.rngCounter=0,this.rngOffset=t,this.rngSeedOverride=i||"",e(),Jt.Math.RND.state(o),this.rngCounter=n,this.rngOffset=a,this.rngSeedOverride=r}addFieldSprite(e,t,i,n,a=0){const r=this.add.sprite(e,t,i,n);return r.setPipeline(this.fieldSpritePipeline),a&&(r.pipelineData.terrainColorRatio=a),r}addPokemonSprite(e,t,i,n,a,r=!1,o=!1){const l=this.addFieldSprite(t,i,n,a);return this.initPokemonSprite(l,e,r,o),l}initPokemonSprite(e,t,i=!1,n=!1){return e.setPipeline(this.spritePipeline,{tone:[0,0,0,0],hasShadow:i,ignoreOverride:n,teraColor:t?pi(t.getTeraType()):void 0,isTerastallized:t?t.isTerastallized:!1}),this.spriteSparkleHandler.add(e),e}moveBelowOverlay(e){this.fieldUI.moveBelow(e,this.fieldOverlay)}processInfoButton(e){this.arenaFlyout.toggleFlyout(e)}showFieldOverlay(e){return new Promise(t=>{this.tweens.add({targets:this.fieldOverlay,alpha:.5,ease:"Sine.easeOut",duration:e,onComplete:h(()=>t(),"onComplete")})})}hideFieldOverlay(e){return new Promise(t=>{this.tweens.add({targets:this.fieldOverlay,alpha:0,duration:e,ease:"Cubic.easeIn",onComplete:h(()=>t(),"onComplete")})})}updateShopOverlayOpacity(e){this.shopOverlayOpacity=e,this.shopOverlayShown&&this.shopOverlay.setAlpha(this.shopOverlayOpacity)}showShopOverlay(e){return this.shopOverlayShown=!0,new Promise(t=>{this.tweens.add({targets:this.shopOverlay,alpha:this.shopOverlayOpacity,ease:"Sine.easeOut",duration:e,onComplete:h(()=>t(),"onComplete")})})}hideShopOverlay(e){return this.shopOverlayShown=!1,new Promise(t=>{this.tweens.add({targets:this.shopOverlay,alpha:0,duration:e,ease:"Cubic.easeIn",onComplete:h(()=>t(),"onComplete")})})}showEnemyModifierBar(){this.enemyModifierBar.setVisible(!0)}hideEnemyModifierBar(){this.enemyModifierBar.setVisible(!1)}updateBiomeWaveText(){const e=!(this.currentBattle.waveIndex%10),t=ga(this.arena.biomeType);this.fieldUI.moveAbove(this.biomeWaveText,this.luckText),this.biomeWaveText.setText(t+" - "+this.currentBattle.waveIndex.toString()),this.biomeWaveText.setColor(e?"#f89890":"#ffffff"),this.biomeWaveText.setShadowColor(e?"#984038":"#636363"),this.biomeWaveText.setVisible(!0)}updateMoneyText(e=!0){if(this.money===void 0)return;const t=or(this.moneyFormat,this.money);this.moneyText.setText(f.t("battleScene:moneyOwned",{formattedMoney:t})),this.fieldUI.moveAbove(this.moneyText,this.luckText),e&&this.moneyText.setVisible(!0)}animateMoneyChanged(e){if(this.tweens.getTweensOf(this.moneyText).length>0)return;const t=this.moneyText.scale*.14*(e?1:-1);this.moneyText.setShadowColor(e?"#008000":"#FF0000"),this.tweens.add({targets:this.moneyText,duration:250,scale:this.moneyText.scale+t,loop:0,yoyo:!0,onComplete:h(i=>this.moneyText.setShadowColor(le(O.MONEY,!0)),"onComplete")})}updateScoreText(){this.scoreText.setText(`Score: ${this.score.toString()}`),this.scoreText.setVisible(this.gameMode.isDaily)}updateAndShowText(e){const t=[this.luckLabelText,this.luckText];for(const n of t)n.setAlpha(0);const i=cf(this.getPlayerParty());this.luckText.setText(cg(i)),i<14?this.luckText.setTint(ug(i)):this.luckText.setTint(16772956,4718441,7039999,16738665),this.luckLabelText.setX(this.scaledCanvas.width-2-(this.luckText.displayWidth+2)),this.tweens.add({targets:t,duration:e,alpha:1,onComplete:h(()=>{for(const n of t)n.setVisible(!0)},"onComplete")})}hideLuckText(e){if(this.reroll)return;const t=[this.luckLabelText,this.luckText];this.tweens.add({targets:t,duration:e,alpha:0,onComplete:h(()=>{for(const i of t)i.setVisible(!1)},"onComplete")})}updateUIPositions(){const e=this.enemyModifiers.filter(n=>n.isIconVisible()).length,t=this.biomeWaveText.getBottomLeft().y-this.biomeWaveText.getTopLeft().y;this.biomeWaveText.setY(-this.scaledCanvas.height+(e?e<=12?15:24:0)+t/2),this.moneyText.setY(this.biomeWaveText.y+10),this.scoreText.setY(this.moneyText.y+10),[this.luckLabelText,this.luckText].map(n=>n.setY((this.scoreText.visible?this.scoreText:this.moneyText).y+10));const i=(this.scoreText.visible?this.scoreText:this.moneyText).y+15;this.partyExpBar.setY(i),this.candyBar.setY(i+15),this.ui?.achvBar.setY(this.scaledCanvas.height+i)}sendTextToBack(){this.fieldUI.sendToBack(this.biomeWaveText),this.fieldUI.sendToBack(this.moneyText),this.fieldUI.sendToBack(this.scoreText)}addFaintedEnemyScore(e){let t=e.getSpeciesForm().getBaseExp()*(e.level/this.getMaxExpLevel())*(e.ivs.reduce((i,n)=>n+=i,0)/93*.2+.8);this.findModifiers(i=>i instanceof es&&i.pokemonId===e.id,!1).map(i=>t*=i.getScoreMultiplier()),e.isBoss()&&(t*=Math.sqrt(e.bossSegments)),this.currentBattle.battleScore+=Math.ceil(t)}getMaxExpLevel(e=!1){const t=ie.LEVEL_CAP_OVERRIDE??0;if(t>0)return t;if(e||t<0)return Number.MAX_SAFE_INTEGER;const i=Math.ceil((this.currentBattle?.waveIndex||1)/10)*10,n=this.gameMode.getWaveForDifficulty(i),a=(1+n/2+Math.pow(n/25,2))*1.2;return Math.ceil(a/2)*2+2}randomSpecies(e,t,i,n,a){if(i)return this.arena.randomSpecies(e,t,void 0,cf(this.party));const r=n?[...new Set(it.filter(o=>o.isCatchable()).filter(n).map(o=>{if(!a)for(;Bt.hasOwnProperty(o.speciesId);)o=zt(Bt[o.speciesId]);return o}))]:it.filter(o=>o.isCatchable());return r[Ke(r.length)]}generateRandomBiome(e){const t=e%250,i=ks(Je).filter(c=>c!==Je.TOWN&&c!==Je.END),n=br[Je.END][0]-2,a=new Array(n+1).fill(null).map((c,u)=>(1-Math.min(Math.abs(u/(n-1)-t/250)+.25,1))/.75*250),r=[];let o=0;for(const c of i)o+=Math.ceil(a[br[c][0]-1]/br[c][1]),r.push(o);const l=Ke(o);for(let c=0;c<i.length;c++)if(l<r[c])return i[c];return i[Ke(i.length)]}isBgmPlaying(){return this.bgm?.isPlaying??!1}playBgm(e,t){if(e===void 0&&(e=this.currentBattle?.getBgmOverride()||this.arena?.bgm),e=cs.getEventBgmReplacement(e),this.bgm&&e===this.bgm.key){this.bgm.isPlaying||this.bgm.play({volume:this.masterVolume*this.bgmVolume});return}t&&!this.bgm&&(t=!1),this.bgmCache.add(e),this.loadBgm(e);let i=0;i=e===this.arena.bgm?this.arena.getBgmLoopPoint():this.getBgmLoopPoint(e);let n=!1;const a=h(()=>{if(this.ui.bgmBar.setBgmToBgmBar(e),e===null&&this.bgm&&!this.bgm.pendingRemove){this.bgm.play({volume:this.masterVolume*this.bgmVolume});return}this.bgm&&!this.bgm.pendingRemove&&this.bgm.isPlaying&&this.bgm.stop(),this.bgm=this.sound.add(e,{loop:!0}),this.bgm.play({volume:this.masterVolume*this.bgmVolume}),i&&this.bgm.on("looped",()=>this.bgm.play({seek:i}))},"playNewBgm");if(this.load.once(Jt.Loader.Events.COMPLETE,()=>{n=!0,(!t||!this.bgm.isPlaying)&&a()}),t){const r=h(()=>{n&&(!this.bgm.isPlaying||this.bgm.pendingRemove)&&a()},"onBgmFaded");this.time.delayedCall(this.fadeOutBgm(500,!0)?750:250,r)}this.load.isLoading()||this.load.start()}pauseBgm(){return this.bgm&&!this.bgm.pendingRemove&&this.bgm.isPlaying?(this.bgm.pause(),!0):!1}resumeBgm(){return this.bgm&&!this.bgm.pendingRemove&&this.bgm.isPaused?(this.bgm.resume(),!0):!1}updateSoundVolume(){if(this.sound)for(const e of this.sound.getAllPlaying())if(this.bgmCache.has(e.key))e.setVolume(this.masterVolume*this.bgmVolume);else{const t=e.key.split("/");switch(t[0]){case"battle_anims":case"cry":t[1].startsWith("PRSFX- ")?e.setVolume(this.masterVolume*this.fieldVolume*.5):e.setVolume(this.masterVolume*this.fieldVolume);break;case"se":case"ui":e.setVolume(this.masterVolume*this.seVolume)}}}fadeOutBgm(e=500,t=!0){return this.bgm&&this.sound.getAllPlaying().find(n=>n.key===this.bgm.key)?(Ds.fadeOut(this,this.bgm,e,t),!0):!1}fadeAndSwitchBgm(e,t=!1,i=2e3){this.fadeOutBgm(i,t),this.time.delayedCall(i,()=>{this.playBgm(e)})}playSound(e,t){const i=typeof e=="string"?e:e.key;t=t??{};try{const n=i.split("/");switch(t.volume=t.volume??1,n[0]){case"level_up_fanfare":case"item_fanfare":case"minor_fanfare":case"heal":case"evolution":case"evolution_fanfare":t.volume*=this.masterVolume*this.bgmVolume;break;case"battle_anims":case"cry":t.volume*=this.masterVolume*this.fieldVolume,n[1].startsWith("PRSFX- ")&&(t.volume*=.5);break;case"ui":t.volume*=this.masterVolume*this.uiVolume;break;case"se":t.volume*=this.masterVolume*this.seVolume;break}return this.sound.play(i,t),this.sound.get(i)}catch{return console.warn(`${i} not found`),null}}playSoundWithoutBgm(e,t){this.bgmCache.add(e);const i=this.pauseBgm();this.playSound(e);const n=this.sound.get(e);return n&&(this.bgmResumeTimer&&this.bgmResumeTimer.destroy(),i&&(this.bgmResumeTimer=this.time.delayedCall(t||ge(n.totalDuration*1e3),()=>{this.resumeBgm(),this.bgmResumeTimer=null})),n)}getBgmLoopPoint(e){switch(e){case"title":return 46.5;case"winter_title":return 20.57;case"battle_kanto_champion":return 13.95;case"battle_johto_champion":return 23.498;case"battle_hoenn_champion_g5":return 11.328;case"battle_hoenn_champion_g6":return 11.762;case"battle_sinnoh_champion":return 12.235;case"battle_champion_alder":return 27.653;case"battle_champion_iris":return 10.145;case"battle_kalos_champion":return 10.38;case"battle_champion_kukui":return 15.784;case"battle_alola_champion":return 13.025;case"battle_galar_champion":return 61.635;case"battle_mustard":return 22.442;case"battle_champion_geeta":return 37.447;case"battle_champion_nemona":return 14.914;case"battle_champion_kieran":return 7.206;case"battle_hoenn_elite":return 11.35;case"battle_unova_elite":return 17.73;case"battle_kalos_elite":return 12.34;case"battle_alola_elite":return 19.212;case"battle_galar_elite":return 164.069;case"battle_paldea_elite":return 12.77;case"battle_bb_elite":return 19.434;case"battle_final_encounter":return 19.159;case"battle_final":return 16.453;case"battle_kanto_gym":return 13.857;case"battle_johto_gym":return 12.911;case"battle_hoenn_gym":return 12.379;case"battle_sinnoh_gym":return 13.122;case"battle_unova_gym":return 19.145;case"battle_kalos_gym":return 44.81;case"battle_galar_gym":return 171.262;case"battle_paldea_gym":return 127.489;case"battle_legendary_kanto":return 32.966;case"battle_legendary_raikou":return 12.632;case"battle_legendary_entei":return 2.905;case"battle_legendary_suicune":return 12.636;case"battle_legendary_lugia":return 19.77;case"battle_legendary_ho_oh":return 17.668;case"battle_legendary_regis_g5":return 49.5;case"battle_legendary_regis_g6":return 21.13;case"battle_legendary_gro_kyo":return 10.547;case"battle_legendary_rayquaza":return 10.495;case"battle_legendary_deoxys":return 13.333;case"battle_legendary_lake_trio":return 16.887;case"battle_legendary_sinnoh":return 22.77;case"battle_legendary_dia_pal":return 16.009;case"battle_legendary_origin_forme":return 18.961;case"battle_legendary_giratina":return 10.451;case"battle_legendary_arceus":return 9.595;case"battle_legendary_unova":return 13.855;case"battle_legendary_kyurem":return 18.314;case"battle_legendary_res_zek":return 18.329;case"battle_legendary_xern_yvel":return 26.468;case"battle_legendary_tapu":return 0;case"battle_legendary_sol_lun":return 6.525;case"battle_legendary_ub":return 9.818;case"battle_legendary_dusk_dawn":return 5.211;case"battle_legendary_ultra_nec":return 10.344;case"battle_legendary_zac_zam":return 11.424;case"battle_legendary_eternatus_p1":return 11.102;case"battle_legendary_eternatus_p2":return 0;case"battle_legendary_glas_spec":return 12.503;case"battle_legendary_calyrex":return 50.641;case"battle_legendary_riders":return 18.155;case"battle_legendary_birds_galar":return .175;case"battle_legendary_ruinous":return 6.333;case"battle_legendary_kor_mir":return 6.442;case"battle_legendary_loyal_three":return 6.5;case"battle_legendary_ogerpon":return 14.335;case"battle_legendary_terapagos":return 24.377;case"battle_legendary_pecharunt":return 6.508;case"battle_rival":return 14.11;case"battle_rival_2":return 17.714;case"battle_rival_3":return 17.586;case"battle_trainer":return 13.686;case"battle_wild":return 12.703;case"battle_wild_strong":return 13.94;case"end_summit":return 30.025;case"battle_rocket_grunt":return 12.707;case"battle_aqua_magma_grunt":return 12.062;case"battle_galactic_grunt":return 13.043;case"battle_plasma_grunt":return 14.758;case"battle_flare_grunt":return 4.228;case"battle_aether_grunt":return 16;case"battle_skull_grunt":return 20.87;case"battle_macro_grunt":return 11.56;case"battle_star_grunt":return 133.362;case"battle_galactic_admin":return 11.997;case"battle_colress":return 12.234;case"battle_skull_admin":return 15.463;case"battle_oleana":return 14.11;case"battle_star_admin":return 9.493;case"battle_rocket_boss":return 9.115;case"battle_aqua_magma_boss":return 14.847;case"battle_galactic_boss":return 106.962;case"battle_plasma_boss":return 25.624;case"battle_flare_boss":return 8.085;case"battle_aether_boss":return 11.33;case"battle_skull_boss":return 13.13;case"battle_macro_boss":return 11.42;case"battle_star_boss":return 25.764;case"mystery_encounter_gen_5_gts":return 8.52;case"mystery_encounter_gen_6_gts":return 9.24;case"mystery_encounter_fun_and_games":return 4.78;case"mystery_encounter_weird_dream":return 41.42;case"mystery_encounter_delibirdy":return 82.28;case"title_afd":return 47.66;case"battle_rival_3_afd":return 49.147}return 0}toggleInvert(e){e?this.cameras.main.setPostPipeline(qT):this.cameras.main.removePostPipeline("InvertPostFX")}addMoney(e){this.money=Math.min(this.money+e,Number.MAX_SAFE_INTEGER),this.updateMoneyText(),this.animateMoneyChanged(!0),this.validateAchvs(bT)}getWaveMoneyAmount(e){const t=this.currentBattle.waveIndex,i=Math.ceil(t/10)-1,n=Math.pow((i+1+(.75+((t-1)%10+1)/10))*100,1+.005*i)*e;return Math.floor(n/10)*10}addModifier(e,t,i,n,a,r){if(!e||!e.type)return!1;let o=!1;const l=e.type.soundName;this.validateAchvs(IT,e);const c=[];if(e instanceof oa){if(e.add(this.modifiers,!!n)){if(e instanceof jn){const u=this.getPokemonById(e.pokemonId);u&&(o=e.apply(u,!0))}i&&!this.sound.get(l)&&this.playSound(l)}else if(!n){const u=vT(e.type.tier);return this.phaseManager.queueMessage(f.t("battle:itemStackFull",{fullItemName:e.type.name,itemName:u.name}),void 0,!1,3e3),this.addModifier(u.newModifier(),t,i,!1,a)}for(const u of c)this.removeModifier(u);!t&&!n&&this.updateModifiers(!0,a)}else if(e instanceof OT)if(i&&!this.sound.get(l)&&this.playSound(l),e instanceof AT){for(const u in this.party){const p=this.party[u],m=[];if(e instanceof xT)if(e.fainted)m.push(1);else{const d=new ct(1);this.applyModifiers(ng,!0,d),m.push(d.value)}else e instanceof _T?m.push(this.getPokemonById(e.fusePokemonId)):e instanceof wT&&r!=null&&m.push(r);if(e.shouldApply(p,...m)){const d=e.apply(p,...m);o||=d}}this.party.forEach(u=>{u.updateInfo(a)})}else{const u=[this];if(e.shouldApply(...u)){const p=e.apply(...u);o||=p}}return o}addEnemyModifier(e,t,i){return new Promise(n=>{const a=[];if(e.add(this.enemyModifiers,!1)){if(e instanceof jn){const r=this.getPokemonById(e.pokemonId);r&&e.apply(r,!0)}for(const r of a)this.removeModifier(r,!0)}t||this.updateModifiers(!1,i),n()})}tryTransferHeldItemModifier(e,t,i,n=1,a,r,o=!0){const l=e.pokemonId?e.getPokemon():null,c=new ft(!1);if(l&&l.isPlayer()!==t.isPlayer()&&ve("BlockItemTheftAbAttr",{pokemon:l,cancelled:c}),c.value)return!1;const u=e.clone();u.pokemonId=t.id;const p=this.findModifier(d=>d instanceof es&&d.matchType(e)&&d.pokemonId===t.id,t.isPlayer());if(p){const d=p.getMaxStackCount();if(p.stackCount>=d)return!1;const y=Math.min(n,e.stackCount,d-p.stackCount);e.stackCount-=y,u.stackCount=p.stackCount+y}else{const d=Math.min(n,e.stackCount);e.stackCount-=d,u.stackCount=d}if(!(e.stackCount===0)||!l||this.removeModifier(e,l.isEnemy())){const d=h(()=>!p||this.removeModifier(p,t.isEnemy())?t.isPlayer()?(this.addModifier(u,r,i,!1,a),l&&o&&ve("PostItemLostAbAttr",{pokemon:l}),!0):(this.addEnemyModifier(u,r,a),l&&o&&ve("PostItemLostAbAttr",{pokemon:l}),!0):!1,"addModifier");return l&&l.isPlayer()!==t.isPlayer()&&!r&&this.updateModifiers(l.isPlayer(),a),d(),!0}return!1}tryDiscardHeldItemModifier(e,t=1){const i=Math.min(t,e.stackCount);return e.stackCount-=i,e.stackCount>0?!0:this.removeModifier(e)}canTransferHeldItemModifier(e,t,i=1){const n=e.clone(),a=n.pokemonId?n.getPokemon():null,r=new ft(!1);if(a&&a.isPlayer()!==t.isPlayer()&&ve("BlockItemTheftAbAttr",{pokemon:a,cancelled:r}),r.value)return!1;const o=this.findModifier(c=>c instanceof es&&c.matchType(n)&&c.pokemonId===t.id,t.isPlayer());if(o){const c=o.getMaxStackCount();if(o.stackCount>=c)return!1;const u=Math.min(i,n.stackCount,c-o.stackCount);n.stackCount-=u}else{const c=Math.min(i,n.stackCount);n.stackCount-=c}return!(n.stackCount===0)||!a||this.hasModifier(e,!a.isPlayer())}removePartyMemberModifiers(e){return new Promise(t=>{const i=this.getPlayerParty()[e].id,n=this.modifiers.filter(a=>a instanceof es&&a.pokemonId===i);for(const a of n)this.modifiers.splice(this.modifiers.indexOf(a),1);this.updateModifiers(),t()})}generateEnemyModifiers(e){return new Promise(t=>{if(this.currentBattle.battleSpec===Xt.FINAL_BOSS)return t();const i=this.gameMode.getWaveForDifficulty(this.currentBattle.waveIndex),n=this.gameMode.isWaveFinal(this.currentBattle.waveIndex);let a=Math.ceil(i/10);n&&(a=Math.ceil(a*2.5));const r=this.getEnemyParty();if(this.currentBattle.trainer){const o=this.currentBattle.trainer.genModifiers(r);for(const l of o)this.addEnemyModifier(l,!0,!0)}r.forEach((o,l)=>{if(e&&l<e.length&&e[l])for(const c of e[l]){let u;c.modifier instanceof MT?u=c.modifier.newModifier(o):(u=c.modifier,u.pokemonId=o.id),u.stackCount=c.stackCount??1,u.isTransferable=c.isTransferable??u.isTransferable,this.addEnemyModifier(u,!0)}else{const c=o.isBoss()||this.currentBattle.battleType===de.TRAINER&&!!this.currentBattle.trainer?.config.isBoss;let u=32;c&&(u/=2),n&&(u/=8);let p=0;for(let m=0;m<a;m++)Ke(this.gameMode.getEnemyModifierChance(c))||p++;c&&(p=Math.max(p,Math.floor(a/2))),kT(i,p,[o],this.currentBattle.battleType===de.TRAINER?ei.TRAINER:ei.WILD,u).map(m=>m.newModifier(o).add(this.enemyModifiers,!1))}return!0}),this.updateModifiers(!1),t()})}clearEnemyModifiers(){const e=this.enemyModifiers.filter(t=>t instanceof oa);for(const t of e)this.enemyModifiers.splice(this.enemyModifiers.indexOf(t),1);this.updateModifiers(!1),this.updateUIPositions()}clearEnemyHeldItemModifiers(e){const t=this.enemyModifiers.filter(i=>i instanceof es&&(!e||i.getPokemon()===e));for(const i of t)this.enemyModifiers.splice(this.enemyModifiers.indexOf(i),1);this.updateModifiers(!1),this.updateUIPositions()}setModifiersVisible(e){[this.modifierBar,this.enemyModifierBar].map(t=>t.setVisible(e))}updateModifiers(e=!0,t){const i=e?this.modifiers:this.enemyModifiers;for(let a=0;a<i.length;a++){const r=i[a];r instanceof es&&!this.getPokemonById(r.pokemonId)&&i.splice(a--,1),r instanceof es&&r.getSpecies()!=null&&!this.getPokemonById(r.pokemonId)?.hasSpecies(r.getSpecies())&&i.splice(a--,1)}for(const a of i)a instanceof oa&&(a.virtualStackCount=0);const n=i.slice(0);for(const a of n)a.getStackCount()||i.splice(i.indexOf(a),1);this.updatePartyForModifiers(e?this.getPlayerParty():this.getEnemyParty(),t),(e?this.modifierBar:this.enemyModifierBar).updateModifiers(i),e||this.updateUIPositions()}updatePartyForModifiers(e,t){return new Promise(i=>{Promise.allSettled(e.map(n=>(n.calculateStats(),n.updateInfo(t)))).then(()=>i())})}hasModifier(e,t=!1){return(t?this.enemyModifiers:this.modifiers).indexOf(e)>-1}removeModifier(e,t=!1){const i=t?this.enemyModifiers:this.modifiers,n=i.indexOf(e);if(n>-1){if(i.splice(n,1),e instanceof jn){const a=this.getPokemonById(e.pokemonId);a&&e.apply(a,!1)}return!0}return!1}getModifiers(e,t=!0){return(t?this.modifiers:this.enemyModifiers).filter(i=>i instanceof e)}findModifiers(e,t=!0){return(t?this.modifiers:this.enemyModifiers).filter(e)}findModifier(e,t=!0){return(t?this.modifiers:this.enemyModifiers).find(e)}applyShuffledModifiers(e,t=!0,...i){let n=(t?this.modifiers:this.enemyModifiers).filter(a=>a instanceof e&&a.shouldApply(...i));return this.executeWithSeedOffset(()=>{const a=h(r=>{if(r.length===0)return r;const o=Ke(r.length);return[r[o],...a(r.filter((l,c)=>c!==o))]},"shuffleModifiers");n=a(n)},this.currentBattle.turn<<4,this.waveSeed),this.applyModifiersInternal(n,t,i)}applyModifiers(e,t=!0,...i){const n=(t?this.modifiers:this.enemyModifiers).filter(a=>a instanceof e&&a.shouldApply(...i));return this.applyModifiersInternal(n,t,i)}applyModifiersInternal(e,t,i){const n=[];for(const a of e)a.apply(...i)&&(a.type.name,n.push(a));return n}applyModifier(e,t=!0,...i){const n=(t?this.modifiers:this.enemyModifiers).filter(a=>a instanceof e&&a.shouldApply(...i));for(const a of n)if(a.apply(...i))return a.type.name,a;return null}triggerPokemonFormChange(e,t,i=!1,n=!1){if(fi.hasOwnProperty(e.species.speciesId)){const a=fi[e.species.speciesId].filter(o=>o.findTrigger(t)&&o.canChange(e));let r;if(e.species.speciesId===ye.NECROZMA&&a.length>1){const o=this.findModifiers(l=>l instanceof jn&&l.pokemonId===e.id).filter(l=>l.active).map(l=>l.formChangeItem);r=o.includes(uf.N_LUNARIZER)?a[0]:o.includes(uf.N_SOLARIZER)?a[1]:null}else r=a[0];if(r){let o;return e.isPlayer()&&!r.quiet?o=this.phaseManager.create("FormChangePhase",e,r,n):o=this.phaseManager.create("QuietFormChangePhase",e,r),e.isPlayer()&&!r.quiet&&n?this.phaseManager.overridePhase(o):i?this.phaseManager.pushPhase(o):this.phaseManager.unshiftPhase(o),!0}}return!1}triggerPokemonBattleAnim(e,t,i,n=!1){const a=this.phaseManager,r=a.create("PokemonAnimPhase",t,e,i);return n?a.pushPhase(r):a.unshiftPhase(r),!0}validateAchvs(e,...t){const i=Object.values(Fe).filter(n=>n instanceof e);for(const n of i)this.validateAchv(n,t)}validateAchv(e,t){return(!this.gameData.achvUnlocks.hasOwnProperty(e.id)||ie.ACHIEVEMENTS_REUNLOCK_OVERRIDE)&&e.validate(t)?(this.gameData.achvUnlocks[e.id]=Date.now(),this.ui.achvBar.showAchv(e),Yt.hasOwnProperty(e.id)&&this.validateVoucher(Yt[e.id]),!0):!1}validateVoucher(e,t){return!this.gameData.voucherUnlocks.hasOwnProperty(e.id)&&e.validate(t)?(this.gameData.voucherUnlocks[e.id]=Date.now(),this.ui.achvBar.showAchv(e),this.gameData.voucherCounts[e.voucherType]++,!0):!1}updateGameInfo(){const e={playTime:this.sessionPlayTime??0,gameMode:this.currentBattle?this.gameMode.getName():"Title",biome:this.currentBattle?ga(this.arena.biomeType):"",wave:this.currentBattle?.waveIndex??0,party:this.party?.map(t=>({name:t.name,form:t.getFormKey(),types:t.getTypes().map(i=>Me[i]),teraType:Me[t.getTeraType()],isTerastallized:t.isTerastallized,level:t.level,currentHP:t.hp,maxHP:t.getMaxHp(),status:t.status?.effect?lt[t.status.effect]:""}))??[],modeChain:this.ui?.getModeChain()??[]};window.gameInfo=e}getActiveKeys(){const e=[];let t=this.getPlayerParty();t=t.concat(this.getEnemyParty());for(const i of t)e.push(i.getSpriteKey(!0)),i.isPlayer()&&e.push(i.getBattleSpriteKey(!0,!0)),e.push(i.species.getCryKey(i.formIndex)),i.fusionSpecies&&e.push(i.fusionSpecies.getCryKey(i.fusionFormIndex));return e}initFinalBossPhaseTwo(e){if(e.isEnemy()&&e.isBoss()&&!e.formIndex&&e.bossSegmentIndex<1){this.fadeOutBgm(ge(2e3),!1),this.ui.showDialogue(qf[Xt.FINAL_BOSS].firstStageWin,e.species.name,void 0,()=>{const t=Zf(ze.MINI_BLACK_HOLE).newModifier(e);t.setTransferrableFalse(),this.addEnemyModifier(t,!1,!0),e.generateAndPopulateMoveset(1),this.setFieldScale(.75),this.triggerPokemonFormChange(e,NT,!1),this.currentBattle.double=!0;const i=this.getPlayerParty().filter(n=>n.isAllowedInBattle());i.length>1&&(this.phaseManager.pushNew("ToggleDoublePositionPhase",!0),i[1].isOnField()||(this.phaseManager.pushNew("SummonPhase",1),this.phaseManager.pushNew("PostSummonPhase",1))),this.phaseManager.shiftPhase()});return}this.phaseManager.shiftPhase()}applyPartyExp(e,t,i,n){const a=n??this.currentBattle.playerParticipantIds,r=this.getPlayerParty(),o=this.findModifier(d=>d instanceof PT),l=this.findModifier(d=>d instanceof RT),c=this.findModifier(d=>d instanceof BT),u=r.filter(d=>d.hp),p=u.filter(d=>d.level<this.getMaxExpLevel()),m=[];if(i&&(e=Math.floor(e*this.currentBattle.waveIndex/5+1)),a.size>0){this.currentBattle.battleType===de.TRAINER||this.currentBattle.mysteryEncounter?.encounterMode===ms.TRAINER_BATTLE?e=Math.floor(e*1.5):this.currentBattle.isBattleMysteryEncounter()&&this.currentBattle.mysteryEncounter&&(e=Math.floor(e*this.currentBattle.mysteryEncounter.expMultiplier));for(const d of u){const y=d.id,g=a.has(y);if(g&&t){d.addFriendship(LT);const I=d.getHeldItems().find(A=>A instanceof DT);I&&I.stackCount<I.getMaxStackCount()&&(I.stackCount++,this.updateModifiers(!0,!0),d.updateInfo())}if(!p.includes(d))continue;if(!g&&!o){m.push(0);continue}let C=0;g?(C+=1/a.size,a.size>1&&c&&(C+=c.getStackCount()*.2)):o&&(C+=o.getStackCount()*.2/a.size),d.pokerus&&(C*=1.5),ie.XP_MULTIPLIER_OVERRIDE!==null&&(C=ie.XP_MULTIPLIER_OVERRIDE);const E=new ct(e*C);this.applyModifiers(FT,!0,d,E),m.push(Math.floor(E.value))}if(l){let d=0,y=0;p.forEach((I,A)=>{y+=m[A],d+=I.level});const g=Math.floor(d/p.length),C=[];p.forEach((I,A)=>{I.level<=g&&C.push(A)});const E=Math.floor(y/C.length);p.forEach((I,A)=>{m[A]=Jt.Math.Linear(m[A],C.indexOf(A)>-1?E:0,.2*l.getStackCount())})}for(let d=0;d<p.length;d++){const y=m[d];if(y){const g=r.indexOf(p[d]);this.phaseManager.unshiftPhase(p[d].isOnField()?this.phaseManager.create("ExpPhase",g,y):this.phaseManager.create("ShowPartyExpBarPhase",g,y))}}}}isMysteryEncounterValidForWave(e,t){const[i,n]=this.gameMode.getMysteryEncounterLegalWaves();return this.gameMode.hasMysteryEncounters&&e===de.WILD&&!this.gameMode.isBoss(t)&&t%10!==1&&t<n&&t>i}isWaveMysteryEncounter(e,t){const[i,n]=this.gameMode.getMysteryEncounterLegalWaves();if(this.isMysteryEncounterValidForWave(e,t)){const a=this.mysteryEncounterSaveData.encounterSpawnChance,r=this.mysteryEncounterSaveData.encounteredEvents,l=HT/(n-i)*(t-i)-r.length,c=a+Math.min(l*WT,Ir/2),u=ie.MYSTERY_ENCOUNTER_RATE_OVERRIDE??c;if(r.length===0||t-r.at(-1).waveIndex>3||ie.MYSTERY_ENCOUNTER_RATE_OVERRIDE!==null){let m=Ir;return this.executeWithSeedOffset(()=>{m=Ke(Ir)},t*3*1e3),m<u}}return!1}getMysteryEncounter(e,t){let i;if(ie.MYSTERY_ENCOUNTER_OVERRIDE!=null&&js.hasOwnProperty(ie.MYSTERY_ENCOUNTER_OVERRIDE)){if(i=js[ie.MYSTERY_ENCOUNTER_OVERRIDE],t)return i}else{if(t)return i=js[e??-1],i;i=e!=null?js[e]:null}if(!i&&this.mysteryEncounterSaveData?.queuedEncounters&&this.mysteryEncounterSaveData.queuedEncounters.length>0){let g=0;for(;g<this.mysteryEncounterSaveData.queuedEncounters.length&&i;){const C=this.mysteryEncounterSaveData.queuedEncounters[g],E=C.spawnPercent;Ke(100)<E&&(i=js[C.type]),g++}}if(i)return i=new df(i),i.populateDialogueTokensFromRequirements(),i;const n=[St.COMMON,St.GREAT,St.ULTRA,St.ROGUE];for(const g of this.mysteryEncounterSaveData.encounteredEvents)g.tier===St.COMMON?n[0]-=6:g.tier===St.GREAT&&(n[1]-=4);const a=n.reduce((g,C)=>g+C),r=Ke(a),o=a-n[0],l=a-n[0]-n[1],c=a-n[0]-n[1]-n[2];let u=r>o?St.COMMON:r>l?St.GREAT:r>c?St.ULTRA:St.ROGUE;ie.MYSTERY_ENCOUNTER_TIER_OVERRIDE!=null&&(u=ie.MYSTERY_ENCOUNTER_TIER_OVERRIDE);let p=[];const m=this.mysteryEncounterSaveData.encounteredEvents.at(-1)?.type??null,d=cs.getEventMysteryEncountersDisabled(),y=UT.get(this.arena.biomeType)?.filter(g=>!d.includes(g))??[];for(;p.length===0&&u!==null;)p=y.filter(g=>{const C=js[g];if(!C||cs.getMysteryEncounterTierForEvent(g,C.encounterTier)!==u)return!1;const E=C.disallowedGameModes;return E&&E.length>0&&E.includes(this.gameMode.modeId)||C.disallowedChallenges?.some(I=>this.gameMode.hasChallenge(I))||!C.meetsRequirements()||m!==null&&g===m?!1:!(this.mysteryEncounterSaveData.encounteredEvents.length>0&&C.maxAllowedEncounters&&C.maxAllowedEncounters>0&&this.mysteryEncounterSaveData.encounteredEvents.filter(I=>I.type===g).length>=C.maxAllowedEncounters)}).map(g=>js[g]),u===St.ROGUE?u=St.ULTRA:u===St.ULTRA?u=St.GREAT:u===St.GREAT?u=St.COMMON:u=null;return p.length===0?js[VT.MYSTERIOUS_CHALLENGERS]:(i=p[Ke(p.length)],i=new df(i),i.populateDialogueTokensFromRequirements(),i)}};h(Up,"BattleScene");let Vf=Up;export{Vf as BattleScene};
